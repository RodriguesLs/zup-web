function NotificationService(a){function b(b){return b=_.extend({},b),a.all("notifications").withHttpConfig({treatingErrors:!0}).customGET(null,b).then(function(a){return a.data.notifications=_.map(a.data.notifications,function(a){return a.description=e(a.description),a}),a.data})}function c(){return a.all("notifications").withHttpConfig({treatingErrors:!0}).customPUT(null,"read-all")}function d(b){return a.one("notifications",b).withHttpConfig({treatingErrors:!0}).remove()}function e(a){return a.replace(/@\[(.*):(.*)\]/,function(a,b,c){return c})}return{getAll:b,markAllRead:c,"delete":d}}function NotificationsCenterComponent(){function a(a,b,c,d,e,f){function g(){l()}function h(){0!=n.unreadCount&&d.markAllRead().then(function(){n.unreadCount=0})}function i(a){return d["delete"](a.id).then(function(){var b=n.notifications.indexOf(a);n.notifications.splice(b,1)})}function j(a){var c={chat_room:"chat-rooms.show","case":"cases.edit"},d=m(c,"notificable",a);b.go(d.name,{id:d.id})}function k(){n.highlightNotificationBar=!0,f(function(){n.highlightNotificationBar=!1},1e3)}function l(){n.loading=!0,d.getAll().then(function(a){n.loading=!1,n.notifications=a.notifications,n.unreadCount=a.unread_count||0,n.unreadCount>n.lastHighlightedNotificationCount&&(n.lastHighlightedNotificationCount=n.unreadCount,k())})}function m(a,b,c){var d=b+"_id",e=b+"_type",f=a[c[e]];return f=_.isObject(f)?m(f.states,f.attr,c[b]):{name:f,id:c[d]}}var n=this;n.notifications=[],n.loading=!1,n.lastHighlightedNotificationCount=0,n.onClickNotification=j,n.onDeleteNotification=i,n.onShownNotifications=h,a.$on("$stateChangeStart",function(a){c.close()}),e(function(){n.loading||l()},5e3),g()}return a.$inject=["$rootScope","$state","Popup","NotificationService","$interval","$timeout"],{restrict:"E",templateUrl:"components/notifications-center/notifications-center.template.html",scope:{},controller:a,controllerAs:"component"}}function NotificationComponent(){return{restrict:"E",templateUrl:"components/notifications-center/notification.template.html",scope:{notification:"=",deleteHandler:"&",clickHandler:"&"},controller:["$scope",function(a){a.getIconClass=function(a){var b={chat_message:"fa fa-comment","case":"fa fa-file"};return b[a.notificable_type]||""}}]}}function CubesViewer(){this.version="2.0.2",this.VIEW_STATE_INITIALIZING=1,this.VIEW_STATE_INITIALIZED=2,this.VIEW_STATE_ERROR=3,this._configure=function(a){$(".cv-version").html(cubesviewer.version),angular.module("cv").constant("cvOptions",a)},this.init=function(a){this._configure(a),angular.element(document).ready(function(){angular.bootstrap(document,["cv"])})},this.createView=function(a,b,c){var d=angular.element(document).injector().get("$compile"),e=angular.element(document).injector().get("viewsService"),f=e.createView("cube",c),g='<div class="cv-bootstrap"><div cv-view-cube view="view"></div></div>';$(a).first().html(g);var h=angular.element(document).scope().$root,i=h.$new();return i.view=f,d($(a).first().contents())(i),f},this.apply=function(a){angular.element(document).scope()?angular.element(document).scope().$apply(a):(console.debug("Delaying"),setTimeout(function(){cubesviewer.apply(a)},1e3))}}function cubesviewerViewCubeDynamicChart(){this.onViewDraw=function(a,b){$(".cv-view-series-horizontal-menu",$(b.container)).remove(),$(".cv-view-series-horizontal-info",$(b.container)).parents(".infopiece").remove()},this.loadData=function(a){var b=this.cubesviewer.views.cube.buildQueryParams(a,!1,!1);$("#"+a.id).find(".cv-view-viewdata").empty().append('<h3>Dynamic Chart</h3><span class="ajaxloader" title="Loading...">  Loading</span>'),$.get(a.cubesviewer.options.cubesUrl+"/cube/"+a.cube.name+"/aggregate",b,a.cubesviewer.views.cube.dynamicchart._loadDataCallback(a),"json")}}function CubesViewerStudio(){this._configure=function(a){cubesviewer._configure(a)},this.init=function(a){this._configure(a),angular.element(document).ready(function(){angular.bootstrap(document,["cv.studio"])})}}angular&&!angular.merge&&(angular.merge=function(){function a(a,b){b?a.$$hashKey=b:delete a.$$hashKey}function b(c,d,e){for(var f=c.$$hashKey,g=0,h=d.length;g<h;++g){var i=d[g];if(angular.isObject(i)||angular.isFunction(i))for(var j=Object.keys(i),k=0,l=j.length;k<l;k++){var m=j[k],n=i[m];e&&angular.isObject(n)?angular.isDate(n)?c[m]=new Date(n.valueOf()):(angular.isObject(c[m])||(c[m]=angular.isArray(n)?[]:{}),b(c[m],[n],!0)):c[m]=n}}return a(c,f),c}return function(a){return b(a,[].slice.call(arguments,1),!0)}}()),angular.module("zupPainelApp",["ngCookies","ngAnimate","ngSanitize","ngStorage","ngRaven","ui.router","angularMoment","ui.bootstrap","ui.autocomplete","ui.sortable","ui.select2","ui.select","ui.mask","restangular","infinite-scroll","lrInfiniteScroll","angularFileUpload","colorpicker.module","frapontillo.bootstrap-switch","monospaced.elastic","angularPromiseButtons","ui.sortable","dibari.angular-ellipsis","rt.popup","pascalprecht.translate","AuthorizationProviderModule","AuthServiceModule","UserServiceModule","FullResponseRestangularServiceModule","ErrorServiceModule","ConfirmDialogDirectiveModule","monospaced.elastic","ZupChatDirectiveModule","ReturnFieldsModule","ApiTranslationsLoaderModule","NavItemComponentModule","DetectScrollTopComponentModule","ZupTranscludeComponentModule","NotificationsCenterComponentModule","NamespaceSelectorModule","config","IndexModule","UserModule","ReportsModule","ItemsModule","ConfigModule","UsersModule","GroupsModule","HelpModule","FlowsModule","CasesModule","BusinessReportsModule","ServicesModule","ChatRoomsModule"]),angular.module("ngLocale",[],["$provide",function(a){var b={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};a.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["domingo","segunda-feira","terça-feira","quarta-feira","quinta-feira","sexta-feira","sábado"],MONTH:["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],SHORTDAY:["dom","seg","ter","qua","qui","sex","sáb"],SHORTMONTH:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],fullDate:"EEEE, d 'de' MMMM 'de' y",longDate:"d 'de' MMMM 'de' y",medium:"dd/MM/yyyy HH:mm:ss",mediumDate:"dd/MM/yyyy",mediumTime:"HH:mm:ss","short":"dd/MM/yy HH:mm",shortDate:"dd/MM/yy",shortTime:"HH:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"R$",DECIMAL_SEP:",",GROUP_SEP:".",PATTERNS:[{gSize:3,lgSize:3,macFrac:0,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,macFrac:0,maxFrac:2,minFrac:2,minInt:1,negPre:"(¤",negSuf:")",posPre:"¤",posSuf:""}]},id:"pt-br",pluralCat:function(a){return 1==a?b.ONE:b.OTHER}})}]),angular.module("zupPainelApp").config(["$urlRouterProvider","RestangularProvider","ENV","uiSelectConfig","$tooltipProvider","$provide","$translateProvider",function(a,b,c,d,e,f,g){a.otherwise("/"),b.setBaseUrl(c.apiEndpoint),b.setFullResponse(!0),b.addResponseInterceptor(function(a,b){if("getList"===b&&angular.isArray(a)){var c={};return c.data=a,c}return a}),d.theme="bootstrap",e.options({appendToBody:!0}),$.fn.bootstrapSwitch.defaults.onText="Sim",$.fn.bootstrapSwitch.defaults.offText="Não",f.decorator("GridOptions",["$delegate","i18nService",function(a,b){var c;return c=angular.copy(a),c.initialize=function(b){var c;return c=a.initialize(b)},b.setCurrentLang("pt-br"),c}]),f.decorator("ngModelDirective",["$delegate",function(a){var b=a[0],c=b.controller;return b.controller=["$scope","$element","$attrs","$injector",function(a,b,d,e){var f=e.get("$interpolate");d.$set("name",f(d.name||"")(a)),e.invoke(c,this,{$scope:a,$element:b,$attrs:d})}],a}]),f.decorator("formDirective",["$delegate",function(a){var b=a[0],c=b.controller;return b.controller=["$scope","$element","$attrs","$injector",function(a,b,d,e){var f=e.get("$interpolate");d.$set("name",f(d.name||d.ngForm||"")(a)),e.invoke(c,this,{$scope:a,$element:b,$attrs:d})}],a}]),g.preferredLanguage("pt-BR"),g.useLoader("apiTranslationsLoader")}]).factory("singleItemUploaderFilter",function(){return{name:"fixQueueLimit",fn:function(a,b){return 1===this.queue.length&&this.clearQueue(),!0}}}).factory("onlyImagesUploaderFilter",function(){return function(a){return{name:"onlyImages",fn:function(b,c){var d=a?b.type:"/"+b.value.slice(b.value.lastIndexOf(".")+1);return d="|"+d.toLowerCase().slice(d.lastIndexOf("/")+1)+"|","|jpg|png|jpeg|bmp|gif|".indexOf(d)!==-1}}}}).run(["Restangular","Auth","$rootScope","$timeout","$templateCache","Error","$http","FullResponseRestangular","ENV","$window","amMoment",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=/^\)\]\}',?\n/;if("string"==typeof a){a=a.replace(b,"");try{a=JSON.parse(a)}catch(c){return a}}return a}k.changeLocale("pt-br"),c.systemVersion=i.version,e.put("template/modal/backdrop.html",'<div class="modal-backdrop fade {{ backdropClass }}"\n     ng-class="{in: animate}"\n     ng-style="{\'z-index\': 10040 + (index && 1 || 0) + index*10}"\n></div>\n'),e.put("template/modal/window.html",'<div tabindex="-1" role="dialog" class="modal fade" ng-class="{in: animate}" ng-style="{\'z-index\': 10050 + index*10, display: \'block\'}" ng-click="close($event)">\n    <div class="modal-dialog" ng-class="{\'modal-sm\': size == \'sm\', \'modal-lg\': size == \'lg\'}"><div class="modal-content" modal-transclude></div></div>\n</div>'),a.setDefaultHeaders({"X-App-Token":b.getToken(),"X-App-Namespace":b.getCurrentNamespaceID()}),h.setDefaultHeaders({"X-App-Token":b.getToken(),"X-App-Namespace":b.getCurrentNamespaceID()}),c.namespace=b.getCurrentNamespace(),c.flowsEnabled="true"===i.flowsEnabled||"TRUE"===i.flowsEnabled,"development"==i.name&&(c.errorReporting=!0,c.mapDebugEnabled=!0),a.addResponseInterceptor(function(a,b,c){if(angular.isDefined(a[c]))return a[c];for(var d in a)if(angular.isObject(a[d]))return a[d];for(var e in a)return a[e];return a}),g.defaults.transformResponse=[l];var m=function(a,b,c){return 401!==a.status||!angular.isUndefined(a.config.treatingUnauthorizedErrors)&&a.config.treatingUnauthorizedErrors!==!1?"undefined"!=typeof a.config.treatingErrors&&a.config.treatingErrors!==!1||f.show(a):f.show("expired_session"),!0};a.setErrorInterceptor(m),h.setErrorInterceptor(m),c.$on("$stateChangeStart",function(a,b,d,e,f){0!==e.name.length&&(c.resolvingRoute=!0,c.uiHasScroll=!1,c.uiDebugMap=!1)}),c.$on("$stateChangeSuccess",function(a,b,e,f,g){c.stateClass="state-"+b.name.replace(/\./g,"-").replace(/_/g,"-"),0===f.name.length&&(c.hideInitialLoading=!0),d(function(){c.resolvingRoute=!1,c.resolvingRequest=!1},150)}),c.$on("$stateChangeError",function(a,b,d,e,g,h){c.stateClass="",403===h.status?j.location="/":404===h.status?j.location="/":401===h.status?f.show("expired_session"):f.show(h)}),c.$on("$stateNotFound",function(a,b,c,d){console.log("$stateNotFound "+b.to+"  - fired when a state cannot be found by its name."),console.log(b,c,d)}),c.glyphicons={"exclamation-sign":"glyphicon-exclamation-sign",ok:"glyphicon-ok"},c.showMessage=function(a,b,e,f){c.systemMessage={icon:a,text:b,messageClass:e},c.showSystemMessage=!0,d(function(){c.showSystemMessage=!1},1e4),f===!0&&(c.scrollTop=!0)},c.addModalMessage=function(a,b,e){c.modalMessage={icon:a,text:b,messageClass:e},d(function(){c.showModalMessage=!0},100),d(function(){c.showModalMessage=!1,d(function(){c.modalMessage={icon:null,text:null,messageClass:null}},1e3)},3500)},c.ckeditorDefaultOptions={docType:"<!DOCTYPE html>",skin:"bootstrapck",language:"pt-br",height:"27cm",resize_enabled:!1,removePlugins:"elementspath",extraPlugins:"sharedspace,tableresize,zupplaceholder,base64image,font,imagepaste,image2,colorbutton,colordialog,print,justify",sharedSpaces:{top:"ckeditor-toolbar"},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"forms",groups:["forms"]},{name:"tools",groups:["tools","print","justify"]},{name:"others",groups:["others"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi","paragraph"]},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"document",groups:["mode","document","doctools"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]}],extraAllowedContent:"div;*[class](*){*}",removeButtons:"Maximize,Image,Source"}}]).filter("abs",function(){return function(a){return Math.abs(a)}}).directive("bindOnce",function(){return{scope:!0,link:function(a,b){setTimeout(function(){a.$destroy(),b.removeClass("ng-binding ng-scope")},0)}}}),angular.module("cubesConfigurationModule",[]).constant("cvOptions",{}).factory("cubesConfigurationService",["$rootScope","cvOptions",function(a,b){var c=a.$new(!0);return{bus:function(){return c},setCubesUrl:function(a){b.cubesUrl=a,c.$emit("cubesUrlChanged",a)}}}]),angular.module("ApiTranslationsLoaderModule",[]).factory("apiTranslationsLoader",["$q","FullResponseRestangular",function(a,b){return function(c){var d=a.defer();return b.all("terminology").customGET().then(function(a){d.resolve(a.data)}),d.promise}}]),angular.module("ReturnFieldsModule",[]).factory("ReturnFieldsService",["$q",function(a){var b={},c=function(a,b){if(!_.isArray(a))throw b?new Error("A `query` para o caminho `"+b+"` precisa ser um Array."):new Error("A `query` precisa ser um Array.");return _.map(a,function(a){return _.isObject(a)?_.map(_.keys(a),function(d){return c(a[d],b?b+"."+d:d)}):b?b+"."+a:a}).join()};return b.convertToString=function(a){return c(a)},b}]),angular.module("AuthServiceModule",["cubesConfigurationModule"]).factory("Auth",["$q","Restangular","FullResponseRestangular","$cookies","$rootScope","ReturnFieldsService","cubesConfigurationService","ENV",function(a,b,c,d,e,f,g,h){var i=null,j=[];return{check:function(){var b=a.defer(),d=this.getToken();if(null!==d&&null===i){var e=c.one("me").get({return_fields:"id,email,permissions,groups.id,groups.name"}),f=this;e.then(function(a){f.saveUser(a.data.user),j=a.data.acessible_namespaces,f._validateCurrentNamespace(),b.resolve(i)},function(){b.reject(),f.clearToken()})}else null!==d&&null!==i?b.resolve(i):(b.reject(),this.clearToken());return g.setCubesUrl(h.apiEndpoint+"/cubes"),b.promise},getToken:function(){var a=d.token;return"undefined"==typeof a?null:a},getConfiguration:function(){return d.configuration?JSON.parse(d.configuration):{}},saveConfiguration:function(){d.configuration=JSON.stringify(configuration)},saveToken:function(a){d.token=a},_validateCurrentNamespace:function(){var a=this.getCurrentNamespace();a&&!_.findWhere(j,{id:a.id})&&(a=null),!a&&j.length>0&&(_.each(j,function(b){b["default"]||(a=b)}),a||(a=j[0]),this.setCurrentNamespace(a)),e.namespace=a},getCurrentNamespace:function(){return d.currentNamespace?JSON.parse(d.currentNamespace):null},getCurrentNamespaceID:function(){var a=this.getCurrentNamespace();return a?a.id:null},setCurrentNamespace:function(a){d.currentNamespace=JSON.stringify(a),c.setDefaultHeaders(_.extend(c.defaultHeaders,{"X-App-Namespace":a.id})),b.setDefaultHeaders(_.extend(b.defaultHeaders,{"X-App-Namespace":a.id})),e.namespace=a},clearToken:function(){delete d.token},clearUser:function(){i=null,e.user=null},saveUser:function(a){i=a},isLogged:function(){return null!==i&&null!==this.getToken()},login:function(d,e){var i=["permissions","id","email","name","groups_names","token",{groups:["id"]}];c.setDefaultHeaders({"X-App-Token":this.getToken()});var k=a.defer(),l=c.one("authenticate").withHttpConfig({treatingErrors:!0,treatingUnauthorizedErrors:!0}).post(null,{email:d,password:e},{return_fields:f.convertToString(i)}),m=this;return l.then(function(a){m.saveUser(a.data.user),m.saveToken(a.data.token),j=a.data.acessible_namespaces,m._validateCurrentNamespace(),g.setCubesUrl(h.apiEndpoint+"/cubes"),b.setDefaultHeaders({"X-App-Token":a.data.token,"X-App-Namespace":m.getCurrentNamespaceID()}),c.setDefaultHeaders({"X-App-Token":a.data.token,"X-App-Namespace":m.getCurrentNamespaceID()}),k.resolve()},function(){k.reject()}),k.promise},logout:function(){this.clearToken(),this.clearUser()}}}]),angular.module("UserServiceModule",[]).service("User",["$q","Auth","$rootScope","$state",function(a,b,c,d){return function(e){e||(e={permissions:[]});var f=a.defer();b.check().then(function(a){c.me=a,c.hasPermission=function(b,c){for(var d in a.permissions)if(d===b){if(_.isBoolean(a.permissions[d]))return a.permissions[d]===!0;if(_.isObject(a.permissions[d])){if(_.isUndefined(c))return a.permissions[d]&&0!==a.permissions[d].length;if(_.isArray(c))for(var e=_.map(c,function(a){return _.isObject(a)&&!_.isUndefined(a.id)?a.id:a}),f=0,g=e.length;f<g;f++)for(var h=e[f],i=a.permissions[d].length-1;i>=0;i--)if(h==a.permissions[d][i])return!0;for(var f=a.permissions[d].length-1;f>=0;f--)if(c==a.permissions[d][f])return!0}}return!1},c.hasAnyPermission=function(a,b){for(var d=a.length-1;d>=0;d--)if(c.hasPermission(a[d],b))return!0;return!1},c.hasPermission("panel_access")||d.go("user.unauthorized"),f.resolve(a)},function(){f.resolve(null),e.permissions.indexOf("isLogged")!==-1&&d.go("user.login")});var g=f.promise;return g?g:null}}]),angular.module("UsersServiceModule",[]).factory("UsersService",["$q","FullResponseRestangular",function(a,b){var c={};return c.fetchAll=function(a){var c={};return c.display_type="full",a=angular.extend(c,a||{}),b.all("users").withHttpConfig({treatingErrors:!0}).customGET(null,a).then(function(a){return a.data.users})},c.fetch=function(a,c){var d={};return d.display_type="full",c=angular.extend(d,c||{}),b.one("users",a).withHttpConfig({treatingErrors:!0}).customGET(null,c).then(function(a){return a.data.user})},c.create=function(c,d){var e={};return d=angular.extend(e,d||{}),b.one("users").withHttpConfig({treatingErrors:!0}).post(null,c,d).then(function(a){return a.data.user})["catch"](function(b){return a.reject(b.data.error)})},c.update=function(c,d){var e={};return d=angular.extend(e,d||{}),b.one("users",c.id).withHttpConfig({treatingErrors:!0}).customPUT(c,null,d)["catch"](function(b){return a.reject(b.data.error)})},c.recoverPassword=function(c,d,e){var f={token:c,new_password:d,new_password_confirmation:e};return b.one("reset_password").withHttpConfig({treatingErrors:!0}).customPUT(f,null)["catch"](function(b){return a.reject(b.data.error)})},c}]),angular.module("AdvancedFiltersServiceModule",["AdvancedFiltersQueryModalControllerModule","AdvancedFiltersCategoryModalControllerModule","AdvancedFiltersStatusModalControllerModule","AdvancedFiltersGroupModalControllerModule","AdvancedFiltersAuthorModalControllerModule","AdvancedFiltersReporterModalControllerModule","PeriodSelectorModule","AdvancedFiltersAreaModalControllerModule","AdvancedFiltersFieldsModalControllerModule","AdvancedFiltersShareModalControllerModule","AdvancedFiltersNotificationMinimumNumberModalControllerModule","AdvancedFiltersNotificationDeadlineModalControllerModule","AdvancedFiltersNotificationOverdueModalControllerModule","AdvancedFiltersNotificationSinceLastModalControllerModule","ReportsCategoriesServiceModule","InventoriesCategoriesServiceModule","ReportsPerimetersServiceModule","AdvancedFiltersShapefileModalControllerModule"]).factory("AdvancedFilters",["$modal","PeriodSelectorService","Restangular","$q","$location","$rootScope","ReportsCategoriesService","InventoriesCategoriesService","ReportsPerimetersService","$log",function(a,b,c,d,e,f,g,h,i,j){var k=function(a){return"items"===a?h.loadedBasicInfo?_.values(h.categories):h.fetchAllBasicInfo():g.loadedBasicInfo?_.values(g.categories):g.fetchAllBasicInfo()};return{query:function(b){a.open({templateUrl:"modals/advanced-filters/query/advanced-filters-query.template.html",windowClass:"filterQueryModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersQueryModalController"})},category:function(b,c){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/category/advanced-filters-category.template.html",windowClass:"filterCategoriesModal",resolve:{categoriesResponse:function(){return k(c)},activeAdvancedFilters:function(){return b},entityType:function(){return c}},controller:"AdvancedFiltersCategoryModalController"})},status:function(b,c){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/status/advanced-filters-status.template.html",windowClass:"filterStatusesModal",resolve:{categoriesResponse:function(){return k(c)},activeAdvancedFilters:function(){return b},entityType:function(){return c}},controller:"AdvancedFiltersStatusModalController"})},group:function(b,d){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/group/advanced-filters-group.template.html",windowClass:"filterGroupsModal",resolve:{groupsResponse:function(){var a=c.all("groups").getList({return_fields:"id,name"});return a.then(function(){f.resolvingRequest=!1}),a},activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersGroupModalController"})},shapefile:function(b){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/shapefile/advanced-filters-shapefile.template.html",windowClass:"filterCategoriesModal",resolve:{perimetersResponse:function(){return i.fetchAll({paginate:!1})},activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersShapefileModalController"})},author:function(b){a.open({templateUrl:"modals/advanced-filters/author/advanced-filters-author.template.html",windowClass:"filterAuthorModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersAuthorModalController"})},reporter:function(b){a.open({templateUrl:"modals/advanced-filters/reporter/advanced-filters-reporter.template.html",windowClass:"filterAuthorModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersReporterModalController"})},period:function(a){b.open(!0).then(function(b){if(b.beginDate){var c={title:"A partir da data",type:"beginDate",desc:moment(b.beginDate).format("DD/MM/YYYY"),value:moment(b.beginDate).startOf("day").format()};a.push(c)}if(b.endDate){var d={title:"Até a data",type:"endDate",desc:moment(b.endDate).format("DD/MM/YYYY"),value:moment(b.endDate).endOf("day").format()};a.push(d)}})},area:function(b){return a.open({templateUrl:"modals/advanced-filters/area/advanced-filters-area.template.html",windowClass:"filterAreaModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersAreaModalController"})},notificationMinimumNumber:function(b){return a.open({templateUrl:"modals/advanced-filters/notification/minimum-number/advanced-filters-notification-minimum-number.template.html",windowClass:"filterNotificationMininumNumberModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersNotificationMinimumNumberModalController"})},notificationSinceLast:function(b){return a.open({templateUrl:"modals/advanced-filters/notification/since-last/advanced-filters-notification-since-last.template.html",windowClass:"filterNotificationModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersNotificationSinceLastModalController"})},notificationDeadline:function(b){return a.open({templateUrl:"modals/advanced-filters/notification/deadline/advanced-filters-notification-deadline.template.html",windowClass:"filterNotificationModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersNotificationDeadlineModalController"})},notificationOverdue:function(b){return a.open({templateUrl:"modals/advanced-filters/notification/overdue/advanced-filters-notification-overdue.template.html",windowClass:"filterNotificationModal",resolve:{activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersNotificationOverdueModalController"})},fields:function(b){f.resolvingRequest=!0,a.open({templateUrl:"modals/advanced-filters/fields/advanced-filters-fields.template.html",windowClass:"fieldsCategoriesModal",resolve:{categoriesResponse:["Restangular",function(a){return k("items")}],activeAdvancedFilters:function(){return b}},controller:"AdvancedFiltersFieldsModalController"})},share:function(){a.open({templateUrl:"modals/advanced-filters/share/advanced-filters-share.template.html",windowClass:"shareModal",resolve:{url:function(){var a=d.defer(),b=gapi.client.urlshortener.url.insert({resource:{longUrl:e.absUrl()}});return b.execute(function(b){a.resolve(b.id)}),a.promise}},controller:"AdvancedFiltersShareModalController"})}}}]),angular.module("FullResponseRestangularServiceModule",[]).factory("FullResponseRestangular",["Restangular",function(a){return a.withConfig(function(a){a.setFullResponse(!0)})}]),angular.module("ConfigServiceModule",["ReportsCategoriesServiceModule"]).factory("ConfigService",["$q","FullResponseRestangular","ReportsCategoriesService",function(a,b,c){var d={defaultColumnWidths:{protocol:"30",assignment:"20%",reporter:"10%",address:"20%",user:"10%",category:"20%",created_at:"150",custom_field:"15%"}};return d.getReportsColumns=function(){var e=a.defer(),f=c.getAllCustomFields(),g=b.all("settings").customGET();return a.all([g,f]).then(function(a){var b=_.findWhere(a[0].data.settings,{name:"reports_listing_columns"}).value,c=a[1],f=_.map(c,function(a){return{id:a.id,type:"custom_field",label:a.title}});_.each(f,function(a){_.findWhere(b,{id:a.id})||b.push(a)}),_.each(b,function(a){a.width=d.defaultColumnWidths[a.type]}),e.resolve(b)}),e.promise},d.updateReportsColumns=function(a){return b.one("settings","reports_listing_columns").customPUT({value:a})},d}]),angular.module("ErrorServiceModule",["ErrorModalControllerModule"]).factory("Error",["$modal","Raven",function(a,b){var c=!1;return{show:function(d){if(d instanceof TypeError&&(d=d.stack.toString(),console.error(d)),c)return b.captureMessage(JSON.stringify(d)),!1;var e=a.open({templateUrl:"modals/error/error.template.html",windowClass:"error-modal",resolve:{response:function(){return d}},controller:"ErrorModalController"});e.result.then(function(){c=!1},function(){c=!1}),c=!0}}}]),angular.module("ReportsCategoriesServiceModule",[]).factory("ReportsCategoriesService",["$rootScope","$q","FullResponseRestangular","Restangular","ReturnFieldsService",function(a,b,c,d,e){var f={};f.categories={},f.categoriesStatuses={},f.loadedBasicInfo=!1;var g=function(b){_.each(b.data.categories,function(a){_.each(a.subcategories,function(a){f.categories[a.id]=a}),f.categories[a.id]=a,_.each(a.statuses,function(a){f.categoriesStatuses[a.id]=a})}),a.$emit("reportsCategoriesFetched",f.categories)};return f.purgeCache=function(){return f.categories={},f.categoriesStatuses={},f.loadedBasicInfo=!1,f.fetchAllBasicInfo()},f.getStatusesByCategory=function(a){return d.one("reports").one("categories",a).all("statuses").getList()},f.fetchTitlesAndIds=function(){var a=c.all("reports").all("categories"),b={};return b.display_type="full",b.subcategories_flat=!0,b.return_fields=e.convertToString(["id","title"]),a.customGET(null,b)},f.fetchAllBasicInfo=function(){var a=c.all("reports").all("categories"),b={};b.display_type="full",b.subcategories_flat=!0,b.return_fields=e.convertToString(["id","title","priority","priority_pretty","pin","parent_id","color","icon",{statuses:["id","color","title"],marker:[{retina:["web"]}]}]);var d=a.customGET(null,b);return d.then(function(a){f.loadedBasicInfo=!0,g(a)}),d},f.fetchTitlesAndIds=function(){var a=c.all("reports").all("categories"),d=b.defer(),f={};f.display_type="full",f.subcategories_flat=!1,f.return_fields=e.convertToString(["id","title",{subcategories:["id","title"]}]);var g=a.customGET(null,f);return g.then(function(a){d.resolve(a.data.categories)},function(a){d.reject(a)}),d.promise},f.getAllCustomFields=function(){var a=b.defer(),d=c.all("reports").all("categories").customGET(null,{display_type:"full",return_fields:"custom_fields"});return d.then(function(b){var c=_.uniq(_.flatten(_.map(b.data.categories,function(a){return a.custom_fields})),function(a){return a.id});a.resolve(c)}),a.promise},f}]),angular.module("ReportsItemsServiceModule",["ReportsCategoriesServiceModule"]).factory("ReportsItemsService",["$q","$rootScope","FullResponseRestangular","ReportsCategoriesService","ReturnFieldsService",function(a,b,c,d,e){var f={},g=0;f.reports={},f.total=0,f.clusters=[],f.resetCache=function(){f.reports={},f.clusters=[],f.total=0,g=0},f.resetItemsAndClusters=function(){g=0,f.reports={},f.clusters=[]},f.fetchAll=function(h){h=h||{};var j=c.one("search").all("reports").all("items"),k={display_type:"full",return_fields:e.convertToString(["id","protocol","address","category_id","status_id","created_at","overdue","overdue_at",{category:["title","priority_pretty"],assigned_group:["name","title"],assigned_user:["name","id"],user:["name","id"],reporter:["name","id"],notifications:["deadline_in_days","days_to_deadline",{notification_type:["title"]}]}])};angular.merge(k,h);var l=d.fetchAllBasicInfo(),m=j.customGET(null,k),n=a.defer();return b.$broadcast("reportsItemsFetching"),m.then(function(a){_.each(a.data.reports,function(a){"undefined"==typeof f.reports[a.id]&&(a.order=g++),f.reports[a.id]=a}),f.total=parseInt(a.headers().total,10),_.size(d.categories)<1?l.then(function(){i(),b.$broadcast("reportsItemsFetched",f.reports),n.resolve(f.reports)}):(i(),b.$broadcast("reportsItemsFetched",f.reports),n.resolve(f.reports))}),n.promise},f.fetchClustered=function(h){var k=c.one("search").all("reports").all("items");h.display_type="full",h.return_fields=e.convertToString(["id","protocol","address","category_id","categories_ids","status_id","created_at","overdue","position",{user:["name","id "]}]);var l=d.fetchAllBasicInfo(),m=k.customGET(null,h),n=a.defer();return b.$broadcast("reportsItemsFetching"),m.then(function(a){f.total=parseInt(a.headers().total,10),_.each(a.data.reports,function(a){"undefined"==typeof f.reports[a.id]&&(a.order=g++),f.reports[a.id]=a}),f.clusters=a.data.clusters,_.size(d.categories)<1?l.then(function(){j(),i(),b.$broadcast("reportsItemsFetched",f.reports),n.resolve(f)}):(j(),i(),b.$broadcast("reportsItemsFetched",f.reports),n.resolve(f))}),n.promise},f.remove=function(b){var d=c.one("reports").one("items",b).remove(),e=a.defer();return d.then(function(){delete f.reports[b],e.resolve()}),e.promise};var h=function(a){return _.each(a,function(a){a.category=d.categories[a.category_id],"undefined"==typeof a.category&&console.log("Report with unknown category",a),a.status=d.categoriesStatuses[a.status_id]})},i=function(){h(f.reports)},j=function(){h(f.clusters)};return f}]),angular.module("ReportsCategoriesNotificationsServiceModule",[]).factory("ReportsCategoriesNotificationsService",["Restangular","FullResponseRestangular","$rootScope","$q","$log","ReturnFieldsService",function(a,b,c,d,e,f){var g={};return g.notificationTypesMap={},g.reportNotificationTypes={},g.notifications={},g.total=0,g.notificationReturnFields=f.convertToString(["id","reports_item_id","updated_at","deadline_in_days","content","user_id","able_to_send","days_to_deadline","created_at","overdue_at","sent",{notification_type:["id","title","active","default_deadline_in_days"]}]),g.cleanCache=function(){e.debug("Cleaning notification cache."),g.notificationTypesMap={},g.reportNotificationTypes={},g.notifications={},g.total=0},g.getLastNotification=function(b,c){e.debug("Retrieving last notification for report [id="+b+"]");var f=d.defer();return a.one("reports").one("categories",c).one("items",b).one("notifications").customGET("last",{return_fields:g.notificationReturnFields}).then(function(a){f.resolve(a.data)}),f.promise},g.getAvailableNotificationsForReport=function(b,c){e.debug("Retrieving notifications for report [id="+b+"]");var f=d.defer();return g.reportNotificationTypes[b]?(e.debug("Notification info from cache."),f.resolve(g.reportNotificationTypes[b])):a.one("reports").one("categories",c).one("items",b).getList("notifications",{return_fields:g.notificationReturnFields}).then(function(a){e.debug("Notification info from rest.");for(var c=a.data,d=[],h=0,i=0,j=c.length;i<j;i++)c[i].notification_type.active&&(d[h++]=c[i]);g.reportNotificationTypes[b]=d,f.resolve(d);
}),f.promise},g.sendNotification=function(b,c,d){return e.debug("Send notification [categoryId: "+c+", reportId: "+b+", notificationTypeId: "+d+"]"),a.one("reports").one("categories",c).one("items",b).withHttpConfig({treatingErrors:!1}).post("notifications",{notification_type_id:d})},g.resendNotification=function(b,c,d){return e.debug("Send notification [categoryId: "+c+", reportId: "+b+", notificationId: "+d+"]"),a.one("reports").one("categories",c).one("items",b).one("notifications",d).one("resend").withHttpConfig({treatingErrors:!1}).put()},g.restartProcess=function(b,c){return e.debug("Restart process for report [categoryId: "+c+", reportId: "+b+"]"),a.one("reports").one("categories",c).one("items",b).one("notifications").one("restart").withHttpConfig({treatingErrors:!1}).put()},g.searchNotifications=function(a){e.debug("Searching notifications");var h={display_type:"full",return_fields:f.convertToString(["id","deadline_in_days","days_to_deadline","created_at","active",{item:["id","address"],user:["name"],notification_type:["id","title",{category:["id","title"]}]}])};angular.merge(h,a);var i=b.one("search").all("reports").all("notifications").customGET(null,h),j=d.defer();return i.then(function(a){_.each(a.data.notifications,function(a){g.notifications[a.id]=a}),j.resolve(g.notifications),g.total=parseInt(a.headers().total,10),c.$broadcast("notificationsFetched")}),j.promise},g}]),angular.module("ReportsPerimetersServiceModule",[]).factory("ReportsPerimetersService",["Restangular","FullResponseRestangular","$rootScope","$q","$log","ReturnFieldsService",function(a,b,c,d,e,f){var g={},h=0;return g.total=0,g.perimeters={},g.listAllReturnFields=["id","title","shp_file","shx_file","status","geometry"],g.cleanCache=function(){e.debug("Cleaning perimeters cache."),g.perimeters={},g.total=0,h=0},g.fetchAll=function(a){e.debug("Fetching perimeters"),a=a||{};var i={display_type:"full",return_fields:f.convertToString(["id","title","status","geometry","created_at",{group:["id","name"]}])};angular.merge(i,a);var j=b.one("reports").all("perimeters").customGET(null,i),k=d.defer();return j.then(function(a){_.each(a.data.perimeters,function(a){"undefined"==typeof g.perimeters[a.id]&&(a.order=h++),g.perimeters[a.id]=a}),g.total=parseInt(a.headers().total,10),k.resolve(g.perimeters),c.$broadcast("perimetersFetched")},function(){k.reject("Erro na consulta")}),k.promise},g.addPerimeter=function(b){return e.debug("Adding new perimeter/region [title: "+b.title+", shp_file: "+b.shp_file.file_name+", shx_file: "+b.shx_file.file_name+"]"),b.return_fields="id",a.one("reports").withHttpConfig({treatingErrors:!0}).post("perimeters",b)},g.updatePerimeter=function(b){return e.debug("Update an existing perimeter/region [title: "+b.title+", id: "+b.id+"]"),b.return_fields="id",a.one("reports").one("perimeters",b.id).withHttpConfig({treatingErrors:!0}).customPUT({title:b.title})},g.deletePerimeter=function(b){return e.debug("Deleting perimeter/region [id: "+b.id+", title: "+b.title+"]"),a.one("reports").withHttpConfig({treatingErrors:!0}).one("perimeters",b.id).remove()},g.createFileUploaderFilter=function(a,b){return{name:a+"Filter",fn:function(c){b.fileTypeError=!1,b.fileTypeFileName="";var d=b.isHTML5&&c.type?c.type:"/"+c.name.slice(c.name.lastIndexOf(".")+1);d=d.toLowerCase().slice(d.lastIndexOf("/")+1);var e=a.toLowerCase()===d;return e||(b.fileTypeError=!0,b.fileTypeFileName=c.name),e}}},g.savePerimeterGroup=function(b){e.debug((b.id?"Update":"Create")+" promise to perimeter group: ["+(b.id?"id: "+b.id+", ":"")+"category_id: "+b.category_id+", group_id: "+b.group_id+", perimeter_id: "+b.perimeter_id+"]");var c,d={perimeter_id:b.perimeter_id,group_id:b.group_id};return b.id?c=a.one("reports").one("categories",b.category_id).one("perimeters",b.id).withHttpConfig({treatingErrors:!0}).customPUT(d):(d.return_fields="id",c=a.one("reports").one("categories",b.category_id).withHttpConfig({treatingErrors:!0}).post("perimeters",d)),c},g.deletePerimeterGroup=function(b){return e.debug("Deleting perimeter group [id: "+b.id+"]"),a.one("reports").one("categories",b.category_id).withHttpConfig({treatingErrors:!0}).one("perimeters",b.id).remove()},g.getPerimetersGroups=function(b){var e=a.one("reports").one("categories",b).all("perimeters").customGET(null,{display_type:"full",return_fields:"id,perimeter.title,group.id,perimeter.id,category.id"}),f=d.defer();return e.then(function(a){g.perimetersGroups=[],_.each(a.data,function(a){var b={};b.id=a.id,_.isNull(a.perimeter)||(b.perimeter_id=a.perimeter.id),b.group_id=a.group.id,b.category_id=a.category.id,b.title=a.perimeter.title,g.perimetersGroups.push(b)}),f.resolve(g.perimetersGroups),c.$broadcast("perimetersGroupFetched")}),f.promise},g}]),function(a){"use strict";function b(a){var b=this;return b.getFeatureFlags=function(){return a.all("feature_flags").getList()},b.convertFeaturesFlagsFrom=function(a){for(var c=[],d=0;d<a.length;d++){var e=a[d];c.push({id:e.id,name:e.name.trim(),enabled:"enabled"===e.status})}return b.features=c,b},b.and=function(){return b},b.addInto=function(a){for(var c=0;c<b.features.length;c++){var d=b.features[c];a[d.name]=d.enabled}return a},b}a.module("ReportsFeatureFlagsServiceModule",[]).factory("ReportsFeatureFlagsService",b),b.$inject=["Restangular"]}(angular),angular.module("InventoriesCategoriesServiceModule",[]).factory("InventoriesCategoriesService",["$rootScope","$q","Restangular","FullResponseRestangular","ReturnFieldsService",function(a,b,c,d,e){var f={};f.categories={},f.categoriesStatuses={},f.loadedBasicInfo=!1;var g=function(b){_.each(b.data.categories,function(a){f.categories[a.id]=a,_.each(a.statuses,function(a){f.categoriesStatuses[a.id]=a})}),a.$emit("inventoriesCategoriesFetched",f.categories)};return f.purgeCache=function(){return f.categories={},f.categoriesStatuses={},f.loadedBasicInfo=!1,f.fetchAllBasicInfo()},f.fetchAllBasicInfo=function(){var a=d.all("inventory").all("categories"),b={};b.display_type="full",b.return_fields=e.convertToString(["id","title","pin","plot_format","color",{statuses:["id","color","title"],marker:[{retina:["web"]}]}]);var c=a.customGET(null,b);return c.then(function(a){f.loadedBasicInfo=!1,g(a)}),c},f.fetchTitlesAndIds=function(){var a=d.all("inventory").all("categories"),b={};return b.display_type="full",b.return_fields=e.convertToString(["id","title"]),a.customGET(null,b)},f.getCategory=function(a){var b=c.one("inventory").one("categories",a).get({display_type:"full"});return b},f.create=function(a){return c.one("inventory").withHttpConfig({treatingErrors:!0}).post("categories",a).then(function(a){return a.data})["catch"](function(a){return b.reject(a.data.error)})},f.update=function(a,c){return d.one("inventory").one("categories",a).withHttpConfig({treatingErrors:!0}).customPUT(c).then(function(a){return a.data})["catch"](function(a){return b.reject(a.data.error)})},f.updateForm=function(a,c){return d.one("inventory").one("categories",a).one("form").withHttpConfig({treatingErrors:!0}).customPUT(c).then(function(a){return a.data.form})["catch"](function(a){return b.reject(a.data.error)})},f}]),angular.module("InventoriesItemsServiceModule",["InventoriesCategoriesServiceModule"]).factory("InventoriesItemsService",["$q","$rootScope","FullResponseRestangular","InventoriesCategoriesService","ReturnFieldsService",function(a,b,c,d,e){var f={},g=0;f.items={},f.total=0,f.clusters=[],f.resetCache=function(){f.items={},f.clusters=[],f.total=0,g=0},f.resetItemsAndClusters=function(){g=0,f.items={},f.clusters=[]},f.fetchOne=function(a,b){var d={display_type:"full",return_fields:e.convertToString(["id","title","address","inventory_status_id","status","locked","locker_id","locked_at","position","inventory_category_id","data","created_at","updated_at"])};return b=_.extend(d,b),c.all("inventory").one("items",a).customGET(null,b)},f.fetchAll=function(h){h=h||{};var j=c.one("search").all("inventory").all("items");h.display_type="full",h.return_fields=e.convertToString(["id","title","address","created_at","updated_at","inventory_status_id","inventory_category_id",{user:["name","id"]}]);var k=d.fetchAllBasicInfo(),l=j.customGET(null,h),m=a.defer();return b.$broadcast("inventoriesItemsFetching"),l.then(function(a){h.appendItems||(f.items={}),_.each(a.data.items,function(a){"undefined"==typeof f.items[a.id]&&(a.order=g++),f.items[a.id]=a}),f.total=parseInt(a.headers().total,10),_.size(d.categories)<1?k.then(function(){i(),b.$broadcast("inventoriesItemsFetched",f.items),m.resolve(f.items)}):(i(),b.$broadcast("inventoriesItemsFetched",f.items),m.resolve(f.items))}),m.promise},f.fetchClustered=function(h){var k=c.one("search").all("inventory").all("items");h.return_fields=e.convertToString(["id","title","address","created_at","updated_at","inventory_status_id","position","inventory_category_id",{user:["name","id"]}]);var l=d.fetchAllBasicInfo(),m=k.customGET(null,h),n=a.defer();return b.$broadcast("inventoriesItemsFetching"),m.then(function(a){f.total=parseInt(a.headers().total,10),_.each(a.data.items,function(a){"undefined"==typeof f.items[a.id]&&(a.order=g++),f.items[a.id]=a}),f.clusters=a.data.clusters,_.size(d.categories)<1?l.then(function(){j(),i(),b.$broadcast("inventoriesItemsFetched",f.items),n.resolve(f)}):(j(),i(),b.$broadcast("inventoriesItemsFetched",f.items),n.resolve(f))}),n.promise},f.remove=function(b,d){var e=c.one("inventory").one("categories",d).one("items",b).remove(),g=a.defer();return e.then(function(){delete f.items[b],g.resolve()}),g.promise},f.create=function(b,d){return c.one("inventory").one("categories",b).withHttpConfig({treatingErrors:!0}).post("items",d).then(function(a){return a.data.item})["catch"](function(b){return a.reject(b.data.error||"Ops, ocorreu um erro inesperado. Por favor, tente novamente!")})},f.update=function(b,d,e){return c.one("inventory").one("categories",d).one("items",b).withHttpConfig({treatingErrors:!0}).customPUT(e).then(function(a){return a.data.item})["catch"](function(b){return a.reject(b.data.error||"Ops, ocorreu um erro inesperado. Por favor, tente novamente!")})};var h=function(a){return _.each(a,function(a){a.category=d.categories[a.inventory_category_id]||d.categories[a.category_id],"undefined"==typeof a.category&&console.log("Inventory item with unknown category",a),a.status=d.categoriesStatuses[a.inventory_status_id]})},i=function(){h(f.items)},j=function(){h(f.clusters)};return f}]),function(a,b){"use strict";function c(c,d,e){function f(a){var c;return c=a.duplicating?a.charts:b.map(a.charts,function(a){if(a&&!a.deleted){var b=e.views[a.index];return a.id=b.id,a.params=b.params,a}}),c=b.filter(c,function(a){return!b.isUndefined(a)&&!a.deleted}),a.params={},b.each(c,function(b){a.params[b.id]=b}),a}function g(a){return a.charts=b.map(a.params),a}var h={},i=["id","title","summary","params"].join();return h.fetchAll=function(a){a=a||{};var b=d.all("business_reports");a.display_type="full",a.return_fields=["id","title","summary"].join();var e=b.customGET(null,a),f=c.defer();return e.then(function(a){var b=a.data.business_reports;f.resolve(b)},function(a){f.reject(a)}),f.promise},h.remove=function(a){var b=d.one("business_reports",a).remove(),e=c.defer();return b.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},h.find=function(b){var e={},f=d.one("business_reports",b);e.display_type="full",e.return_fields=i;var h=f.customGET(null,e),j=c.defer();return h.then(function(b){var c=d.stripRestangular(b.data.business_report);c._original=a.copy(c),j.resolve(g(c))},function(a){j.reject(a)}),j.promise},h.save=function(b){var e={},g=c.defer();e.return_fields=i;var h,j=f(a.copy(b));return b.id?(j.id=b.id,h=d.one("business_reports",b.id).customPUT(j),h.then(function(a){var b=a.data.business_report;g.resolve(b)},function(a){g.reject(a)})):(h=d.one("business_reports").customPOST(j),h.then(function(a){var b=a.data.business_report;g.resolve(b)},function(a){g.reject(a)})),g.promise},h.isValid=function(a){var c=[];c.push(b.size(a.title)>0);var d=b.filter(a.charts,function(a){return a&&!a.deleted});return!!(a.charts&&d.length>0)&&(c.push(b.every(a.charts,function(a){if(b.isUndefined(a)||a.deleted)return!0;var c=e.views[a.index];return c&&a.title&&a.title.length>0})),b.every(c,function(a){return a}))},h.clearViews=function(){e.views=[]},h}a.module("BusinessReportsServiceModule",[]).factory("BusinessReportsService",c),c.$inject=["$q","FullResponseRestangular","studioViewsService"]}(angular,_),angular.module("GoogleMapServiceModule",[]).factory("GoogleMapService",["ENV","$compile","$rootScope",function(a,b,c){var d={map:{zoom:null,mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}},e=function(a,b,c,e,f){d.map.zoom=e;var g=new google.maps.LatLng(b,c),h=new google.maps.StyledMapType(d.styles,{name:"zup"});this.itemsAreReports=a,this.map=new google.maps.Map(f,d.map),this.map.mapTypes.set("zup",h),this.map.setMapTypeId("zup"),this.map.setCenter(g),this.currentMarkers={},this.infoWindow=new google.maps.InfoWindow,this.activeFilterAreas=[]};e.prototype.getDistance=function(){var a=this.map.getBounds(),b=a.getCenter(),c=a.getNorthEast();return google.maps.geometry.spherical.computeDistanceBetween(b,c)},e.prototype.clearMarkers=function(){_.each(this.currentMarkers,function(a){a.setMap(null)}),this.currentMarkers={}},e.prototype.createMarker=function(a,b,c,d,e,f){var g,h="";_.isNull(b)?(f&&(h="general-cluster"),g='<div class="marker '+h+'">'):(h=b.isPin?"pin":"",g='<div class="marker '+h+'" style="background-image: url('+b.url+')">'),d&&(g+='<span style="background-color: '+c+';">'+d+"</span>"),g+="</div>";var i=new RichMarker({position:a,map:this.map,draggable:!1,shadow:!1,content:g,extraData:e,isReport:this.itemsAreReports,infoWindow:this.infoWindow});return _.isUndefined(e)?_.isNull(b)&&google.maps.event.addListener(i,"click",this.zoomToMarker):google.maps.event.addListener(i,"click",this.displayInfoWindow),i},e.prototype.zoomToMarker=function(){this.map.setZoom(this.map.getZoom()+1),this.map.setCenter(this.position)},e.prototype.displayInfoWindow=function(){var a;a=this.isReport?'<div class="pinTooltip"><h1>{{ item.category.title }}</h1><p>Enviado em {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/reports/{{ item.id }}">Ver detalhes</a></div>':'<div class="pinTooltip"><h1>{{ item.title }}</h1><p>Criado em {{ item.created_at | date: \'dd/MM/yy HH:mm\'}}</p><a href="#/items/{{ item.id }}">Ver detalhes</a></div>';var d=c.$new(!0);d.category=this.extraData.category,d.item=this.extraData.item;var e=b(a)(d);d.$apply(),this.infoWindow.setContent(e[0]),this.infoWindow.open(this.map,this)},e.prototype.createClusterMarker=function(a){var b=new google.maps.LatLng(a.position[0],a.position[1]);return a.categories_ids?this.createMarker(b,null,"#259ECB",a.count,void 0,!0):this.createMarker(b,null,a.category.color,a.count)},e.prototype.createItemMarker=function(a){var b={};this.itemsAreReports||"pin"!==a.category.plot_format?(b.url=a.category.marker.retina.web,b.isPin=!1):(b.url=a.category.pin.retina.web,b.isPin=!0);var c=new google.maps.LatLng(a.position.latitude,a.position.longitude),d=this.createMarker(c,b,!1,!1,{category:a.category,item:a});return d},e.prototype.processMarkers=function(a,b){var c={},d=this;_.each(a,function(a){if((_.isUndefined(a.category)||!a.category)&&_.isUndefined(a.categories_ids))return!1;var b=_.isUndefined(a.category)?a.categories_ids[0]:a.category_id,e=a.position[0].toString()+a.position[1]+a.count+b;d.currentMarkers[e]?(c[e]=d.currentMarkers[e],delete d.currentMarkers[e]):(c[e]=d.createClusterMarker(a),c[e].setMap(d.map),c[e].setVisible(!0))}),_.each(b,function(a){d.currentMarkers[a.id]?(c[a.id]=d.currentMarkers[a.id],delete d.currentMarkers[a.id]):(c[a.id]=d.createItemMarker(a),c[a.id].setMap(d.map),c[a.id].setVisible(!0))}),_.each(this.currentMarkers,function(a){a.setMap(null)}),this.currentMarkers=c},e.prototype.isMarkerInsideBounds=function(a){return this.map.getBounds().contains(a.getPosition())},e.prototype.hideOutOfBoundsMarkers=function(){var a=this;_.each(this.currentMarkers,function(b){a.isMarkerInsideBounds(b)?b.setVisible(!0):b.setVisible(!1)})},e.prototype.getMap=function(){return this.map},e.prototype.getZoom=function(){return this.map.getZoom()},e.prototype.getCenter=function(){return this.map.getCenter()},e.prototype.createCircle=function(a,b,c){var d={fillColor:"#6FCCEF",map:this.map,center:a,radius:b,originalDistance:b,strokeWeight:0,zIndex:1};c&&(d.fillColor="#37A6CF",d.strokeWeight=1,d.strokeColor="#37A6CF",d.zIndex=1);var e=new google.maps.Circle(d);return e},e.prototype.clearCircles=function(){for(var a=this.activeFilterAreas.length-1;a>=0;a--)this.activeFilterAreas[a].inner.setMap(null),this.activeFilterAreas[a].outer.setMap(null);this.activeFilterAreas[a]=[]};var f=function(a,b){var c=Math.pow(2,21-b.getZoom());return a+1128.49722*c*.0027};return e.prototype.processAreaFilters=function(a){this.clearCircles();for(var b=a.length-1;b>=0;b--){var c=a[b],d=new google.maps.LatLng(c.latitude,c.longitude),e=this.createCircle(d,c.distance,!0),g=this.createCircle(d,f(c.distance,this));this.activeFilterAreas.push({inner:e,outer:g})}},e.prototype.changeFilterOuterCircles=function(){for(var a=this.activeFilterAreas.length-1;a>=0;a--){var b=f(this.activeFilterAreas[a].outer.originalDistance,this);console.log("original -> ",this.activeFilterAreas[a].outer.originalDistance," new radius -> ",b,"zoom -> ",this.getZoom()),this.activeFilterAreas[a].outer.set("radius",b)}},e}]),function(a,b){"use strict";function c(a,c){function d(c,d,g){var h=b.isString(c)?a.hasPermission:a.hasAnyPermission,i=h(c,d||void 0);return g&&(h=b.isFunction(g)?g:f)(i,e),i}function e(){return a.showMessage("exclamation-sign","Você não possui permissão para visualizar essa página.","error"),c.go("items.list",{},{reload:!0})}function f(a,b){a||b()}return{authorize:d}}a.module("AuthorizationProviderModule",[]).factory("Authorization",c),c.$inject=["$rootScope","$state"]}(angular,_),angular.module("ServicesServiceModule",[]).factory("ServicesService",["$q","FullResponseRestangular",function(a,b){var c={};return c.fetchAll=function(a){var c={};return c.display_type="full",a=angular.extend(c,a||{}),b.all("services").withHttpConfig({treatingErrors:!0}).customGET(null,a).then(function(a){return a.data.services})},c.fetch=function(a,c){var d={};return d.display_type="full",c=angular.extend(d,c||{}),b.one("services",a).withHttpConfig({treatingErrors:!0}).customGET(null,c).then(function(a){return a.data.service})},c.create=function(c,d){var e={};return d=angular.extend(e,d||{}),b.one("services").withHttpConfig({treatingErrors:!0}).post(null,c,d).then(function(a){return a.data.service})["catch"](function(b){return a.reject(b.data.error)})},c.update=function(c,d){var e={};return d=angular.extend(e,d||{}),b.one("services",c.id).withHttpConfig({treatingErrors:!0}).customPUT(c,null,d)["catch"](function(b){return a.reject(b.data.error)})},c}]),angular.module("FlowsServiceModule",[]).factory("FlowsService",["$q","FullResponseRestangular","ReturnFieldsService",function(a,b,c){var d={};return d.fetchAll=function(a){var d={};return d.display_type="full",d.return_fields=c.convertToString(["id","title","description","initial","total_cases","created_at","updated_at","resolution_states",{created_by:["id","name"],updated_by:["id","name"],steps:["id"]}]),a=angular.extend(d,a||{}),b.all("flows").withHttpConfig({treatingErrors:!0}).customGET(null,a).then(function(a){return a.data.flows})},d.fetch=function(a,d,e){var f={};return f.display_type="full",f.return_fields=c.convertToString(["id","title","resolution_states","description","initial","version_id","created_at","draft","steps_order",{list_versions:["version_id","id","updated_at"],my_steps:["id","title","step_type",{my_child_flow:["id","title","step_type"]}]}]),e=angular.extend(f,e||{}),d&&(e.version=d),b.one("flows",a).withHttpConfig({treatingErrors:!0}).customGET(null,e).then(function(a){var b=a.data.flow;return b.my_steps=_.map(b.steps_order,function(a){return _.findWhere(b.my_steps,{id:a})}),b})},d.getPreviousStepList=function(a,d){var e={display_type:"full",return_fields:c.convertToString(["steps_order",{steps:["id","title"]}])};return b.one("flows",a).customGET(null,e).then(function(a){var b=a.data.flow.steps,c=a.data.flow.steps_order.slice(0,a.data.flow.steps_order.indexOf(d));return _.select(b,function(a){if(_.include(c,a.id))return!0})})},d.getInventoryItemFields=function(a){var d={display_type:"full",inventory_field_contender:"true",return_fields:c.convertToString(["id","title",{category_inventory:[{sections:[{fields:["id","title","label"]}]}]}])};return b.one("flows",a).all("fields").customGET(null,d).then(function(a){return a.data.fields})},d.create=function(a){return b.all("flows").withHttpConfig({treatingErrors:!0}).post(a).then(function(a){return a.data.flow})},d.update=function(a){return b.one("flows",a.id).withHttpConfig({treatingErrors:!0}).customPUT(a).then(function(a){return a.data})},d.destroy=function(a){return b.one("flows",a).withHttpConfig({treatingErrors:!0}).remove().then(function(a){return a.data.message})},d.reorder=function(a,c){var d={ids:[]};return angular.forEach(c,function(a){d.ids.push(a.id)}),b.one("flows",a).withHttpConfig({treatingErrors:!0}).customPUT(d,"steps")},d.publish=function(a){return b.one("flows",a).withHttpConfig({treatingErrors:!0}).customPOST(null,"publish")},d.setVersion=function(a,c){var d={new_version:c};return b.one("flows",a).withHttpConfig({treatingErrors:!0}).customPUT(d,"version")},d}]),angular.module("StepsServiceModule",[]).factory("StepsService",["$q","Restangular",function(a,b){function c(c,e,f){var g=a.defer();return f=f||{},_.isUndefined(e)?f.draft=!0:f.version=e,c.customGET(null,f).then(function(a){var c=d(b.stripRestangular(a.data));g.resolve(c)},function(a){g.reject(a)}),g.promise}function d(a){return a.fields=_.map(a.fields,e.fieldDenormalizer),a.my_fields=_.map(a.my_fields,e.fieldDenormalizer),a}var e={};return e.fetch=function(a,d,e){return c(b.one("flows",a).one("steps",d),e,{display_type:"full"})},e.fetchFields=function(a,d,e,f){return c(b.one("flows",a).one("steps",d).all("fields"),e||null,f)},e.fetchTriggers=function(a,d,e){return c(b.one("flows",a).one("steps",d).all("triggers"),e||null)},e.destroyTrigger=function(a,c,d){return b.one("flows",a).one("steps",c).one("triggers",d).withHttpConfig({treatingErrors:!0}).remove().then(function(a){return a.data.message})},e.destroyCondition=function(a,c,d,e){return b.one("flows",a).one("steps",c).one("triggers",d).one("trigger_conditions",e).withHttpConfig({treatingErrors:!0}).remove().then(function(a){return a.data.message})},e.updatePermission=function(a,c,d,e){return b.one("flows",a).one("steps",c).one("permissions").customPUT({permission_type:d,group_ids:_.map(e,function(a){return a.id})})},e.update=function(a,c,d){return b.one("flows",a).one("steps",c).customPUT(d)},e.fieldDenormalizer=function(a){var b=["previous_field","report_item","inventory_item","inventory_field"];return _.isNull(a.requirements)?(a.requirements={presence:"false",multiline:"false"},a):(a.requirements.presence=a.requirements.presence||"false",a.requirements.multiline=a.requirements.multiline||"false",a.requirements.minimum&&(a.requirements.minimum=parseInt(a.requirements.minimum,10)),a.requirements.maximum&&(a.requirements.maximum=parseInt(a.requirements.maximum,10)),_.include(b,a.field_type)||(a.has_size_requirements=!0),a.category_report&&a.category_report.length>0&&(a.values=_.map(a.category_report,function(a){return a.id})),a.category_inventory&&a.category_inventory.length>0&&(a.values=_.map(a.category_inventory,function(a){return a.id})),a)},e.getDefaultFieldLabel=function(a){var b,c,d=e.getAvailableFields();return b=(c=_.findWhere(d.normal,{kind:a}))?c.name:_.findWhere(d.special,{kind:a}).name,b="Novo "+b[0].toLocaleLowerCase()+b.slice(1)},e.getAvailableFields=function(){return{normal:[{kind:"text",name:"Campo de texto"},{kind:"integer",name:"Campo numérico"},{kind:"decimal",name:"Campo decimal"},{kind:"checkbox",name:"Campo de múltipla escolha",multipleOptions:!0},{kind:"select",name:"Campo de lista",multipleOptions:!0},{kind:"radio",name:"Campo de escolha única",multipleOptions:!0},{kind:"meter",name:"Campo em metros"},{kind:"centimeter",name:"Campo em centímetros"},{kind:"kilometer",name:"Campo em quilômetros"},{kind:"year",name:"Campo em anos"},{kind:"month",name:"Campo em meses"},{kind:"day",name:"Campo em dias"},{kind:"hour",name:"Campo em horas"},{kind:"minute",name:"Campo em minutos"},{kind:"second",name:"Campo em segundos"},{kind:"angle",name:"Campo de ângulo"},{kind:"date",name:"Campo de data"},{kind:"time",name:"Campo de tempo"},{kind:"cpf",name:"Campo de CPF"},{kind:"cnpj",name:"Campo de CNPJ"},{kind:"url",name:"Campo de URL"},{kind:"email",name:"Campo de e-mail"},{kind:"image",name:"Campo de imagem"},{kind:"attachment",name:"Campo de anexo"}],special:[{kind:"previous_field",name:"Campo de uma etapa anterior"},{kind:"report_item",name:"Seletor de relato"},{kind:"inventory_item",name:"Seletor de item de inventário"},{kind:"inventory_field",name:"Campo de um item de inventário"}]}},e}]),angular.module("CasesServiceModule",[]).factory("CasesService",["$q","FullResponseRestangular","ReturnFieldsService",function(a,b,c){var d={};d.fetchAll=function(a){var d={};d.display_type="full",d.return_fields=c.convertToString(["id","initial_flow_id","created_at","updated_at","next_step_id","total_steps","status","steps_not_fulfilled",{get_responsible_user:["id","name"],get_responsible_group:["id","name"],resolution_state:["title","id"]}]),a=angular.extend(d,a||{});var e=b.all("cases").customGET(null,a);return e.then(function(a){return{cases:a.data.cases,headers:a.headers}})};var e={active:"Ativo",pending:"Em andamento",finished:"Finalizado",inactive:"Inativo",transfer:"Transferido",not_satisfied:"Não finalizado"},f=d.denormalizeCase=function(a){var b={id:a.id,status:e[a.status],flow:a.initial_flow,created_at:a.created_at,updated_at:a.updated_at,current_step:a.current_step?h(a.current_step):null,related_entities:a.related_entities};return a.next_steps&&(b=_.extend(b,{next_steps:_.map(a.next_steps,function(a){return h({id:null,my_step:a})}),next_steps_ids:_.map(a.next_steps,function(a){return a.id})})),a.previous_steps&&(b=_.extend(b,{previous_steps:_.map(_.select(a.case_steps,function(b){return b.id!==a.current_step.id}),h)})),(a.current_step||a.previous_steps||a.next_steps)&&(b=g(b)),b},g=function(a){var b=_.flatten(_.compact([a.current_step,a.previous_steps,a.next_steps])),c=_.flatten(_.map(b,function(a){return a.my_step.my_fields})),e=_.select(c,function(a){return"previous_field"==a.type});return _.each(e,function(a){var c=_.findWhere(b,{step_id:a.previous_field_step_id});void 0!==c&&(a.previous_field=d.denormalizeCaseStepField(a.previous_field,c))}),a},h=function(a){return _.extend(a,{flow_step:_.extend(a.my_step,{fields:_.map(a.my_step.fields_id,function(b){return d.denormalizeCaseStepField(_.findWhere(a.my_step.my_fields,{id:parseInt(b,10)}),a)})}),conductor:a.responsible_user||a.responsible_group})},i=function(a,b){return _.select(b,function(b){return b.field.id==a.id})[0]||{}},j=function(a){return _.include(["meter","centimeter","kilometer","year","month","day","hour","hours","minute","second","angle","decimal","integer"],a.field_type)},k=function(a,b){var c=i(a,b);switch(a.field_type){case"image":return c?c.case_step_data_images:[];case"attachment":return c?c.case_step_data_attachments:[];case"inventory_item":return m(a,b);case"select":if(c)return _.findWhere(a.values,{value:c.value});break;case"checkbox":if(c)return _.map(a.values,function(a){return _.include(c.value,a.value)});break;default:if(c)return j(a)?parseInt(c.value,10):c.value}},l=function(a,b){return i(a,b).report_items},m=function(a,b){return i(a,b).inventory_items};d.denormalizeInventoryFieldValue=function(a,b){switch(a.type){case"select":if(b)return _.findWhere(a.values,{value:b[0]});break;case"radio":if(b)return b[0];break;default:return b}},d.denormalizeInventoryField=function(a,b){return{type:b.kind,values:_.map(_.reject(b.field_options,function(a){return a.disabled}),function(a){return{value:a.id,label:a.value}})}},d.denormalizeCaseStepField=function(a,b){return a.values=a.values?_.map(a.values,function(a){return{value:a,label:a}}):null,_.extend(a,{requirements:_.extend(a.requirements,{presence:a.requirements&&"true"==a.requirements.presence,multiline:a.requirements&&"true"==a.requirements.multiline}),type:a.field_type,inventory_field:a.category_inventory_field?d.denormalizeInventoryField(a,a.category_inventory_field):void 0,value:b.case_step_data_fields&&b.case_step_data_fields.length>0?k(a,b.case_step_data_fields):void 0,report_items:l(a,b.case_step_data_fields),inventory_items:m(a,b.case_step_data_fields),previous_field:a.previous_field})};var n=["id","title","field_type","filter","origin_field_id","origin_field_version","category_inventory","category_inventory_field","category_report","requirements","multiple","values","active","version_id","updated_at","created_at","previous_field_step_id","field_id","previous_field"],o=["id","active","conduction_mode_open","created_at","fields_id","flow_id","step_type","title","updated_at","version_id","permissions",{fields:n,my_fields:n}],p=["id","step_id","created_at",{created_by:["id","name"],responsible_group:["id","name"],responsible_user:["id","name"],updated_by:["id","name"],my_step:o,case_step_data_fields:["id","value","case_step_data_images","case_step_data_images","case_step_data_attachments","report_items","inventory_items",{field:n}]}],q=c.convertToString(["id","status",{case_steps:p,current_step:p,next_steps:o,previous_steps:p,responsible_user:["id"],get_responsible_user:["name"],initial_flow:["id","title","my_resolution_states"],related_entities:[{report_items:["id","title","custom_fields",{category:["id","title",{custom_fields:["id","title"]}]}]}]}]);return d.fetch=function(a){var c={};return c.display_type="full",c.return_fields=q,b.one("cases",a).withHttpConfig({treatingErrors:!0}).customGET(null,c).then(function(a){return f(a.data["case"])})},d.fetchHistory=function(a){return b.one("cases",a).all("history").customGET(null,{display_type:"full",return_fields:c.convertToString(["action","created_at","before_user","before_group","after_user","after_group",{user:["id","name"],step:["id","title"]}])})},d.saveStep=function(a,c){var d={};return d.display_type="full",d.return_fields=q,b.one("cases",a).customPUT(_.extend(d,c)).then(function(a){return f(a.data["case"])})},d.create=function(a){var c=b.all("cases").customPOST(_.extend({return_fields:q},a));return c.then(function(a){return{"case":a.data["case"],headers:a.headers}})},d.inactive=function(a){var c=b.one("cases",a.id).remove();return c.then(function(a){return{message:a.data.message,headers:a.headers}})},d.restore=function(a){var c=b.one("cases",a.id).customPUT(null,"restore");return c.then(function(a){return{message:a.data.message,headers:a.headers}})},d.finish=function(a,c){var d={resolution_state_id:c.id};return b.one("cases",a.id).customPUT(d,"finish")},d}]),angular.module("NamespacesServiceModule",[]).factory("NamespacesService",["$q","Restangular",function(a,b){return self.fetchAll=function(){var c=b.all("namespaces").withHttpConfig({treatingErrors:!0}),d=c.customGET(),e=a.defer();return d.then(function(a){var c=b.stripRestangular(a.data);e.resolve(c)},function(a){e.reject(a)}),e.promise},self.remove=function(c){var d=b.one("namespaces",c).withHttpConfig({treatingErrors:!0}).remove(),e=a.defer();return d.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},self.save=function(c){var d,e=a.defer();return c.id?(d=b.one("namespaces",c.id).withHttpConfig({
treatingErrors:!0}).customPUT(c),d.then(function(a){e.resolve(a.data)},function(a){e.reject(a)})):(d=b.one("namespaces").withHttpConfig({treatingErrors:!0}).customPOST(c),d.then(function(a){e.resolve(a.data)},function(a){e.reject(a)})),e.promise},self}]),angular.module("ChatServiceModule",[]).factory("ChatService",["Restangular","ReturnFieldsService",function(a,b){var c={};return c.listMessages=function(c,d,e){var f={return_fields:b.convertToString(["kind","text","created_at",{user:["id","name"]}])};return e=angular.extend(f,e),a.one(c,d).withHttpConfig({treatingErrors:!1}).customGET("chat",e)},c.postMessage=function(b,c,d){return a.one("chat").withHttpConfig({treatingErrors:!1}).post("messages",{text:b,chattable_type:c,chattable_id:d,return_fields:"id,chattable_id,chattable_type,kind,text,created_at,user.id,user.name"})},c.autoCompleteUser=function(b){return a.one("autocomplete").withHttpConfig({treatingErrors:!1}).getList("user",{term:b})},c.getRooms=function(b){return a.all("chat_rooms").withHttpConfig({treatingErrors:!0}).customGET(null,b)},c.createRoom=function(b){return a.all("chat_rooms").withHttpConfig({treatingErrors:!0}).post(b)},c.updateRoom=function(b){return a.one("chat_rooms",b.id).withHttpConfig({treatingErrors:!0}).put(b)},c.deleteRoom=function(b){return a.one("chat_rooms",b.id).withHttpConfig({treatingErrors:!0}).remove()},c.getRoom=function(b){return a.one("chat_rooms",b).withHttpConfig({treatingErrors:!0}).get()},c}]),angular.module("NotificationServiceModule",[]).factory("NotificationService",NotificationService),NotificationService.$inject=["FullResponseRestangular"],angular.module("UserModule",["UserLoginModule","UserLogoutModule","UserUnauthorizedModule","UserRecoverPasswordModule"]).config(["$stateProvider",function(a){a.state("user",{"abstract":!0,url:"/user",template:""})}]),angular.module("UserLoginModule",["UserLoginControllerModule"]).config(["$stateProvider",function(a){a.state("user.login",{url:"/login",views:{"@":{templateUrl:"routes/user/login/user-login.template.html",controller:"UserLoginController",controllerAs:"ctrl"}}})}]),angular.module("UserLoginControllerModule",["UserPasswordRecoverModalControllerModule"]).controller("UserLoginController",["$scope","$rootScope","$state","Auth","$modal",function(a,b,c,d,e){a.login=function(){return a.loginError=!1,a.processingRequest=!0,d.login(a.email,a.password).then(function(){c.go("reports.index.list")},function(){a.loginError=!0,a.processingRequest=!1}),!1},a.recoverPassword=function(){e.open({templateUrl:"modals/user/password-recovery/user-password-recovery.template.html",windowClass:"removeModal",controller:"UserPasswordRecoveryModalController"})}}]),angular.module("UserLogoutModule",["UserLogoutControllerModule"]).config(["$stateProvider",function(a){a.state("user.logout",{url:"/logout",views:{"@":{template:"",controller:"UserLogoutController",controllerAs:"ctrl"}}})}]),angular.module("UserLogoutControllerModule",[]).controller("UserLogoutController",["$state","Auth",function(a,b){b.logout(),a.go("user.login")}]),angular.module("UserUnauthorizedModule",["UserUnauthorizedControllerModule"]).config(["$stateProvider",function(a){a.state("user.unauthorized",{url:"/unauthorized",views:{"@":{templateUrl:"routes/user/unauthorized/user-unauthorized.template.html",controller:"UserUnauthorizedController",controllerAs:"ctrl"}}})}]),angular.module("UserUnauthorizedControllerModule",[]).controller("UserUnauthorizedController",["$rootScope","Auth","$scope","$state",function(a,b,c,d){!_.isUndefined(a.hasPermission)&&a.hasPermission("panel_access")&&d.go("/"),b.clearToken(),b.clearUser()}]),angular.module("UserRecoverPasswordModule",["UserRecoverPasswordControllerModule"]).config(["$stateProvider",function(a){a.state("user.recover-password",{url:"/password/new/:resetToken",views:{"@":{templateUrl:"routes/user/recover-password/user-recover-password.template.html",controller:"UserRecoverPasswordController",controllerAs:"ctrl"}}})}]),angular.module("UserRecoverPasswordControllerModule",["UsersServiceModule"]).controller("UserRecoverPasswordController",["$scope","$rootScope","$state","Auth","$stateParams","UsersService",function(a,b,c,d,e,f){a.resetToken=e.resetToken,a.newPassword="",a.newPasswordConfirmation="",a.responseMessage="",a.createNewPassword=function(){var b=f.recoverPassword(a.resetToken,a.newPassword,a.newPasswordConfirmation);return b.then(function(b){b.data.error?a.responseMessage=b.data.message:c.go("user.login")}),b}}]),angular.module("IndexModule",["IndexControllerModule"]).config(["$stateProvider",function(a){a.state("home",{url:"/",template:"",resolve:{User:["User",function(a){return a()}]},controller:"IndexController"})}]),angular.module("IndexControllerModule",[]).controller("IndexController",["User","$state","$rootScope","$scope","$log",function(a,b,c,d,e){e.debug("IndexController created."),a?c.hasAnyPermission(["inventories_full_access","inventories_categories_edit","inventories_items_create","inventories_items_edit","inventories_items_delete","inventories_items_read_only"])?b.go("items.list"):b.go("reports.index.list"):b.go("user.login"),d.$on("$destroy",function(){e.debug("IndexController destroyed.")})}]),angular.module("ChatRoomsModule",["ChatRoomsIndexModule","ChatRoomsShowModule"]).config(["$stateProvider",function(a){a.state("chat-rooms",{"abstract":!0,url:"/chat-rooms",templateUrl:"routes/chat-rooms/chat-rooms.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("ChatRoomsIndexModule",["ChatRoomsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("chat-rooms.list",{url:"",views:{"":{templateUrl:"routes/chat-rooms/index/chat-rooms-index.template.html",controller:"ChatRoomsIndexController",controllerAs:"ctrl"}}})}]),angular.module("ChatRoomsIndexControllerModule",["ChatServiceModule","ChatRoomsEditModalControllerModule"]).controller("ChatRoomsIndexController",["$scope","$modal","$timeout","ChatService",function(a,b,c,d){var e=1,f=30;a.rooms=[],a.searchQuery="";var g,h=function(){var b={page:e,per_page:f};return""!==a.searchQuery&&(b.query=a.searchQuery),d.getRooms(b).then(function(b){var c=b.data;c.length>0&&(a.rooms=a.rooms.concat(c),e++)})};a.$watch("searchQuery",function(b,d){g&&c.cancel(g),g=c(function(){angular.equals(d,b)===!1&&a.reload()},1e3)}),a.loadRooms=function(){a.loadingPagination=!0,h().then(function(){a.loadingPagination=!1})},a.reload=function(){a.rooms=[],e=1,a.loadRooms()},a.createRoom=function(){b.open({templateUrl:"modals/chat-rooms/edit/chat-rooms-edit.template.html",windowClass:"chatRoomsEditModal",resolve:{room:function(){return null},rooms:function(){return a.rooms}},controller:"ChatRoomsEditModalController"})},a.deleteRoom=function(c){b.open({templateUrl:"modals/chat-rooms/destroy/chat-rooms-destroy.template.html",windowClass:"removeModal",resolve:{rooms:function(){return a.rooms}},controller:["$scope","$modalInstance","rooms",function(a,b,e){a.room=c,a.confirm=function(){d.deleteRoom(a.room).then(function(){b.close(),a.showMessage("ok","A sala de chat foi excluida com sucesso.","success",!0),e.splice(e.indexOf(a.room),1)})},a.close=function(){b.close()}}]})}}]),angular.module("ChatRoomsShowModule",["ChatRoomsShowControllerModule"]).config(["$stateProvider",function(a){a.state("chat-rooms.show",{url:"/{id:[0-9]{1,4}}",views:{"":{templateUrl:"routes/chat-rooms/show/chat-rooms-show.template.html",controller:"ChatRoomsShowController",controllerAs:"ctrl"}},resolve:{room:["ChatService","$stateParams",function(a,b){return a.getRoom(b.id).then(function(a){return a.data})}]}})}]),angular.module("ChatRoomsShowControllerModule",["ChatServiceModule","ChatRoomsEditModalControllerModule"]).controller("ChatRoomsShowController",["$scope","$modal","ChatService","User","room",function(a,b,c,d,e){a.room=e,a.user=d,a.editRoom=function(){b.open({templateUrl:"modals/chat-rooms/edit/chat-rooms-edit.template.html",windowClass:"chatRoomsEditModal",resolve:{room:function(){return a.room}},controller:"ChatRoomsEditModalController"})}}]),angular.module("ReportsModule",["ReportsIndexModule","ReportsShowModule","ReportsAddModule","ReportsCategoriesIndexModule","ReportsCategoriesEditModule","ReportsPerimetersIndexModule"]).config(["$stateProvider",function(a){a.state("reports",{"abstract":!0,url:"/reports",templateUrl:"routes/reports/reports.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("ReportsIndexModule",["ReportsIndexControllerModule","ReportsIndexListModule","ReportsIndexMapModule","ReportsIndexNotificationsModule","MapComponentModule","StyleResultsTableComponentModule"]).config(["$stateProvider",function(a){a.state("reports.index",{"abstract":!0,views:{"":{templateUrl:"routes/reports/index/reports-index.template.html",controller:"ReportsIndexController",controllerAs:"ctrlReportsIndex"}}})}]),angular.module("ReportsIndexControllerModule",["ReportsDestroyModalControllerModule","OnFocusComponentModule","OnBlurComponentModule","AdvancedFiltersServiceModule","ReportsItemsServiceModule"]).controller("ReportsIndexController",["$rootScope","$scope","Restangular","$modal","$q","AdvancedFilters","$location","$window","$cookies","ReportsItemsService","$state","$log","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l,m){l.debug("ReportsIndexController created."),b.loading=!0,a.uiHasScroll=!0,b.loadingPagination=!1,b.filtersHash=null,b.categories={},b.categoriesStatuses={};var n=function(){b.selectedCategories=[],b.selectedShapefiles=[],b.selectedStatuses=[],b.selectedUsers=[],b.selectedReporters=[],b.selectedGroups=[],b.beginDate=null,b.endDate=null,b.searchText=null,b.overdueOnly=null,b.assignedToMyGroup=null,b.assignedToMe=null,b.minimumNotificationNumber=null,b.daysSinceLastNotification=null,b.daysForLastNotificationDeadline=null,b.daysForOverdueNotification=null,b.position=null,b.selectedAreas=[]};n(),m(["REPORTS_FILTERS_WITH_CATEGORIES","REPORTS_FILTERS_WITH_STATUSES","REPORTS_FILTERS_REPORT_USER","REPORTS_FILTERS_ONLY_DELAYED_REPORTS"]).then(function(a){b.availableFilters=[{name:"Protocolo ou endereço contém...",action:"query"},{name:a.REPORTS_FILTERS_WITH_CATEGORIES,action:"category"},{name:a.REPORTS_FILTERS_WITH_STATUSES,action:"status"},{name:"Criado pelos solicitantes...",action:"author"},{name:a.REPORTS_FILTERS_REPORT_USER,action:"reporter"},{name:"Por período...",action:"date"},{name:"Por perímetros...",action:"area"},{name:"Por perímetro de encaminhamento...",action:"shapefile"},{name:a.REPORTS_FILTERS_ONLY_DELAYED_REPORTS,action:"overdueOnly"},{name:"Associados ao meu grupo...",action:"assignedToMyGroup"},{name:"Associados à mim...",action:"assignedToMe"},{name:"Quantidade de notificações emitidas...",action:"minimumNotificationNumber"},{name:"Dias desde a última notificação emitida...",action:"daysSinceLastNotification"},{name:"Dias para o vencimento da última notificação emitida...",action:"daysForLastNotificationDeadline"},{name:"Dias em atraso para notificações vencidas...",action:"daysForOverdueNotification"}]}),b.activeAdvancedFilters=[],angular.isDefined(i.reportsFiltersHash)&&(b.activeAdvancedFilters=JSON.parse(h.atob(i.reportsFiltersHash))),angular.isDefined(g.search().filters)&&(b.filtersHash=g.search().filters,b.activeAdvancedFilters=JSON.parse(h.atob(b.filtersHash)));var o=function(a,b){a.indexOf(b)===-1&&a.push(b)};b.$watch("activeAdvancedFilters",function(){n(),0!==b.activeAdvancedFilters.length?(b.filtersHash=h.btoa(JSON.stringify(b.activeAdvancedFilters)),g.search("filters",b.filtersHash),i.reportsFiltersHash=b.filtersHash):(b.filtersHash=null,g.search("filters",null),delete i.reportsFiltersHash);for(var a=b.activeAdvancedFilters.length-1;a>=0;a--){var c=b.activeAdvancedFilters[a];"query"===c.type&&(b.searchText=c.value),"categories"===c.type&&o(b.selectedCategories,c.value),"shapefiles"===c.type&&o(b.selectedShapefiles,c.value),"statuses"===c.type&&o(b.selectedStatuses,c.value),"groups"===c.type&&o(b.selectedGroups,c.value),"authors"===c.type&&o(b.selectedUsers,c.value),"reporters"===c.type&&o(b.selectedReporters,c.value),"beginDate"===c.type&&(b.beginDate=c.value),"endDate"===c.type&&(b.endDate=c.value),"area"===c.type&&o(b.selectedAreas,c.value),"overdueOnly"===c.type&&(b.overdueOnly=!0),"assignedToMyGroup"===c.type&&(b.assignedToMyGroup=!0),"assignedToMe"===c.type&&(b.assignedToMe=!0),"minimumNotificationNumber"===c.type&&(b.minimumNotificationNumber=c.value),"daysSinceLastNotification"===c.type&&(b.daysSinceLastNotification=c.value),"daysForLastNotificationDeadline"===c.type&&(b.daysForLastNotificationDeadline=c.value),"daysForOverdueNotification"===c.type&&(b.daysForOverdueNotification=c.value)}p()},!0),b.generateReportsFetchingOptions=function(){var a={};if(null!==b.searchText&&(a.query=b.searchText),0!==b.selectedCategories.length&&(a.reports_categories_ids=b.selectedCategories.join()),0!==b.selectedShapefiles.length&&(a.reports_perimeters_ids=b.selectedShapefiles.join()),0!==b.selectedStatuses.length&&(a.statuses_ids=b.selectedStatuses.join()),0!==b.selectedGroups.length&&(a.groups_ids=b.selectedGroups.join()),0!==b.selectedUsers.length&&(a.users_ids=b.selectedUsers.join()),0!==b.selectedReporters.length&&(a.reporters_ids=b.selectedReporters.join()),null!==b.beginDate&&(a.begin_date=b.beginDate),null!==b.endDate&&(a.end_date=b.endDate),0===b.selectedAreas.length&&null!==b.position)a["position[latitude]"]=b.position.latitude,a["position[longitude]"]=b.position.longitude,a["position[distance]"]=b.position.distance;else if(0!==b.selectedAreas.length)for(var c=b.selectedAreas.length-1;c>=0;c--){var d="position["+c+"][latitude]",e="position["+c+"][longitude]",f="position["+c+"][distance]";a[d]=b.selectedAreas[c].latitude,a[e]=b.selectedAreas[c].longitude,a[f]=b.selectedAreas[c].distance}return null!==b.overdueOnly&&(a.overdue=b.overdueOnly),null!==b.assignedToMyGroup&&(a.assigned_to_my_group=b.assignedToMyGroup),null!==b.assignedToMe&&(a.assigned_to_me=b.assignedToMe),null!==b.minimumNotificationNumber&&(a.minimum_notification_number=b.minimumNotificationNumber),null!==b.daysSinceLastNotification&&(a["days_since_last_notification[begin]"]=b.daysSinceLastNotification.begin,a["days_since_last_notification[end]"]=b.daysSinceLastNotification.end),null!==b.daysForLastNotificationDeadline&&(a["days_for_last_notification_deadline[begin]"]=b.daysForLastNotificationDeadline.begin,a["days_for_last_notification_deadline[end]"]=b.daysForLastNotificationDeadline.end),null!==b.daysForOverdueNotification&&(a["days_for_overdue_notification[begin]"]=b.daysForOverdueNotification.begin,a["days_for_overdue_notification[end]"]=b.daysForOverdueNotification.end),a};var p=b.reload=function(a){b.$broadcast("loadFilters",a)};b.removeFilter=function(a){b.activeAdvancedFilters.splice(b.activeAdvancedFilters.indexOf(a),1)},b.resetFilters=function(){b.activeAdvancedFilters=[],b.$broadcast("resetFilters")},b.loadFilter=function(a){"query"===a&&f.query(b.activeAdvancedFilters),"category"===a&&f.category(b.activeAdvancedFilters,"reports"),"shapefile"===a&&f.shapefile(b.activeAdvancedFilters),"status"===a&&f.status(b.activeAdvancedFilters,"reports"),"group"===a&&f.group(b.activeAdvancedFilters,"reports"),"author"===a&&f.author(b.activeAdvancedFilters),"reporter"===a&&f.reporter(b.activeAdvancedFilters),"date"===a&&f.period(b.activeAdvancedFilters),"area"===a&&f.area(b.activeAdvancedFilters),"overdueOnly"===a&&m("REPORTS_FILTERS_ADVANCED_FILTERS_ONLY_DELAYED_REPORTS").then(function(a){b.activeAdvancedFilters.push({title:"Atraso",type:"overdueOnly",desc:a})}),"assignedToMyGroup"===a&&m("REPORTS_FILTERS_REPORTS_ASSOCIATED").then(function(a){b.activeAdvancedFilters.push({title:a,type:"assignedToMyGroup",desc:"Ao meu grupo"})}),"assignedToMe"===a&&m("REPORTS_FILTERS_REPORTS_ASSOCIATED").then(function(a){b.activeAdvancedFilters.push({title:a,type:"assignedToMe",desc:"À mim"})}),"minimumNotificationNumber"===a&&f.notificationMinimumNumber(b.activeAdvancedFilters),"daysSinceLastNotification"===a&&f.notificationSinceLast(b.activeAdvancedFilters),"daysForLastNotificationDeadline"===a&&f.notificationDeadline(b.activeAdvancedFilters),"daysForOverdueNotification"===a&&f.notificationOverdue(b.activeAdvancedFilters)},b.openReport=function(b,c){a.loading||"a"==c.target.parentNode.tagName.toLowerCase()||"a"==c.target.tagName.toLowerCase()||k.go("reports.show",{id:b})},b.search=function(a){b.searchText=a,p()},b.share=function(){f.share()};b.$on("$destroy",function(){l.debug("ReportsIndexController destroyed.")})}]),angular.module("ReportsIndexListModule",["ReportsIndexListControllerModule"]).config(["$stateProvider",function(a){a.state("reports.index.list",{url:"",views:{"":{templateUrl:"routes/reports/index/list/reports-index-list.template.html",controller:"ReportsIndexListController",controllerAs:"ctrlReportsList"}}})}]),angular.module("ReportsIndexListControllerModule",["ReportsDestroyModalControllerModule","OnFocusComponentModule","OnBlurComponentModule","ReportsItemsServiceModule","angular-toArrayFilter","ConfigServiceModule"]).controller("ReportsIndexListController",["$rootScope","$scope","Restangular","$modal","$q","$location","$window","$cookies","ReportsItemsService","$state","$log","ConfigService",function(a,b,c,d,e,f,g,h,i,j,k,l){k.debug("ReportsIndexListController created.");var m=1,n=15;b.loadingPagination=!1,b.$parent.total=0,b.reports=[],b.sort={column:"created_at",descending:!0},b.sortableColumns={user_name:!0,reporter:!0,created_at:!0,priority:!0},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1),i.resetCache(),b.reload()},b.getColumnClasses=function(a){var c="column-"+a.type;return b.sortableColumns[a.type]&&(c+=" sort-table "+b.selectedCls(a.type)),c},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending},b.deleteReport=function(a){d.open({templateUrl:"modals/reports/destroy/reports-destroy.template.html",windowClass:"removeModal",resolve:{removeReportFromList:function(){return function(a){b.$parent.total--,b.reports.splice(b.reports.indexOf(a),1)}},report:function(){return a}},controller:"ReportsDestroyModalController"})};var o=function(a){var b=["id","status_id","category_id","overdue"],c=function(a){return"custom_field"==a.type};return _.any(_.select(a,c))&&b.push("custom_fields"),a=_.reject(a,function(a){return"custom_field"==a.type}),a=_.map(a,function(a){switch(a.type){case"category":return"category.title";case"reporter":return["reporter.id","reporter.name"].join();case"user":return["user.id","user.name"].join();case"assignment":return["assigned_group.name","assigned_group.title","assigned_user.name","assigned_user.id"].join();case"priority":return"category.priority_pretty";default:return a.type}}),_.union(b,a).join()},p=b.getData=function(){var a=e.defer();if(b.$parent.loadingPagination===!1){b.$parent.loadingPagination=!0;var c=b.generateReportsFetchingOptions();return""!==b.sort.column&&(c.sort=b.sort.column,c.order=b.sort.descending?"desc":"asc"),c.page=+m||1,c.per_page=+n||15,l.getReportsColumns().then(function(d){b.activeColumns=_.filter(d,function(a){return a.active}),c.return_fields=o(b.activeColumns);var e=i.fetchAll(c);e.then(function(c){m++,b.reports=c;var d=Math.ceil(b.total/n);m===d+1?b.$parent.loadingPagination=null:b.$parent.loadingPagination=!1,b.$parent.loading=!1,a.resolve(b.reports)})}),a.promise}};b.$on("reportsItemsFetched",function(){b.$parent.total=i.total,b.$parent.loading=!1}),b.$on("loadFilters",function(a,c){i.resetCache(),m=1,b.$parent.loadingPagination=!1,c&&(b.$parent.reloading=!0),b.$parent.loadingContent=!0,p().then(function(a){b.$parent.loadingContent=!1,b.reports=a,c&&(b.$parent.reloading=!1)})}),b.$on("$destroy",function(){k.debug("ReportsIndexListController destroyed.")})}]),angular.module("ReportsIndexMapModule",["ReportsIndexMapControllerModule","StyleMapComponentModule","MapComponentModule"]).config(["$stateProvider",function(a){a.state("reports.index.map",{url:"/map",views:{"":{templateUrl:"routes/reports/index/map/reports-index-map.template.html",controller:"ReportsIndexMapController",controllerAs:"ctrlReportsMap"}}})}]),angular.module("ReportsIndexMapControllerModule",["ReportsDestroyModalControllerModule","OnFocusComponentModule","OnBlurComponentModule","ReportsItemsServiceModule"]).controller("ReportsIndexMapController",["$rootScope","$scope","Restangular","$modal","$q","$location","$window","$cookies","ReportsItemsService","$state","$log",function(a,b,c,d,e,f,g,h,i,j,k){k.debug("ReportsIndexMapController created.");b.reports=[],b.zoom=null,b.clusterize=null,a.pageHasMap=!0,b.generateReportsFetchingMapOptions=function(){var a=b.generateReportsFetchingOptions();return null!==b.zoom&&(a.zoom=b.zoom),null!==b.clusterize&&(a.clusterize=!0),a},b.$on("reportsItemsFetching",function(){b.$parent.loading=!0}),b.$on("reportsItemsFetched",function(){b.$parent.total=i.total,b.$parent.loading=!1}),b.$on("loadFilters",function(a,c){b.$broadcast("mapRefreshRequested",!0)}),b.$on("resetFilters",function(a,c){b.$broadcast("mapRefreshRequested",!0)}),b.$on("$destroy",function(){a.pageHasMap=!1,k.debug("ReportsIndexMapController destroyed.")})}]),angular.module("ReportsIndexNotificationsModule",["ReportsIndexNotificationsControllerModule"]).config(["$stateProvider",function(a){a.state("reports.index.notifications",{url:"/notifications",views:{"":{templateUrl:"routes/reports/index/notifications/reports-index-notifications.template.html",controller:"ReportsIndexNotificationsController",controllerAs:"ctrlReportsNotifications"}}})}]),angular.module("ReportsIndexNotificationsControllerModule",["ReportsDestroyModalControllerModule","OnFocusComponentModule","OnBlurComponentModule","ReportsCategoriesNotificationsServiceModule","angular-toArrayFilter"]).controller("ReportsIndexNotificationsController",["$rootScope","$scope","Restangular","$modal","$q","$location","$window","$cookies","ReportsCategoriesNotificationsService","$state","$log",function(a,b,c,d,e,f,g,h,i,j,k){k.debug("ReportsIndexNotificationsController created.");var l=1,m=15;b.loadingPagination=!1,b.$parent.total=0,b.notifications=[];var n=b.getData=function(){if(b.$parent.loadingPagination===!1){b.$parent.loadingPagination=!0;var a=b.generateReportsFetchingOptions();a.page=+l||1,a.per_page=+m||15;var c=i.searchNotifications(a);return c.then(function(a){l++,b.notifications=a;var c=Math.ceil(b.$parent.total/m);l===c+1?b.$parent.loadingPagination=null:b.$parent.loadingPagination=!1,b.$parent.loading=!1}),c}};b.$on("notificationsFetched",function(){b.$parent.total=i.total,b.$parent.loading=!1}),b.$on("loadFilters",function(a,c){i.cleanCache(),l=1,b.$parent.loadingPagination=!1,c===!0&&(b.$parent.reloading=!0),b.$parent.loadingContent=!0,n().then(function(a){b.$parent.loadingContent=!1,b.notifications=a,c===!0&&(b.$parent.reloading=!1)})}),b.getDaysTxt=function(a){var b=_.isNull(a)||_.isUndefined(a)?0:a;return b<0?Math.abs(b)+" dia"+(b===-1?"":"s")+" atrás":b+" dia"+(1===b?"":"s")},b.$on("$destroy",function(){k.debug("ReportsIndexNotificationsController destroyed.")})}]),angular.module("ReportsShowModule",["ReportsShowControllerModule","ReportsShowPrintModule"]).config(["$stateProvider",function(a){a.state("reports.show",{url:"/{id:[0-9]{1,9}}",resolve:{reportResponse:["Restangular","$stateParams","ReturnFieldsService",function(a,b,c){var d=["id","protocol","address","number","district","country","postal_code","state","city","created_at","description","comment_required_when_updating_status","feedback","images","inventory_item","inventory_item_category_id","overdue","position","reference","status","custom_fields","perimeter","offensive_flags",{notifications:["created_at","days_to_deadline","content","active",{notification_type:["title","default_deadline_in_days"]}],category:["custom_fields","id","marker","notifications","icon","priority_pretty","comment_required_when_updating_status","comment_required_when_forwarding","solver_groups_ids","statuses","title",{solver_groups:["id","name"],default_solver_group:["name","id"]}],user:["name","email","id","phone"],assigned_user:["id","name"],assigned_group:["id","name"],related_entities:[{inventory_items:["id","title","sequence","created_at","updated_at",{category:["title"],status:["title"]}],cases:["id","created_at","updated_at","status",{initial_flow:["title"]}]}]}];return a.one("reports").one("items",b.id).get({return_fields:c.convertToString(d)})}]},views:{"":{templateUrl:"routes/reports/show/reports-show.template.html",controller:"ReportsShowController",controllerAs:"ctrl"}}})}]),angular.module("ReportsShowControllerModule",["MapShowReportComponentModule","ReportsEditStatusModalControllerModule","ReportsEditDescriptionModalControllerModule","ReportsEditCustomFieldModalControllerModule","ReportsEditCategoryModalControllerModule","ReportsSelectAddressModalControllerModule","ReportsForwardModalControllerModule","ReportsSelectUserModalControllerModule","ReportsEditReferenceModalControllerModule","ReportsPrintModalControllerModule","ReportSearchMapComponentModule","MapNewReportComponentModule","NextFieldOnEnterComponentModule","duScroll","ReportsSendNotificationsModalControllerModule","ReportsCategoriesNotificationsServiceModule","ReportsCategoriesServiceModule","ReportsFeatureFlagsServiceModule","ckeditor","angularLoad","CasesServiceModule"]).value("duScrollOffset",200).controller("ReportsShowController",["$scope","Restangular","$q","$modal","$window","reportResponse","$state","$rootScope","$log","CasesService","ReportsCategoriesNotificationsService","ReportsCategoriesService","ReportsFeatureFlagsService","angularLoad","ENV",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){var b=Math.abs(a);return b+(1===b?" dia":" dias")}i.info("ReportsShowController created."),a.$on("$destroy",function(){i.info("ReportsShowController destroyed.")}),a.report=f.data,a.report.related_entities.cases&&(a.report.related_entities.cases=_.map(a.report.related_entities.cases,function(a){return j.denormalizeCase(a)})),a.report.status&&(a.report.status_id=a.report.status.id),a.categoryData=a.report.category,a.report.custom_fields=_.map(a.report.category.custom_fields,function(b){return a.report.custom_fields[b.id]&&(b.value=a.report.custom_fields[b.id]),b}),a.images=[],a.report.position?(a.lat=a.report.position.latitude,a.lng=a.report.position.longitude):(a.lat=null,a.lng=null),b.one("reports",a.report.id).all("comments").getList({return_fields:"id,created_at,message,visibility,author.id,author.name"}).then(function(b){a.comments=b.data}),b.one("reports",a.report.id).one("feedback").get({return_fields:"id,kind,content,images"}).then(function(b){a.feedback=b.data}),m.getFeatureFlags().then(function(b){m.convertFeaturesFlagsFrom(b.data).and().addInto(a)});for(var q=a.report.images.length-1;q>=0;q--)a.images.push({versions:a.report.images[q]});a.newUserResponse={message:null,privateComment:!0,typing:!1},a.newSystemComment={message:null,typing:!1},a.filterByUserMessages=function(a){return 0===a.visibility||1===a.visibility};var r=function(c,d){return b.one("reports",a.report.id).customPOST({message:c,visibility:d,return_fields:"id,created_at,message,visibility,author.id,author.name"},"comments")};a.submitUserResponse=function(){a.processingComment=!0;var b=0;a.newUserResponse.privateComment&&(b=1);var c=r(a.newUserResponse.message,b);c.then(function(b){a.newUserResponse.message=null,a.processingComment=!1,a.comments.push(b.data),a.refreshHistory()})},a.submitSystemComment=function(){a.processingSystemComment=!0;var b=r(a.newSystemComment.message,2);b.then(function(b){a.processingSystemComment=!1,a.newSystemComment.message=null,a.comments.push(b.data),a.refreshHistory()})},a.editCategory=function(){h.resolvingRequest=!0,d.open({templateUrl:"modals/reports/edit-category/reports-edit-category.template.html",windowClass:"report-edit-category-modal",resolve:{report:function(){return a.report},category:function(){return a.report.category},categories:function(){return b.all("reports").all("categories").getList({display_type:"full",return_fields:"id,title,subcategories.id,subcategories.title"})}},controller:"ReportsEditCategoryModalController"})},a.editReportStatus=function(c,e){h.resolvingRequest=!0,d.open({templateUrl:"modals/reports/edit-status/reports-edit-status.template.html",windowClass:"editStatusModal",resolve:{report:function(){return c},category:function(){return e},statusesResponse:function(){return b.one("reports").one("categories",a.report.category.id).all("statuses").getList()}},controller:"ReportsEditStatusModalController"})};var s=["address","number","city","postal_code","reference","state","country","district"],t=a.lat,u=a.lng;a.editAddress=function(){a.editingAddress=!0,t=a.lat,u=a.lng,a.address={},_.each(s,function(b){a.address[b]=a.report[b]}),a.address.number=parseInt(a.address.number,10)},a.cancelAddressEdit=function(){a.editingAddress=!1,a.lat=t,a.lng=u},a.saveAddress=function(c){if(c.$submitted=!0,c.$valid){a.savingAddress=!0;var d={latitude:a.lat,longitude:a.lng,return_fields:"position.latitude,position.longitude,address,number,reference,district,postal_code,state,city,assigned_group.id,assigned_group.name,perimeter"};_.each(s,function(a){d[a]=c[a].$viewValue});var e=b.one("reports",a.report.category.id).one("items",a.report.id).customPUT(d);e.then(function(b){var c=b.data;a.showMessage("ok","O endereço do relato foi alterado com sucesso.","success",!0),a.loading=a.savingAddress=a.editingAddress=!1,a.report.position=c.position,a.lat=a.report.position.latitude,a.lng=a.report.position.longitude,_.each(s,function(b){a.report[b]=c[b]}),a.report.assigned_group=c.assigned_group,a.report.perimeter=c.perimeter,a.refreshHistory()})}},a.editDescription=function(){d.open({templateUrl:"modals/reports/edit-description/reports-edit-description.template.html",windowClass:"editReportModal",resolve:{report:function(){return a.report},refreshHistory:function(){return a.refreshHistory}},controller:"ReportsEditDescriptionModalController"})},a.editCustomField=function(b){d.open({templateUrl:"modals/reports/edit-custom-field/reports-edit-custom-field.template.html",windowClass:"editReportModal",resolve:{field:function(){return b},report:function(){return a.report}},controller:"ReportsEditCustomFieldModalController"})},a.editReference=function(){d.open({templateUrl:"modals/reports/edit-reference/reports-edit-reference.template.html",windowClass:"editReportModal",resolve:{report:function(){return a.report},parentScope:function(){return a}},controller:"ReportsEditReferenceModalController"})},a.forwardReport=function(){h.resolvingRequest=!0,d.open({templateUrl:"modals/reports/forward/reports-forward.template.html",windowClass:"reports-forward-modal",resolve:{report:function(){return a.report},category:function(){return a.report.category},groupsResponse:function(){return b.all("groups").getList({return_fields:"id,name"})}},controller:"ReportsForwardModalController"})},a.assignReport=function(){d.open({templateUrl:"modals/reports/select-user/reports-select-user.template.html",windowClass:"modal-reports-select-user",resolve:{setUser:["Restangular","$state","$rootScope",function(b,c,d){return function(e){d.resolvingRequest=!0;var f=b.one("reports",a.report.category.id).one("items",a.report.id).one("assign").customPUT({user_id:e.id,return_fields:""});f.then(function(){d.resolvingRequest=!1,a.showMessage("ok","O usuário responsável foi alterado com sucesso.","success",!0),c.go(c.current,{},{reload:!0})})}}],filterByGroup:function(){return a.report.assigned_group.id}},controller:"ReportsSelectUserModalController"})},a.print=function(){d.open({templateUrl:"modals/reports/print/reports-print.template.html",windowClass:"filterCategoriesModal",resolve:{openModal:function(){return function(b){e.open("#/reports/"+a.report.id+"/print?sections="+b.join(),"ZUP Imprimir relato","height=800,width=850")}}},controller:"ReportsPrintModalController"})},a.refreshHistory=function(){var c={return_fields:"changes,created_at,kind,user.id,user.name,action"
},d=a.selectedFilters();0!==d.length&&(c.kind=d.join()),a.historyFilterBeginDate&&(c["created_at[begin]"]=a.historyFilterBeginDate),a.historyFilterEndDate&&(c["created_at[end]"]=a.historyFilterEndDate),a.loadingHistoryLogs=!0;var e=b.one("reports").one("items",a.report.id).one("history").getList(null,c);e.then(function(b){a.historyLogs=b.data;for(var c=!1,d=0,e=a.historyLogs.length;d<e;d++){var f=a.historyLogs[d],g=f.kind;if("overdue"!==g){if(c&&("status"===g||"creation"===g)){a.overdue_status=f.changes["new"].title;break}}else c=!0}a.loadingHistoryLogs=!1})},a.historyOptions={type:void 0},a.availableHistoryFilters=[{type:"category",name:"Categoria",selected:!1},{type:"status",name:"Estados",selected:!1},{type:"address",name:"Endereço",selected:!1},{type:"description",name:"Descrição",selected:!1},{type:"category",name:"Categoria",selected:!1}],a.availableHistoryDateFilters=[{name:"Hoje",beginDate:moment().startOf("day").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Ontem",beginDate:moment().subtract(1,"days").startOf("day").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Este mês",beginDate:moment().startOf("month").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Mês passado",beginDate:moment().subtract(1,"months").startOf("month").format(),endDate:moment().subtract(1,"months").subtract(1,"days").endOf("day").format(),selected:!1},{name:"Todos",beginDate:null,endDate:null,selected:!0}],a.selectedFilters=function(){var b=[];return _.each(a.availableHistoryFilters,function(a){a.selected&&b.push(a.type)}),b},a.toggleOption=function(b){b.selected=!b.selected,a.refreshHistory()};var v=a.report.address,w=a.report.number,x=!1;a.fieldOnEnter=function(b,c){return"address"==b.name||""==a.address.address||""==a.address.number?void(x=!1):void(a.address.address==v&&a.address.number==parseInt(w,10)||(x=!0,v=a.address.address,w=a.address.number,a.$broadcast("addressChanged")))},a.$on("reports:position-updated",function(b,c){a.lat=c.lat(),a.lng=c.lng(),x||a.$broadcast("addressChanged",!0)}),a.resetHistoryFilters=function(){_.each(a.availableHistoryFilters,function(a){a.selected=!0}),a.refreshHistory()},a.showCustomDateFields=function(){_.each(a.availableHistoryDateFilters,function(a){a.selected=!1}),a.showCustomDateHelper=!0},a.selectDateFilter=function(b){_.each(a.availableHistoryDateFilters,function(a){a.selected=!1}),b.selected=!b.selected,a.historyFilterBeginDate=b.beginDate,a.historyFilterEndDate=b.endDate,a.showCustomDateHelper=!1,a.refreshHistory()},a.historyLogs=[],a.refreshHistory(),a.canSendNotifications=a.report.category.notifications&&h.hasAnyPermission(["reports_items_restart_notification","reports_items_send_notification","reports_full_access","reports_categories_edit","reports_items_edit"]),a.notifications=a.report.notifications,a.reloadNotifications=function(){var c=["status","notifications.notification_type.title","notifications.notification_type.default_deadline_in_days","notifications.created_at","notifications.days_to_deadline","notifications.content","notifications.active"];b.one("reports").one("items",a.report.id).get({return_fields:c.join()}).then(function(b){a.notifications=b.data.notifications})},a.scriptLoaded=!1,n.loadScript(o.ckeditorPath).then(function(){a.scriptLoaded=!0}),a.getDaysTxt=function(a){return a<0?p(a)+" atrás":0===a?"Encerrado":p(a)},a.showNotificationsModal=function(){d.open({templateUrl:"modals/reports/notifications/reports-notifications-modal.template.html",windowClass:"reports-notifications-modal",backdrop:"static",resolve:{report:function(){return a.report},notifications:function(){return a.retrieveNotificationsPromise=k.getAvailableNotificationsForReport(a.report.id,a.report.category.id),a.retrieveNotificationsPromise},parentScope:function(){return a}},controller:"ReportsSendNotificationsModalController"})},a.openRelatedCase=function(a){g.go("cases.edit",{id:a.id})},a.openRelatedInventoryItem=function(a){g.go("items.show",{id:a.id})}}]),angular.module("ReportsShowPrintModule",["ReportsShowPrintControllerModule"]).config(["$stateProvider",function(a){a.state("reports.show.print",{url:"/print?sections",resolve:{reportResponse:["Restangular","$stateParams",function(a,b){return a.one("reports").one("items",b.id).get()}],feedbackResponse:["Restangular","$stateParams",function(a,b){return a.one("reports",b.id).one("feedback").get()}],commentsResponse:["Restangular","$stateParams",function(a,b){return a.one("reports",b.id).all("comments").getList()}],reportHistoryResponse:["Restangular","$stateParams",function(a,b){return a.one("reports").one("items",b.id).one("history").getList()}]},views:{"@":{templateUrl:"routes/reports/show/print/reports-show-print.template.html",controller:"ReportsShowPrintController",controllerAs:"ctrl"}}})}]),angular.module("ReportsShowPrintControllerModule",["MapShowReportComponentModule"]).controller("ReportsShowPrintController",["$scope","$window","$timeout","$document","$stateParams","reportResponse","feedbackResponse","commentsResponse","reportHistoryResponse",function(a,b,c,d,e,f,g,h,i){a.report=f.data,a.report.status_id=a.report.status.id,a.feedback=g.data,a.comments=h.data;var j=e.sections.split(",");a.showSection=function(a){return j.indexOf(a)!==-1},a.showAnySection=function(b){return _.reduce(b,function(b,c){return b||a.showSection(c)})},a.filterByUserMessages=function(a){return 0===a.visibility||1===a.visibility},a.historyLogs=i.data,a.print=function(){b.print()}}]),angular.module("ReportsAddModule",["ReportsAddControllerModule"]).config(["$stateProvider",function(a){a.state("reports.add",{url:"/add",views:{"":{templateUrl:"routes/reports/add/reports-add.template.html",controller:"ReportsAddController",controllerAs:"ctrl",resolve:{inventoriesCategoriesResponse:["Restangular","$stateParams",function(a,b){return a.all("inventory").all("categories").getList({display_type:"full",return_fields:["id","title","pin","marker"].join()})}],reportCategoriesResponse:["Restangular","$stateParams",function(a,b){return a.all("reports").all("categories").getList({display_type:"full",return_fields:["id","title","pin","marker","inventory_categories","subcategories.id","subcategories.title","subcategories.inventory_categories","subcategories.pin","custom_fields","subcategories.marker"].join()})}]}}}})}]),angular.module("ReportsAddControllerModule",["SelectListComponentModule","ReportsSelectUserModalControllerModule","ReportsCreateUserModalControllerModule","ReportSearchMapComponentModule","MapNewReportComponentModule","NgThumbComponentModule"]).controller("ReportsAddController",["ENV","$scope","$rootScope","Restangular","$q","$modal","$state","FileUploader","onlyImagesUploaderFilter","reportCategoriesResponse","inventoriesCategoriesResponse","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=j.data;b.address={city:a.defaultCity,state:a.defaultState,country:a.defaultCountry},b.categories=m,b.createAnother=!1,b.inventoryCategories=k.data;var n=b.uploader=new h;b.selectedCategory=null,n.filters.push(i(n.isHTML5)),b.getInventoryCategory=function(a){for(var c=b.inventoryCategories.length-1;c>=0;c--)if(b.inventoryCategories[c].id===a)return b.inventoryCategories[c];return null};var o=function(a){return b.has_custom_fields=a.custom_fields&&a.custom_fields.length>0,b.has_custom_fields&&(b.custom_fields={}),b.categoryData=a};b.$watch("selectedCategory",function(a,c){if(a!==c)for(var d=b.categories.length-1;d>=0;d--){if(b.categories[d].id===parseInt(b.selectedCategory))return o(b.categories[d]);if(0!==b.categories[d].subcategories.length)for(var e=b.categories[d].subcategories.length-1;e>=0;e--)if(b.categories[d].subcategories[e].id===parseInt(b.selectedCategory))return o(b.categories[d].subcategories[e])}}),b.selectUser=function(){f.open({templateUrl:"modals/reports/select-user/reports-select-user.template.html",windowClass:"modal-reports-select-user",resolve:{setUser:function(){return function(a){b.user=a}},filterByGroup:function(){return null}},controller:"ReportsSelectUserModalController"})},b.registerUser=function(){f.open({templateUrl:"modals/reports/create-user/reports-create-user.template.html",windowClass:"modal-reports-create-user",resolve:{setUser:function(){return function(a){b.user=a}}},controller:"ReportsCreateUserModalController"})};var p=function(a){var b=e.defer(),c=new FileReader;return c.addEventListener("load",function(c){var d=c.target,e={};e.content=d.result.replace(/^data:image\/[^;]+;base64,/,""),e.title=a.file.title,e.file_name=a.file.name,b.resolve(e)}),c.readAsDataURL(a._file),b.promise};b.$on("reportMap:position_changed",function(a,c){b.lat=c.lat(),b.lng=c.lng()});var q=b.address.address,r=b.address.number,s=!1;b.fieldOnEnter=function(a,c){return"address"==a.name||""==b.address.address||""==b.address.number?void(s=!1):void(b.address.address==q&&b.address.number==parseInt(r,10)||(s=!0,q=b.address.address,r=b.address.number,b.$broadcast("addressChanged")))},b.addressChanged=function(){b.$broadcast("addressChanged")},b.$on("reports:position-updated",function(a,c){b.lat=c.lat(),b.lng=c.lng(),s||b.$broadcast("addressChanged",!0)}),b.send=function(){c.resolvingRequest=!0;for(var a=[],f=b.uploader.queue.length-1;f>=0;f--)a.push(p(b.uploader.queue[f]));e.all(a).then(function(a){var e={latitude:b.lat,longitude:b.lng,inventory_item_id:b.itemId,description:b.description,reference:b.address.reference,address:b.address.address,number:b.address.number,district:b.address.district,city:b.address.city,state:b.address.state,country:b.address.country,postal_code:b.address.postal_code,images:a,custom_fields:b.custom_fields,return_fields:"id"};b.user&&(e.user_id=b.user.id);var f=d.one("reports",b.selectedCategory).customPOST(e,"items");f.then(function(a){b.showMessage("ok","O relato foi criado com sucesso.","success",!0),b.createAnother?(b.lat=null,b.lng=null,b.itemId=null,b.description=null,b.formattedAddress=null,b.reference=null,b.user=null,b.address={},b.uploader.clearQueue(),c.resolvingRequest=!1):g.go("reports.show",{id:a.data.id})})})}}]),angular.module("ReportsCategoriesIndexModule",["ReportsCategoriesIndexControllerModule","ReportsCategoriesServiceModule"]).config(["$stateProvider",function(a){a.state("reports.categories",{url:"/categories",cache:!1,views:{"":{templateUrl:"routes/reports/categories/index/reports-categories-index.template.html",controller:"ReportsCategoriesIndexController",controllerAs:"ctrl"}}})}]),angular.module("ReportsCategoriesIndexControllerModule",["ReportsCategoriesDestroyModalControllerModule","ReportsCategoriesServiceModule"]).controller("ReportsCategoriesIndexController",["$scope","ReportsCategoriesService","$modal",function(a,b,c){a.loading=!0;var d=function(b){b=angular.copy(b),_.each(b,function(c){if(null!==c.parent_id){var d=b.indexOf(_.findWhere(b,{id:c.parent_id}));if(d===-1)return!1;var e=b.indexOf(c);_.isUndefined(b[d].subcategories)?b[d].subcategories=[c]:b[d].subcategories.push(c),b[e]=void 0}b=_.without(b,void 0),a.categories=b}),a.loading=!1};b.fetchAllBasicInfo().then(function(a){d(a.data.categories)}),a.iconSeed=Math.random().toString(36).substring(7),a.deleteCategory=function(b){c.open({templateUrl:"modals/reports/categories/destroy/reports-categories-destroy.template.html",windowClass:"removeModal",resolve:{destroyCategory:function(){return function(b){if(_.isNull(b.parent_id))a.categories.splice(a.categories.indexOf(b),1);else{var c=_.findWhere(a.categories,{id:b.parent_id}).subcategories;c.splice(c.indexOf(b),1)}}},category:function(){return b}},controller:"ReportsCategoriesDestroyModalController"})}}]),angular.module("ReportsCategoriesEditModule",["ReportsCategoriesEditControllerModule"]).config(["$stateProvider",function(a){a.state("reports.categories.edit",{url:"/{id:[0-9]{1,4}}/edit",views:{"@reports":{templateUrl:"routes/reports/categories/edit/reports-categories-edit.template.html",controller:"ReportsCategoriesEditController",controllerAs:"ctrl",resolve:{reportCategoriesResponse:["Restangular",function(a){return a.all("reports").all("categories").getList({display_type:"full",return_fields:"id,title"})}],groupsResponse:["Restangular",function(a){return a.all("groups").getList({return_fields:"id,name"})}],notificationsTypesResponse:["Restangular","$stateParams",function(a,b){return a.one("reports").one("categories",b.id).all("notification_types").getList({return_fields:"id,category.id,status.id,order,title,default_deadline_in_days,layout,active,created_at,updated_at"})}]}}}}).state("reports.categories.add",{url:"/add",views:{"@reports":{templateUrl:"routes/reports/categories/edit/reports-categories-edit.template.html",controller:"ReportsCategoriesEditController",controllerAs:"ctrl",resolve:{reportCategoriesResponse:["Restangular",function(a){return a.all("reports").all("categories").getList({return_fields:"id,title"})}],groupsResponse:["Restangular",function(a){return a.all("groups").getList({return_fields:"id,name"})}],notificationsTypesResponse:[function(){return{}}]}}}})}]),angular.module("ReportsCategoriesEditControllerModule",["FormatErrorsHelperModule","NgThumbComponentModule","SelectListComponentModule","MultipleSelectListComponentModule","ReportsCategoriesManageStatusesModalControllerModule","ReportsCategoriesServiceModule","ReportsCategoriesNotificationsLayoutControllerModule","DisplayNotificationDirectiveModule","ReportsPerimetersServiceModule","CustomFieldsEditorDirectiveModule"]).factory("NotificationTypesService",["Restangular","$q",function(a,b){function c(){var c=this;c.notificationTypesMap={},c.cleanCache=function(){c.notificationTypesMap={}},c.updateCache=function(a,b){c.notificationTypesMap[a]=b},c.getNotificationTypesArrayForCategory=function(d){var e=b.defer();return c.notificationTypesMap[d]?e.resolve(c.notificationTypesMap[d]):a.one("reports").one("categories",d).all("notification_types").getList({return_fields:"id,category.id,status.id,order,title,default_deadline_in_days,layout,active,created_at,updated_at"}).then(function(a){c.updateCache(d,a.data),e.resolve(a.data)},function(a){e.reject(a)}),e.promise},c.saveNotificationType=function(b,c){return a.one("reports").one("categories",b).withHttpConfig({treatingErrors:!0}).post("notification_types",c)},c.updateNotificationType=function(b,c){return a.one("reports").one("categories",b).one("notification_types",c.id).withHttpConfig({treatingErrors:!0}).customPUT(c)},c.deleteNotificationType=function(b,c){return a.one("reports").one("categories",b).one("notification_types",c.id).remove()}}return new c}]).controller("ReportsCategoriesEditController",["$scope","$rootScope","$stateParams","NotificationTypesService","Restangular","FileUploader","$q","$http","$location","$anchorScroll","$modal","$document","reportCategoriesResponse","groupsResponse","notificationsTypesResponse","Error","ReportsCategoriesService","$log","$state","ReportsPerimetersService","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=a.updating=!1,w=a.categoryId=c.id;r.debug("ReportsCategoriesEditController created."),a.$on("$destroy",function(){r.debug("ReportsCategoriesEditController destroyed.")}),"undefined"!=typeof w&&(v=!0,a.updating=!0),a.mainColors=["#59B1DF","#7DDCE2","#64D2AF","#5CB466","#99C450","#EACD31","#F3AC2E","#F18058","#EF4D3E","#E984FC","#A37FE1","#7A7AF2"],a.alternativeColors=["#4383A6","#5CAFB5","#4D9F88","#3E7148","#73943D","#AC9827","#B78226","#C45C35","#A23463","#A938BE","#7340C1","#5051BB","#28344E","#465366","#677B86","#8195A0","#A0B2BC","#B9CDD8"],a.loading=!0,a.defaultResolutionTimeSelection=60,a.defaultUserResponseTimeSelection=60;var x=86400,y=3600,z=60,A=function(a){return a%x==0?x:a%y==0?y:z};a.perimeters=[],a.perimetersGroupsToRemove=[];var B=a.loadPerimeters=function(){a.loading=!0,t.fetchAll().then(function(b){_.forEach(b,function(b){_.isEqual(b.status,"imported")&&a.perimeters.push(b)}),a.loading=!1})};B(),a.showPerimeters=!1,a.perimetersLimit=5;var C=function(a,b,c,d){var e=_.find(a,function(a){return _.isEqual(a[b],d)});return e?e[c]:"Não disponível"};a.getPerimeterTitle=function(b){return C(a.perimeters,"id","title",b)},a.getGroupTitle=function(b){return C(a.groups,"id","name",b)},a.addNewPerimeterGroup=function(){var b={};b.category_id=w,b.editing=!0,a.perimetersGroups.push(b)},a.changePerimetersDelay=function(){u(function(){a.showPerimeters=a.category.perimeters},1e3)},a.updatePerimetersLimit=function(){a.perimetersLimit<a.perimetersGroups.length?a.perimetersLimit+=5:a.perimetersLimet=a.perimetersGroups.length},a.removePerimeterGroup=function(b){b.id&&a.perimetersGroupsToRemove.push(b),a.perimetersGroups.splice(a.perimetersGroups.indexOf(b),1)},a.reportCategories=m.data,a.groups=n.data,a.notificationTypesArray=[];var D=function(){for(var b=0;b<a.notificationTypesArray.length;b++){var c=a.notificationTypesArray[b],d=c.status;d&&(c.reports_status_id=d.id),c.order||(c.order=b)}a.notificationTypesArray.sort(function(a,b){return a.order>b.order})},E=function(){d.cleanCache(),d.getNotificationTypesArrayForCategory(w).then(function(b){a.notificationTypesArray=b,D()})};a.prepareToDeleteNotificationType=function(b){a.notificationTypeToDelete=b},a.prepareToDisplayNotification=function(b){a.notificationContentToDisplay=b.layout},a.deleteNotificationType=function(b){a.deleteNotificationTypePromise=d.deleteNotificationType(w,b).then(function(){a.showMessage("ok","O tipo de notificacao foi removido com sucesso","success",!0),a.notificationTypesArray.splice(a.notificationTypesArray.indexOf(b),1)})},a.notificationsSortableOptions={handle:".move",stop:function(b,c){a.notificationOrderArray=[];for(var d=0;d<a.notificationTypesArray.length;d++)a.notificationOrderArray[a.notificationTypesArray[d].id]=d},start:function(a,b){b.placeholder.height(b.item.height())},tolerance:"pointer",items:"li",revert:!0,placeholder:"ui-sortable-placeholder-notification-type"},a.editingNotificationType=!1,a.editingNotificationTypeId="",a.addingNotificationType=!1,a.addNotificationType=function(){a.addingNotificationType=!0;var b={};b.order=a.notificationTypesArray.length,b.title="Novo tipo de notificação",b.id=void 0,b.reports_category_id=w,a.notificationTypesArray[b.order]=b,a.editNotificationType(b)},a.editNotificationType=function(b){a.dirtyNotificationType=!1,a.notificationTypeOriginator=b,a.notificationTypeMemento=angular.copy(b),a.editingNotificationTypeId=b.id,a.editingNotificationType=!0},a.verifyDirtyNotificationTypeMemento=function(b){a.notificationTypeMemento.default_deadline_in_days=parseInt(a.notificationTypeMemento.default_deadline_in_days,10);var c=angular.equals(b,a.notificationTypeMemento);a.dirtyNotificationType=!c};var F=function(b){a.showMessage("ok",b,"success",!0)},G=function(b,c){a.showMessage("exclamation-sign",c,"error",!0),"object"!=typeof b.data.error?p.show(b):a.inputErrors=b.data.error};a.updateEditingNotificationType=function(b){a.inputErrors=null,b.title=a.notificationTypeMemento.title,b.reports_status_id=a.notificationTypeMemento.reports_status_id,b.default_deadline_in_days=a.notificationTypeMemento.default_deadline_in_days,b.layout=a.notificationTypeMemento.layout,a.saveNotificationTypePromise=void 0,a.addingNotificationType?a.saveNotificationTypePromise=d.saveNotificationType(w,b).then(function(){H(),a.addingNotificationType=!1,F("O tipo de notificação foi criado com sucesso"),E(),a.saveNotificationTypePromise=void 0},function(b){G(b,"O tipo de notificação não pode ser salvo"),a.saveNotificationTypePromise=void 0}):a.saveNotificationTypePromise=d.updateNotificationType(w,b).then(function(){H(),a.addingNotificationType=!1,F("O tipo de notificação foi atualizado com sucesso"),E(),a.saveNotificationTypePromise=void 0},function(b){G(b,"O tipo de notificação não pode ser salvo"),a.saveNotificationTypePromise=void 0})};var H=function(){a.dirtyNotificationType=!1,a.notificationTypeMemento=null,a.editingNotificationTypeId=null,a.editingNotificationType=!1};a.cancelEditingNotificationType=function(){a.addingNotificationType&&(a.notificationTypesArray.splice(a.notificationTypesArray.length-1,1),a.addingNotificationType=!1),H()},a.isEditNotificationType=function(b){return a.editingNotificationTypeId===b.id},a.isDirtyNotificationType=function(b){return a.isEditNotificationType(b)&&a.dirtyNotificationType},a.editNotificationTypeLayout=function(b){k.open({templateUrl:"modals/reports/categories/notifications/reports-categories-notifications-layout.template.html",windowTemplateUrl:"modals/reports/categories/notifications/reports-categories-notifications-layout-modal.template.html",backdrop:!1,resolve:{notificationType:function(){return b},parentScope:function(){return a}},controller:"ReportsCategoriesNotificationsLayoutController",navigateWithoutLoading:"/layout-modal"})};var I,J=e.one("inventory").all("categories").getList({return_fields:"id,title"});if(v){I=a.category={};var K=e.one("reports").one("categories",w).get(),L=t.getPerimetersGroups(w);g.all([J,K,L]).then(function(b){if(a.categories=b[0].data,_.extend(I,b[1].data),I.statuses=_.map(b[1].data.statuses,function(a){return a.flow&&(a.flow_id=a.flow.id,a.flow_title=a.flow.title),a}),I.solver_groups_ids||(I.solver_groups_ids=[]),I.default_solver_group&&(I.default_solver_group_id=I.default_solver_group.id),I.default_solver_group_id&&0==I.solver_groups_ids.length&&I.solver_groups_ids.push(I.default_solver_group_id),I.solver_groups=N(a.groups,I.solver_groups_ids),a.showPerimeters=I.perimeters=b[1].data.perimeters,a.perimetersGroups=b[2],d.updateCache(w,o.data),a.notificationTypesArray=o.data,D(),null!==b[1].data.user_response_time&&(a.enabledUserResponseTime=!0,I.user_response_time=b[1].data.user_response_time,a.defaultUserResponseTimeSelection=A(I.user_response_time),a.preferedUserResponseTime=I.user_response_time/a.defaultUserResponseTimeSelection),null!==b[1].data.resolution_time&&(I.resolution_time=b[1].data.resolution_time,a.defaultResolutionTimeSelection=A(I.resolution_time),a.preferedResolutionTime=I.resolution_time/a.defaultResolutionTimeSelection),I.inventory_categories=[],"object"==typeof b[1].data.inventory_categories&&0!==b[1].data.inventory_categories.length)for(var c=b[1].data.inventory_categories.length-1;c>=0;c--)I.inventory_categories.push(b[1].data.inventory_categories[c].id);a.icon=b[1].data.original_icon,a.loading=!1})}else J.then(function(b){a.categories=b.data,a.loading=!1}),a.perimetersGroups=[],a.enabledUserResponseTime=!1,I=a.category={marker:"R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",inventory_categories:[],allows_arbitrary_position:!0,color:"#2AB4DC",solver_groups_ids:[],default_solver_group_id:null,statuses:[{title:"Em andamento",color:"#f8b01d",initial:!1,"final":!1,active:!0,created_at:"2014-03-05T01: 12: 34.181-03: 00",updated_at:"2014-03-05T01: 12: 34.181-03: 00","private":!1},{title:"Resolvidas",color:"#78c953",initial:!1,"final":!0,active:!0,created_at:"2014-03-05T01: 12: 34.195-03: 00",updated_at:"2014-03-05T01: 12: 34.195-03: 00","private":!1},{title:"Não resolvidas",color:"#999999",initial:!1,"final":!0,active:!0,created_at:"2014-03-05T01: 12: 34.200-03: 00",updated_at:"2014-03-05T01: 12: 34.200-03: 00","private":!1},{title:"Em aberto",color:"#ff0000",initial:!0,"final":!1,active:!0,created_at:"2014-03-17T22: 52: 50.365-03: 00",updated_at:"2014-03-17T22: 52: 50.365-03: 00","private":!1}],notifications:!1};var M=a.uploader=new f;M.filters.push({name:"onlyImages",fn:function(a,b){var c=M.isHTML5?a.type:"/"+a.value.slice(a.value.lastIndexOf(".")+1);return c="|"+c.toLowerCase().slice(c.lastIndexOf("/")+1)+"|","|jpg|png|jpeg|bmp|gif|".indexOf(c)!==-1}}),a.pickColor=function(b){a.category.color=b},a.pickIcon=function(b){a.selectedIcon=b,M.queue=[]},a.filterByIds=function(a){return!(_.isUndefined(I.solver_groups_ids)||!~I.solver_groups_ids.indexOf(a.id))},a.categoriesAutocomplete={options:{source:function(a,b){var c=e.one("search").one("inventory").all("categories").getList({title:a.term,return_fields:"id,title"});c.then(function(a){b($.map(a.data,function(a){return{label:a.title,value:a.title,id:a.id}}))})},select:function(b,c){a.addCategory(c.item.id)},messages:{noResults:"",results:function(){}}}},a.addCategory=function(a){~I.inventory_categories.indexOf(a)||I.inventory_categories.push(a)},a.removeCategory=function(a){I.inventory_categories.splice(I.inventory_categories.indexOf(a),1)};var N=function(a,b){return _.filter(a,function(a){return _.contains(b,a.id)})};a.$watchCollection("category.solver_groups_ids",function(b,c){_.isEqual(b,c)||(a.category.solver_groups=N(a.groups,b),_.isEmpty(b)&&(a.category.default_solver_group_id=null,a.category.default_solver_group=null))}),a.manageStatuses=function(){k.open({templateUrl:"modals/reports/categories/manage-statuses/reports-categories-manage-statuses.template.html",windowClass:"manageStatuses",resolve:{category:function(){return a.category},updating:function(){return v},categoryId:function(){return w}},controller:"ReportsCategoriesManageStatusesModalController"})},a.$watch("preferedResolutionTime",function(){I.resolution_time=a.preferedResolutionTime*a.defaultResolutionTimeSelection}),a.changeDefaultResolutionTimeSelection=function(b){a.preferedResolutionTime=Math.round(I.resolution_time/b),a.defaultResolutionTimeSelection=b},a.$watch("preferedUserResponseTime",function(){I.user_response_time=a.preferedUserResponseTime*a.defaultUserResponseTimeSelection}),a.changeDefaultUserResponseTimeSelection=function(b){a.preferedUserResponseTime=Math.round(I.user_response_time/b),a.defaultUserResponseTimeSelection=b},a.shouldShowGlobalOption=function(){return a.hasPermission("manage_namespaces")&&!v&&1!==b.namespace.id},a.send=function(){function c(a){var b=g.defer(),c=new FileReader;return c.addEventListener("load",function(a){var c=a.target,d=c.result.replace(/^data:image\/[^;]+;base64,/,"");b.resolve(d)}),c.readAsDataURL(a),b.promise}a.inputErrors=null,b.resolvingRequest=!0;var d=[];if(0==M.queue.length&&a.selectedIcon){var f=function(){var b=g.defer(),c=l[0].createElement("CANVAS"),d=c.getContext("2d"),e=new Image;return e.crossOrigin="Anonymous",e.onload=function(){c.height=e.height,c.width=e.width,d.drawImage(e,0,0);var a=c.toDataURL("image/png");b.resolve(a.replace(/^data:image\/[^;]+;base64,/,"")),c=null},e.src="assets/images/icons/"+a.selectedIcon+".png",b.promise}();d.push(f)}else for(var h=M.queue.length-1;h>=0;h--)d.push(c(M.queue[h]._file));g.all(d).then(function(c){var f=c[0],h=angular.copy(I),j=h.statuses;h.statuses={};for(var k=j.length-1;k>=0;k--)j[k].initial=j[k].initial.toString(),j[k]["final"]=j[k]["final"].toString(),j[k].active=j[k].active.toString(),j[k]["private"]=j[k]["private"].toString(),h.statuses[k]=j[k];if(h.resolution_time=h.resolution_time,"undefined"!=typeof h.user_response_time&&"null"!==h.user_response_time&&1==a.enabledUserResponseTime?h.user_response_time=h.user_response_time:h.user_response_time=null,v){f&&(h.icon=f);var l=e.one("reports").one("categories",w).withHttpConfig({treatingErrors:!0}).customPUT(h);d=[],d.push(l);for(var k=a.perimetersGroups.length-1;k>=0;k--){var m=a.perimetersGroups[k];m.__isDirty&&m.__isDirty()&&d.push(t.savePerimeterGroup(m))}for(var k=a.perimetersGroupsToRemove.length-1;k>=0;k--)d.push(t.deletePerimeterGroup(a.perimetersGroupsToRemove[k]));g.all(d).then(function(c){q.purgeCache(),a.showMessage("ok","A categoria de relato foi atualizada com sucesso","success",!0),b.resolvingRequest=!1;for(var d=a.perimetersGroups.length-1;d>=0;d--)a.perimetersGroups[d].__resetDirty&&a.perimetersGroups[d].__resetDirty();a.perimetersGroupsToRemove=[],_.each(c,function(b){if(_.isEqual("POST",b.config.method)&&_.isEqual("perimeters",b.data.route)){var c=_.find(a.perimetersGroups,function(a){return _.isNull(a.id)||_.isUndefined(a.id)});c.id=b.data.id}})},function(c){a.showMessage("exclamation-sign","A categoria de relato não pode ser salva","error",!0),"object"!=typeof c.data.error?p.show(c):a.inputErrors=c.data.error,b.resolvingRequest=!1})}else{h.icon=f,h.marker=f;var n=e.one("reports").withHttpConfig({treatingErrors:!0}).post("categories",h);n.then(function(){q.purgeCache(),a.showMessage("ok","A categoria de relato foi criada com sucesso","success",!0),i.path("/reports/categories"),b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","A categoria de relato não pode ser salva","error",!0),"object"!=typeof c.data.error?p.show(c):a.inputErrors=c.data.error,b.resolvingRequest=!1})}})}}]),angular.module("ReportsPerimetersIndexControllerModule",["angularInlineEdit","ReportsPerimetersServiceModule","ReportsPerimetersModalControllerModule","angular-toArrayFilter"]).controller("ReportsPerimetersIndexController",["$scope","$rootScope","$log","ReportsPerimetersService","$modal",function(a,b,c,d,e){c.debug("ReportsPerimetersIndexController created."),a.$on("$destroy",function(){c.debug("ReportsPerimetersIndexController destroyed.")});var f=d;a.loading=!1,a.loadingPerimeter={},a.statusDecorator={pendent:["time","perimeter-status-process","EM PROCESSAMENTO"],imported:["ok","perimeter-status-ok","CADASTRADO COM SUCESSO"],invalid_file:["warning-sign","perimeter-status-error","ERRO: ARQUIVO INVÁLIDO"],out_of_bounds:["warning-sign","perimeter-status-error","ERRO: FORA DO PERÍMETRO DA CIDADE"],invalid_quantity:["warning-sign","perimeter-status-error","ERRO: QUANTIDADE INVÁLIDA"],invalid_geometry:["warning-sign","perimeter-status-error","ERRO: FORMA GEOMÉTRICA INVÁLIDA"]},a.perimeters=[];var g=a.cleanCache=function(){h=1,i=15,f.cleanCache()};a.sort={column:"created_at",descending:!0};var h=1,i=15;a.changeTitleTerm=function(){g(),j()};var j=a.getData=function(){if(a.loading===!1){a.loading=!0;var c={};""!==a.sort.column&&(c.sort=a.sort.column,c.order=a.sort.descending?"desc":"asc"),c.paginate=!0,c.page=+h||1,c.per_page=+i||15,c.title=_.isEmpty(a.titleTerm)?null:a.titleTerm;var d=f.fetchAll(c);return d.then(function(b){h++,a.perimeters=b;var c=Math.ceil(a.total/i);h===c+1?a.loading=null:a.loading=!1,a.loading=!1},function(){a.loading=!1,b.showMessage("exclamation-sign","Não foi possível atualizar a listagem.","error",!1)}),d}};a.$on("perimetersFetched",function(){a.total=f.total,a.loading=!1}),j(),a.updatePerimeter=function(d,e){d.title=e,a.loadingPerimeter[d.id]=!0,f.updatePerimeter(d).then(function(){a.loadingPerimeter[d.id]=!1,b.showMessage("ok","Nome do perímetro atualizado com sucesso.","success",!0),c.debug("Updated title")})},a.addPerimeter=function(){e.open({templateUrl:"modals/reports/perimeters/reports-perimeters-modal.template.html",backdrop:!1,resolve:{parentScope:function(){return a}},controller:"ReportsPerimetersModalController"})},a.deletePerimeter=function(c){a.deletePromise=f.deletePerimeter(c).then(function(){delete a.perimeters[c.id],b.showMessage("ok","Perímetro removido com sucesso.","success",!0),a.deletePromise=null},function(){b.showMessage("exclamation-sign","Não foi possível remover o perímetro.","error",!0),a.deletePromise=null})}}]),angular.module("ReportsPerimetersIndexModule",["ReportsPerimetersIndexControllerModule"]).config(["$stateProvider",function(a){a.state("reports.perimeters",{url:"/perimeters",cache:!1,views:{"":{templateUrl:"routes/reports/perimeters/index/reports-perimeters-index.template.html",controller:"ReportsPerimetersIndexController",controllerAs:"ctrl"}}})}]),angular.module("ItemsModule",["ItemsIndexModule","ItemsShowModule","ItemsEditModule","ItemsSelectCategoryModule","ItemsCategoriesIndexModule","ItemsCategoriesEditModule"]).config(["$stateProvider",function(a){a.state("items",{"abstract":!0,url:"/items",templateUrl:"routes/items/items.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("ItemsIndexModule",["ItemsIndexControllerModule","ItemsIndexMapModule","StyleResultsTableComponentModule"]).config(["$stateProvider",function(a){a.state("items.list",{url:"",views:{"":{templateUrl:"routes/items/index/items-index.template.html",controller:"ItemsIndexController",controllerAs:"ctrl",resolve:{isMap:function(){return!1}}}}})}]),angular.module("ItemsIndexControllerModule",["AdvancedFiltersServiceModule","InventoriesItemsServiceModule","ItemsDestroyModalControllerModule","angular-toArrayFilter"]).controller("ItemsIndexController",["$state","$scope","$rootScope","$modal","$q","isMap","AdvancedFilters","$location","$window","$cookies","InventoriesItemsService","$log",function(a,b,c,d,e,f,g,h,i,j,k,l){
l.info("ItemsIndexController created."),b.loading=!0,c.uiHasScroll=!0;var m=1,n=15;b.loadingPagination=!1,b.filtersHash=null,b.categories={},b.categoriesStatuses={},b.total=0;var o=function(){b.selectedCategories=[],b.selectedStatuses=[],b.selectedUsers=[],b.beginDate=null,b.endDate=null,b.searchText=null,b.fields=[],b.position=null,b.selectedAreas=[],b.zoom=null,b.clusterize=null};o(),b.sort={column:"created_at",descending:!0},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1),k.resetCache(),b.reload()},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending},b.availableFilters=[{name:"Protocolo ou endereço contém...",action:"query"},{name:"Com as categorias...",action:"category"},{name:"Com os estados...",action:"status"},{name:"Por criador do item...",action:"author"},{name:"Por período...",action:"date"},{name:"Por perímetro...",action:"area"},{name:"Por campos...",action:"fields"}],b.activeAdvancedFilters=[],"undefined"!=typeof j.inventoryFiltersHash&&(b.activeAdvancedFilters=JSON.parse(i.atob(j.inventoryFiltersHash))),"undefined"!=typeof h.search().filters&&(b.filtersHash=h.search().filters,b.activeAdvancedFilters=JSON.parse(i.atob(b.filtersHash))),b.$watch("activeAdvancedFilters",function(){o(),0!==b.activeAdvancedFilters.length?(b.filtersHash=i.btoa(JSON.stringify(b.activeAdvancedFilters)),h.search("filters",b.filtersHash),j.inventoryFiltersHash=b.filtersHash):(b.filtersHash=null,h.search("filters",null),delete j.inventoryFiltersHash);for(var a=b.activeAdvancedFilters.length-1;a>=0;a--){var c=b.activeAdvancedFilters[a];"query"===c.type&&(b.searchText=c.value),"categories"===c.type&&b.selectedCategories.push(c.value),"statuses"===c.type&&b.selectedStatuses.push(c.value),"authors"===c.type&&b.selectedUsers.push(c.value),"fields"===c.type&&b.fields.push(c.value),"beginDate"===c.type&&(b.beginDate=c.value),"endDate"===c.type&&(b.endDate=c.value),"area"===c.type&&b.selectedAreas.push(c.value)}q()},!0),b.generateItemsFetchingOptions=function(){var a={appendItems:!0};if(b.position||(a.page=m,a.per_page=n),null!==b.searchText&&(a.query=b.searchText),0!==b.selectedCategories.length&&(a.inventory_categories_ids=b.selectedCategories.join()),0!==b.selectedStatuses.length&&(a.inventory_statuses_ids=b.selectedStatuses.join()),0!==b.selectedUsers.length&&(a.users_ids=b.selectedUsers.join()),null!==b.beginDate&&(a["created_at[begin]"]=b.beginDate),null!==b.endDate&&(a["created_at[end]"]=b.endDate),""!==b.sort.column&&(a.sort=b.sort.column,a.order=b.sort.descending?"desc":"asc"),0!==b.fields.length){console.log(b.fields);for(var c=b.fields.length-1;c>=0;c--){var d="fields["+b.fields[c].id+"]["+b.fields[c].condition+"]";if(_.isArray(b.fields[c].value))for(var e=b.fields[c].value.length-1;e>=0;e--){var f=d+"["+e+"]";a[f]=b.fields[c].value[e]}else a[d]=b.fields[c].value}}if(0===b.selectedAreas.length&&null!==b.position)a["position[latitude]"]=b.position.latitude,a["position[longitude]"]=b.position.longitude,a["position[distance]"]=b.position.distance;else if(0!==b.selectedAreas.length)for(var g=b.selectedAreas.length-1;g>=0;g--){var h="position["+g+"][latitude]",i="position["+g+"][longitude]",j="position["+g+"][distance]";a[h]=b.selectedAreas[g].latitude,a[i]=b.selectedAreas[g].longitude,a[j]=b.selectedAreas[g].distance}return null!==b.zoom&&(a.zoom=b.zoom),null!==b.clusterize&&(a.clusterize=!0),a};var p=b.getData=function(a,c){if(b.loadingPagination===!1){b.loadingPagination=!0,"undefined"!=typeof c&&(b.position=c.position,b.zoom=c.zoom,b.clusterize=c.clusterize);var d=k.fetchAll(b.generateItemsFetchingOptions());return d.then(function(a){m++,b.items=a,b.total=k.total;var c=Math.ceil(b.total/n);m===c+1?b.loadingPagination=null:b.loadingPagination=!1,b.loading=!1}),d}};b.$on("inventoriesItemsFetching",function(){f&&(b.loading=!0)}),b.$on("inventoriesItemsFetched",function(){b.total=k.total,b.loading=!1});var q=b.reload=function(a){f?b.$broadcast("mapRefreshRequested",!0):(k.resetCache(),m=1,b.loadingPagination=!1,a===!0&&(b.reloading=!0),b.loadingContent=!0,b.items=[],p().then(function(c){b.loadingContent=!1,b.items=c,a===!0&&(b.reloading=!1)}))};b.reloadMap=function(){c.$emit("mapRefreshRequested")},b.removeFilter=function(a){b.activeAdvancedFilters.splice(b.activeAdvancedFilters.indexOf(a),1)},b.resetFilters=function(){b.activeAdvancedFilters=[],f&&b.$broadcast("updateMap",!0)},b.loadFilter=function(a){"query"===a&&g.query(b.activeAdvancedFilters),"category"===a&&g.category(b.activeAdvancedFilters,"items"),"status"===a&&g.status(b.activeAdvancedFilters,"items"),"author"===a&&g.author(b.activeAdvancedFilters),"fields"===a&&g.fields(b.activeAdvancedFilters,"items"),"date"===a&&g.period(b.activeAdvancedFilters),"area"===a&&g.area(b.activeAdvancedFilters)},b.search=function(a){b.searchText=a,q()},b.share=function(){g.share()},b.changeToMap=function(){null!==b.filtersHash?h.url("/inventories/map?filters="+b.filtersHash):h.url("/inventories/map")},b.changeToList=function(){null!==b.filtersHash?h.url("/inventories?filters="+b.filtersHash):h.url("/inventories")},b.deleteItem=function(a,b){d.open({templateUrl:"modals/items/destroy/items-destroy.template.html",windowClass:"removeModal",resolve:{item:function(){return a},category:function(){return b}},controller:"ItemsDestroyModalController"})},b["export"]=function(){d.open({templateUrl:"views/inventories/export.html",windowClass:"filterCategoriesModal",resolve:{categories:function(){return b.categories}},controller:["$scope","$modalInstance","categories",function(a,b,c){a.categories=c,a.updateCategory=function(b){var c=a.categories.indexOf(b);a.categories[c].selected===!0?a.categories[c].selected=!1:a.categories[c].selected=!0},a.close=function(){b.close()}}]})},b.openItem=function(b,d){c.loading||"a"==d.target.parentNode.tagName.toLowerCase()||"a"==d.target.tagName.toLowerCase()||a.go("items.show",{id:b.id})},c.pageHasMap=f,b.$on("$destroy",function(){c.pageHasMap=!1,l.info("ItemsIndexController destroyed.")}),b.canUserEditItems=b.hasPermission("inventories_full_access")||b.hasPermission("inventories_categories_edit")||b.hasPermission("inventories_items_edit")||b.hasPermission("inventories_items_delete")}]),angular.module("ItemsIndexMapModule",["StyleMapComponentModule","MapComponentModule"]).config(["$stateProvider",function(a){a.state("items.list.map",{url:"/map",views:{"@items":{templateUrl:"routes/items/index/map/items-index-map.template.html",controller:"ItemsIndexController",controllerAs:"ctrl",resolve:{isMap:function(){return!0}}}}})}]),angular.module("ItemsShowModule",["ItemsShowControllerModule"]).config(["$stateProvider",function(a){a.state("items.show",{url:"/{id:[0-9]{1,9}}",views:{"":{templateUrl:"routes/items/show/items-show.template.html",controller:"ItemsShowController",controllerAs:"ctrl",resolve:{itemResponse:["$q","Restangular","$stateParams","ReturnFieldsService",function(a,b,c,d){var e=a.defer(),f=["id","address","inventory_category_id","inventory_category_id","inventory_status_id","position","title",{data:["id","content","selected_options",{field:["id"]}],related_entities:[{report_items:["id","created_at","updated_at",{category:["title"],status:["title"]}],cases:["id","created_at","updated_at","status",{initial_flow:["title"]}]}]}],g=["id","title","marker","pin","statuses","plot_format","sections.id","sections.title","sections.disabled","sections.position","sections.fields.title","sections.fields.label","sections.fields.kind","sections.fields.id","sections.fields.position","sections.fields.disabled"],h=b.one("inventory").one("items",c.id).get({return_fields:d.convertToString(f),display_type:"full"});return h.then(function(a){var c=angular.copy(a.data),d=b.one("inventory").one("categories",c.inventory_category_id).get({return_fields:g.join(),display_type:"full"});d.then(function(a){c.category=angular.copy(a.data),e.resolve(c)})}),e.promise}]}}}})}]),angular.module("ItemsShowControllerModule",["MapShowItemComponentModule","MapViewStreetviewComponentModule","FieldHistoryModalControllerModule","GalleryComponentModule"]).controller("ItemsShowController",["$rootScope","$scope","Restangular","$q","$state","$modal","itemResponse","$log","CasesService","ReturnFieldsService",function(a,b,c,d,e,f,g,h,i,j){function k(a){return _.flatten(_.map(a.sections,function(a){return _.pluck(a.fields,"id")}))}h.info("ItemsShowController created."),b.$on("$destroy",function(){h.info("ItemsShowController destroyed.")}),b.item=g,b.category=b.item.category,b.show_status_bar=b.category.statuses&&b.category.statuses.length>0,b.item_status=null,b.item.related_entities.cases&&(b.item.related_entities.cases=_.map(b.item.related_entities.cases,function(a){return i.denormalizeCase(a)})),b.openRelatedCase=function(a){e.go("cases.edit",{id:a.id})},b.openRelatedReport=function(a){e.go("reports.show",{id:a.id})},b.updateItemStatus=function(){if(null!=b.item.inventory_status_id){for(var a=b.category.statuses,c=0;c<a.length;c++)if(b.item.inventory_status_id===a[c].id){b.item_status=a[c];break}}else b.item_status={color:"#271129",title:"Não definido"}},b.updateItemStatus(),b.getDataByInventoryFieldId=function(a){for(var c=b.item.data.length-1;c>=0;c--)if("undefined"!=typeof b.item.data[c].field&&null!==b.item.data[c].field&&b.item.data[c].field.id===parseInt(a))return b.item.data[c].content;return null},b.getSelectedOptionsByFieldId=function(a){for(var c=b.item.data.length-1;c>=0;c--)if("undefined"!=typeof b.item.data[c].field&&null!==b.item.data[c].field&&b.item.data[c].field.id===parseInt(a))return b.item.data[c].selected_options;return null},b.editItemStatus=function(a,d){f.open({templateUrl:"modals/items/edit-status/items-edit-status.template.html",windowClass:"editStatusModal",resolve:{item:function(){return a},category:function(){return d},refreshItemHistory:function(){return b.refreshHistory},updateItemStatus:function(){return b.updateItemStatus}},controller:["$scope","$modalInstance","category","item","refreshItemHistory","updateItemStatus",function(a,b,d,e,f,g){a.category=d,a.item=angular.copy(e),a.changeStatus=function(b){a.item.inventory_status_id=b},a.save=function(){var d=["id","address","inventory_category_id","inventory_category_id","inventory_status_id","position","title",{data:["id","content","selected_options",{field:["id"]}],related_entities:[{report_items:["id","created_at","updated_at",{category:["title"],status:["title"]}],cases:["id","created_at","updated_at","status",{initial_flow:["title"]}]}]}],h=c.all("inventory").one("categories",a.category.id).one("items",a.item.id).customPUT({inventory_status_id:a.item.inventory_status_id,return_fields:j.convertToString(d)});h.then(function(){e.inventory_status_id=a.item.inventory_status_id,f(),g(),b.close()})},a.close=function(){b.close()}}]})},b.deleteItem=function(a,b){f.open({templateUrl:"modals/items/destroy/items-destroy.template.html",windowClass:"removeModal",resolve:{removeItemFromList:function(){return!1},item:function(){return a},category:function(){return b}},controller:"ItemsDestroyModalController"})},b.showFieldHistory=function(c){a.resolvingRequest=!0,f.open({templateUrl:"modals/items/field-history/items-field-history.template.html",windowClass:"field-history-modal",resolve:{field:function(){return c},itemId:function(){return b.item.id},itemHistoryResponse:["Restangular","$stateParams",function(a,d){return a.one("inventory").one("items",b.item.id).one("history").getList(null,{object_id:c.id})}]},controller:"FieldHistoryModalController"})},b.refreshHistory=function(){var a={return_fields:"id,action,created_at,kind,objects.id,objects.label,objects.title,objects.name,user.name,user.id"},d=b.selectedFilters();0!==d.length&&(a.kind=d.join()),b.historyFilterBeginDate&&(a["created_at[begin]"]=b.historyFilterBeginDate),b.historyFilterEndDate&&(a["created_at[end]"]=b.historyFilterEndDate),b.loadingHistoryLogs=!0;var e=c.one("inventory").one("items",b.item.id).one("history").getList(null,a);e.then(function(a){b.historyLogs=a.data,b.loadingHistoryLogs=!1})},b.historyOptions={type:void 0},b.availableHistoryFilters=[{type:"report",name:"Relatos",selected:!1},{type:"fields",name:"Campos",selected:!1},{type:"images",name:"Imagens",selected:!1},{type:"flow",name:"Fluxo",selected:!1},{type:"formula",name:"Fórmulas",selected:!1},{type:"status",name:"Estados",selected:!1}],b.availableHistoryDateFilters=[{name:"Hoje",beginDate:moment().startOf("day").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Ontem",beginDate:moment().subtract(1,"days").startOf("day").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Este mês",beginDate:moment().startOf("month").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Mês passado",beginDate:moment().subtract(1,"months").startOf("month").format(),endDate:moment().subtract(1,"months").subtract(1,"days").endOf("day").format(),selected:!1},{name:"Todos",beginDate:null,endDate:null,selected:!0}],b.selectedFilters=function(){var a=[];return _.each(b.availableHistoryFilters,function(b){b.selected&&a.push(b.type)}),a},b.toggleOption=function(a){a.selected=!a.selected,b.refreshHistory()},b.resetHistoryFilters=function(){_.each(b.availableHistoryFilters,function(a){a.selected=!0}),b.refreshHistory()},b.showCustomDateFields=function(){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),b.showCustomDateHelper=!0},b.selectDateFilter=function(a){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),a.selected=!a.selected,b.historyFilterBeginDate=a.beginDate,b.historyFilterEndDate=a.endDate,b.showCustomDateHelper=!1,b.refreshHistory()},b.historyLogs=[],b.refreshHistory(),b.userCanEditItem=b.hasPermission("inventories_full_access")||b.hasPermission("inventories_categories_edit",b.item.category.id)||b.hasPermission("inventories_items_edit",b.item.category.id)||b.hasPermission("inventory_fields_can_edit",k(b.item.category))}]),angular.module("ItemsEditModule",["ItemsEditControllerModule"]).config(["$stateProvider",function(a){a.state("items.show.edit",{url:"/category/{categoryId:[0-9]{1,9}}/edit",views:{"@":{templateUrl:"routes/items/edit/items-edit.template.html",controller:"ItemsEditController",controllerAs:"ctrl",resolve:{categoryResponse:["Restangular","$stateParams","ReturnFieldsService",function(a,b,c){var d=["id","marker","pin","plot_format","require_item_status","statuses","title","updated_at",{sections:["id","title","disabled","required","location","position",{fields:["id","disabled","title","kind","label","available_values","field_options","position","maximum","minimum","required"]}]}];return a.one("inventory").one("categories",b.categoryId).get({display_type:"full",return_fields:c.convertToString(d)})}],itemResponse:["Restangular","$stateParams","ReturnFieldsService",function(a,b,c){var d=["id","title","address","inventory_status_id","status","locked","locker_id","locked_at","position","inventory_category_id","data","created_at","updated_at"];return a.one("inventory").one("items",b.id).get({display_type:"full",return_fields:c.convertToString(d)})}]}}}}).state("items.add",{url:"/category/{categoryId:[0-9]{1,9}}/add",views:{"@":{templateUrl:"routes/items/edit/items-edit.template.html",controller:"ItemsEditController",controllerAs:"ctrl",resolve:{categoryResponse:["Restangular","$stateParams","ReturnFieldsService",function(a,b,c){var d=["id","marker","pin","plot_format","require_item_status","statuses","title",{sections:["id","title","disabled","required","location","position",{fields:["id","disabled","title","kind","label","available_values","field_options","position","maximum","minimum","required"]}]}];return a.one("inventory").one("categories",b.categoryId).get({display_type:"full",return_fields:c.convertToString(d)})}],itemResponse:function(){return!1}}}}})}]),angular.module("ItemsEditControllerModule",["ItemsRestoreModalControllerModule","ItemsSelectAddressModalControllerModule","InventoriesItemsServiceModule","NgThumbComponentModule","TranslateErrorsHelperModule","OnEnterComponentModule"]).controller("ItemsEditController",["$scope","Restangular","$q","$state","$modal","$rootScope","FileUploader","onlyImagesUploaderFilter","$localStorage","itemResponse","categoryResponse","$timeout","User","InventoriesItemsService","ReturnFieldsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q=a.updating=!1,r=k.data.id,s=r.toString()+k.data.updated_at,t=a.itemData={},u=!1;if(a.uploaders={},a.isObject=_.isObject,j){var v=j.data.id;q=!0,a.updating=!0}a.storage=i,a.back=function(){j?d.transitionTo("items.show",{id:v},{reload:!0}):d.transitionTo("items.list",null,{reload:!0})},a.isUnselected=function(a){return _.chain(a).values().find(function(a){return a}).isUndefined().value()},q?("undefined"==typeof a.storage.updating?(a.storage.updating={},a.storage.updating[s]={},a.storage.updating[s][v]=null):"undefined"==typeof a.storage.updating[s]?(a.storage.updating[s]={},a.storage.updating[s][v]=null):"undefined"==typeof a.storage.updating[s][v]&&(a.storage.updating[s][v]=null),null!==a.storage.updating[s][v]&&(p=angular.copy(a.storage.updating[s][v]),u=!0)):("undefined"==typeof a.storage.creating?(a.storage.creating={},a.storage.creating[s]=null):"undefined"==typeof a.storage.creating[s]&&(a.storage.creating[s]=null),null!==a.storage.creating[s]&&(p=angular.copy(a.storage.creating[s]),u=!0)),u&&e.open({templateUrl:"modals/items/restore/items-restore.template.html",windowClass:"removeModal",resolve:{setItemData:function(){return function(){t=a.itemData=angular.copy(p)}},clearData:function(){return function(){q?a.storage.updating[s][v]=null:a.storage.creating[s]=null}}},controller:"ItemsRestoreModalController"}),a.hiddenFields=[];var w=a.locationFieldsIds=[];a.locationFields=[],a.item={inventory_status_id:null},a.category=k.data,a.item.category=a.category;for(var x=a.category.sections.length-1;x>=0;x--)for(var y=a.category.sections[x].fields.length-1;y>=0;y--){var z=a.category.sections[x];if("undefined"!=typeof z&&(!z.disabled||q)){if(t[z.fields[y].id]=null,"checkbox"===z.fields[y].kind){var A={};if(null!==z.fields[y].field_options)for(var B=z.fields[y].field_options.length-1;B>=0;B--)A[z.fields[y].field_options[B].id]=!1;$.isEmptyObject(A)?t[z.fields[y].id]=null:t[z.fields[y].id]=A}if(z.location===!0&&z.fields[y].disabled===!1&&("latitude"===z.fields[y].title&&(a.locationFieldsIds[0]=z.fields[y].id,a.locationFields[0]=z.fields[y],a.hiddenFields.push(z.fields[y].id)),"longitude"===z.fields[y].title&&(a.locationFieldsIds[1]=z.fields[y].id,a.hiddenFields.push(z.fields[y].id)),"address"===z.fields[y].title&&(a.locationFieldsIds[2]=z.fields[y].id),"postal_code"===z.fields[y].title&&(a.locationFieldsIds[3]=z.fields[y].id),"district"===z.fields[y].title&&(a.locationFieldsIds[4]=z.fields[y].id),"city"===z.fields[y].title&&(a.locationFieldsIds[5]=z.fields[y].id),"state"===z.fields[y].title&&(a.locationFieldsIds[6]=z.fields[y].id)),"images"===z.fields[y].kind){var C=new g;C.filters.push(h(C.isHTML5)),a.uploaders[z.fields[y].id]=C,t[z.fields[y].id]={areImages:!0}}}}if(q||a.$watch("itemData",function(b,c){angular.equals(b,c)||(a.storage.creating[s]=angular.copy(b))},!0),q){a.item=j.data,a.item.locked===!0&&a.item.locker_id!==m.id&&(a.locked=!0);var D=function(b){for(var c=a.item.data.length-1;c>=0;c--)if("undefined"!=typeof a.item.data[c].field&&null!==a.item.data[c].field&&a.item.data[c].field.id==b)return a.item.data[c]};for(var E in t){var F=D(E);if("undefined"!=typeof F)if("checkbox"===F.field.kind&&null!==F.content)for(var x=F.content.length-1;x>=0;x--)t[E][F.content[x]]=!0;else"images"===F.field.kind&&null!==F.content?t[E].existingImages=F.content:t[E]=F.content}a.$watch("itemData",function(b,c){angular.equals(b,c)||(a.storage.updating[s][v]=angular.copy(b))},!0);var G=!0,H=function(){b.all("inventory").one("categories",r).one("items",v).all("update_access").patch();l(function(){G&&H()},45e3)};(!a.item.locked||a.item.locked===!0&&a.item.locker_id==m.id)&&H(),a.$on("$destroy",function(){G=!1})}a.userCanEditAllFields=a.hasPermission("inventories_full_access")||a.hasPermission("inventories_categories_edit",a.category.id)||a.hasPermission("inventories_items_edit",a.category.id),a.openMapModal=function(){var b=e.open({templateUrl:"modals/items/select-address/items-select-address.template.html",windowClass:"mapModal",resolve:{category:function(){return a.category},updating:function(){return q},itemData:function(){return t},locationFieldsIds:function(){return w}},controller:"ItemsSelectAddressModalController"});b.opened.then(function(){setTimeout(function(){f.selectLatLngMap.start()},80)})},a.send=function(){function b(a){var b=c.defer(),d=new FileReader;return d.addEventListener("load",function(a){var c=a.target;b.resolve(c.result.replace(/^data:image\/[^;]+;base64,/,""))}),d.readAsDataURL(a),b.promise}if(a.form.$invalid)return a.showValidationError=!0,!1;a.processingForm=!0;var e=[],f={inventory_status_id:a.item.inventory_status_id,data:{}},g=function(a,d){for(var e=c.defer(),g=[],h=a.queue.length-1;h>=0;h--)g.push(b(a.queue[h]._file));return c.all(g).then(function(a){for(var b=[],c=a.length-1;c>=0;c--)b.push({content:a[c]});if(0!==b.length)if("undefined"==typeof f.data[d])f.data[d]=b;else for(var c=b.length-1;c>=0;c--)f.data[d].push(b[c]);e.resolve()}),e.promise};for(var h in t)if(!isNaN(parseInt(h,10))&&null!==t[h])if("object"==typeof t[h])if(t[h].areImages===!0){if(e.push(g(a.uploaders[h],h)),"undefined"!=typeof t[h].existingImages)for(var i=t[h].existingImages.length-1;i>=0;i--)t[h].existingImages[i].destroy===!0&&("undefined"==typeof f.data[h]?f.data[h]=[{id:t[h].existingImages[i].id,destroy:!0}]:f.data[h].push({id:t[h].existingImages[i].id,destroy:!0}))}else{var j=[];for(var k in t[h])t[h][k]===!0&&j.push(parseInt(k));0!==j.length&&(f.data[h]=j)}else f.data[h]=t[h];c.all(e).then(function(){q?n.update(v,r,f).then(function(b){a.storage.updating[s][v]=null,a.showMessage("ok","O item foi atualizado com sucesso!","success",!0),a.processingForm=!1,d.go("items.show",{id:v},{reload:!0})})["catch"](function(b){a.inputErrors=b,a.processingForm=!1}):n.create(r,f).then(function(b){a.storage.creating[s]=null,a.showMessage("ok","O item foi criado com sucesso","success",!0),d.go("items.show",{id:b.id})})["catch"](function(b){a.inputErrors=b,a.processingForm=!1})})}}]),angular.module("ItemsSelectCategoryControllerModule",[]).controller("ItemsSelectCategoryController",["$scope","categoriesResponse",function(a,b){a.categories=b}]),angular.module("ItemsSelectCategoryModule",["ItemsSelectCategoryControllerModule"]).config(["$stateProvider",function(a){a.state("items.select-category",{url:"/select-category",views:{"@":{templateUrl:"routes/items/select-category/items-select-category.template.html",controller:"ItemsSelectCategoryController",controllerAs:"ctrl",resolve:{categoriesResponse:["InventoriesCategoriesService","$q",function(a,b){var c=function(){var c=b.defer();return a.fetchAllBasicInfo().then(function(a){c.resolve(a.data.categories)}),c.promise};return a.loadedBasicInfo?_.values(a.categories):c()}]}}}})}]),angular.module("ItemsCategoriesIndexModule",["ItemsCategoriesIndexControllerModule","InventoriesCategoriesServiceModule"]).config(["$stateProvider",function(a){a.state("items.categories",{url:"/categories",views:{"":{templateUrl:"routes/items/categories/index/items-categories-index.template.html",controller:"ItemsCategoriesIndexController",controllerAs:"ctrl",resolve:{categoriesResponse:["InventoriesCategoriesService","$q",function(a,b){var c=function(){var c=b.defer();return a.fetchAllBasicInfo().then(function(a){c.resolve(a.data.categories)}),c.promise};return a.loadedBasicInfo?_.values(a.categories):c()}]}}}})}]),angular.module("ItemsCategoriesIndexControllerModule",["ItemsCategoriesDestroyModalControllerModule"]).controller("ItemsCategoriesIndexController",["$scope","categoriesResponse","$modal",function(a,b,c){a.categories=b,a.deleteCategory=function(b){c.open({templateUrl:"modals/items/categories/destroy/items-categories-destroy.template.html",windowClass:"removeModal",backdrop:"static",resolve:{inventoriesCategoriesList:function(){return a.categories},category:function(){return b}},controller:"ItemsCategoriesDestroyModalController"})}}]),angular.module("ItemsCategoriesEditModule",["ItemsCategoriesEditControllerModule"]).config(["$stateProvider",function(a){a.state("items.categories.edit",{url:"/{id:[0-9]{1,4}}/edit",views:{"@":{templateUrl:"routes/items/categories/edit/items-categories-edit.template.html",controller:"ItemsCategoriesEditController",controllerAs:"ctrl",resolve:{categoryResponse:["Restangular","$stateParams",function(a,b){return a.one("inventory").one("categories",b.id).get({display_type:"full"})}],analyzesResponse:["Restangular","$stateParams",function(a,b){return a.one("inventory").one("categories",b.id).all("analyzes").getList()}],formulasResponse:["FullResponseRestangular","$stateParams","$q","$log","$rootScope",function(a,b,c,d,e){var f=c.defer();if(e.hasPermission("inventories_formulas_full_access")){var g=a.one("inventory").one("categories",b.id).all("formulas").customGET();g.then(function(a){f.resolve(a)},function(){f.resolve(!1)})}else d.info("Sem permissão de edição de fórmulas."),f.resolve(!0);return f.promise}],groupsResponse:["Restangular",function(a){return a.all("groups").getList({ignore_namespaces:!0,return_fields:"id,name,namespace"})}]}}}}).state("items.categories.add",{url:"/add",views:{"@":{templateUrl:"routes/items/categories/edit/items-categories-edit.template.html",controller:"ItemsCategoriesEditController",controllerAs:"ctrl",resolve:{categoryResponse:function(){return!1},formulasResponse:function(){return!1},analyzesResponse:function(){return!1},groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}})}]),function(a,b){"use strict";function c(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(){s.on("click",function(c){var d=b(c.target);d[0].hasAttribute("has-popover")||d[0].hasAttribute("uis-transclude-append")||d.closest(".popover").length>0||d.closest(".ui-select-choices-row-inner").length>0||d.closest(".ui-select-match-item").length>0||d.hasClass("ui-select-choices-row-inner")||d.hasClass("ui-select-choices-row")||a.$emit("hidePopovers",!0)})}var u=a.updating=!1;if(a.groups=f.data,e){u=!0,a.updating=!0,a.category=e.data;var v=a.category.id}a.analyzes=p.data,a.unsavedCategory=!1,a.showDisabledFields=h,a.currentTab="fields",a.enableEditing=function(){a.editingCategoryTitle=!0,k(function(){b("#edit-title-input").focus()},100)};var w=["integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time"];a.getLabelForMinField=function(a){return w.indexOf(a)===-1?"Min. de caracteres":"Valor mínimo"},a.getLabelForMaxField=function(a){return w.indexOf(a)===-1?"Máx. de caracteres":"Valor máximo"},a.availableInputs=[{kind:"text",name:"Campo de texto",multipleOptions:!1},{kind:"textarea",name:"Campo de parágrafo",multipleOptions:!1},{kind:"integer",name:"Campo numérico",multipleOptions:!1},{kind:"decimal",name:"Campo decimal",multipleOptions:!1},{kind:"checkbox",name:"Campo de múltipla escolha",multipleOptions:!0},{kind:"radio",name:"Campo de escolha única",multipleOptions:!0},{kind:"select",name:"Campo de lista",multipleOptions:!0},{kind:"meters",name:"Campo em metros",multipleOptions:!1},{kind:"centimeters",name:"Campo em centímetros",multipleOptions:!1},{kind:"kilometers",name:"Campo em quilômetros",multipleOptions:!1},{kind:"years",name:"Campo em anos",multipleOptions:!1},{kind:"months",name:"Campo em meses",multipleOptions:!1},{kind:"days",name:"Campo em dias",multipleOptions:!1},{kind:"hours",name:"Campo em horas",multipleOptions:!1},{kind:"seconds",name:"Campo em segundos",multipleOptions:!1},{kind:"angle",name:"Campo de ângulo",multipleOptions:!1},{kind:"date",name:"Campo de data",multipleOptions:!1},{kind:"time",name:"Campo de tempo",multipleOptions:!1},{kind:"cpf",name:"Campo de CPF",multipleOptions:!1},{kind:"cnpj",name:"Campo de CNPJ",multipleOptions:!1},{kind:"url",name:"Campo de URL",multipleOptions:!1},{kind:"email",name:"Campo de e-mail",multipleOptions:!1},{kind:"images",name:"Campo de imagens",multipleOptions:!1}],a.kindHasMultipleOptions=function(b){for(var c=a.availableInputs.length-1;c>=0;c--)if(a.availableInputs[c].kind===b)return a.availableInputs[c].multipleOptions===!0;return!1},a.onChangeFieldRequire=function(a,b){console.log("onChangeFieldRequire:",a,b),a.required||(b.required=!1)},a.onChangeSectionRequire=function(a){console.log("onChangeSectionRequire:",a),a.required&&a.fields.forEach(function(a){a.required=!0})};var x=function(b){return _.findWhere(a.groups,{id:b})};if(u){a.category.plot_format="pin"!==a.category.plot_format;for(var y=a.category.permissions.groups_can_edit.length-1;y>=0;y--)a.category.permissions.groups_can_edit[y]=x(a.category.permissions.groups_can_edit[y]);for(var y=a.category.permissions.groups_can_view.length-1;y>=0;y--)a.category.permissions.groups_can_view[y]=x(a.category.permissions.groups_can_view[y])}else{a.category={},a.category.title="Nova categoria sem título",a.category.color="#2AB4DC",a.category.icon="R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.category.marker="R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.category.pin="R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a.category.plot_format=!1,a.category.global=!1,a.category.statuses=[],a.category.permissions={groups_can_edit:[],groups_can_view:[]};for(var y=a.me.groups.length-1;y>=0;y--)a.category.permissions.groups_can_edit.push(a.me.groups[y]);a.category.sections=[{title:"Localização",required:!0,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]},fields:[{title:"longitude",kind:"text",size:null,inventory_section_id:14,available_values:null,position:1,label:"Longitude",maximum:null,minimum:null,required:!0,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"postal_code",kind:"text",size:null,inventory_section_id:14,available_values:null,position:3,label:"CEP",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"road_classification",kind:"text",size:null,inventory_section_id:14,available_values:null,position:8,label:"Classificação Viária",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"city",kind:"text",size:null,inventory_section_id:14,available_values:null,position:5,label:"Cidade",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"latitude",kind:"text",size:null,inventory_section_id:14,available_values:null,position:0,label:"Latitude",maximum:null,minimum:null,required:!0,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"address",kind:"text",size:null,inventory_section_id:14,available_values:null,position:2,label:"Endereço",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"district",kind:"text",size:null,inventory_section_id:14,available_values:null,position:4,label:"Bairro",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"state",kind:"text",size:null,inventory_section_id:14,available_values:null,position:6,label:"Estado",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}},{title:"codlog",kind:"text",size:null,inventory_section_id:14,available_values:null,position:7,label:"Codlog",maximum:null,minimum:null,required:!1,location:!0,permissions:{groups_can_view:[],groups_can_edit:[]}}]}]}a.$watch("category",function(b,c){b!==c&&(a.unsavedCategory=!0)},!0),a.groupsCanEditAutocomplete={options:{onlySelect:!0,source:function(a,c){var d=g.all("groups").getList({name:a.term});d.then(function(a){c(b.map(a.data,function(a){return{label:a.name,value:a.name,group:{id:a.id,name:a.name,
namespace:{name:a.namespace.name}}}}))})},messages:{noResults:"",results:function(){}}}},a.groupsCanViewAutocomplete={options:{onlySelect:!0,source:function(a,c){var d=g.all("groups").getList({name:a.term});d.then(function(a){c(b.map(a.data,function(a){return{label:a.name,value:a.name,group:{id:a.id,name:a.name,namespace:{name:a.namespace.name}}}}))})},messages:{noResults:"",results:function(){}}}},a.groupsCanEditAutocomplete.events={select:function(b,c){for(var d=!1,e=a.category.permissions.groups_can_edit.length-1;e>=0;e--)a.category.permissions.groups_can_edit[e].id===c.item.group.id&&(d=!0);d||a.category.permissions.groups_can_edit.push(c.item.group)},change:function(){a.groupCanEdit=""}},a.groupsCanViewAutocomplete.events={select:function(b,c){for(var d=!1,e=a.category.permissions.groups_can_view.length-1;e>=0;e--)a.category.permissions.groups_can_view[e].id===c.item.group.id&&(d=!0);d||a.category.permissions.groups_can_view.push(c.item.group)},change:function(){a.groupCanView=""}},a.removeGroupCanView=function(b){a.category.permissions.groups_can_view.splice(a.category.permissions.groups_can_view.indexOf(b),1)},a.removeGroupCanEdit=function(b){a.category.permissions.groups_can_edit.splice(a.category.permissions.groups_can_edit.indexOf(b),1)},a.editFieldOptions=function(a){j.open({templateUrl:"modals/items/categories/edit-field-values/items-categories-edit-field-values.template.html",windowClass:"editFieldOptions",controller:"ItemsCategoriesEditFieldValuesModalController",resolve:{field:function(){return a},setFieldOptions:function(){return function(b){a.field_options=b}}}})},a.$on("$locationChangeStart",function(b){a.unsavedCategory===!0&&(a.unsavedCategory=!1,a.loading=!0)}),a.goBack=function(){a.unsavedCategory===!0?(a.unsavedCategory=!1,a.loading=!0,m.go("items.categories",{},{reload:!0})):(a.loading=!0,m.go("items.categories",{},{reload:!0}))},a.newSection=function(){a.$broadcast("hidePopovers");var c={title:"Nova seção sem título",required:!1,location:!1,fields:[]};a.category.sections.push(c),b("html, body").animate({scrollTop:b(document).height()},"slow")},a.newStatus=function(){j.open({templateUrl:"modals/items/categories/new-status/items-categories-new-status.template.html",windowClass:"editInventoryStatusesModal",resolve:{statuses:function(){return a.category.statuses},updating:function(){return u},categoryId:function(){return v}},controller:"ItemsCategoriesNewStatusModalController"})},a.editStatus=function(a){j.open({templateUrl:"modals/items/categories/edit-status/items-categories-edit-status.template.html",windowClass:"editInventoryStatusesModal",resolve:{status:function(){return a},updating:function(){return u},categoryId:function(){return v}},controller:"ItemsCategoriesEditStatusModalController"})},a.removeStatus=function(b){if("undefined"!=typeof b.id){var c=g.one("inventory").one("categories",v).one("statuses",b.id).remove();c.then(function(){a.category.statuses.splice(a.category.statuses.indexOf(b),1)})}else a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.$on("hidePopovers",function(b,c){a.$broadcast("hideOpenPopovers",c)}),a.uploaderQueue={items:[]},a.editCategoryOptions=function(){r.open(a.category,a.uploaderQueue,a.send)},a.save_use_field_as_title=function(b){if(b.use_as_title){var c=_.map(a.category.sections,function(a){return a.fields});c=_.flatten(c),_.each(_.reject(c,b),function(a){a.use_as_title=!1})}},a.send=function(){function b(a){var b=i.defer(),c=new FileReader;return c.addEventListener("load",function(a){var c=a.target;d=c.result.replace(/^data:image\/[^;]+;base64,/,""),b.resolve()}),c.readAsDataURL(a),b.promise}a.processingForm=!0;for(var d,e=[],f=a.uploaderQueue.items.length-1;f>=0;f--)e.push(b(a.uploaderQueue.items[f]._file));return i.all(e).then(function(){for(var b={groups_can_edit:[],groups_can_view:[]},e=a.category.permissions.groups_can_edit.length-1;e>=0;e--)b.groups_can_edit.push(a.category.permissions.groups_can_edit[e].id);for(var e=a.category.permissions.groups_can_view.length-1;e>=0;e--)b.groups_can_view.push(a.category.permissions.groups_can_view[e].id);var f={title:a.category.title,require_item_status:a.category.require_item_status,statuses:a.category.statuses,color:a.category.color,plot_format:a.category.plot_format,permissions:b},g={sections:a.category.sections};if(1===c.namespace.id&&(a.category.global=!0),a.category.global===!0&&(f.global=a.category.global),_.each(g.sections,function(a){_.each(a.fields,function(b,c){if(_.isObject(b)&&(_.isUndefined(b.id)&&b.hasOwnProperty("toRemove")&&(b.toRemove?a.fields.splice(c,1):delete b.toRemove),_.isUndefined(b.id)&&_.isArray(b.field_options)&&!_.isEmpty(b.field_options))){var d=[];_.each(b.field_options,function(a){d.push(a.value)}),b.field_options=d}})}),a.category.plot_format===!1?f.plot_format="pin":f.plot_format="marker",u){delete f.statuses,d&&(f.icon=d);var h=q.update(v,f).then(function(b){a.category.original_icon=b.original_icon}),j=q.updateForm(v,g).then(function(b){a.category.sections=b.sections});return i.all([h,j]).then(function(){a.showMessage("ok","A categoria de inventário foi atualizada com sucesso!","success",!0),a.unsavedCategory=!1,a.processingForm=!1,q.purgeCache()})["catch"](function(b){var c=b[0]||b[1],d=_.first(_.keys(c)),e=_.first(_.values(c)[0]),f=d.charAt(0).toUpperCase()+d.slice(1)+" "+e;a.showMessage("exclamation-sign",f,"error",!0),a.processingForm=!1})}d?f.icon=d:f.icon=a.category.icon,q.create(f).then(function(b){var c,d={};a.category.original_icon=b.original_icon;for(var e=b.sections.length-1;e>=0;e--)if(b.sections[e].location===!0){c=b.sections[e].id;for(var f=b.sections[e].fields.length-1;f>=0;f--)d[b.sections[e].fields[f].title]=b.sections[e].fields[f].id}for(var h=a.category.sections.length-1;h>=0;h--){var i=a.category.sections[h];if(i.location===!0){i.id=c;for(var j=i.fields.length-1;j>=0;j--)i.fields[j].id=d[i.fields[j].title]}}return q.updateForm(b.id,g).then(function(){a.showMessage("ok","A categoria de inventário foi criada com sucesso","success",!0),q.purgeCache(),m.go("items.categories.edit",{id:b.id})})})["catch"](function(b){var c=_.first(_.keys(b)),d=_.first(_.values(b)[0]),e=c.charAt(0).toUpperCase()+c.slice(1)+" "+d;a.showMessage("exclamation-sign",e,"error",!0),a.processingForm=!1})})},o?a.triggers=o.data:a.triggers=[],a.onlyActiveTriggers=function(a){return!(!_.isUndefined(a._destroy)&&1==a._destroy)},a.newTrigger=function(){var b={conditions:[{inventory_field_id:null,operator:"equal_to",content:null}],inventory_status_id:null,isNew:!0};a.triggers.push(b)},a.shouldShowGlobalOption=function(){return c.hasPermission("manage_namespaces")&&!u&&1!==c.namespace.id},a.resetSearchInput=function(a){a.search=""},t()}a.module("ItemsCategoriesEditControllerModule",["ItemsCategoriesEditOptionsModalControllerModule","ItemsCategoriesEditFieldValuesModalControllerModule","ItemsCategoriesNewStatusModalControllerModule","ItemsCategoriesEditStatusModalControllerModule","InventorySortableSectionsComponentModule","InventoryPopoverComponentModule","InventoryPopoverLinkComponentModule","InventoryDroppableInputsAreaComponentModule","InventoryEditLabelComponentModule","InputsSidebarComponentModule","InventoryDraggableInputComponentModule","InventoryEditSectionComponentModule","InventoryTriggerComponentModule","InventoryTriggerConditionComponentModule","InventoriesCategoriesServiceModule"]).controller("ItemsCategoriesEditController",c),c.$inject=["$scope","$rootScope","$stateParams","categoryResponse","groupsResponse","Restangular","$localStorage","$q","$modal","$timeout","$window","$state","FileUploader","formulasResponse","analyzesResponse","InventoriesCategoriesService","ItemsCategoriesEditOptionsModalService","$document"]}(angular,$),angular.module("UsersModule",["UsersIndexModule","UsersShowModule","UsersEditModule"]).config(["$stateProvider",function(a){a.state("users",{"abstract":!0,url:"/users",templateUrl:"routes/users/users.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("UsersIndexModule",["UsersIndexControllerModule"]).config(["$stateProvider",function(a){a.state("users.list",{url:"",resolve:{Authorize:["Authorization","User",function(a){return a.authorize(["users_full_access","users_edit"],null,!0)}],groupsResponse:["Restangular",function(a){return a.all("groups").getList({return_fields:"id,name"})}]},views:{"":{templateUrl:"routes/users/index/users-index.template.html",controller:"UsersIndexController",controllerAs:"ctrl"}}})}]),angular.module("UsersIndexControllerModule",["KeyboardPosterComponentModule","GenericInputComponentModule","UsersDisableModalControllerModule","GroupSelectorModule"]).controller("UsersIndexController",["$scope","$q","$stateParams","$modal","Restangular","GroupSelectorService",function(a,b,c,d,e,f){a.loading=!0,a.loadingPagination=!1;var g,h=1,i=30,j="";a.sort={column:"name",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending};var k=function(){var b={page:h,per_page:i,disabled:!0,return_fields:"id,name,disabled,email,phone,groups.id,groups.name",sort:a.sort};return 0!==a.selectedGroups.length&&(b.groups=_.map(a.selectedGroups,function(a){return a.id}).join()),0!==j.length&&(b.query=j),e.one("search").all("users").getList(b)};a.selectedGroups=[],a.getGroupsExcerpt=function(){switch(a.selectedGroups.length){case 1:return"Grupo: "+a.selectedGroups[0].name;case 0:return"Filtrar por grupo";default:return"Grupo: "+a.selectedGroups.length+" grupos selecionados"}},a.filterUsersByGroup=function(){f.open(a.selectedGroups,!0).then(function(b){a.selectedGroups=b,m()})};var l=a.getData=function(b){if(a.loadingPagination===!1){a.loadingPagination=!0;var c=k();return c.then(function(c){if(b!==!0)a.users=c.data;else{"undefined"==typeof a.users&&(a.users=[]);for(var d=0;d<c.data.length;d++)a.users.push(c.data[d]);h++}g=parseInt(c.headers().total);var e=Math.ceil(g/i);h===e+1?a.loadingPagination=null:a.loadingPagination=!1,a.loading=!1}),c}},m=function(){h=1,a.loadingPagination=!1,a.loadingSearch=!0,a.users=[],l(!1).then(function(){a.loadingSearch=!1,h++})};a.search=function(a){j=a,m()},a.disableUser=function(a){d.open({templateUrl:"modals/users/disable/users-disable.template.html",windowClass:"removeModal",resolve:{user:function(){return a}},controller:"UsersDisableModalController"})},a.enableUser=function(b){b.loading=!0;var c=e.one("users",b.id).customPUT({},"enable");c.then(function(){b.disabled=!1,b.loading=!1,a.showMessage("ok","O Usuário "+b.name+" foi ativado com sucesso.","success",!1)})}}]),angular.module("UsersShowModule",["UsersShowControllerModule"]).config(["$stateProvider",function(a){a.state("users.show",{url:"/{id:[0-9]*}",resolve:{userResponse:["Restangular","$stateParams",function(a,b){return a.one("users",b.id).get()}]},views:{"":{templateUrl:"routes/users/show/users-show.template.html",controller:"UsersShowController",controllerAs:"ctrl"}}})}]),angular.module("UsersShowControllerModule",[]).controller("UsersShowController",["$scope","userResponse","$modal","$location",function(a,b,c,d){a.user=b.data,a.disableUser=function(a){c.open({templateUrl:"modals/users/disable/users-disable.template.html",windowClass:"removeModal",resolve:{user:function(){return a}},controller:"UsersDisableModalController"})}}]),angular.module("UsersEditModule",["UsersEditControllerModule"]).config(["$stateProvider",function(a){a.state("users.show.edit",{url:"/edit",resolve:{Authorize:["Authorization","userResponse","User",function(a,b,c){return a.authorize(["users_full_access","users_edit"],b.groups,function(a,d){a||c.id==b.id||d()})}]},views:{"@users":{templateUrl:"routes/users/edit/users-edit.template.html",controller:"UsersEditController",controllerAs:"ctrl",resolve:{groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}}).state("users.add",{url:"/add",views:{"":{templateUrl:"routes/users/edit/users-edit.template.html",controller:"UsersEditController",controllerAs:"ctrl",resolve:{Authorize:["Authorization",function(a){return a.authorize(["users_full_access","users_edit"],null,!0)}],groupsResponse:["Restangular",function(a){return a.all("groups").getList()}]}}}})}]),angular.module("UsersEditControllerModule",["ngCpfCnpj","EqualsComponentModule","GroupsSelectorInlineModule","UsersServiceModule"]).controller("UsersEditController",["$scope","$rootScope","Restangular","UsersService","$stateParams","$location","groupsResponse","Error","moment",function(a,b,c,d,e,f,g,h,i){var j=a.updating=!1,k=e.id;if(a.user={groups:[]},a.isObject=angular.isObject,"undefined"!=typeof k&&(j=!0,a.updating=!0),a.loading=!0,j)d.fetch(k).then(function(b){a.user=b,a.user.birthdate=i(a.user.birthdate).format("DD/MM/YYYY"),a.loading=!1});else{var l=c.stripRestangular(g.data);a.loading=!1;for(var m=l.length-1;m>=0;m--)"Público"===l[m].name&&a.user.groups.push(l[m])}a.send=function(){a.inputErrors=null,a.processingForm=!0,b.resolvingRequest=!0;var c=angular.copy(a.user);c.birthdate&&(c.birthdate=i(c.birthdate,"DD/MM/YYYY").toJSON());var e={};if(a.should_generate_password&&(delete c.password,delete c.password_confirmation,e.generate_password=!0),c.groups_ids=_.pluck(c.groups,"id"),delete c.groups,j){var g=d.update(c,e);g.then(function(){a.showMessage("ok","O usuário foi atualizado com sucesso","success",!0),a.processingForm=!1,b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","O usuário não pode ser salvo","error",!0),a.inputErrors=c,a.processingForm=!1,b.resolvingRequest=!1})}else{e.return_fields="id";var h=d.create(c,e);h.then(function(){a.showMessage("ok","O usuário foi criado com sucesso","success",!0),f.path("/users"),a.processingForm=!1,b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","O usuário não pode ser criado","error",!0),a.inputErrors=c,a.processingForm=!1,b.resolvingRequest=!1})}}}]),angular.module("GroupsModule",["GroupsIndexModule","GroupsShowModule","GroupsEditModule"]).config(["$stateProvider",function(a){a.state("groups",{"abstract":!0,url:"/groups",templateUrl:"routes/groups/groups.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("GroupsIndexModule",["GroupsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("groups.list",{url:"",views:{"":{templateUrl:"routes/groups/index/groups-index.template.html",controller:"GroupsIndexController",controllerAs:"ctrl",resolve:{Authorize:["$rootScope","$state",function(a,b){a.hasAnyPermission(["groups_full_access","group_edit","group_read_only"])||(a.showMessage("exclamation-sign","Você não possui permissão para visualizar essa página.","error"),b.go("items.list"))}]}}}})}]),angular.module("GroupsIndexControllerModule",["GroupsEditModalControllerModule","NamespacesModalModule"]).controller("GroupsIndexController",["$scope","$modal","Restangular","NamespacesModalService",function(a,b,c,d){a.loading=!0;var e=c.all("groups").getList({return_fields:"id,name"});e.then(function(b){a.groups=b.data,a.loading=!1}),a.addGroup=function(){b.open({templateUrl:"modals/groups/edit/groups-edit.template.html",windowClass:"editStatusModal",resolve:{group:function(){return null}},controller:"GroupsEditModalController"})},a.deleteGroup=function(d){b.open({templateUrl:"modals/groups/destroy/groups-destroy.template.html",windowClass:"removeModal",resolve:{groupsList:function(){return a.groups}},controller:["$scope","$modalInstance","groupsList",function(a,b,e){a.group=d,a.confirm=function(){var d=c.one("groups",a.group.id).remove();d.then(function(){b.close(),e.splice(e.indexOf(a.group),1)})},a.close=function(){b.close()}}]})},a.manageNamespaces=function(){d.open()}}]),angular.module("NamespacesModalModule",["NamespacesServiceModule"]).controller("NamespacesModalModuleController",["$scope","$modalInstance","NamespacesService","$timeout",function(a,b,c,d){function e(a){f("Um erro ocorreu durante a realização da ação solicitada. Por favor, tente novamente ou entre em contato com o suporte."),console.error("Namespace modal request error: ",a)}function f(b){a.namespaceError=b,d(function(){delete a.namespaceError},1e4)}a.dataLoaded=!1,a.namespace={name:""};var g=function(){c.fetchAll().then(function(b){a.namespaces=b,a.dataLoaded=!0})};g(),a.submitNamespace=function(){a.isSaveRequestPending=!0,a.saveNamespacePromise=c.save(a.namespace).then(function(){a.isSaveRequestPending=!1,a.namespace={name:""},g()},e)},a.remove=function(b){a.removeNamespacePromise=c.remove(b.id).then(function(){var c=a.namespaces.indexOf(b);a.namespaces.splice(c,1)},e)},a.saveNamespace=function(b){b.isRequestPending=!0,a.saveNamespacePromise=c.save(b).then(function(){b.isRequestPending=!1,g()},e)},a.close=function(){b.dismiss()}}]).factory("NamespacesModalService",["$modal",function(a){return{open:function(){return a.open({templateUrl:"routes/groups/index/components/namespaces.template.html",windowClass:"namespacesModal",controller:"NamespacesModalModuleController"})}}}]),angular.module("GroupsShowModule",["GroupsShowControllerModule"]).config(["$stateProvider",function(a){a.state("groups.show",{url:"/{id:[0-9]*}",resolve:{Authorize:["Authorization","$stateParams","User",function(a,b){return a.authorize(["groups_full_access","group_edit","group_read_only"],b.id,!0)}],Resource:["Restangular","$stateParams",function(a,b){return a.one("groups",b.id).withHttpConfig({treatingErrors:!0}).get().then(function(a){return a.data})}]},views:{"":{templateUrl:"routes/groups/show/groups-show.template.html",controller:"GroupsShowController",controllerAs:"ctrl"}}})}]),angular.module("GroupsShowControllerModule",["GroupsEditModalControllerModule","GroupsAddUsersModalControllerModule","GroupsRemoveUserModalControllerModule"]).controller("GroupsShowController",["$scope","Restangular","$stateParams","$q","$modal","Resource",function(a,b,c,d,e,f){a.isService="services"===f.route;var g=c.id,h=1,i=15;a.loading=!1,a.loadingPagination=!1,a.total=0,a.resource=f,a.sort={column:"",descending:!1},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1)},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending},a.removeUserFromGroup=function(b){e.open({templateUrl:"modals/groups/remove-user/groups-remove-user.template.html",windowClass:"removeModal",resolve:{group:function(){return a.resource},user:function(){return b},removeUserFromList:function(){return function(b){a.users.splice(a.users.indexOf(b),1)}}},controller:"GroupsRemoveUserModalController"})};var j=a.getData=function(c){if(a.loadingPagination===!1){a.loadingPagination=!0;var d=b.all("search").one("groups",g).one("users").getList(null,{page:h,per_page:i,name:a.searchText,global_namespaces:!0});return d.then(function(b){if(c!==!0)a.users=b.data;else{"undefined"==typeof a.users&&(a.users=[]);for(var d=0;d<b.data.length;d++)a.users.push(b.data[d]);h++}a.total=parseInt(b.headers().total);var e=Math.ceil(a.total/i);h===e+1&&c===!0?a.loadingPagination=null:a.loadingPagination=!1,a.loading=!1}),d}};j(!0),a.search=function(b){a.searchText=b,a.loadingPagination=!1,a.loadingSearch=!0,a.users=[],h=1;var c=j(!0);c.then(function(){a.loadingSearch=!1})},a.editGroup=function(){e.open({templateUrl:"modals/groups/edit/groups-edit.template.html",windowClass:"editStatusModal",resolve:{group:function(){return a.resource}},controller:"GroupsEditModalController"})},a.addUsers=function(){e.open({templateUrl:"modals/groups/add-users/groups-add-users.template.html",windowClass:"modal-groups-select-user",resolve:{group:function(){return a.resource}},controller:"GroupsAddUsersModalController"})}}]),angular.module("GroupsEditModule",["GroupsEditControllerModule"]).config(["$stateProvider",function(a){a.state("groups.show.edit",{url:"/edit",resolve:{Authorize:["Authorization","$stateParams","User",function(a,b){return a.authorize(["groups_full_access","group_edit"],b.id,!0)}]},views:{"@groups":{templateUrl:"routes/groups/edit/groups-edit.template.html",controller:"GroupsEditController",controllerAs:"ctrl",resolve:{permissionsResponse:["FullResponseRestangular","$stateParams",function(a,b){return a.one("groups",b.id).all("permissions").customGET()}],objectsResponse:["FullResponseRestangular",function(a){return a.one("utils").all("available_objects").customGET()}],groupResponse:["Restangular","$stateParams",function(a,b){return a.one("groups",b.id).get()}]}}}})}]),angular.module("GroupsEditControllerModule",["DiacriticsInsensitiveFilterHelperModule"]).controller("GroupsEditController",["$scope","$rootScope","Restangular","$stateParams","$location","$timeout","groupResponse","permissionsResponse","Resource","objectsResponse","$translate",function(a,b,c,d,e,f,g,h,i,j,k){var l=a.isService="services"===i.route;if(a.resource=i,a.group=g.data,a.permissions=h.data,a.groups=j.data.groups,a.flows=j.data.flows,a.namespaces=j.data.namespaces,a.chat_rooms=j.data.chat_rooms,a.inventoriesCategories=j.data.inventory_categories,a.reportsCategories=j.data.reports_categories,a.businessReports=j.data.business_reports,a.availablePermissionTypes=[],a.newPermission={type:null,objects:[],slugs:[]},a.isString=function(a){return"string"==typeof a},k(["REPORTS","REPORTS_ATTRIBUTES_CATEGORIES","REPORT","REPORTS_ATTRIBUTES_CATEGORY"]).then(function(b){a.availablePermissionTypes=a.availablePermissionTypes.concat([{type:"user",name:"Usuários",permissionsNames:[{slug:"users_full_access",name:"Gerenciar todos os usuários",needsObject:!1,tooltip:"Ao ativar essa opção, será permitido que este grupo possa ver, adicionar e remover todos os usuários dos grupos às quais tem permissão de visualizar."},{slug:"users_read_private",name:"Ver dados privados dos usuários",needsObject:!1,tooltip:"Ao ativar essa opção, será permitido que este grupo possa ver informações sensitivas de todos os usuários, como o CPF, Data de Nascimento e etc."},{type:"group",slug:"users_edit",name:"Gerenciar usuários de um grupo específico",needsObject:!0,tooltip:"Ao ativar essa opção, será permitido que este grupo possa visualizar, adicionar e remover todos os usuários dos outros grupos que você selecionar para esta permissão."},{slug:"manage_services",name:"Gerenciar integração com serviços",needsObject:!1,tooltip:"Ao ativar essa opção, será permitido que este grupo possa utilizar os serviços de integração."}]},{type:"group",name:"Grupos",permissionsNames:[{slug:"groups_full_access",name:"Gerenciar todos os grupos",needsObject:!1,tooltip:"Selecionada esta opção, o grupo obtém todas as permissões de edições sobre todos os grupos existentes, sobre novos grupos adicionados no futuro, e sobre todos os usuários pertencentes a todos os grupos. Também permite a visualização e edição de dados dos usuários, buscar, deletar e adicionar usuários."},{slug:"group_edit",name:"Editar e visualizar o grupo",needsObject:!0,tooltip:"Permite sobre os grupos selecionados: a visualização e edição de dados dos usuários, buscar, deletar e adicionar usuários. Permite a edição das permissões dos grupos selecionados."},{slug:"group_read_only",name:"Visualizar o grupo",needsObject:!0,tooltip:"Permite acessar a listagem de grupos selecionados, visualizar quais os usuários estão dentro do grupo. Nesta permissão o usuário não tem permissão de adicionar, deletar ou editar os grupos, usuários e permissões."}]},{type:"other",name:"Configurações",permissionsNames:[{slug:"panel_access",name:"Acesso ao painel permitido",needsObject:!1},{slug:"manage_config",name:"Gerenciar configurações do sistema",needsObject:!1}]},{type:"inventory",name:"Inventário",serviceAllowed:!0,permissionsNames:[{slug:"inventories_full_access",name:"Gerenciar todas as categorias",needsObject:!1,tooltip:"Ativada esta opção, o grupo obtém todas as permissões de edição sobre todas as categorias de inventário existentes, sobre novas categorias adicionados no futuro, e sobre todos os formulários pertencentes a todas as categorias. Também permite a visualização e edição de dados dos itens de inventário, buscar, deletar e adicionar itens de inventário."},{slug:"inventories_formulas_full_access",name:"Gerenciar fórmulas",needsObject:!1,needsPermission:"inventories_full_access"},{slug:"inventories_categories_edit",name:"Editar a categoria",needsObject:!0,disableFields:["inventories_items_edit","inventories_items_create","inventories_items_delete","inventories_items_create","inventories_items_read_only"],tooltip:"Permite sobre as categorias selecionadas: a visualização e edição de dados dos itens de inventário, buscar, deletar e adicionar itens de inventário. Permite a edição dos campos de formulários das categorias selecionadas."},{slug:"inventories_items_create",name:"Criar novos itens",needsObject:!0,tooltip:"Ao selecionar quais categorias de inventário o grupo terá acesso, os usuários poderão apenas adicionar itens de inventário sobre as categorias selecionadas, além de poder visualizar os itens que o próprio usuário criou."},{slug:"inventories_items_edit",name:"Visualizar e editar itens",needsObject:!0,tooltip:'Ao selecionar quais categorias de inventário o grupo terá acesso, os usuários poderão visualizar e editar os itens de inventário das categorias selecionadas. Essa opção automaticamente ativará a permissão "Visualizar itens".'},{slug:"inventories_items_delete",name:"Remover itens",needsObject:!0,tooltip:'Ao selecionar quais categorias de inventário o grupo terá acesso, os usuários poderão visualizar e excluir os itens de inventário das categorias selecionadas. Essa opção automaticamente ativará a permissão "Visualizar itens".'},{slug:"inventories_items_read_only",name:"Listar itens",needsObject:!0,tooltip:"Essa opção permitirá que os usuários deste grupo possam listar os itens de inventário das categorias de inventário selecionadas. Para que os campos possam ser visualizados, é necessário acessar as categorias e adicionar as permissões de visualização ou edição para cada grupo nas seções ou campos desejados."}]},{type:"report",name:b.REPORTS,serviceAllowed:!0,permissionsNames:[{slug:"reports_full_access",name:"Gerenciar todas as "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase(),needsObject:!1,tooltip:"Selecionada esta opção, o grupo obtém todas as permissões de edição sobre todas as "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" de "+b.REPORTS.toLowerCase()+" existentes, sobre novas "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" adicionados no futuro, e sobre todos os "+b.REPORTS.toLowerCase()+" criados pertencentes a todas as "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+". Também permite a visualização e edição de dados dos "+b.REPORTS.toLowerCase()+", buscar, deletar e adicionar "+b.REPORTS.toLowerCase()},{slug:"reports_categories_edit",name:"Parametrizar as "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase(),disableFields:["reports_items_create","reports_items_delete","reports_items_edit","reports_items_read_public","reports_items_read_private","reports_items_forward","reports_items_create_internal_comment","reports_items_alter_status","reports_items_create_comment"],needsObject:!0,tooltip:"Permite sobre as "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" selecionadas: a visualização e edição de dados dos "+b.REPORTS.toLowerCase()+", buscar, deletar e adicionar relatos. Permite a edição dos parâmetros das "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" selecionadas."},{slug:"reports_items_edit",name:"Visualizar e editar "+b.REPORTS.toLowerCase(),needsObject:!0,tooltip:"Permite visualizar e editar os "+b.REPORTS.toLowerCase()+" das "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" selecionadas.",disableFields:["reports_items_forward","reports_items_create_internal_comment","reports_items_alter_status","reports_items_create_comment","reports_items_read_public","reports_items_read_private"]},{slug:"reports_items_create",name:"Criar novos "+b.REPORTS.toLowerCase(),needsObject:!0,tooltip:"Permite que os usuários do painel possam adicionar novos "+b.REPORTS.toLowerCase()+" às "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" selecionadas."},{slug:"reports_items_delete",name:"Remover "+b.REPORTS.toLowerCase(),needsObject:!0,needsPermission:"reports_items_read_private",tooltip:"Permite visualizar e deletar os "+b.REPORTS.toLowerCase()+" das "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" selecionadas."},{slug:"reports_items_read_private",name:"Visualizar "+b.REPORTS.toLowerCase()+" completo",needsObject:!0,tooltip:"Permite a visualização completa de todos os campos disponíveis nos "+b.REPORTS.toLowerCase()+" das "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" selecionadas."},{slug:"reports_items_read_public",name:"Visualizar "+b.REPORTS.toLowerCase()+" parcial",needsObject:!0,tooltip:"A visualização de "+b.REPORT.toLowerCase()+" parcial é uma permissão que restringe o acesso as informações do "+b.REPORT.toLowerCase()+", isto é, os usuários do grupo não poderão visualizar as observações internas, as respostas enviadas ao solicitante no modo privado e o protocolo. Os usuário exergarão todas as demais informações da tela."},{slug:"reports_items_forward",name:"Encaminhar "+b.REPORTS.toLowerCase(),needsObject:!0,tooltip:"Grupo pode encaminhar item de "+b.REPORT.toLowerCase()+" da "+b.REPORTS_ATTRIBUTES_CATEGORY.toLowerCase()+" atribuída."},{slug:"reports_items_create_internal_comment",name:"Inserir observações internas",needsObject:!0,tooltip:"Grupo pode inserir uma observação interna nos "+b.REPORTS.toLowerCase()+" da "+b.REPORTS_ATTRIBUTES_CATEGORY.toLowerCase()+" atribuída."},{slug:"reports_items_alter_status",name:"Alterar o estado do "+b.REPORT.toLowerCase(),needsObject:!0,tooltip:"Grupo pode alterar o estado de "+b.REPORTS.toLowerCase()+" da "+b.REPORTS_ATTRIBUTES_CATEGORY.toLowerCase()+" atribuída."},{slug:"reports_items_create_comment",name:"Enviar comentários ao solicitante",needsObject:!0,tooltip:"Grupo pode adicionar comentário público ou privado nos "+b.REPORTS.toLowerCase()+" da "+b.REPORTS_ATTRIBUTES_CATEGORY.toLowerCase()+" atribuída."},{slug:"reports_items_send_notification",name:"Enviar notificação de "+b.REPORTS.toLowerCase(),needsObject:!0,tooltip:"Grupo pode enviar e reenviar notificações."},{slug:"reports_items_restart_notification",name:"Reeiniciar processo de notificação de "+b.REPORTS.toLowerCase(),needsObject:!0,tooltip:"Grupo pode reiniciar todo o processo de notificações."}]},{type:"business_report",name:"Relatórios",permissionsNames:[{slug:"business_reports_edit",name:"Gerenciar relatórios",needsObject:!1},{slug:"business_reports_view",name:"Visualizar relatório específico",needsObject:!0}]},{type:"chat",name:"Chat",permissionsNames:[{slug:"manage_chat_rooms",name:"Gerenciar salas de chat",needsObject:!1},{slug:"chat_rooms_read",name:"Participar de uma sala de chat específica",needsObject:!0}]},{type:"case",name:"Casos",permissionsNames:[{slug:"manage_cases",name:"Gerenciar casos",needsObject:!1},{slug:"cases_with_reports_view",name:"Visualizar casos com "+b.REPORTS_ATTRIBUTES_CATEGORIES.toLowerCase()+" de relato",needsObject:!0}]},{type:"namespace",name:"Localidade",permissionsNames:[{slug:"manage_namespaces",name:"Gerenciar localidades",needsObject:!1},{slug:"namespaces_access",name:"Visualizar localidade",needsObject:!0}]}])}),b.flowsEnabled){var m={type:"flow",name:"Fluxos",permissionsNames:[{slug:"flow_can_delete_own_cases",name:"Remover casos próprios",needsObject:!0},{slug:"flow_can_execute_all_steps",name:"Executar todas etapas",needsObject:!0},{slug:"flow_can_view_all_steps",name:"Visualizar todas etapas",needsObject:!0},{slug:"can_execute_step",name:"Executar etapa",needsObject:!0},{slug:"can_view_step",name:"Visualizar etapa",needsObject:!0},{slug:"manage_flows",name:"Gerenciar fluxos",needsObject:!1},{slug:"flow_can_delete_all_cases",name:"Remover todos casos",needsObject:!1}]};a.availablePermissionTypes.push(m)}a.isAllowed=function(a){return l&&a.serviceAllowed||!l};var n=a.getType=function(b){for(var c=a.availablePermissionTypes.length-1;c>=0;c--)if(a.availablePermissionTypes[c].type===b)return a.availablePermissionTypes[c];
return null};a.getTypeName=function(a){if(a)return a&&_.isArray(a.permission_names)&&"users_edit"==a.permission_names[0]?"Usuários":n(a.permission_type)?n(a.permission_type).name:a.permission_type},a.getTypePermissions=function(a){return n(a)?n(a).permissionsNames:null};var o=function(a,b){if(a=n(a),!a)return null;for(var c=a.permissionsNames.length-1;c>=0;c--)if(a.permissionsNames[c].slug===b)return a.permissionsNames[c];return null};a.getPermissionsExcerpt=function(){switch(a.newPermission.slugs.length){case 0:return"Selecione a permissão";case 1:return a.getPermissionName(a.newPermission.type,a.newPermission.slugs[0]);default:return a.newPermission.slugs.length+" permissões selecionadas"}},a.isPermissionSelected=function(b){var c=a.newPermission.slugs.indexOf(b);return c!==-1};var p=[];a.togglePermission=function(b){var c=a.newPermission.slugs.indexOf(b.slug);c===-1?(a.newPermission.slugs.push(b.slug),b.type&&(a.newPermission.actual_type=b.type),_.isUndefined(b.needsPermission)||a.newPermission.slugs.indexOf(b.needsPermission)!==-1||a.togglePermission(o(a.newPermission.type,b.needsPermission)),_.isUndefined(b.disableFields)||p.push(b)):(a.newPermission.slugs.splice(c,1),_.isUndefined(b.disableFields)||p.splice(p.indexOf(b),1))},a.getObjectsExcerpt=function(){switch(a.newPermission.objects.length){case 0:return"Selecione um item";case 1:return a.newPermission.objects[0].name||a.newPermission.objects[0].title;default:return a.newPermission.objects.length+" categorias selecionadas"}},a.isObjectSelected=function(b){for(var c=a.newPermission.objects.length-1;c>=0;c--)if(a.newPermission.objects[c].id===b)return!0;return!1},a.toggleChildObject=function(b,c){var d=q(a.newPermission.objects,function(a){return a.id===b.id});d!==-1?a.newPermission.objects.splice(d,1):(_.isUndefined(c)||a.isObjectSelected(c.id)||a.newPermission.objects.push(c),a.newPermission.objects.push(b))},a.toggleObject=function(b,c){var d=q(a.newPermission.objects,function(a){return a.id===b.id});d!==-1?(_.each(c,function(b){var c=q(a.newPermission.objects,function(a){return a.id===b.id});c!==-1&&a.newPermission.objects.splice(c,1)}),a.newPermission.objects.splice(d,1)):a.newPermission.objects.push(b)},a.selectAllObjects=function(b){for(var c=b.length-1;c>=0;c--){for(var d=!1,e=0;e<a.newPermission.objects.length;e++)a.newPermission.objects[e].id==b[c].id&&(d=!0);d||a.newPermission.objects.push(b[c]),_.isUndefined(b[c].subcategories)||a.selectAllObjects(b[c].subcategories)}},a.isObjectNeeded=function(){if(0===a.newPermission.slugs.length)return null;for(var b=a.newPermission.slugs.length-1;b>=0;b--)if(o(a.newPermission.type,a.newPermission.slugs[b]).needsObject)return!0;return!1},a.isPermissionDisabled=function(b){for(var c=a.newPermission.slugs.length-1;c>=0;c--)if(o(a.newPermission.type,a.newPermission.slugs[c]).needsPermission===b)return!0;for(var c=p.length-1;c>=0;c--)if(p[c].disableFields.indexOf(b)!==-1)return!0;return!1},a.getPermissionName=function(a,b){return!(!a||!b)&&("users_edit"==b?"Gerenciar usuários de um grupo específico":o(a,b)?o(a,b).name:b)},a.setNewPermissionType=function(b){f(function(){a.newPermission.objects=[],a.newPermission.slugs=[],p=[],a.showPermissionsMenu=!1,a.showObjectsMenu=!1,a.newPermission.type=b?b.type:null})},a.createPermission=function(){a.creatingPermission=!0;var b=a.newPermission.actual_type||a.newPermission.type,d=a.newPermission.slugs;if(0!==a.newPermission.objects.length)for(var e=[],f=a.newPermission.objects.length-1;f>=0;f--)e.push(a.newPermission.objects[f].id);var g=c.one("permissions").one(l?"services":"groups",a.resource.id).one(b),h=g.customPOST({permissions:d,objects_ids:e});h.then(function(c){if(a.creatingPermission=!1,0===a.newPermission.objects.length)a.permissions.push({permission_type:b,permission_names:d,object:null});else for(var e=a.newPermission.objects.length-1;e>=0;e--){for(var f=!1,g=a.permissions.length-1;g>=0;g--)_.isUndefined(a.permissions[g].object)||a.permissions[g].permission_type!=b||a.permissions[g].object.id!=a.newPermission.objects[e].id||(f=!0,a.permissions[g].permission_names=_.union(a.permissions[g].permission_names,angular.copy(d)));f||a.permissions.push({permission_type:b,permission_names:angular.copy(d),object:a.newPermission.objects[e]})}a.setNewPermissionType(null)})},a.removePermission=function(b,d){b.removingPermission=!0;var e=b.object?b.object.id:void 0,f=c.one("permissions").one(l?"services":"groups",a.resource.id).one(b.permission_type).customDELETE(null,{permission:d,object_id:e});f.then(function(){"string"==typeof b.permission_names||"object"==typeof b.permission_names&&1===b.permission_names.length?a.permissions.splice(a.permissions.indexOf(b),1):b.permission_names.splice(b.permission_names.indexOf(d),1),b.removingPermission=!1})};var q=function(a,b){var c=-1;return _.each(a,function(a,d){if(b(a))return void(c=d)}),c}}]),angular.module("ConfigModule",["ConfigControllerModule"]).config(["$stateProvider",function(a){a.state("config",{url:"/config",templateUrl:"routes/config/config.template.html",controller:"ConfigController",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}],flagsResponse:["Restangular",function(a){return a.all("feature_flags").getList()}]}})}]),angular.module("ConfigControllerModule",["FeatureFlagComponentModule","ConfigServiceModule"]).controller("ConfigController",["$scope","flagsResponse","ConfigService",function(a,b,c){for(var d={explore:{name:"Explorar o mapa",desc:"Permite visualizar os relatos publicados por outros usuário em um mapa. As informações pessoais destes usuários não são exibidas nos relatos.",mobileConfig:!0},create_report_clients:{name:"Criar relatos",desc:"Permite que cidadãos possam criar os relatos.",mobileConfig:!0},create_report_panel:{name:"Criar relato pelo painel administrativo",desc:"Permite que usuários do painel administrativo possam criar relatos dos usuários. Ideal para atendimento ao solicitante (156) e prestadora de serviços.",mobileConfig:!1},stats:{name:"Estatísticas",desc:"Permite que os usuários visualizem estatísticas globais dos status dos relatos. As informações detalhadas não é exibida nesta interface, apenas a somatória de todos os relatos dentro daquele status específicos.",mobileConfig:!0},social_networks_facebook:{name:"Compartilhamento do relato no Facebook",desc:"Permite que o usuário, ao publicar um novo relato, compartilhe no Facebook. Se desativado o usuário não pode conectar sua conta do Facebook no aplicativo e também não é exibido o botão de compartilhamento.",mobileConfig:!0},social_networks_twitter:{name:"Compartilhamento do relato no Twitter",desc:"Permite que o usuário, ao publicar um novo relato, compartilhe no Twitter. Se desativado o usuário não pode conectar sua conta do Twitter no aplicativo e também não é exibido o botão de compartilhamento.",mobileConfig:!0},social_networks_gplus:{name:"Compartilhamento do relato no Google Plus",desc:"Permite que o usuário, ao publicar um novo relato, compartilhe no Google Plus. Se desativado o usuário não pode conectar sua conta do Google Plus no aplicativo e também não é exibido o botão de compartilhamento.",mobileConfig:!0},allow_photo_album_access:{name:"Permitir acesso ao album de fotos",desc:"Permite que o usuário, ao publicar um novo relato, selecione uma foto do próprio album para inserir no relato. Se desativado o usuário só poderá fazer uma fotografia ou continuar sem enviar nenhuma foto.",mobileConfig:!0},cases:{name:"Casos",desc:"Aenean eu leo quam. Pellentesque ornare sem lacinia quam venenatis vestibulum. Cras justo odio, dapibus ac facilisis in, egestas eget quam.",mobileConfig:!1},inventory:{name:"Inventário",desc:"O sistema ZUP permite que instituições e empresas criem qualquer tipo de inventário georeferenciado. O usuário com permissão de acesso às categorias de inventário tem a liberdade de criar campos diretamente pelo painel, para que outros usuários possam criar os itens de inventário relacionado a categoria e fazer a gestão deste itens de inventário utilizando diversas ferramentas disponíveis.",mobileConfig:!1},reports:{name:"Relatos",desc:"A categoria de relato permite que empresas e instituições criem um canal de comunicação com os seus clientes e usuários, permitindo que os usuários relatem problemas. É possível criar ilimitadas categorias de relatos, é permitido que estas categorias possam ser disponibilizadas aos usuários nos aplicativos ou privado, isto é, só será permitido que usuários com acesso ao Painel ZUP possa criar os relatos.",mobileConfig:!1},show_resolution_time_to_clients:{name:"Exibir o tempo de resolução do relato para os usuários",desc:"Quando o usuário cria um relato, é exibido uma mensagem de agradecimento e o tempo de resolução do relato. Se desativado, esta mensagem do tempo é ocultada.",mobileConfig:!0},show_answer_to_requester:{name:"Responder ao solicitante",desc:"Exibe o campo que permite responder ao solicitante na tela de visualização do relato, no modal de alteração de status, no relato no aplicativo técnico e no modal de alteração de status no aplicativo técnico",mobileConfig:!0}},e=angular.copy(b.data),f=e.length-1;f>=0;f--){var g=e[f].name;"undefined"!=typeof d[g]&&(e[f].name=d[g].name,e[f].desc=d[g].desc,e[f].mobileConfig=d[g].mobileConfig,e[f].enabled="disabled"!==e[f].status)}a.flags=e,c.getReportsColumns().then(function(b){a.reportsColumns=b}),a.$watch("reportsColumns",function(a,b){a&&b&&c.updateReportsColumns(a)},!0),a.reportColumnsSortableOptions={handle:".handle",stop:function(a,b){},start:function(a,b){b.placeholder.height(b.item.height())},tolerance:"pointer",items:"li",revert:!0,placeholder:"sortable-placeholder"}}]),angular.module("HelpModule",["HelpControllerModule"]).config(["$stateProvider",function(a){a.state("help",{url:"/help",templateUrl:"routes/help/help.template.html",controller:"HelpController",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("HelpControllerModule",["yaru22.md"]).controller("HelpController",["$scope",function(a){}]),angular.module("FlowsModule",["FlowsIndexModule","FlowsShowModule","FlowsShowStepsEditModule"]).config(["$stateProvider",function(a){a.state("flows",{"abstract":!0,url:"/flows",templateUrl:"routes/flows/flows.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("FlowsIndexModule",["FlowsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("flows.list",{url:"",views:{"":{templateUrl:"routes/flows/index/flows-index.template.html",controller:"FlowsIndexController",controllerAs:"ctrl"}}})}]),angular.module("FlowsIndexControllerModule",["FlowsAddModalControllerModule","FlowsEditModalControllerModule","FlowsDestroyModalControllerModule","FlowsServiceModule"]).controller("FlowsIndexController",["$scope","$modal","$timeout","FlowsService",function(a,b,c,d){var e=1,f=30;a.flows=[],a.searchQuery="",a.sortTable={column:"created_at",descending:!0};var g,h=function(){var b={page:e,per_page:f,initial:!0};""!==a.searchQuery&&(b.query=a.searchQuery),a.sortTable&&(b.sort=a.sortTable.column,b.order=a.sortTable.descending?"desc":"asc");var c=d.fetchAll(b);return c.then(function(b){b.length>0&&(a.flows=a.flows.concat(b),e++)})};a.$watch("searchQuery",function(b,d){g&&c.cancel(g),g=c(function(){angular.equals(d,b)===!1&&a.reload()},1e3)}),a.changeSorting=function(b){var c=a.sortTable;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1),a.reload()},a.selectedCls=function(b){var c=a.sortTable;return b===c.column&&"sort-"+c.descending},a.loadFlows=function(){a.loadingPagination=!0,h().then(function(){a.loadingPagination=!1})},a.reload=function(){a.flows=[],e=1,a.loadFlows()},a.addFlow=function(){b.open({templateUrl:"modals/flows/add/flows-add.template.html",windowClass:"addFlowModal",resolve:{flows:function(){return a.flows}},controller:"FlowsAddModalController"})},a.editFlow=function(c){b.open({templateUrl:"modals/flows/edit/flows-edit.template.html",windowClass:"addFlowModal",resolve:{flows:function(){return a.flows},flow:function(){return c}},controller:"FlowsEditModalController"})},a.removeFlow=function(c){b.open({templateUrl:"modals/flows/destroy/flows-destroy.template.html",windowClass:"removeModal",resolve:{flows:function(){return a.flows},flow:function(){return c}},controller:"FlowsDestroyModalController"})}}]),angular.module("FlowsShowModule",["FlowsShowControllerModule"]).config(["$stateProvider",function(a){a.state("flows.show",{url:"/{id:[0-9]{1,4}}",views:{"":{templateUrl:"routes/flows/show/flows-show.template.html",controller:"FlowsShowController",controllerAs:"ctrl"}}})}]),angular.module("FlowsShowControllerModule",["FlowsStepsAddModalControllerModule","FlowsStepsDestroyModalControllerModule","FlowsStepsOrderComponentModule","FlowsServiceModule"]).controller("FlowsShowController",["$rootScope","$scope","$stateParams","$modal","FlowsService",function(a,b,c,d,e){var f=c.id;b.flow=null,b.loading=!0,b.sortableOptions={containment:"window",axis:"y",placeholder:"ui-state-highlight",stop:function(a,c){var d=e.reorder(b.flow.id,b.flow.my_steps);b.loading=!0,d.then(function(a){b.showMessage("ok","O fluxo foi ordenado com sucesso.","success",!0),b.selectVersion(null)})["catch"](function(a){b.showMessage("exclamation-sign","O fluxo não pode ser ordenado.","error",!0)})["finally"](function(){b.loading=!1})}},b.tableSort={column:"version_id",descending:!0};var g=function(a){angular.forEach(a.list_versions,function(b,c){b.friendly_id=c+1,a.version_id===b.version_id&&(a.friendly_version_id=b.friendly_id)})};b.changeSorting=function(a){var c=b.tableSort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1)},b.selectedCls=function(a){return a===b.tableSort.column&&"sort-"+b.tableSort.descending},b.selectVersion=function(a){var c=e.fetch(f,a,{draft:!0});b.loading=!0,c.then(function(a){b.loading=!1,b.flow=a,g(b.flow)})},b.addStep=function(){d.open({templateUrl:"modals/flows/steps/add/flows-steps-add.template.html",windowClass:"editStepModal",resolve:{flow:function(){return b.flow}},controller:"FlowsStepsAddModalController"})},b.editStep=function(a){d.open({templateUrl:"modals/flows/steps/edit/flows-steps-edit.template.html",windowClass:"editStepModal",resolve:{flow:function(){return b.flow},step:function(){return a}},controller:"FlowsStepsEditModalController"})},b.removeStep=function(a){d.open({templateUrl:"modals/flows/steps/destroy/flows-steps-destroy.template.html",windowClass:"removeModal",resolve:{flow:function(){return b.flow},step:function(){return a}},controller:"FlowsStepsDestroyModalController"})},b.editFlow=function(){d.open({templateUrl:"modals/flows/edit/flows-edit.template.html",windowClass:"addFlowModal",resolve:{flows:function(){return null},flow:function(){return b.flow}},controller:"FlowsEditModalController"}).result.then(function(a){b.flow=a})},b.publishFlow=function(){var a=e.publish(b.flow.id);b.loading=!0,a.then(function(a){b.showMessage("ok","O fluxo foi publicado com sucesso","success",!0),b.selectVersion()})["catch"](function(a){b.showMessage("exclamation-sign","O fluxo não pode ser publicado","error",!0),b.loading=!1})},b.setVersion=function(a){var c=e.setVersion(a.id,a.version_id);b.loading=!0,c.then(function(){b.showMessage("ok","A versão corrente foi atualizada","success",!0),b.selectVersion(a.version_id)})["catch"](function(a){b.showMessage("exclamation-sign","A versão não pode ser utilizada","error",!0),b.loading=!1})},b.selectVersion()}]),angular.module("FlowsShowStepsEditModule",["FlowsShowStepsEditControllerModule"]).config(["$stateProvider",function(a){a.state("flows.show.steps-edit",{url:"/version/{versionId:[0-9]{1,4}|draft}/steps/{stepId:[0-9]{1,4}}/edit",views:{"@":{templateUrl:"routes/flows/show/steps-edit/flows-show-steps-edit.template.html",controller:"FlowsShowStepsEditController",controllerAs:"ctrl"}}})}]),angular.module("FlowsShowStepsEditControllerModule",["FlowsStepsEditModalControllerModule","FlowsCreateValueComponentModule","FlowsDroppableInputsAreaComponentModule","FlowsSingleValueComponentModule","FlowsStepFieldComponentModule","FlowsTriggerComponentModule","InventoryPopoverComponentModule","InventoryPopoverLinkComponentModule","InputsSidebarComponentModule","FlowsDraggableInputComponentModule","FlowsServiceModule","StepsServiceModule","TwoStepSelectorModule","ReportsCategoriesServiceModule","InventoriesCategoriesServiceModule","ItemSelectorDirectiveModule"]).controller("FlowsShowStepsEditController",["$scope","Restangular","$modal","$stateParams","$q","StepsService","FlowsService","InventoriesCategoriesService","ReportsCategoriesService",function(a,b,c,d,e,f,g,h,i){var j=d.id,k=d.stepId,l="draft"==d.versionId?null:d.versionId;a.loading=!0,a.currentTab="form";var m=g.fetch(j,l,{return_fields:["id","title","draft","initial","status","steps","resolution_states","steps_order"].join()}),n=g.fetchAll({return_fields:["id","title"].join()}),o=f.fetch(j,k,l),p=f.fetchTriggers(j,k,l);a.flow={},a.flows=[],a.step={},a.fields={},a.triggers=[],e.all([m,n,o,p]).then(function(b){a.loading=!1,a.flow=b[0],a.flows=b[1],a.step=b[2],a.fields=_.map(a.step.fields_id,function(b){return _.findWhere(a.step.fields,{id:parseInt(b,10)})}),a.triggers=b[3]}),a.availableInputs=f.getAvailableFields(),a.sortableOptions={containment:".flows-triggers",axis:"y",placeholder:"ui-state-highlight",stop:function(c,d){var e={ids:_.map(a.triggers,function(a){return a.id})},f=b.one("flows",a.flow.id).one("steps",a.step.id).withHttpConfig({treatingErrors:!0}).customPUT(e,"triggers");a.loading=!0,f.then(function(b){a.showMessage("ok","O gatilho foi ordenado com sucesso.","success",!0)})["catch"](function(b){a.showMessage("exclamation-sign","O fluxo não pode ser ordenado.","error",!0)})["finally"](function(){a.loading=!1})}},a.kindHasMultipleOptions=function(b){for(var c=a.availableInputs.normal.length-1;c>=0;c--)if(a.availableInputs.normal[c].kind===b)return a.availableInputs.normal[c].multipleOptions===!0;return!1},a.action_types=[{action:"enable_steps",name:"Ativar etapa(s)"},{action:"disable_steps",name:"Desativar etapa(s)"},{action:"finish_flow",name:"Finalizar fluxo(s)"},{action:"transfer_flow",name:"Transferir fluxo(s)"}],a.newTrigger=function(){var b={title:"",trigger_conditions:[],action_type:"disable_steps",action_values:[],description:"",isNew:!0};a.triggers.push(b)},a.removeTrigger=function(c){if(a.processingForm=!0,c.isNew){var d=e.defer();a.removerTriggerPromise=d.promise,a.removerTriggerPromise.then(function(){a.triggers.splice(a.triggers.indexOf(c),1),a.processingForm=!1}),d.resolve(!0)}else a.removerTriggerPromise=b.one("flows",a.flow.id).one("steps",a.step.id).one("triggers",c.id).remove(),a.removerTriggerPromise.then(function(){a.triggers.splice(a.triggers.indexOf(c),1),a.processingForm=!1})};var q;a.updatePermissions=function(b){if(b){if(!q)return void(q=angular.copy(b));var c,d;angular.equals(q.can_execute_step,b.can_execute_step)||(c="can_execute_step",d=b.can_execute_step),angular.equals(q.can_view_step,b.can_view_step)||(c="can_view_step",d=b.can_view_step),f.updatePermission(j,k,c,d).then(function(){q=angular.copy(b),a.showMessage(null,null,"updated-successfuly",!1)},function(){a.permissions=angular.copy(q)})}},a.toggleConductionMode=function(){a.step.conduction_mode_open=!a.step.conduction_mode_open,f.update(j,k,{conduction_mode_open:a.step.conduction_mode_open}).then(function(){a.showMessage(null,null,"updated-successfuly",!1)},function(){a.step.conduction_mode_open=!a.step.conduction_mode_open})},a.$watch("step.permissions",a.updatePermissions,!0),a.$on("hidePopovers",function(b,c){a.$broadcast("hideOpenPopovers",c)}),a.editStep=function(){c.open({templateUrl:"modals/flows/steps/edit/flows-steps-edit.template.html",windowClass:"editStepModal",resolve:{flow:function(){return a.flow},step:function(){return a.step}},controller:"FlowsStepsEditModalController"})},a.getCategories=function(a){return"report_item"==a?i.fetchTitlesAndIds:"inventory_item"==a?h.fetchTitlesAndIds:void 0}}]),angular.module("CasesModule",["CasesIndexModule","CasesEditModule"]).config(["$stateProvider",function(a){a.state("cases",{"abstract":!0,url:"/cases",templateUrl:"routes/cases/cases.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("CasesIndexModule",["CasesIndexControllerModule"]).config(["$stateProvider",function(a){a.state("cases.list",{url:"",views:{"":{templateUrl:"routes/cases/index/cases-index.template.html",controller:"CasesIndexController",controllerAs:"ctrl"}}})}]),angular.module("CasesIndexControllerModule",["CasesServiceModule","FlowsServiceModule","CasesInactiveModalModule"]).controller("CasesIndexController",["$scope","CasesService","FlowsService","CasesInactiveModalService","$q","$location","$timeout",function(a,b,c,d,e,f,g){function h(){a.loading=!0,a.loadingPagination=!1,o().then(function(){a.loading=!1})}a.currentTab="my-cases";var i,j,k=1,l=30;a.cases=[],a.flows=[],a.resolution_states=[],a.sortTables={progress:{column:"updated_at",descending:!0},"my-cases":{column:"updated_at",descending:!0},finished:{column:"updated_at",descending:!0}},a.filters={flows:[],steps:[],resolution_states:[]},a.querySearch={finished:"",progress:""};var m=function(){var c={page:k,per_page:l,completed:!1};0!==a.filters.flows.length&&(c.initial_flow_id=a.filters.flows.join()),0!==a.filters.steps.length&&(c.step_id=a.filters.steps.join()),0!==a.filters.resolution_states.length&&(c.resolution_state_id=a.filters.resolution_states.join()),"finished"===a.currentTab&&(c.completed=!0),"my-cases"===a.currentTab&&(c.mine=!0,c.completed=!1);var d=a.querySearch[a.currentTab]||"";d.length>0&&(c.query=d);var e=a.sortTables[a.currentTab];return e&&(c.sort=e.column,c.order=e.descending?"desc":"asc"),b.fetchAll(c)},n=function(){var a={initial:"true",return_fields:["id","title","steps.id","steps.title","resolution_states.id","resolution_states.title"].join()};return c.fetchAll(a)},o=function(){var b=n(),c=m(),d=e.all([c,b]);return d.then(function(b){a.flows=b[1],a.cases=b[0].cases,i=parseInt(b[0].headers().total),j=Math.ceil(i/l),a.steps=[],a.resolution_states=[],angular.forEach(a.flows,function(b){a.steps=a.steps.concat(b.steps),a.resolution_states=a.resolution_states.concat(b.resolution_states)}),angular.forEach(a.cases,function(a){a.steps_complete=a.total_steps-a.steps_not_fulfilled.length,angular.forEach(a.steps,function(b,c){if(b.step.id==a.next_step_id)return void(a.next_step=c+1)})})}),d};a.$watchCollection("[currentTab, filters.flows, filters.steps, filters.resolution_states]",function(b,c){angular.equals(b,c)===!1&&a.reload()});var p;a.$watchCollection("[querySearch.progress, querySearch.finished]",function(b,c){p&&g.cancel(p),p=g(function(){angular.equals(b,c)===!1&&a.reload()},1e3)}),a.paginate=function(){var b=e.defer();if(k<=j&&a.loadingPagination===!1){a.loadingPagination=!0;var c=m();c.then(function(c){angular.forEach(c.cases,function(b){b.steps_complete=b.total_steps-b.steps_not_fulfilled.length,a.cases.push(b),angular.forEach(b.steps,function(a,c){if(a.step.id==b.next_step_id)return void(b.next_step=c+1)})}),k++,a.loadingPagination=!1,b.resolve()},function(){b.resolve()})}else a.loadingPagination=null,b.resolve();return b.promise},a.reload=function(){a.cases=[],a.loadingPagination=!1,a.loadingContent=!0,k=1,o().then(function(){a.loadingContent=!1})},a.changeSorting=function(b){var c=a.sortTables[a.currentTab];c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1),a.reload()},a.selectedCls=function(b){if(a.sortTables[b]){var c=a.sortTables[a.currentTab];return b===c.column&&"sort-"+c.descending}},a.createCase=function(a){return b.create({initial_flow_id:a.id,step_id:a.steps[0].id}).then(function(a){f.path("/cases/"+a["case"].id)})},a.inactiveCase=function(b){d.open(b).then(function(){a.cases.splice(a.cases.indexOf(b),1)})},a.restoreCase=function(c){var d=b.restore(c);c.loading=!0,d.then(function(){c.status="active",c.loading=!1,a.cases.splice(a.cases.indexOf(c),1),a.showMessage("ok","O caso foi restaurado com sucesso.","success",!1)})},h()}]),angular.module("CasesEditModule",["CasesEditControllerModule"]).config(["$stateProvider",function(a){a.state("cases.edit",{url:"/{id:[0-9]{1,4}}",views:{"@":{templateUrl:"routes/cases/edit/cases-edit.template.html",controller:"CasesEditController",controllerAs:"ctrl"}}})}]),angular.module("CasesEditControllerModule",["CaseDirectiveModule"]).controller("CasesEditController",["$scope","Restangular","$modal","$stateParams",function(a,b,c,d){a.id=d.id,a.loading=!0,a.currentTab="steps",a.stepId=null,a.selectConductor=function(){c.open({templateUrl:"views/cases/selectConductor.html",windowClass:"modalConductor"})},a.changeConductor=function(){c.open({templateUrl:"views/cases/changeConductor.html",windowClass:"modalConductor"})}}]),angular.module("CaseDirectiveModule",["CasesServiceModule","CaseStepsDirectiveModule","CaseStepDirectiveModule","CasesSelectConductorModalModule","CasesInactiveModalModule","CasesFinishModalModule","CaseHistoryDirectiveModule"]).directive("case",["CasesService","CasesSelectConductorModalService","CasesInactiveModalService","CasesFinishModalService",function(a,b,c,d){return{restrict:"E",scope:{id:"=",stepId:"="},templateUrl:"routes/cases/edit/components/case/case.template.html",controller:["$scope","$rootScope","$state",function(e,f,g){e.currentTab="steps",e.stepId=e.stepId||null,e.loading=!0,e.user=f.me,e.canExecute=function(a){return!!f.hasPermission("manage_cases")||(a.responsible_group?f.hasPermission("can_execute_step",a.step_id):a.conductor&&e.user.id===a.conductor.id)},e.canManageCase=function(){return f.hasPermission("manage_cases")};var h=function(a){e.loading=!1,e.saveInProgress=!1,e.kase=a,e.stepId?e.step=_.findWhere(a.steps,{id:e.stepId}):e.step=a.current_step,e.canExecute(e.step)?e.step.editable=a.current_step.id==e.step.id&&!e.step.executed:e.step.editable=!1},i=function(){f.showMessage("exclamation-sign","Caso não encontrado","error",!0),g.go("cases.list")};a.fetch(e.id).then(h)["catch"](i),e.selectStep=function(a){a.id?e.step=a:e.step=_.filter(e.kase.next_steps,function(b){return b.flow_step.id==a.flow_step.id})[0]},e.saveStep=function(b){e.saveInProgress=!0;var c={step_id:e.step.step_id,fields:b};a.saveStep(e.kase.id,c).then(function(a){e.saveInProgress=!1,h(a),a.next_steps_ids.length>0?e.changeConductor({nextStep:!0}):e.finishCase(e.kase)})},e.changeConductor=function(a){var c;c=a&&a.nextStep===!0?e.kase.next_steps[0].flow_step:e.step.flow_step,b.open(e.kase,c).then(h)},e.inactiveCase=function(a){c.open(a).then(function(){g.go("cases.list")})},e.finishCase=function(a){d.open(a).then(function(){a.status="Finalizado"})};var j=140;$(".chat-window").height($(document).innerHeight()-j)}]}}]),angular.module("CaseHistoryDirectiveModule",["CasesServiceModule"]).directive("caseHistory",["CasesService",function(a){return{restrict:"E",scope:{id:"="},templateUrl:"routes/cases/edit/components/history/history.template.html",controller:["$scope",function(b){a.fetchHistory(b.id).then(function(a){b.log={},_.each(a.data.cases_log_entries,function(a){var c=moment(a.created_at),d=c.format("DD")+" de "+c.format("MMMM")+" de "+c.format("YYYY");a.hour=c.format("HH")+"h "+c.format("mm")+"min",b.log[d]?b.log[d].push(a):b.log[d]=[a]})})}]}}]),angular.module("CaseStepDirectiveModule",["CaseStepFieldDirectiveModule","InventoriesItemsServiceModule","CasesServiceModule"]).directive("caseStep",function(){return{restrict:"E",scope:{step:"=",editable:"=",saveInProgress:"=",onStepSave:"&",onChangeConductor:"&"},templateUrl:"routes/cases/edit/components/step/step.template.html",controller:["$scope","$rootScope","InventoriesItemsService","CasesService",function(a,b,c,d){a.user=b.me,a.canExecute=function(b){return b.responsible_group?a.canExecuteStepByPermission(b):b.conductor&&a.user.id===b.conductor.id},a.canExecuteStepByPermission=function(a){return b.hasPermission("can_execute_step",a.flow_step.flow_id)||b.hasPermission("flow_can_execute_all_steps",a.flow_step.flow_id)},a.toggleEditable=function(){a.editable=!a.editable},a.$watch("step",function(b){b&&(a.futureStep=!b.id,a.stepFilled=!!b.updated_by)});var e=function(a){return _.map(a,function(a){switch(a.type){case"inventory_item":var b=_.pluck(a.value,"id");return{id:a.id,value:b};case"select":var b=a.value?a.value.value:null;return{id:a.id,value:b};case"checkbox":var c=[];return a.value&&_.each(a.values,function(b,d){a.value[d]&&c.push(b.value)}),{id:a.id,value:c};case"image":case"attachment":if(!a.value)return;return a.value=_.reject(a.value,function(a){return!a.destroy&&!a.content}),_.each(a.value,function(a){a.content&&delete a.url}),{id:a.id,value:a.value};default:return{id:a.id,value:a.value}}})};a.isFormValid=function(){return a.stepForm.$valid&&!_.any(a.step.flow_step.fields,function(a){return a.has_errors})},a.saveStep=function(){a.formSubmitted=!0,a.displayErrors=!0,a.isFormValid()&&(a.displayErrors=!1,a.onStepSave({fields:e(a.step.flow_step.fields)}))},a.changeConductor=function(){a.onChangeConductor()};var f=function(b){return _.select(a.step.flow_step.fields,function(a){return a.inventory_field&&a.field_id==b.id})};a.$on("cases:inventory_items_selected",function(a,b){var e=f(b);if(_.any(e)){var g=b.value[0].id;c.fetchOne(g).then(function(a){var b=a.data.item;_.each(e,function(a){_.each(b.data,function(b){b.field.id==a.origin_field_id&&(a.value=d.denormalizeInventoryFieldValue(a,b.content))})})})}}),a.$on("cases:inventory_items_removed",function(a,b){var c=f(b);_.any(c)&&_.each(c,function(a){delete a.value})})}]}}),angular.module("StepFieldValidatorDirectiveModule",[]).directive("stepFieldValidator",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){a.field.errors={};var e=function(b,c){a.field.errors[b]=c,a.field.has_errors=_.any(_.filter(a.field.errors,function(a){return a}))},f=function(){if(a.field.requirements&&a.field.requirements.presence){var b=_.filter(a.field.value,function(a){return!a.destroy});!a.field.value||b.length<1?e("required",!0):e("required",!1)}},g=function(){a.field.requirements.presence&&!_.any(_.values(a.field.value))?e("required",!0):e("required",!1)},h=function(a){a&&!CPF.isValid(a.replace(/[^\d]/g,""))?e("cpf",!0):e("cpf",!1)},i=function(a){a&&!CNPJ.isValid(a.replace(/[^\d]/g,""))?e("cnpj",!0):e("cnpj",!1)},j=function(a){var b=/(^$)|(^(http|https|ftp|udp):\/\/[a-z0-9]+([\-\.][a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?([\/].*)?$)/i;a&&a.match(b)?e("url",!1):e("url",!0)},k=function(a){var b=/^([^\s]+)((?:[-a-z0-9]\.)[a-z]{2,})$/;a&&a.match(b)?e("email",!1):e("email",!0)},l=function(a){if(!a)return e("date",!1),!0;try{$.datepicker.parseDate("dd/mm/yy",a),e("date",!1)}catch(b){e("date",!0)}},m=function(b){b&&b.length>parseInt(a.field.requirements.maximum,10)?e("maxLength",!0):e("maxLength",!1)},n=function(b){b&&b.length<parseInt(a.field.requirements.minimum,10)?e("minLength",!0):e("minLength",!1)};switch(a.field.type){case"attachment":case"image":case"report_item":case"inventory_item":a.$watch("field.value",f,!0);break;case"checkbox":a.$watch("field.value",g,!0);break;case"cpf":a.$watch("field.value",h,!0);break;case"cnpj":a.$watch("field.value",i,!0);break;case"url":a.$watch("field.value",j,!0);break;case"email":a.$watch("field.value",k,!0);break;case"date":a.$watch("field.value",l,!0)}a.field.requirements&&a.field.requirements.maximum&&a.$watch("field.value",m,!0),a.field.requirements&&a.field.requirements.minimum&&a.$watch("field.value",n,!0)}}}),angular.module("CaseStepFieldDirectiveModule",["StepFieldValidatorDirectiveModule","UploaderDirectiveModule","ReportsSelectModalModule","ItemsSelectModalModule"]).directive("caseStepField",function(){return{restrict:"E",scope:{field:"=",editable:"=",viewMode:"=",stepForm:"=",displayErrors:"="},templateUrl:"routes/cases/edit/components/step-field/step-field.template.html",controller:["$scope","ReportsSelectModalService","ItemsSelectModalService",function(a,b,c){a.field.itemBeingCreated=!1,a.getExtensions=function(a){
var b={image:"png|jpg|gif|jpeg"};return b[a]},a.isInputType=function(b){var c={metric:["meter","centimeter","kilometer","year","month","day","hour","hours","minute","second","angle"],normal_text:["text","url","email"],small_text:["date","time"],number:["decimal","integer"],file:["image","attachment"]};return _.contains(c[b],a.field.type)},a.translateMetric=function(a){var b={meter:"m",centimeter:"cm",kilometer:"km",year:"anos",month:"meses",day:"dias",hour:"horas",hours:"horas",minute:"minutos",second:"segundos",angle:"° (graus)"};return b[a]},a.getMask=function(){switch(a.field.type){case"cpf":return"999.999.999-99";case"cnpj":return"99.999.999/9999-99";case"date":return"99/99/9999";case"time":return"99:99"}},a.invalid=function(){return a.stepForm["field_"+a.field.id].$invalid||a.field.has_errors},a.errorMessage=function(){var b=a.stepForm["field_"+a.field.id];return a.field.has_errors&&_.extend(b.$error,a.field.errors),b.$error.required?"O preenchimento deste campo é obrigatório.":b.$error.cpf?"O CPF é inválido.":b.$error.cnpj?"O CNPJ é inválido.":b.$error.url?"A URL é inválida.":b.$error.email?"O Email é inválido.":b.$error.mask?"O formato está inválido.":b.$error.date?"A data é inválida.":b.$error.maxLength?"O campo não pode possuir mais de "+a.field.requirements.maximum+" caracteres.":b.$error.minLength?"O campo deve possuir mais de "+a.field.requirements.minimum+" caracteres.":void 0},a.addInventories=function(){_.isArray(a.field.value)||(a.field.value=[]),c.open(a.field.value,_.pluck(a.field.category_inventory,"id"),a.field.requirements&&a.field.requirements.multiple).then(function(b){a.field.value=b,a.$emit("cases:inventory_items_selected",a.field)})},a.addReports=function(){_.isArray(a.field.value)||(a.field.value=[]),b.open(a.field.value,_.pluck(a.field.category_report,"id"),a.field.requirements&&a.field.requirements.multiple).then(function(b){a.field.value=b})};var d=a.removeReport=function(b){a.field.value.splice(b,1)};a.removeItem=function(b){d(b),a.$emit("cases:inventory_items_removed",a.field)};var e=function(a){var b=[];return _.each(a.values,function(c,d){a.value[d]&&b.push(c.value)}),b},f=function(a){switch(a.type){case"textarea":a.type="text",a.requirements=_.extend({},a.requirements,{multiline:!0});break;case"centimeters":case"kilometers":case"years":case"hours":case"months":case"days":case"seconds":case"meters":case"images":a.type=a.type.substr(0,a.type.length-1)}};a.getLabelForInventoryChoiceField=function(a){if(a.value)return _.findWhere(a.values,{value:a.value}).label},a.$watch("field",function(b){if(b){switch("inventory_field"==b.type&&(_.extend(a.field,b.inventory_field),f(a.field),a.field.inventory_field=!0),"previous_field"==b.type&&(_.extend(a.field,b.previous_field),a.field.previous_field=!0),"inventory_item"==b.type&&a.field.value&&a.field.value.length>0&&a.$emit("cases:inventory_items_selected",a.field),a.field.type){case"image":case"attachment":a.field.value=a.field.value||[]}"image"!=b.type&&"attachment"!=b.type||_.each(b.value,function(a){a.content&&(a.content=a.content.replace(/^data:[^;]+;base64,/,""))}),"checkbox"==b.type&&b.value&&(b.selected_values=e(b))}},!0)}]}}),angular.module("CaseStepsDirectiveModule",[]).directive("caseSteps",function(){return{restrict:"E",scope:{activeStep:"=",previousSteps:"=",nextSteps:"=",currentStep:"=",onStepSelect:"&"},templateUrl:"routes/cases/edit/components/steps/steps.template.html",controller:["$scope",function(a){a.selectStep=function(b){a.onStepSelect({step:b})}}]}}),angular.module("CaseDirectiveModule").directive("relatedReports",function(){return{restrict:"E",scope:{reports:"="},templateUrl:"routes/cases/edit/components/related-reports/related-reports.template.html",controller:["$scope","$rootScope","$state",function(a,b,c){a.$watchCollection("reports",function(b,c){_.each(a.reports,function(a){var b=a.category;return a.custom_fields_normalized=_.map(a.custom_fields,function(a,c){var d=_.find(b.custom_fields,function(a){return a.id==parseInt(c)});return{title:d.title,value:a}}),a})})}]}}),function(a){"use strict";a.module("BusinessReportsModule",["BusinessReportsIndexModule","BusinessReportsEditModule","BusinessReportsExploreModule"]).config(["$stateProvider",function(a){a.state("business_reports",{url:"/business-reports",templateUrl:"routes/business-reports/business-reports.template.html","abstract":!0,resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}])}(angular),function(a){"use strict";a.module("BusinessReportsIndexModule",["BusinessReportsIndexControllerModule"]).config(["$stateProvider",function(a){a.state("business_reports.list",{url:"",views:{"":{templateUrl:"routes/business-reports/index/business-reports-index.template.html",controller:"BusinessReportsIndexController",controllerAs:"ctrl"}}})}])}(angular),function(a){"use strict";function b(a,b,c){b.info("BusinessReportsIndexController created."),a.$on("$destroy",function(){b.info("BusinessReportsIndexController destroyed.")}),a.loadContent=c.fetchAll}a.module("BusinessReportsIndexControllerModule",["BusinessReportsIndexHeaderDirectiveModule","BusinessReportsIndexListDirectiveModule","BusinessReportsServiceModule"]).controller("BusinessReportsIndexController",b),b.$inject=["$scope","$log","BusinessReportsService"]}(angular),function(a){"use strict";a.module("BusinessReportsIndexHeaderDirectiveModule",[]).directive("businessReportsIndexHeader",function(){return{restrict:"E",scope:{showAddNewButton:"="},templateUrl:"routes/business-reports/index/components/header/business-reports-index-header.template.html"}})}(angular),function(a,b){"use strict";function c(){return{restrict:"E",scope:{loadContent:"&",showEditButton:"=",showRemoveButton:"="},templateUrl:"routes/business-reports/index/components/list/business-reports-index-list.template.html",controller:d}}function d(a,b,c,d,e,f,g){c.info("businessReportsIndexListController created."),a.$on("$destroy",function(){c.info("businessReportsIndexListController destroyed.")}),a.loadContent().then(function(b){a.reports=b,a.contentLoaded=!0},function(){a.errorLoadingContent=!0});var h=function(b){a.reports.splice(a.reports.indexOf(b),1)};a.deleteReport=function(a){g.open(a).then(h)},a.reloadApplication=function(){b.location.reload(!0)},a.openBusinessReport=function(a,b){f.loading||"a"==b.target.parentNode.tagName.toLowerCase()||"a"==b.target.tagName.toLowerCase()||d.go("business_reports.show",{reportId:a})},a.duplicateReport=function(a){f.loading||(f.loading=!0,e.find(a.id).then(function(a){delete a.id,a.title+=" - cópia",a.duplicating=!0,e.save(a).then(function(){f.showMessage("ok","Relato duplicado com sucesso!","success",!0),f.loading=!1,d.transitionTo(d.current,{},{reload:!0,inherit:!1,notify:!0})})}))}}a.module("BusinessReportsIndexListDirectiveModule",["BusinessReportsDestroyModalModule","BusinessReportsServiceModule"]).directive("businessReportsIndexList",c),c.$inject=[],d.$inject=["$scope","$window","$log","$state","BusinessReportsService","$rootScope","BusinessReportDestroyModalService"]}(angular,_),angular.module("BusinessReportsEditModule",["BusinessReportsEditControllerModule","BusinessReportsServiceModule"]).config(["$stateProvider",function(a){a.state("business_reports.edit",{url:"/{reportId:[0-9]{1,9}}/edit",views:{"":{templateUrl:"routes/business-reports/edit/business-reports-edit.template.html",controller:"BusinessReportsEditController"}},resolve:{editable:["$q",function(a){var b=a.defer();return b.resolve(!0),b.promise}]}}),a.state("business_reports.show",{url:"/{reportId:[0-9]{1,9}}/show",views:{"":{templateUrl:"routes/business-reports/edit/business-reports-edit.template.html",controller:"BusinessReportsEditController"}},resolve:{editable:["$q",function(a){var b=a.defer();return b.resolve(!1),b.promise}]}}),a.state("business_reports.add",{url:"/add",views:{"":{templateUrl:"routes/business-reports/edit/business-reports-edit.template.html",controller:"BusinessReportsEditController"}},resolve:{editable:["$q",function(a){var b=a.defer();return b.resolve(!0),b.promise}]}})}]),function(a,b){"use strict";function c(b,c,d,e,f,g,h){function i(){c.valid=c.reportLoaded&&g.isValid(c.report)}function j(){c.savePromise=g.save(a.copy(c.report)),c.savePromise.then(function(a){c.report=a,c.showMessage("ok","O Relatório "+c.report.title+" foi salvo com sucesso","success",!0),b.go("business_reports.show",{reportId:c.report.id})},function(){c.showMessage("exclamation-sign"," Não foi possível salvar o relatório "+c.report.title+". Por favor, tente novamente em alguns minutos.","error",!0)})}function k(){g.clearViews(),d.reportId?g.find(d.reportId).then(function(a){c.report=a,c.reportLoaded=!0},function(){c.showMessage("exclamation-sign"," Não foi possível carregar o relatório requisitado. Por favor, tente novamente em alguns minutos.","error",!0),b.go("business_reports.list")}):(c.report={charts:[]},c.reportLoaded=!0),f.MasonryHack={position:"relative"}}c.reportLoaded=!1,c.editable=h,c.saveBusinessReport=j,c.$watch("report.title",i),c.$watch("report.summary",i),c.$watch("report.charts",i,!0),e(k,500)}a.module("BusinessReportsEditControllerModule",["BusinessReportsEditHeaderDirectiveModule","BusinessReportsEditFormDirectiveModule","BusinessReportsEditChartsDirectiveModule","BusinessReportsServiceModule","AngularPrint"]).controller("BusinessReportsEditController",c),c.$inject=["$state","$scope","$stateParams","$timeout","$window","BusinessReportsService","editable"]}(angular,_),function(a){"use strict";function b(){return{restrict:"E",scope:{report:"=",savePromise:"=",showPrintButton:"=",showEditButton:"=",showSaveButton:"=",enableSaveButton:"=",saveButtonClicked:"&",xlsButtonClicked:"&"},templateUrl:"routes/business-reports/edit/components/header/business-reports-edit-header.template.html"}}a.module("BusinessReportsEditHeaderDirectiveModule",[]).directive("businessReportsEditHeader",b)}(angular),function(a){"use strict";function b(){return{restrict:"E",scope:{editable:"=",report:"=",valid:"="},templateUrl:"routes/business-reports/edit/components/form/business-reports-edit-form.template.html",controller:c}}function c(a,b){}a.module("BusinessReportsEditFormDirectiveModule",["angularInlineEdit"]).directive("businessReportsEditForm",b),b.$inject=[],c.$inject=["$scope","$log"]}(angular),function(a,b,c){"use strict";function d(){return{restrict:"E",scope:{editable:"=",onChartUpdate:"&",onChartDelete:"&",index:"=",chart:"="},templateUrl:"routes/business-reports/edit/components/chart/business-reports-edit-chart.template.html",controllerAs:"chartCtrl",controller:e}}function e(b,d,e,f){function g(){return!!b.studioViewsService.views[b.index]}function h(){return!!b.editable}function i(){return b.studioViewsService.views[b.index]}function j(){b.studioViewsService.closeView(i()),b.onChartDelete(b.index)}function k(){return f.isConnected()?void(b.chart.params&&b.studioViewsService.addViewObject(b.chart.params,b.index)):e(k,500)}d("CubesViewerStudioController",{$scope:b,$element:void 0}),b.size=c.size,b.isCubeSelected=g,b.isEditable=h,b.getView=i,b.removeView=j,b.onChartTemplateLoaded=function(){a(".cv-views-container").masonry({itemSelector:".cv-view-container",columnWidth:".cv-views-gridsizer",percentPosition:!0,containerStyle:{position:"relative"}})};var l=function(){b.onChartUpdate(b.index)};b.$on("ViewRefresh",l),b.$on("ViewModeChanged",l),k()}b.module("BusinessReportsEditChartDirectiveModule",["googlechart","BusinessReportsEditChartModalModule"]).directive("businessReportsChart",d),d.$inject=[],e.$inject=["$scope","$controller","$timeout","cubesService"]}($,angular,_),function(a){"use strict";function b(){return{restrict:"E",scope:{charts:"=",valid:"=",editable:"="},templateUrl:"routes/business-reports/edit/components/charts/business-reports-edit-charts.template.html",controller:c}}function c(a,b){function c(){var b={index:h++};a.charts[b.index]=b}function d(b){var c=_.findWhere(a.charts,{index:b});return c.updated>0?c.updated++:void(c.updated=1)}function e(b){a.charts[b].deleted=!0}function f(a){return!a.deleted}function g(){a.charts.length<1&&a.addChart(),_.each(a.charts,function(a){!_.isUndefined(a)&&a.index>h&&(h=a.index)}),h+=1}b.info("businessReportsChartsController created."),a.$on("$destroy",function(){b.info("businessReportsChartsController destroyed.")}),a.addChart=c,a.updatedChart=d,a.deleteChart=e,a.isActive=f;var h=0;g()}a.module("BusinessReportsEditChartsDirectiveModule",["BusinessReportsEditChartDirectiveModule"]).directive("businessReportsCharts",b),b.$inject=[],c.$inject=["$scope","$log"]}(angular),function(a){"use strict";a.module("BusinessReportsExploreModule",["BusinessReportsExploreControllerModule"]).config(["$stateProvider",function(a){a.state("business_reports.explore",{url:"/explore",views:{"":{templateUrl:"routes/business-reports/explore/business-reports-explore.template.html",controller:"BusinessReportsExploreController",controllerAs:"ctrl"}}})}])}(angular),function(a,b){"use strict";function c(b,c){b.compact=_.compact,a(".cv-views-container").masonry({itemSelector:".cv-view-container",columnWidth:".cv-views-gridsizer",percentPosition:!0}),c.MasonryHack={position:"absolute"}}b.module("BusinessReportsExploreControllerModule",["BusinessReportsExploreHeaderDirectiveModule","cv.studio"]).controller("BusinessReportsExploreController",c),c.$inject=["$scope","$window"]}($,angular),function(a){"use strict";function b(){return{restrict:"E",scope:{},templateUrl:"routes/business-reports/explore/components/header/business-reports-explore-header.template.html"}}a.module("BusinessReportsExploreHeaderDirectiveModule",[]).directive("businessReportsExploreHeader",b),b.$inject=[]}(angular),angular.module("ServicesModule",["ServicesIndexModule","ServicesEditModule","ServicesShowModule","ServicesPermissionsModule","GroupsEditModule"]).config(["$stateProvider",function(a){a.state("services",{"abstract":!0,url:"/services",templateUrl:"routes/services/services.template.html",resolve:{User:["User",function(a){return a({permissions:["isLogged"]})}]}})}]),angular.module("ServicesIndexModule",["ServicesIndexControllerModule"]).config(["$stateProvider",function(a){a.state("services.list",{url:"",resolve:{Authorize:["Authorization","User",function(a,b){return a.authorize(["manage_services"],null,!0)}]},views:{"":{templateUrl:"routes/services/index/services-index.template.html",controller:"ServicesIndexController",controllerAs:"ctrl"}}})}]),angular.module("ServicesIndexControllerModule",["KeyboardPosterComponentModule","GenericInputComponentModule","ServicesDisableModalControllerModule"]).controller("ServicesIndexController",["$scope","$q","$stateParams","Restangular","ServicesDisableModalService",function(a,b,c,d,e){a.loading=!0,a.loadingPagination=!1;var f,g=1,h=30,i="";a.sort={column:"name",descending:!0},a.changeSorting=function(b){var c=a.sort;c.column===b?c.descending=!c.descending:(c.column=b,c.descending=!1),l()},a.selectedCls=function(b){return b===a.sort.column&&"sort-"+a.sort.descending};var j=function(){var b={page:g,per_page:h,disabled:!0,return_fields:"id,name,disabled,email,token",sort:a.sort};return 0!==i.length&&(b.name=i),d.all("services").getList(b)},k=a.getData=function(b){if(a.loadingPagination===!1){a.loadingPagination=!0;var c=j();return c.then(function(c){if(b!==!0)a.services=c.data;else{"undefined"==typeof a.services&&(a.services=[]);for(var d=0;d<c.data.length;d++)a.services.push(c.data[d]);g++}f=parseInt(c.headers().total);var e=Math.ceil(f/h);g===e+1?a.loadingPagination=null:a.loadingPagination=!1,a.loading=!1}),c}},l=function(){g=1,a.loadingPagination=!1,a.loadingSearch=!0,a.services=[],k(!1).then(function(){a.loadingSearch=!1,g++})};a.search=function(a){i=a,l()},a.disableService=function(a){e.open(a)},a.enableService=function(b){b.loading=!0;var c=d.one("services",b.id).customPUT({},"enable");c.then(function(){b.disabled=!1,b.loading=!1,a.showMessage("ok","A aplicação "+b.name+" foi ativada com sucesso.","success",!1)})}}]),angular.module("ServicesEditModule",["ServicesEditControllerModule"]).config(["$stateProvider",function(a){a.state("services.show.edit",{url:"/edit",resolve:{Authorize:["Authorization","User",function(a,b){return a.authorize(["manage_services"],null,!0)}]},views:{"@services":{templateUrl:"routes/services/edit/services-edit.template.html",controller:"ServicesEditController",controllerAs:"ctrl"}}}).state("services.add",{url:"/add",views:{"":{templateUrl:"routes/services/edit/services-edit.template.html",controller:"ServicesEditController",controllerAs:"ctrl",resolve:{Authorize:["Authorization","User",function(a,b){return a.authorize(["manage_services"],null,!0)}]}}}})}]),angular.module("ServicesEditControllerModule",["EqualsComponentModule","ServicesServiceModule"]).controller("ServicesEditController",["$scope","$rootScope","$stateParams","$location","ServicesService",function(a,b,c,d,e){var f=a.updating=!1,g=c.id;a.service={},a.isObject=angular.isObject,"undefined"!=typeof g&&(f=!0,a.updating=!0),a.loading=!0,f&&e.fetch(g).then(function(b){a.service=b,a.loading=!1}),a.send=function(){a.inputErrors=null,a.processingForm=!0,b.resolvingRequest=!0;var c=angular.copy(a.service);if(f){var g=e.update(c,{});g.then(function(){a.showMessage("ok","A aplicação foi atualizada com sucesso","success",!0),a.processingForm=!1,b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","A aplicação não pode ser salva","error",!0),a.inputErrors=c,a.processingForm=!1,b.resolvingRequest=!1})}else{var h=e.create(c,{return_fields:"id"});h.then(function(){a.showMessage("ok","A aplicação foi criada com sucesso","success",!0),d.path("/services"),a.processingForm=!1,b.resolvingRequest=!1},function(c){a.showMessage("exclamation-sign","A aplicação não pode ser criada","error",!0),a.inputErrors=c,a.processingForm=!1,b.resolvingRequest=!1})}}}]),angular.module("ServicesShowModule",["ServicesShowControllerModule"]).config(["$stateProvider",function(a){a.state("services.show",{url:"/{id:[0-9]*}",resolve:{Authorize:["Authorization","User",function(a,b){return a.authorize(["manage_services"],null,!0)}],Resource:["Restangular","$stateParams",function(a,b){return a.one("services",b.id).withHttpConfig({treatingErrors:!0}).get().then(function(a){return a.data})}]},views:{"":{templateUrl:"routes/services/show/services-show.template.html",controller:"ServicesShowController",controllerAs:"ctrl"}}})}]),angular.module("ServicesShowControllerModule",[]).controller("ServicesShowController",["$scope","Resource","$modal",function(a,b,c){a.service=b,a.disableService=function(a){c.open({templateUrl:"modals/users/disable/services-disable.template.html",windowClass:"removeModal",resolve:{service:function(){return a}},controller:"ServicesDisableModalController"})}}]),angular.module("ServicesPermissionsModule",["GroupsEditControllerModule"]).config(["$stateProvider",function(a){a.state("services.show.permissions",{url:"/permissions",resolve:{Authorize:["Authorization","User",function(a,b){return a.authorize(["manage_services"],null,!0)}]},views:{"@services":{templateUrl:"routes/groups/edit/groups-edit.template.html",controller:"GroupsEditController",controllerAs:"ctrl",resolve:{permissionsResponse:["FullResponseRestangular","$stateParams",function(a,b){return a.all("permissions").one("services",b.id).customGET()}],objectsResponse:["FullResponseRestangular",function(a){return a.one("utils").all("available_objects").customGET()}]}}}})}]),angular.module("CustomFieldsEditorDirectiveModule",[]).directive("customFieldsEditor",function(){return{restrict:"E",scope:{categoryId:"=",fields:"=",onFieldsUpdate:"&"},templateUrl:"routes/reports/categories/edit/components/custom-fields-editor/custom-fields-editor.template.html",controller:["$scope","$element","FullResponseRestangular",function(a,b,c){var d=function(){return{title:"",multiline:!1}};a.newField=d(),a.localFields=angular.copy(a.fields);var e=function(){return c.one("reports").one("categories",a.categoryId).customPUT({custom_fields:a.fields,display_type:"full",return_fields:"custom_fields"})};a.save=function(b){var c;b.id?(c=_.findWhere(a.fields,{id:b.id}),c?_.extend(c,b):a.fields.push(angular.copy(b))):a.fields.splice(a.localFields.indexOf(b),0,b),a.fieldPromise=e().then(function(c){b.editing=!1,a.fields=c.data.category.custom_fields,a.localFields=_.map(a.fields,function(b){var c=_.findWhere(a.localFields,{id:b.id});return c?_.extend(c,b):angular.copy(b)})})},a.create=function(b){a.localFields.push(b),a.newField=d(),a.save(b)},a.cancel=function(b){b=a.localFields[a.localFields.indexOf(b)]=b.original,b.editing=!1},a.edit=function(a){a.original=angular.copy(a),a.editing=!0},a.remove=function(b){if(a.localFields.splice(a.localFields.indexOf(b),1),b.id){var c=_.findWhere(a.fields,{id:b.id});c._destroy=!0,e()}},a.customFieldsAutocomplete={options:{position:{my:"left top",at:"left bottom",of:b.find("#fieldAutocomplete")},onlySelect:!0,source:function(b,d){var e=c.all("reports/custom_fields").customGET(null,{title:b.term});e.then(function(b){var c=_.reject(b.data.custom_fields,function(b){return _.findWhere(a.localFields,{id:b.id})});d(_.map(c,function(a){return{label:a.title,value:a.title,field:a}}))})},messages:{noResults:"",results:angular.noop}}},a.customFieldsAutocomplete.events={select:function(b,c){a.create(c.item.field),a.$apply()}}}]}}),angular.module("GroupsSelectorInlineModule",[]).directive("groupsSelectorInline",["Restangular",function(a){return{restrict:"E",scope:{groups:"=",permittedGroups:"=",multiple:"=",ignoreNamespaces:"="},templateUrl:"components/groups-selector-inline/groups-selector-inline.template.html",controllerAs:"groupsSelectorCtrl",controller:["$scope","$element",function(b,c){"undefined"===b.ignoreNamespaces&&(b.ignoreNamespaces=!0),b.groupsAutocomplete={options:{position:{my:"left top",at:"left bottom",of:c.find(".groups-autocomplete")},onlySelect:!0,source:function(c,d){var e={name:c.term,return_fields:"id,name,namespace",like:!0,ignore_namespaces:b.ignoreNamespaces};_.isArray(b.permittedGroups)&&b.permittedGroups.length>0&&(e.groups=_.pluck(b.permittedGroups,"id").join(","));var f=a.all("search/groups").getList(e);f.then(function(a){d($.map(a.data,function(a){return{label:a.name+" ("+a.namespace.name+")",value:a.name,group:{id:a.id,name:a.name,namespace:{name:a.namespace.name}}}}))})},messages:{noResults:"",results:angular.noop}}},b.groupsAutocomplete.events={select:function(a,c){b.multiple&&!_.findWhere(b.groups,{id:c.item.group.id})?b.groups.push(c.item.group):b.groups[0]=c.item.group},change:function(){b.group=""}},b.removeGroup=function(a){b.groups.splice(b.groups.indexOf(a),1)}}]}}]),angular.module("UsersSelectorInlineModule",[]).directive("usersSelectorInline",["Restangular",function(a){return{restrict:"E",scope:{users:"=",permittedGroups:"=",multiple:"="},templateUrl:"components/users-selector-inline/users-selector-inline.template.html",controllerAs:"usersSelectorCtrl",controller:["$scope","$element",function(b,c){b.usersAutocomplete={options:{position:{my:"left top",at:"left bottom",of:c.find(".users-autocomplete")},onlySelect:!0,source:function(c,d){var e={name:c.term,return_fields:"id,name",like:!0};_.isArray(b.permittedGroups)&&b.permittedGroups.length>0&&(e.groups=_.pluck(b.permittedGroups,"id").join(","));var f=a.all("search/users").getList(e);f.then(function(a){d($.map(a.data,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:angular.noop}}},b.usersAutocomplete.events={select:function(a,c){b.multiple&&!_.findWhere(b.users,{id:c.item.user.id})?b.users.push(c.item.user):b.users[0]=c.item.user},change:function(){b.user=""}},b.removeUser=function(a){b.users.splice(b.users.indexOf(a),1)}}]}}]),angular.module("NamespaceSelectorModule",["AuthServiceModule","NamespacesServiceModule"]).directive("namespaceSelector",["Auth","NamespacesService","NamespacesSelectorModalService",function(a,b,c){return{restrict:"E",templateUrl:"components/namespace-selector/namespace-selector.template.html",controller:["$scope",function(a){a.modalOpen=!1,a.openNamespaceSelector=function(){a.modalOpen=!0,c.open()}}]}}]).controller("NamespacesSelectorController",["$scope","Auth","$modalInstance","NamespacesService","$state",function(a,b,c,d,e){a.close=function(){c.dismiss()},d.fetchAll().then(function(b){a.namespaces=b,a.dataLoaded=!0}),a.selectNamespace=function(c){b.setCurrentNamespace(c),a.close();var d=e.href(e.current.name,e.params),f=d.match(/([^\d]+)/)[1];window.location.pathname||"/"==f[0]||(f="/"+f),"/"==f[f.length-1]&&(f=f.substr(0,f.length-1)),window.location=window.location.pathname+f,e.transitionTo(e.current,e.params,{reload:!0,inherit:!1,notify:!0})},a.modalOpen=!0,a.dataLoaded=!1}]).factory("NamespacesSelectorModalService",["$modal",function(a){return{open:function(){return a.open({templateUrl:"components/namespace-selector/namespace-selector-modal.template.html",windowClass:"namespacesListModal",controller:"NamespacesSelectorController"})}}}]),angular.module("EqualsComponentModule",[]).directive("equals",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){a.$watch(c.ngModel,function(){e()}),c.$observe("equals",function(a){e()});var e=function(){var a=d.$viewValue,b=c.equals;"undefined"!=typeof a&&"undefined"!=typeof b&&d.$setValidity("equals",a===b)}}}}}),angular.module("NextFieldOnEnterComponentModule",[]).directive("nextFieldOnEnter",function(){return function(a,b,c){var d=b.find("input");if(c.nextFieldOnEnter)var e=a.$eval(c.nextFieldOnEnter);_.each(d,function(b){angular.element(b).bind("keydown keypress",function(c){13===c.which&&(a.$apply(function(){var a,c=d.index(b)+1;(a=d.get(c))?(a.focus(),e&&e(b,a)):e(b,null)}),c.preventDefault())})})}}),angular.module("NavItemComponentModule",[]).directive("navItem",["$location",function(a){return{restrict:"A",link:function(b,c){var d=c.find("a")[0].getAttribute("ng-href");b.location=a,b.$watch("location.absUrl()",function(a){a.indexOf(d)!==-1?c.addClass("active"):c.removeClass("active")})}}}]),angular.module("MapComponentModule",["GoogleMapServiceModule","ReportsItemsServiceModule","InventoriesItemsServiceModule"]).directive("map",["$rootScope","GoogleMapService","ReportsItemsService","InventoriesItemsService","ENV",function(a,b,c,d,e){return{restrict:"A",scope:{getCategory:"&",getData:"&",getFiltersOptions:"&",filterSelectedAreas:"="},link:function(f,g,h){var i="reports"===h.mapCategory,j=new b(i,parseFloat(e.mapLat),parseFloat(e.mapLng),parseInt(e.mapZoom,10),g[0]),k=i?c.fetchClustered:d.fetchClustered,l=null,m=function(){var b=j.getCenter(),e={zoom:j.getZoom(),clusterize:!0},g=f.getFiltersOptions()||{},h={latitude:b.lat(),longitude:b.lng(),distance:j.getDistance()};a.mapDebug=_.extend({zoom:e.zoom},h),_.isUndefined(g["position[0][latitude]"])&&(e["position[latitude]"]=h.latitude,e["position[longitude]"]=h.longitude,e["position[distance]"]=h.distance),e=_.extend(e,g),l=e,i?c.resetCache():d.resetCache(),k(e).then(function(a){if(l===e){var b=a.clusters,c=i?a.reports:a.items;j.processMarkers(b,c),j.hasOwnProperty("processMarkersCanvas")&&j.processMarkersCanvas(b,c)}})},n=null,o=null,p=function(){n&&clearTimeout(n),n=setTimeout(function(){m()},300),o&&clearTimeout(o),o=setTimeout(function(){j.hideOutOfBoundsMarkers()},100)},q=j.getZoom();google.maps.event.addListener(j.getMap(),"bounds_changed",function(){q!==j.getZoom()&&(j.changeFilterOuterCircles(),q=j.getZoom()),p()});var r=google.maps.event.addListener(j.getMap(),"dragend",function(){j.overlay&&j.overlay.hasOwnProperty("draw")&&j.overlay.draw()});f.$on("mapRefreshRequested",function(){p(),f.$watch("filterSelectedAreas",function(){j.processAreaFilters(f.filterSelectedAreas)})});var s=f.$on("$destroy",function(){r&&(google.maps.event.removeListener(r),r=null),s(),s=null})}}}]),angular.module("PeriodSelectorModule",[]).controller("PeriodSelectorController",["$scope","$modalInstance","promise","openEnded",function(a,b,c,d){a.openEnded=d,a.period={beginDate:new Date,endDate:new Date,tab:"between"},a.save=function(){var d=!1,e=!1;"between"!==a.period.tab&&"from"!==a.period.tab||(d=!0,a.period.beginDate=moment(a.period.beginDate).startOf("day").toDate()),"between"!==a.period.tab&&"to"!==a.period.tab||(e=!0,a.period.endDate=moment(a.period.endDate).startOf("day").toDate()),d&&e?c.resolve(a.period):d?c.resolve({beginDate:a.period.beginDate}):e&&c.resolve({endDate:a.period.endDate}),b.close()},a.validRange=function(){return!(!d||"between"==a.period.tab)||a.period.beginDate<=a.period.endDate},a.close=function(){c.reject(),b.close()}}]).factory("PeriodSelectorService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"components/period-selector/period-selector.template.html",windowClass:"periodSelectorModal",resolve:{promise:function(){return d},openEnded:function(){return c}},controller:"PeriodSelectorController"}),d.promise}}}]),angular.module("GroupSelectorModule",[]).controller("GroupSelectorController",["$scope","$modalInstance","selectedGroups","multiple","promise","Restangular",function(a,b,c,d,e,f){a.selectedGroups=angular.copy(c),a.multiple=d,a.loading=!0,f.all("groups").getList({return_fields:"id,name"}).then(function(b){a.loading=!1,a.groups=f.stripRestangular(b.data)}),a.isActive=function(b){return _.findWhere(a.selectedGroups,{id:b.id})},a.toggle=function(b){var c=_.findWhere(a.selectedGroups,{id:b.id});d?c?a.selectedGroups.splice(c,1):a.selectedGroups.push(b):a.selectedGroups=[c]},a.confirm=function(){e.resolve(a.selectedGroups),b.close()},a.close=function(){e.reject(),b.close()}}]).factory("GroupSelectorService",["$modal","$q",function(a,b){return{open:function(c,d){var e=b.defer();return a.open({templateUrl:"components/group-selector/group-selector.template.html",windowClass:"groupSelectorModal",resolve:{promise:function(){return e},selectedGroups:function(){return c},multiple:function(){return d}},controller:"GroupSelectorController"}),e.promise}}}]),function(a,b,c){"use strict";b.module("angularInlineEdit.providers",[]).value("InlineEditConfig",{btnEdit:"Edit",btnSave:"",btnCancel:"",editOnClick:!1,onBlur:null}).constant("InlineEditConstants",{CANCEL:"cancel",SAVE:"save"})}(window,window.angular),function(a,b,c){"use strict";b.module("angularInlineEdit.controllers",[]).controller("InlineEditController",["$scope","$document","$timeout",function(a,b,c){a.placeholder="",a.validationError=!1,a.validating=!1,a.isOnBlurBehaviorValid=!1,a.cancelOnBlur=!1,a.editMode=!1,a.inputValue="";var d;a.editText=function(e){a.editMode=!0,a.inputValue="string"==typeof e?e:a.model,d&&c.cancel(d),d=c(function(){a.editInput[0].focus(),a.isOnBlurBehaviorValid&&b.bind("click",a.onDocumentClick)},0)},a.applyText=function(d,e){function f(){a.model=i,a.callback({newValue:i}),a.editMode=!1}function g(){a.validationError=!0,j&&c.cancel(j),j=c(function(){a.editText(i)},0)}function h(b){a.validating=!1,b&&e&&a.$apply()}var i=a.inputValue;a.validationError=!1;var j;if(d||a.model===i)a.editMode=!1,e&&a.$apply();else{a.validating=!0,e&&a.$apply();var k=a.validate({newValue:a.inputValue});k&&k.then?k.then(f)["catch"](g)["finally"](h):k||"undefined"==typeof k?(f(),h(!0)):(g(),h(!0))}a.isOnBlurBehaviorValid&&b.unbind("click",a.onDocumentClick)},a.onInputKeyup=function(b){if(!a.validating)switch(b.keyCode){case 13:a.applyText(!1,!1);break;case 27:a.applyText(!0,!1)}},a.onDocumentClick=function(b){a.validating||b.target!==a.editInput[0]&&a.applyText(a.cancelOnBlur,!0)},a.$on("$destroy",function(){a.isOnBlurBehaviorValid&&b.unbind("click",a.onDocumentClick)})}])}(window,window.angular),function(a,b,c){"use strict";b.module("angularInlineEdit.directives",["angularInlineEdit.providers","angularInlineEdit.controllers"]).directive("inlineEdit",["$compile","InlineEditConfig","InlineEditConstants",function(a,c,d){return{restrict:"A",controller:"InlineEditController",scope:{model:"=inlineEdit",callback:"&inlineEditCallback",validate:"&inlineEditValidation"},link:function(e,f,g){e.model=e.$parent.$eval(g.inlineEdit);var h=g.hasOwnProperty("inlineEditOnBlur")?g.inlineEditOnBlur:c.onBlur;
h!==d.CANCEL&&h!==d.SAVE||(e.isOnBlurBehaviorValid=!0,e.cancelOnBlur=h===d.CANCEL);var i=b.element("<div class=\"ng-inline-edit\" ng-class=\"{'ng-inline-edit--validating': validating, 'ng-inline-edit--error': validationError}\">"),j=b.element('<input type="text" class="ng-inline-edit__input" ng-disabled="validating" ng-show="editMode" ng-keyup="onInputKeyup($event)" ng-model="inputValue" placeholder="{{placeholder}}" />'),k=b.element('<div class="ng-inline-edit__inner-container"></div>');k.append(b.element('<span class="ng-inline-edit__text" ng-class="{\'ng-inline-edit__text--placeholder\': !model}" '+(g.hasOwnProperty("inlineEditOnClick")||c.editOnClick?'ng-click="editText()" ':"")+'ng-if="!editMode">{{model || placeholder}}</span>'));var l=g.hasOwnProperty("inlineEditBtnEdit")?g.inlineEditBtnEdit:c.btnEdit;l&&k.append(b.element('<a class="ng-inline-edit__button ng-inline-edit__button--edit" ng-if="!editMode" ng-click="editText()">'+l+"</a>"));var m=g.hasOwnProperty("inlineEditBtnSave")?g.inlineEditBtnSave:c.btnSave;m&&k.append(b.element('<a class="ng-inline-edit__button ng-inline-edit__button--save" ng-if="editMode && !validating" ng-click="applyText(false, false)">'+m+"</a>"));var n=g.hasOwnProperty("inlineEditBtnCancel")?g.inlineEditBtnCancel:c.btnCancel;n&&k.append(b.element('<a class="ng-inline-edit__button ng-inline-edit__button--cancel" ng-if="editMode && !validating" ng-click="applyText(true, false)">'+n+"</a>")),i.append(j).append(k),f.append(i),e.editInput=j,g.$observe("inlineEdit",function(b){e.model=e.$parent.$eval(b),a(f.contents())(e)}),g.$observe("inlineEditPlaceholder",function(a){e.placeholder=a})}}}])}(window,window.angular),function(a,b,c){"use strict";b.module("angularInlineEdit",["angularInlineEdit.providers","angularInlineEdit.controllers","angularInlineEdit.directives"])}(window,window.angular),angular.module("StyleMapComponentModule",[]).directive("styleMap",["$window",function(a){return{restrict:"A",priority:0,link:function(b,c){var d=function(){c.find(".mapItems").css({"margin-top":c.find(".advancedSearch").height()})},e=function(){var b=$(a).height()-60-71-56-c.find(".advancedSearch").height()-2;c.find(".mapItems").height(b)};d(),e(),$(a).resize(function(){e()}),b.$watch("activeAdvancedFilters",function(){d(),e()},!0)}}}]),angular.module("StyleResultsTableComponentModule",[]).directive("styleResultsTable",["$timeout",function(a){var b=null;return{restrict:"A",priority:0,link:function(c,d){var e=function(){d.find(".custom_table").css({"margin-top":d.find(".advancedSearch").height()})};e(),c.$watch("activeAdvancedFilters",function(){b&&a.cancel(b),b=a(function(){e()},0)},!0)}}}]),angular.module("OnBlurComponentModule",[]).directive("onBlur",function(){return{restrict:"A",link:function(a,b,c){b.bind("blur",function(){"undefined"!=typeof c.onBlurDelay?setTimeout(function(){a.$apply(c.onBlur)},c.onBlurDelay):a.$apply(c.onBlur)})}}}),angular.module("OnFocusComponentModule",[]).directive("onFocus",function(){return{restrict:"A",link:function(a,b,c){b.bind("focus",function(){a.$apply(c.onFocus)})}}}),function(a){"use strict";function b(){return{restrict:"A",link:function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.onEnter)}),b.preventDefault())})}}}a.module("OnEnterComponentModule",[]).directive("onEnter",b)}(angular),angular.module("FocusOnEventComponentModule",[]).directive("focusOnEvent",function(){return{restrict:"A",link:function(a,b,c){a.$on(c.focusOnEvent,function(){b.focus()})}}}),angular.module("FocusIfComponentModule",[]).directive("focusIf",["$timeout","$parse",function(a,b){var c;return{link:function(d,e,f){var g=b(f.focusIf);g.literal===!0&&(c&&a.cancel(c),c=a(function(){e[0].focus()},400))}}}]),angular.module("AddAreaCircleFormComponentModule",[]).directive("addAreaCircleForm",function(){return{restrict:"A",link:function(a,b){var c={types:["geocode"],componentRestrictions:{country:"br"}},d=new google.maps.places.Autocomplete(b.find(".address")[0],c);d.bindTo("bounds",a.map),google.maps.event.addListener(d,"place_changed",function(){var a=d.getPlace();a.geometry&&(b.find(".lat").val(a.geometry.location.lat()),b.find(".lng").val(a.geometry.location.lng()))}),a.addCircle=function(){var c=b.find(".lat"),d=b.find(".lng"),e=!1;c.removeClass("form-error"),d.removeClass("form-error"),""===c.val()&&(c.addClass("form-error"),e=!0),""===d.val()&&(d.addClass("form-error"),e=!0),e||a.addCircleByLatLng(c.val(),d.val())}}}}),angular.module("AreaMapComponentModule",[]).directive("areaMap",["ENV",function(a){return{restrict:"A",link:function(b,c){var d={options:{homeLatlng:new google.maps.LatLng(a.mapLat,a.mapLng),map:{zoom:parseInt(a.mapZoom),mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}},map:null,circles:[],lastListenerDistance:null,lastListenerPosition:null,DistanceWidget:function(a,b){this.set("map",a),this.set("position",b);var c=new google.maps.Marker({draggable:!0,title:"Me mova!",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA0CAYAAADBjcvWAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAG2YAABzjgAA+YsAAIR4AAB8wwAA95IAAC/yAAARoZE2jZ4AAAzVSURBVHjaxFprbGXXVf7WPq/7cG1fv+5NJ74eexIzGZgJaUd9qg+ESqREpa3oj6pIqOIPRVQgBD+CQEjwo6qEkChCQkgEqrbqQ6oaNVIpRWpaCKlSmsbDlITJTCYZxx3PMzPj6/s8Z++9+HH2vnd7+1zbk7jCoz3n+Fzfc86311rfWuvbm5gZh/RDY87dHx5zfug/4SGAIe/cv+YC8QcKjv9vwHwgwhnkHKnAWgxAO0ft/H6olgzfoIVcMIEZwjmKMcBcMMoM7Rz1YQEM7xIQOQBC5xg6vwcFVmMPmDRgpDOUM960e4Z3aSX74pEzYnN0AfpWY89SEkA2ZtAebnpowMhzudAAiQEk3jG6S2CpATIw5wPzDAtQFpDOoQBzySA0L544o2SGD8yNv6IY8y02MCMC0Dfn9tnWRe867sJ93M+1kgum7JzHAOKf3OzO/ufm1vKPbvZOXe7rpS2pZzPmEgDEgtKJQNxuJLTxtpnST3/lyPT5dy1UbxhgsTcxRTGq7hYYFSRo1/1sDFkQFTMssHgrlZUvv3TjxJObnV+90stWe4qnJFMpfy0a5QcGAuK0LMTWXCm89Gv10g8+9Qvza41KvG1csQ+gZ0bXHK0FpcOc/EaA+ZaybmcBVQ2oMoDkb89cfuhrr7U+ttFXp4gIRGJnkiMazrl9DAPQ5pd6TK98+J7KE396evGZgKjvgOsYcBagjUd10HjzgQknpmLHSlVnlC+3B1OfeWb9k89vpQ9LIApAyDEIkHADdASTifM3YvtmDMUAoPFLE9F//OUvN770jsbkFcdiHWf0HXB+vtsXmEvpNqYsmAl7vnajXf/dp9f/YH2gTwmRAwqIQIYriMwA5RYz5mIiAAztAMvPNZiBuRDrf/Fg428+ujL7sgOsbUbXAScP4pJiHze0RFEBUP7x1Vb9t//91ccu9fQpGlPpDqPKuCERQIJAzO6nsFNh73M946XH1q489q2LN4857j50exPvwZiqZiwwF1TgUXsZQOlOqqq//8z6710e8P1k3dwc9C43yK+TGw1EADOEM9HsTchtifqf//eVP3zuRqfusW/ipRPaD5woYEM3CQ/z1KefuvDxlzv8NuKCulbv06M432EGxrVKAsDVDEt/8uz6b3n50s2VB7JakcUiz2LxV168cv/TN/oftrxtYn7HlDDnFzTnrMdagzmPI22YkMHDrzHzkEj85uVsR73/s/916Z0F4A5sNVFAHIGTv2IA0eMv3Xikz6Ji32TIbMNih6E1Q0oJrTWYABYEBYZiCaU1JCtI1tCckxqxhiANwYAAIyAgICA0eeLJy9u/3k5lySGypCCRjwUnClqR0LFa+MT5q82X2uo0vBlmBljn15TWyKRGphiZVEiVRKYUpNKQzJBaQisNrRnaEhoxCDm40cMZBCAC42cp3f/4/2w+6AFzAe4JbpzFhpX6Uxt3HmhrngLrnJq1oW+Th6RkKMl53HDuikoCmdJQzNCKoRRDaoZmBoHAmqE0Q2lAaiDVjJQZmQYyDaQa6DHiH17bPlVQzvluWRhzodcRC7+vev713oOkOf+UCSANZmGT4Ij0LB2yzm+jCVrr3HWJQAFBMxkrk/mevS+GR4X8FgyN873wgY077YnF6QlpAMkx7YztBIbXw4L60KV9cW2glhgEZgZR/kLE9oV9tjPloSGSUb8hEJi/zysTHj1Vj47a4VMCcE3yPXeubEwuTj/Q9SqOIlqVLgWFBTrGDv1iS6LGFoSxhqZRYbuL4o01GdohOg2lRJ6seVQ/mmka/Z2wr567dY/FxFa7MwngltP2+AKQP7S91TjJjAAgU5S4RaxLIuxYyg6NnPmURk4W2nzXCXEe/sPO//VoQhgA6Yz+99zZRqfTiW/fvl1J07TiVEIVryrZkQb2lQaIcoZmkRODIBNKTv5xawm2MTWMO+N+1gVpVFox3PPcF5nsRGiQFrh67Xrp3LlzU0KIbHZ2Npifn0e5XGZPEJKeOLSj0SzU/WKobpdFInT+wpo4dx6dAx0Gv2NnskmczCwAyLMaGVfdrbaxbd/YiUtAS0n9zc3NMhGVer1eqLVGvV7X5XLZ7cStvLDLYkV+qgHo6RDXOinXmCl/YRNgbP3LuOYImDBEY+MyPxeGaWyFQu6E0M4H5/MWYEL2tpIwkp1OJ9ZaQylFRKSTJJFxHGdBEKRuznVpXxTIYzu0vuVqeCH/IC+PhjHGZHIXj4iEAWgFaA2tNFip/O8VQWlAmZjTnOcxV4qyOdAGK4cB5to3rk9PVAe9Xi9M0zTodDrx1tZW0mq1kjRNI0/221FmiSIruT773nrljHniKIZ4VN3n7uXTfm4CVoZIydAq046gzOvFHJHmUa2mAYi4gvprZ9YnJ6qDfr8fZlkWWHCdTidSSvki7Q4VushirogpP7J6z4VGjFe0ctiM2WMO9pjfxBWR00V7OZVNwudRzZmzKoNFiFLrens1URvb29txlmWUpqnIsixQSgkp5X7rBLss5gZkCiA7VZ+6/a650tOAtYALzi0bDDy3exaUG0nz0G2H5/aRxrW1nTQNUJTgnovPXTw2O3Wz1WrFWZYFUkqhlCIAiONYB0Ggxyxu7OrHfDHTipjp5z5w33cXguxSXvgaWh7+I2MLHtG3MF3zUKgiQOcxyaYUg7Z5C8MalBmAECi3Xu++J9t8vr29HaVpKtI0FVJKwcxcKpWyarWaBUHg6/7uggeLPcRMK2QOFicrrc88tPiFiPQgT6QaGFrPsJxp9i2RWAuxtZCtOkzBZNOy7ctsfFEQ8y++8K8/WiiFrV6vF0opAymlkFIiSRI5Ozvbq9VqgyAIZEH+GlpwXIxZa1lJrP/Hp5trH1msfs2KMZp13kzmJcbQRTUXD9Y6dzfTu2lDHKzNBAgCl9+Co2e+/cLbo+65brcbSSmDLMuElJKSJFFzc3Pder3enZyc7Buqd+XwHSKPGCNBZw4wK2L2vvjoySceqUdfz99HOCWVBrPatUjETmYc9W8jQKMyTADxBN76kyfPv7vz6o8Hg0FgmFBorZEkiZyfn+80m82tRqPRiePY1fsHjua4yxXHxVnf0fm6AHrf/I23f/UTRyv/mJDqWnAm7MCszDCWUgxWuYXYDFci0CCoKIEgoZd++JWfvufWi8+qNMVgMAiVUoKIuFKppEeOHGmtrq7eWlpa2p6YmOg679V3qg7pLkEVKcHCkQdc+a3qFJ+lzz936eTfn73ym5f6dAIiBDhv90fkK3be1X1MIIAoAUCoXruwdf/Z75y9j7rrIAIRcRRFqlqtDmZnZ7eXl5dvHz9+/NbKykqrVqt1giAo0hx7vqBapN3bJOeusLgV9VC7V8ylT3/v/MPf/1nrg1dRXpFaBxh0TRll2xExwkUAylUIOUB548Wt2UtrmyuvX7hYicKuEAJRFMlSqZROTk727r333q2VlZVbx48fv7O4uLg9OTlpFWEXmAU18CXwcYsSviocOxrf0Gp2XL52feKvvvj10/92C+9/pfnOh0AE6GxU3gOACIEoxNTad6/PXDqzOd+99Xo1DtoAKIoiWalU+lNTU92FhYXto0eP3lldXb29srLSmpmZ6ZbL5Z4Dquto+30H1A7yoDEaHxW4ZewtI5W95aTk+bW1mT96/Bsfe/bkRx/WDILOzDJLDBICc0/980bztbWXy6VSXwihoyjKKpVKr1ardRqNxnaz2byzsrKytby83FpYWOiVy+VBEAT9olj3QO1aw6Y99nkUrTm7QqovQ5fSNC13u93y7/z1Pzz8neUPfbzfHyQUhBAy44Xv/dP6W6+88Gq1Wu3UarXtWq3Wnpub69Tr9Vaz2dw+cuRIu9Fo9KanpwfVajU1dG5Zr+eNsWx4EGD+orqrXrlC5o7YU0qVgiCIP/XZz3/oG/X3fTLLVNL4l7+7uNJaP99cWrp64sSJa8eOHbszPz/fnZub609PT6eVSiU11YQMgiBzSjo3l/pWGgvqIMD22jHgLwhWHZIpAYg+8Wefe/TcxuZ970j6Z0+fPn355MmTt5rNZmdmZmYQBIEyQ3q7CDKnpOu7FZBzXe0F6qDA9nPNpCAllNI0LbXb7eTmzZslZha1Wi2dnp5Ox4CR3rp06tWrmZOrpAeID7pUe7euGRekhDKARCmVSClFGIZkqnHlWaboKD0gmbcXRB9kVfNud+bwjj6leF/UsCwLgmAQBEHgpOgi60gnXoosWeR2+1rjjW4SczU+WXDdlmSRV2hLpxaVBTtzirYisdelHsjF3szutyJw7Lx46rTt7mfKs4q/l2pXb/VGth+92W19Pjj2YkgUANNjNoftteXv7rfoHdJGTCrYnkRjth3xHmAObc9ieEj3YU+x0QXrVlyg6hwqmJ8HsCLGpD0m4Oe6bRYA/m8A8FVIJHb+8hMAAAAASUVORK5CYII="});c.bindTo("map",this),c.bindTo("position",this);var e=new d.RadiusWidget(a);e.bindTo("map",this),e.bindTo("center",this,"position"),this.bindTo("distance",e),this.bindTo("bounds",e)},RadiusWidget:function(a){var b=new google.maps.Circle({strokeWeight:1,strokeColor:"#37A6CF",fillColor:"#37A6CF"}),c=a.getBounds().getCenter(),d=a.getBounds().getNorthEast(),e=google.maps.geometry.spherical.computeDistanceBetween(c,d)/1e3;this.set("distance",e/3),this.bindTo("bounds",b),b.bindTo("center",this),b.bindTo("map",this),b.bindTo("radius",this),this.addSizer_()},setHelpers:function(){d.DistanceWidget.prototype=new google.maps.MVCObject,d.RadiusWidget.prototype=new google.maps.MVCObject,d.RadiusWidget.prototype.distance_changed=function(){this.set("radius",1e3*this.get("distance"))},d.RadiusWidget.prototype.addSizer_=function(){var a=new google.maps.Marker({draggable:!0,title:"Me mova!",icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAG2YAABzjgAA+YsAAIR4AAB8wwAA95IAAC/yAAARoZE2jZ4AAALBSURBVHjarJbvS5NRFMc/PtMpUQoDM6jMqBylRprhJoUQlEbRu4jo16LUBkXRC3vTfxAUhRX9gMrsdRBaVhBE0i9oy1qRsCkEWmQKkQpW27cXbXPN51mb+n04cLnPPfd7zzn3nHuyJGGF1bffxIZOoA4oBgqjc5+AfuARMGSm/3b3mvg425rEbwMOAieiRKnwBDgNdFotMMwmK9r9dRLvJS5LOCX4j9RJdEg8lVgem09JVNHu9wIP07DCDOuBl1E3WxOVt/uPCC4K7AKmKQ7BQ8HGxL2zYpeh/JavAegAbMwOhoDawN6qYNyislu+AsE1gW0GliRLoeD6P7dO4gSwMPE4OUYWPXsqpxzzauALZ32DacdsVZtv64d9VZ3GqjafDfAmr/gV0UxJYjgGkC3JnZCElhj/HeFOcJhUCW6BjStvvnYYEpus8iOGiXCEOdkG1zeXUpKfRxp5lSg2ifWGoMIqoAAXej6z614vP36GKZqTw436UkoK8jK9GE5DUqEkzOS8f5BzvgEC38bY3zVJdrN+BSX5uVjpmYjDSOXc1jeTgQ8MjyeQ2WlrKGVJfm78/05nyjDbDElD6Z7s3bcxPA8mydq3OCmeZ+dgeREt1YtS6Q4ZiA+ZOPvt1zE8CZbd2V7GyXWL/57bWq/XkNSVga+RRM/XUTz3PzIRjjDPPlmxLNaHJXVnIz0HRgBHJslROX8uubakEJvn2ONgY82IEWysCSNaM3Gfp2wBp9xLpm5pvr41Xr2XXXnhAD6mUyEyRHeoybUhXr1DTa4RxAFEmNkr36OIQ1MevlCzq1OoRczKFxbaHWp29Zq+sH3N7jOIozO07DtiG+Juyp6h77C7FbEFEZwGyStENaILpdEF9Xndj0BloOOg/jQYXoN2gGpAwX/LclLPYIall54lN5BrE36PAu+iDeSAmX6/tzY+/jMApcCWpTVr3IcAAAAASUVORK5CYII="});a.bindTo("map",this),a.bindTo("position",this,"sizer_position");var b=this;google.maps.event.addListener(a,"drag",function(){b.setDistance()})},d.RadiusWidget.prototype.center_changed=function(){var a=this.get("bounds");if(a){var b=a.getNorthEast().lng(),c=new google.maps.LatLng(this.get("center").lat(),b);this.set("sizer_position",c)}},d.RadiusWidget.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},d.RadiusWidget.prototype.setDistance=function(){var a=this.get("sizer_position"),b=this.get("center"),c=this.distanceBetweenPoints_(b,a);this.set("distance",c)}},createMap:function(){var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(c[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup"),this.map.setCenter(this.options.homeLatlng),setTimeout(function(){google.maps.event.trigger(d.map,"resize"),google.maps.event.trigger(d.map,"bounds_changed"),d.map.setCenter(d.options.homeLatlng)},80),this.setHelpers(),google.maps.event.addListener(d.map,"click",function(a){d.addCircle(a.latLng)})},setLastCircleInfo:function(a){b.lastCirclePosition=a.get("position"),b.lastCircleDistance=a.get("distance"),b.lastCircleArea=a.get("distance")*a.get("distance")*Math.PI},addCircle:function(a){var b=new d.DistanceWidget(d.map,a);d.circles.push(b),d.setLastCircleInfo(b),google.maps.event.removeListener(d.lastListenerDistance),google.maps.event.removeListener(d.lastListenerPosition),d.lastListenerDistance=google.maps.event.addListener(b,"distance_changed",function(){d.setLastCircleInfo(b)}),d.lastListenerPosition=google.maps.event.addListener(b,"position_changed",function(){d.setLastCircleInfo(b)})}};d.createMap(),b.$parent.circles=d.circles,b.map=d.map,b.eraseAllCircles=function(){for(var a=d.circles.length-1;a>=0;a--)d.circles[a].set("map",null);d.circles=[]},b.eraseLastCircle=function(){d.circles[d.circles.length-1].set("map",null),d.circles.splice(d.circles.length-1,1)},b.fitCirclesBounds=function(){if(0!==d.circles.length){for(var a=new google.maps.LatLngBounds,b=d.circles.length-1;b>=0;b--)a.extend(d.circles[b].get("bounds").getNorthEast()),a.extend(d.circles[b].get("bounds").getSouthWest());d.map.fitBounds(a)}},b.addCircleByLatLng=function(a,c){d.addCircle(new google.maps.LatLng(a,c)),b.fitCirclesBounds()}}}}]),angular.module("FieldsFilterItemComponentModule",[]).directive("fieldsFilterItem",function(){return{restrict:"A",link:function(a){a.changeCondition=function(b){a.item.condition=b},a.$watch("item.fieldId",function(){if(null!==a.item.fieldId){a.item.category.fields=_.flatten(_.pluck(a.item.category.sections,"fields"));for(var b=a.item.category.fields.length-1;b>=0;b--)a.item.category.fields[b].id==a.item.fieldId&&(a.item.field=a.item.category.fields[b])}}),a.changeField=function(b){a.item.field=b},a["delete"]=function(){a.$parent.items.splice(a.$parent.items.indexOf(a.item),1)}}}}),angular.module("MapShowItemComponentModule",[]).directive("mapShowItem",["$timeout","$q","$rootScope","$compile",function(a,b,c,d){return{restrict:"A",link:function(a,b){var c={options:{homeLatlng:new google.maps.LatLng((-23.549671),(-46.6321713)),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.item&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),c.addMarker(a.item,a.category)},80)})},addMarker:function(b,e){var f,g,h=new google.maps.LatLng(b.position.latitude,b.position.longitude),i=c.infoWindow;"marker"===e.plot_format?(f=new google.maps.Size(54,51),g=e.marker.retina.web):(f=new google.maps.Size(15,15),g=e.pin.retina.web);var j=new google.maps.MarkerImage(g,null,null,null,f),k={position:h,map:this.map,icon:j,category:e,item:b},l=new google.maps.Marker(k);this.map.setCenter(h),google.maps.event.addListener(l,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ item.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",e=a.$new(!0);e.category=this.category,e.item=this.item;var f=d(b)(e);e.$apply(),i.setContent(f[0]),i.open(c.map,this)})}};c.start()}}}]),angular.module("MapShowReportComponentModule",[]).directive("mapShowReport",["$timeout","$q","$rootScope","$compile",function(a,b,c,d){return{restrict:"A",link:function(a,b){var c={options:{homeLatlng:new google.maps.LatLng((-23.549671),(-46.6321713)),map:{zoom:15,scrollwheel:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},infoWindow:new google.maps.InfoWindow,map:null,marker:null,start:function(){var d=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(b[0],this.options.map),this.map.mapTypes.set("zup",d),this.map.setMapTypeId("zup"),a.$watch("loading",function(){"undefined"!=typeof a.report&&setTimeout(function(){google.maps.event.trigger(c.map,"resize"),google.maps.event.trigger(c.map,"bounds_changed"),c.map.setCenter(c.options.homeLatlng),_.isNull(c.marker)||c.marker.setMap(null),c.marker=c.addMarker(a.report,a.report.category)},80)}),a.$watchCollection("[lat, lng]",function(){c.moveMarker(a.lat,a.lng)})},moveMarker:function(a,b){if(c.marker){var d=new google.maps.LatLng(a,b);c.map.setCenter(d),c.marker.setPosition(d)}},addMarker:function(b,e){var f=new google.maps.LatLng(b.position.latitude,b.position.longitude),g=c.infoWindow,h=new google.maps.Size(54,51),i=new google.maps.MarkerImage(e.marker.retina.web,null,null,null,h),j={position:f,map:this.map,icon:i,category:e,report:b},k=new google.maps.Marker(j);return this.map.setCenter(f),google.maps.event.addListener(k,"click",function(){var b="<div class=\"pinTooltip\"><h1>{{category.title}}</h1><p>Enviada {{ report.created_at | date: 'dd/MM/yy HH:mm'}}</p></div>",e=a.$new(!0);e.category=this.category,e.report=this.report;var f=d(b)(e);e.$apply(),g.setContent(f[0]),g.open(c.map,this)}),k}};c.start()}}}]),angular.module("MapViewStreetviewComponentModule",[]).directive("mapViewStreetview",function(){return{restrict:"A",scope:{latitude:"=",longitude:"="},link:function(a,b,c){function d(b,c){if(c!=google.maps.StreetViewStatus.OK)return a.$parent.hideStreetview=!0,void a.$apply();var d=e(h,b.location.latLng),f={position:h,addressControl:!0,linksControl:!0,panControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},pov:{heading:d,pitch:10,zoom:1},enableCloseButton:!1,visible:!0};g.setOptions(f)}function e(a,b){var c=57.2957795,d=.017453,e=a.lat()-b.lat(),g=a.lng()-b.lng(),h=Math.atan2(g*Math.cos(a.lat()*d),e)*c;return f(h)}function f(a){return a>=360?a-=360:a<0&&(a+=360),a}var g=new google.maps.StreetViewPanorama(b.find(".roundedMap").get(0)),h=new google.maps.LatLng(a.latitude,a.longitude),i=new google.maps.StreetViewService;i.getPanoramaByLocation(h,50,d);var j=function(a,b){var c,d,e=new google.maps.LatLng(a.position.latitude,a.position.longitude);"marker"===b.plot_format?(c=new google.maps.Size(54,51),d=b.marker.retina.web):(c=new google.maps.Size(15,15),d=b.pin.retina.web);var f=new google.maps.MarkerImage(d,null,null,null,c),h={position:e,map:g,icon:f,category:b,item:a};new google.maps.Marker(h)};j(a.$parent.item,a.$parent.category)}}}),angular.module("SelectLatLngMapComponent",[]).directive("selectLatLngMap",["$rootScope","ENV","FullResponseRestangular",function(a,b,c){return{restrict:"A",scope:{},link:function(d,e){var f={options:{homeLatlng:new google.maps.LatLng(b.mapLat,b.mapLng),map:{zoom:parseInt(b.mapZoom),scrollwheel:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControlOptions:{style:google.maps.ZoomControlStyle.MEDIUM,position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"zup"]}}},map:null,mainMarker:null,start:function(){var a=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(e[0],this.options.map),this.map.mapTypes.set("zup",a),this.map.setMapTypeId("zup");var b;null===d.$parent.latLng[0]&&null===d.$parent.latLng[1]?b=f.options.homeLatlng:(b=new google.maps.LatLng(d.$parent.latLng[0],d.$parent.latLng[1]),f.changedMarkerPosition(d.$parent.latLng[0],d.$parent.latLng[1]));var c=new google.maps.MarkerImage(d.$parent.category.marker.retina.web,null,null,null,new google.maps.Size(54,51)),g=new google.maps.Marker({map:f.map,draggable:!0,animation:google.maps.Animation.DROP,position:b,icon:c});f.mainMarker=g,f.map.setCenter(b),f.checkMarkerInsideAllowedBounds(f.mainMarker.getPosition().lat(),f.mainMarker.getPosition().lng()),google.maps.event.addListener(g,"dragend",function(){d.$parent.latLng[0]=f.mainMarker.getPosition().lat(),d.$parent.latLng[1]=f.mainMarker.getPosition().lng(),f.changedMarkerPosition(f.mainMarker.getPosition().lat(),f.mainMarker.getPosition().lng()),f.checkMarkerInsideAllowedBounds(f.mainMarker.getPosition().lat(),f.mainMarker.getPosition().lng())})},checkMarkerInsideAllowedBounds:function(a,b){var e=c.all("utils").all("city-boundary").customGET("validate",{longitude:b,latitude:a});e.then(function(a){d.$parent.markerOutOfBounds=a.data.inside_boundaries===!1})},changedMarkerPosition:function(a,b,c,e){var f=new google.maps.Geocoder;d.$parent.latLng=[a,b],d.$parent.addressComponents=null,d.$parent.formattedAddress=null,"undefined"!=typeof c&&(d.$parent.addressComponents=c),"undefined"!=typeof e&&(d.$parent.formattedAddress=e),f.geocode({latLng:new google.maps.LatLng(a,b)},function(a,b){b===google.maps.GeocoderStatus.OK&&("undefined"==typeof c&&(d.$parent&&(d.$parent.addressComponents=a[0].address_components,d.$parent.formattedAddress=a[0].formatted_address),d.formattedAddress=a[0].formatted_address),d.$apply())})}};f.start(),a.selectLatLngMap=f}}}]),angular.module("SearchLatLngMapComponent",[]).directive("searchLatLngMap",["$rootScope",function(a){return{restrict:"A",link:function(b,c){a.$watch("selectLatLngMap",function(){if("undefined"!=typeof a.selectLatLngMap){google.maps.event.clearListeners(a.selectLatLngMap.map);var b={types:["geocode"],componentRestrictions:{country:"br"}},d=new google.maps.places.Autocomplete(c[0],b);d.bindTo("bounds",a.selectLatLngMap.map),google.maps.event.addListener(d,"place_changed",function(){var b=d.getPlace();b.geometry&&(b.geometry.viewport?a.selectLatLngMap.map.fitBounds(b.geometry.viewport):(a.selectLatLngMap.map.setCenter(b.geometry.location),a.selectLatLngMap.map.setZoom(17)),a.selectLatLngMap.mainMarker.setPosition(b.geometry.location),a.selectLatLngMap.changedMarkerPosition(b.geometry.location.lat(),b.geometry.location.lng(),b.address_components,b.formatted_address))})}})}}}]),angular.module("NgThumbComponentModule",[]).directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(b)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),angular.module("InputsSidebarComponentModule",[]).directive("inputsSidebar",function(){return{restrict:"A",link:function(a,b){b.affix({offset:{top:75}})}}}),angular.module("InventoryDraggableInputComponentModule",[]).directive("inventoryDraggableInput",function(){return{restrict:"A",link:function(a,b){b.draggable({connectToSortable:".droppableInputsArea",revert:"invalid",helper:function(){return $('<div class="customDraggableHelper">'+b.find("p").html()+"</div>")},start:function(a,b){$(b.helper).css("width","auto").css("height","auto")}})}}}),angular.module("InventoryDroppableInputsAreaComponentModule",[]).directive("inventoryDroppableInputsArea",function(){return{restrict:"A",link:function(a,b){var c=null,d=function(){b.find(".input").each(function(){$(this).scope().field.position=$(this).index()}),a.$apply()};b.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para adicionar</p></div>')},update:function(){}},receive:function(a,b){var d=b.item.attr("name"),e=b.item.find("p").html(),f={toRemove:!1,kind:d,label:'Novo "'+e+'"',title:null,location:!1,maximum:null,minimum:null,required:!1,size:"M",inventory_fields_can_view:[],inventory_fields_can_edit:[],field_options:[],position:null};c=f},update:function(b,d){var e=$(d.item).index();if(null!==c){$(this).find(".item").remove(),c.position=e;for(var f=a.section.fields.length-1;f>=0;f--)a.section.fields[f].position===e&&(a.section.fields[f].position=a.section.fields[f].position+.5);a.section.fields.push(c),a.$apply(),c=null}},start:function(a,b){$(b.helper).addClass("helper"),d()},stop:function(a,b){$(b.item).removeClass("helper"),d()}})}}}),angular.module("InventoryEditLabelComponentModule",[]).directive("inventoryEditLabel",["$timeout","$rootScope",function(a,b){return{restrict:"A",link:function(c,d,e){c.editLabel=function(){"section"===e.inventoryEditLabel?(c.label=angular.copy(c.section.title),c.editingSectionLabel=!0):(c.label=angular.copy(c.field.label),c.editingLabel=!0),a(function(){d.find(".editLabelField").focus()})},c.saveLabel=function(){return 0===c.label.length?void b.showMessage("exclamation-sign","Você não pode deixar o título do campo em branco.","error"):void("section"===e.inventoryEditLabel?(c.section.title=c.label,c.editingSectionLabel=!1):(c.field.label=c.label,c.editingLabel=!1))},d.find(".editLabelField").keyup(function(a){13===a.keyCode&&(c.saveLabel(),c.$apply()),27===a.keyCode&&("section"===e.inventoryEditLabel?c.editingSectionLabel=!1:c.editingLabel=!1,c.$apply())})}}}]),angular.module("InventoryEditSectionComponentModule",[]).directive("inventoryEditSection",function(){return{restrict:"A",link:function(a){a.$watch("section.permissions",function(b,c){if(b!==c)for(var d=_.difference(c.groups_can_edit,b.groups_can_edit),e=_.difference(b.groups_can_edit,c.groups_can_edit),f=_.difference(c.groups_can_view,b.groups_can_view),g=_.difference(b.groups_can_view,c.groups_can_view),h=a.section.fields.length-1;h>=0;h--)e&&(a.section.fields[h].permissions.groups_can_edit=_.union(a.section.fields[h].permissions.groups_can_edit,e)),g&&(a.section.fields[h].permissions.groups_can_view=_.union(a.section.fields[h].permissions.groups_can_view,g)),d&&(a.section.fields[h].permissions.groups_can_edit=_.difference(a.section.fields[h].permissions.groups_can_edit,d)),f&&(a.section.fields[h].permissions.groups_can_view=_.difference(a.section.fields[h].permissions.groups_can_view,f))},!0)}}}),angular.module("InventoryCreateValueComponentModule",[]).directive("InventoryCreateValue",function(){return{restrict:"A",link:function(a){var b=1;a.newValue=function(){a.field.available_values.push("Nova opção "+b),b++}}}}),function(a){"use strict";a.module("InventoryPopoverComponentModule",[]).directive("inventoryPopover",function(){return{restrict:"A",link:function(a){function b(){a.$$phase||a.$apply()}a.popover={permissions:!1,options:!1,remove:!1},a.$on("hideOpenPopovers",function(){for(var c in a.popover)a.popover[c]===!0&&(a.popover[c]=!1);b()})}}})}(angular),function(a,b){"use strict";function c(){return{restrict:"A",link:function(a){a.openPopover=function(b){a.$emit("hidePopovers",!0),a.popover[b]=!0},a.closePopover=function(){a.$emit("hidePopovers",!0)}}}}a.module("InventoryPopoverLinkComponentModule",[]).directive("inventoryPopoverLink",c),c.$inject=["$document"]}(angular,$),angular.module("InventoryTriggerConditionComponentModule",[]).directive("inventoryTriggerCondition",["Restangular",function(a){return{restrict:"A",scope:{category:"="},link:function(a){a.$parent.$watch("condition.inventory_field_id",function(){_.each(a.category.sections,function(b){var c=_.findWhere(b.fields,{id:parseInt(a.$parent.condition.inventory_field_id,10)});if(!_.isUndefined(c))return void(a.$parent.condition.field=c)})})}}}]),angular.module("InventoryTriggerComponentModule",[]).directive("inventoryTrigger",["Restangular",function(a){return{restrict:"A",link:function(b){b.trigger.isNew&&(b.editing=!0),b.types=[{id:"equal_to",name:"Igual"},{id:"different",name:"Diferente"},{id:"greater_than",name:"Maior"},{id:"lesser_than",name:"Menor"},{id:"includes",name:"Inclui"},{id:"between",name:"Entre"}],b.removeTrigger=function(){if(b.trigger.isNew)b.$parent.triggers.splice(b.$parent.triggers.indexOf(b.trigger),1);else{b.processingForm=!0;var c=a.one("inventory").one("categories",b.$parent.category.id).one("formulas",b.trigger.id).remove();c.then(function(){b.$parent.triggers.splice(b.$parent.triggers.indexOf(b.trigger),1),b.processingForm=!1})}},b.newCondition=function(){b.trigger.conditions.push({conditionable_id:null,conditionable_type:"Inventory::Field",operator:"equal_to",content:null})},b.removeCondition=function(a){a._destroy=!0},b.saveTrigger=function(){b.processingForm=!0;for(var c=[],d=b.trigger.conditions.length-1;d>=0;d--){var e=b.trigger.conditions[d],f={conditionable_id:e.conditionable_id,conditionable_type:e.conditionable_type,operator:e.operator,content:e.content};_.isUndefined(e.id)||(f.id=e.id),_.isUndefined(e._destroy)||1!=e._destroy||(f._destroy=!0),c.push(f)}var g,h={inventory_status_id:b.trigger.inventory_status_id,conditions:c,groups_to_alert:[],run_formula:b.trigger.run_formula},i=a.one("inventory").one("categories",b.$parent.category.id);g=b.trigger.isNew===!0?i.post("formulas",h):i.one("formulas",b.trigger.id).customPUT(h),g.then(function(){b.showMessage("ok","O gatilho foi atualizado com sucesso!","success"),b.processingForm=!1})}}}}]),angular.module("InventorySortableSectionsComponentModule",[]).directive("inventorySortableSections",function(){return{restrict:"A",link:function(a,b){var c=function(){b.find(".section").each(function(){$(this).scope().section.position=$(this).index()}),a.$apply()};b.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para re-ordenar</p></div>')},update:function(){}},start:function(a,b){$(b.helper).addClass("helper"),c()},stop:function(a,b){$(b.item).removeClass("helper"),c()}})}}}),angular.module("InventorySingleValueComponentModule",[]).directive("inventorySingleValue",["Restangular",function(a){return{restrict:"A",link:function(b){b.newValue=angular.copy(b.option.value),b.saveOption=function(){if(b.editingValue=!1,b.isExistingField){b.updating=!0;var c=a.all("inventory").one("fields",b.field.id).one("options",b.option.id).customPUT({value:b.newValue});c.then(function(){b.updating=!1})}b.option.value=b.newValue},b.removeOption=function(){var c=b.$parent.field.field_options.indexOf(b.option);if(b.isExistingField){b.updating=!0;var d=a.all("inventory").one("fields",b.field.id).one("options",b.option.id).remove();d.then(function(){b.updating=!1})}c!==-1&&(b.option.disabled=!0)}}}}]),angular.module("GalleryComponentModule",["GalleryModalControllerModule"]).directive("gallery",function(){return{restrict:"E",templateUrl:"components/gallery/gallery.template.html",scope:{images:"="},replace:!0,controller:["$scope","$modal",function(a,b){a.show=function(a){b.open({templateUrl:"modals/gallery/gallery.template.html",windowClass:"gallery-modal",controller:"GalleryModalController",
resolve:{image:function(){return a}}})}}]}}),angular.module("FeatureFlagComponentModule",[]).directive("featureFlag",["Restangular",function(a){return{restrict:"A",link:function(b,c){b.$watch("flag.enabled",function(c,d){if(c!==d){b.loading=!0;var e=a.one("feature_flags",b.flag.id).customPUT({status:b.flag.enabled===!0?1:0});e.then(function(){b.loading=!1})}})}}}]),angular.module("GenericInputComponentModule",[]).directive("genericInput",function(){return{restrict:"A",link:function(a,b){a.$watch("inputErrors",function(){var c=a.inputErrors,d=$(b).closest(".form-group");if(b.removeClass("has-error"),d.removeClass("has-error"),"undefined"!=typeof c)for(var e in c)e===b.attr("name")&&(b.addClass("has-error"),d.addClass("has-error"))}),a.$parent.$watch("processingForm",function(){a.$parent.processingForm===!0?b.attr("disabled",!0):b.attr("disabled",!1)})}}}),angular.module("KeyboardPosterComponentModule",[]).directive("keyboardPoster",["$parse","$timeout",function(a,b){var c=700;return function(d,e,f){var g=angular.element(e)[0],h=null;g.onkeydown=function(){var g=a(f.keyboardPoster),i=g(d);h&&b.cancel(h),h=b(function(){i(e.val())},c)}}}]),angular.module("DetectScrollTopComponentModule",[]).directive("detectScrollTop",function(){return{restrict:"A",link:function(a,b){a.$watch("scrollTop",function(){a.scrollTop===!0&&(b.animate({scrollTop:0},900),a.scrollTop=!1)})}}}),angular.module("MapNewReportComponentModule",[]).directive("mapNewReport",["$compile","$timeout","Restangular","FullResponseRestangular","ENV","$filter",function(a,b,c,d,e,f){var g=new google.maps.Geocoder;return{restrict:"A",link:function(a,h,i){var j=parseInt(e.mapZoom);""!=a.address.address&&(j=16);var k={options:{homeLatlng:new google.maps.LatLng(e.mapLat,e.mapLng),map:{zoom:j,mapTypeControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}}},zoomLevels:{},currentZoom:parseInt(e.mapZoom),map:null,getNewItemsTimeout:null,hideNotVisibleMarkersTimeout:null,doAnimation:!0,activeMethod:"reports",activeInventoryFilters:[],hiddenReportsCategories:[],hiddenInventoryCategories:[],mainMarker:null,allows_arbitrary_position:!0,bindsToInventoryCategories:!1,start:function(){this.createMap(),this.setListeners()},createMap:function(){this.zoomLevels={},this.currentZoom=11;var b=new google.maps.StyledMapType(this.options.styles,{name:"zup"});this.map=new google.maps.Map(h[0],this.options.map),this.map.mapTypes.set("zup",b),this.map.setMapTypeId("zup"),this.map.setCenter(this.options.homeLatlng),setTimeout(function(){google.maps.event.trigger(k.map,"resize"),google.maps.event.trigger(k.map,"bounds_changed"),k.map.setCenter(k.options.homeLatlng),a.lat||a.lng||k.checkMarkerInsideAllowedBounds(k.options.homeLatlng.lat(),k.options.homeLatlng.lng())},80)},setListeners:function(){a.$on("addressChanged",function(b,c){if(c){var d=new google.maps.LatLng(a.lat,a.lng);k.mainMarker.setPosition(d),k.map.setCenter(d)}else{var e=a.address.address+", "+a.address.number;a.address.district&&(e+=", "+a.address.district),a.address.city&&(e+=", "+a.address.city),g.geocode({address:e,region:"BR"},function(b,c){c===google.maps.GeocoderStatus.OK&&b.length>0&&(k.mainMarker.setPosition(b[0].geometry.location),k.map.setCenter(b[0].geometry.location),a.lat=a.$parent.lat=k.mainMarker.getPosition().lat(),a.lng=a.$parent.lng=k.mainMarker.getPosition().lng(),k.checkMarkerInsideAllowedBounds(a.$parent.lat,a.$parent.lng))})}}),a.$watch("categoryData",function(){a.categoryData&&(this.bindsToInventoryCategories="undefined"!=typeof a.categoryData.inventory_categories,k.createMap(),setTimeout(function(){var b;if(b=a.lat&&a.lng?new google.maps.LatLng(a.lat,a.lng):k.options.homeLatlng,google.maps.event.trigger(k.map,"resize"),google.maps.event.trigger(k.map,"bounds_changed"),k.map.setCenter(b),a.$emit("reportMap:position_changed",b),a.categoryData)if(this.bindsToInventoryCategories)google.maps.event.addListener(k.map,"bounds_changed",function(){k.boundsChanged()}),google.maps.event.trigger(k.map,"bounds_changed"),k.allows_arbitrary_position=!1,k.mainMarker=null,a.$apply();else{var c=new google.maps.MarkerImage(a.categoryData.marker.retina.web,null,null,null,new google.maps.Size(54,51)),d=new google.maps.Marker({map:k.map,draggable:!0,animation:google.maps.Animation.DROP,position:b,icon:c});k.mainMarker=d,k.allows_arbitrary_position=!0,a.$apply(),google.maps.event.addListener(d,"dragend",function(){a.markerPositionUpdated=!0,a.lat=a.$parent.lat=k.mainMarker.getPosition().lat(),a.lng=a.$parent.lng=k.mainMarker.getPosition().lng(),k.checkMarkerInsideAllowedBounds(a.$parent.lat,a.$parent.lng),a.$emit("reportMap:position_changed",new google.maps.LatLng(a.lat,a.lng)),a.$apply(),a.$parent.$apply()})}a.itemId=null,a.formattedAddress=null,a.$apply()},80))}),a.updateMarkerAddress=function(){k.changedMarkerPosition(k.mainMarker.getPosition().lat(),k.mainMarker.getPosition().lng()),a.markerPositionUpdated=!1}},changedMarkerPosition:function(b,c,d,e){"undefined"==typeof d?(a.lat=b,a.lng=c):a.itemId=d,!_.isUndefined(e)&&e||g.geocode({latLng:new google.maps.LatLng(b,c)},function(b,c){if(c===google.maps.GeocoderStatus.OK){var d=f("filterGoogleAddressComponents")(b[0].address_components);d.number&&d.number.indexOf("-")!==-1&&(d.number=d.number.split("-")[0]),a.address.address=d.address,a.address.number=parseInt(d.number,10),a.address.district=d.neighborhood,a.address.city=d.city,a.address.state=d.state,a.address.country=d.country,a.address.postal_code=d.zipcode,a.$apply()}})},checkMarkerInsideAllowedBounds:function(b,c){var e=d.all("utils").all("city-boundary").customGET("validate",{longitude:c,latitude:b});e.then(function(b){b.data.inside_boundaries===!1?a.markerOutOfBounds=!0:a.markerOutOfBounds=!1})},boundsChanged:function(d){var e=!1;"undefined"==typeof this.zoomLevels[this.map.getZoom()]&&(this.zoomLevels[this.map.getZoom()]={}),this.currentZoom!==this.map.getZoom()&&(e=!0,this.currentZoom=this.map.getZoom()),this.hideNotVisibleMarkersTimeout&&b.cancel(this.hideNotVisibleMarkersTimeout),this.hideNotVisibleMarkersTimeout=b(function(){k.hideNotVisibleMarkers()},200),this.bindsToInventoryCategories&&(this.getNewItemsTimeout&&b.cancel(this.getNewItemsTimeout),a.isLoadingItems=!0,this.getNewItemsTimeout=b(function(){for(var b=[],f=a.categoryData.inventory_categories.length-1;f>=0;f--)b.push(a.categoryData.inventory_categories[f].id);var g=c.all("inventory").all("items").getList({"position[latitude]":k.map.getCenter().lat(),"position[longitude]":k.map.getCenter().lng(),"position[distance]":k.getDistance(),zoom:k.map.getZoom(),limit:100,inventory_category_id:b.join()});g.then(function(b){a.isLoadingItems=!1,d===!0&&k.removeAllMarkers(),e&&k.hideAllMarkersFromInactiveLevels();for(var c=b.data.length-1;c>=0;c--)k.addMarker(b.data[c],k.doAnimation);k.doAnimation===!0&&(k.doAnimation=!1)})},1e3))},hideNotVisibleMarkers:function(){angular.forEach(this.zoomLevels[this.map.getZoom()],function(a,b){if(k.isMarkerInsideBounds(a)){var c;"report"===a.type&&(c=k.hiddenReportsCategories.indexOf(a.item.category_id)),"item"===a.type&&(c=k.hiddenInventoryCategories.indexOf(a.item.inventory_category_id)),~c||a.setVisible(!0)}else a.setVisible(!1)})},hideAllMarkersFromInactiveLevels:function(){angular.forEach(this.zoomLevels,function(a,b){console.log(b,k.currentZoom),b!=k.currentZoom&&angular.forEach(a,function(a,b){a.setVisible(!1)})})},isMarkerInsideBounds:function(a){return this.map.getBounds().contains(a.getPosition())},addMarker:function(b,c,d){if("undefined"==typeof this.zoomLevels[this.map.getZoom()][d+"_"+b.id]){var e=new google.maps.LatLng(b.position.latitude,b.position.longitude),f=(new google.maps.InfoWindow,a.getInventoryCategory(b.inventory_category_id)),g=new google.maps.Size(15,15),h=(a.viewItem,"item"),i=(k.hiddenInventoryCategories.indexOf(b.inventory_category_id),new google.maps.MarkerImage(f.pin.retina.web,null,null,null,g)),j={position:e,map:this.map,icon:i,category:f,item:b,type:h};"undefined"!=typeof c&&c===!0&&(j.animation=google.maps.Animation.DROP);var l=new google.maps.Marker(j);this.zoomLevels[this.map.getZoom()][d+"_"+b.id]=l,google.maps.event.addListener(l,"click",function(){var b=new google.maps.LatLng(this.item.position.latitude,this.item.position.longitude);if(k.changedMarkerPosition(this.item.position.latitude,this.item.position.longitude,this.item.id),null===k.mainMarker){var c=new google.maps.MarkerImage(a.categoryData.marker.retina.web,null,null,null,new google.maps.Size(54,51)),d=new google.maps.Marker({map:k.map,animation:google.maps.Animation.DROP,position:b,icon:c});k.mainMarker=d}else k.mainMarker.setPosition(b)})}},getDistance:function(){var a=this.map.getBounds(),b=a.getCenter(),c=a.getNorthEast(),d=google.maps.geometry.spherical.computeDistanceBetween(b,c);return d}};k.start(),a.mapProvider=k}}}]),angular.module("ReportStatusComponentModule",[]).directive("reportStatus",function(){return{restrict:"A",link:function(a){a.$parent.$parent.updating===!0&&a.$watch("status",function(b,c){b!==c&&(a.$parent.$parent.updateStatuses[c.id]=a.status)},!0)}}}),angular.module("ReportSearchMapComponentModule",["FilterGoogleAddressComponentsHelperModule"]).directive("reportSearchMap",["$timeout","$filter","$rootScope",function(a,b,c){return{restrict:"A",link:function(d,e){d.$watch("mapProvider",function(){if("undefined"!=typeof d.mapProvider){google.maps.event.clearListeners(d.mapProvider.map);var f={types:["address"],componentRestrictions:{country:"br"}},g=new google.maps.places.Autocomplete(e[0],f);g.bindTo("bounds",d.mapProvider.map);var h,i=function(b,c){c!=google.maps.places.PlacesServiceStatus.OK&&a(function(){d.showLoadingForAutocompleteRequest=!1})},j=new google.maps.places.AutocompleteService;d.showLoading=function(){d.showLoadingForAutocompleteRequest=!0,h||(h=a(function(){j.getQueryPredictions({input:e[0]},i),h=void 0},400))},google.maps.event.addListener(g,"place_changed",function(){var a=g.getPlace();if(a.geometry){c.$broadcast("reports:position-updated",a.geometry.location);var e=b("filterGoogleAddressComponents")(a.address_components);d.$apply(function(){d.address.address=e.address,d.address.number=parseInt(e.number,10),d.address.reference="",d.address.district=e.neighborhood,e.city&&(d.address.city=e.city),e.state&&(d.address.state=e.state),e.country&&(d.address.country=e.country)});var f=new google.maps.Geocoder;if(f.geocode({latLng:a.geometry.location},function(a,c){if(c===google.maps.GeocoderStatus.OK){var e=b("filterGoogleAddressComponents")(a[0].address_components);d.$apply(function(){d.address.postal_code=e.zipcode})}}),a.geometry.viewport?d.mapProvider.map.fitBounds(a.geometry.viewport):(d.mapProvider.map.setCenter(a.geometry.location),d.mapProvider.map.setZoom(17)),1==d.mapProvider.allows_arbitrary_position)d.mapProvider.mainMarker.setPosition(a.geometry.location),d.mapProvider.changedMarkerPosition(a.geometry.location.lat(),a.geometry.location.lng(),void 0,!0),d.mapProvider.checkMarkerInsideAllowedBounds(d.mapProvider.mainMarker.getPosition().lat(),d.mapProvider.mainMarker.getPosition().lng());else{var h=new google.maps.Marker({map:d.mapProvider.map,position:a.geometry.location});h.setIcon({url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)})}}})}})}}}]),angular.module("GalleryImageOnLoadComponentModule",[]).directive("galleryImageOnLoad",["$window",function(a){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$apply(function(){a.loading=!1,a.$parent.imageDimensions={width:b.width(),height:b.height()}})})}}}]),angular.module("CopyTextComponentModule",[]).directive("copyText",function(){return{link:function(a,b){b.find(".form-control").on("click",function(){this.select()});var c=new ZeroClipboard(b.find(".btn-custom"));c.on("ready",function(){c.on("aftercopy",function(){b.find(".form-control").select(),b.addClass("has-success"),a.copied=!0,a.$apply()})})}}}),angular.module("FlowsCreateValueComponentModule",[]).directive("flowsCreateValue",function(){return{restrict:"A",link:function(a){a.newValue=function(){a.field.values.push("Nova opção"),a.saveField()}}}}),angular.module("FlowsDroppableInputsAreaComponentModule",["StepsServiceModule"]).directive("flowsDroppableInputsArea",["Restangular","StepsService","$interval",function(a,b,c){return{restrict:"A",link:function(d,e){e.sortable({revert:!0,handle:".handle",forcePlaceholderSize:!1,placeholder:{element:function(){return $('<div class="customSortablePlaceholder"><p>Solte para adicionar</p></div>')},update:angular.noop},receive:function(e,f){var g=f.item.attr("name"),h={id:void 0,field_type:g,title:b.getDefaultFieldLabel(g),maximum:null,minimum:null,presence:!1,position:null,values:[]};d.kindHasMultipleOptions(g)===!0&&(h.values=["Nova opção"]);var i=$(this).find(".item"),j=i.index();d.fields.splice(j,0,h);var k=this,l=c(function(){if(!_.findWhere({id:void 0})){var b=_.compact(_.map($(k).children(),function(a){return $(a).scope().field.id}));a.one("flows",d.flow.id).one("steps",d.step.id).all("fields").customPUT({ids:b}),c.cancel(l)}},500);i.remove(),d.$apply()},update:function(b,c){if("undefined"!=typeof c.item.attr("flows-step-field")){var e=_.map($(c.item).parent().children(),function(a){return $(a).scope().field.id});a.one("flows",d.flow.id).one("steps",d.step.id).all("fields").customPUT({ids:e})}}})}}}]),angular.module("FlowsSingleValueComponentModule",[]).directive("flowsSingleValue",["$parse",function(a){return{restrict:"A",link:function(b,c,d){b.editValue=angular.copy(b.value),b.index=a(d.flowsSingleValue)(b),b.saveValue=function(){b.editingValue=!1,b.$parent.field.values[b.index]=b.editValue,b.$parent.saveField()},b.removeValue=function(){b.$parent.field.values.length>1&&(b.$parent.field.values.splice(b.index,1),b.$parent.saveField())}}}}]),angular.module("FlowsStepFieldComponentModule",["FlowsServiceModule","StepsServiceModule"]).directive("flowsStepField",["Restangular","TwoStepSelector","FlowsService","StepsService","$q",function(a,b,c,d,e){return{restrict:"A",link:function(f){var g=function(){f.savingField=!0;var b=a.one("flows",f.flow.id).one("steps",f.step.id).post("fields",f.field);b.then(function(a){var b=d.fieldDenormalizer(a.data);f.fields[f.fields.indexOf(f.field)]=b,f.field=b,f.savingField=!1})},h=function(){return a.one("flows",f.flow.id).one("steps",f.step.id).one("fields",f.field.id).customPUT(f.field).then(function(a){f.showMessage(null,null,"updated-successfuly",!1);var b=d.fieldDenormalizer(a.data);f.field=_.extend(f.fields[f.fields.indexOf(f.field)],b)})},i=function(){var a;f.field.previous_field&&(a={},a[f.field.previous_field_step_id]=[{id:f.field.previous_field.id,title:f.field.previous_field.title}]),b.open(a,"Selecione os campos desejados",!1,"Etapas",c.getPreviousStepList(f.flow.id,f.step.id),"Campos",function(a){return d.fetchFields(f.flow.id,a.id,f.step.version_id,{display_type:"full",return_fields:["id","title"].join()})}).then(function(a){var b=_.keys(a)[0];f.field.origin_field_id=a[b][0].id,f.field.id?(f.field.title==f.field.previous_field.title&&(f.field.title=a[b][0].title),h()):(f.field.title=a[b][0].title,g())},function(){f.field.id||f.fields.splice(f.fields.indexOf(f.field),1)})},j=function(){f.savingField=!0;var a;f.field.origin_field_id&&(a={},a[f.field.field_id]=[f.field.origin_field_id]),b.open(a,"Selecione o campo de item de inventário desejado",!1,"Seletores de itens de inventário",c.getInventoryItemFields(f.flow.id,f.step.id),"Campos",function(a){var b=e.defer(),c=_.flatten(_.map(a.category_inventory[0].sections,function(a){return _.each(a.fields,function(a){a.label&&(a.title=a.label)}),a.fields}));return b.resolve(c),f.field.field_id=a.id,b.promise}).then(function(a){var b=_.keys(a)[0];f.field.origin_field_id=a[b][0].id,f.field.id?(f.field.title==f.field.category_inventory_field.title&&(f.field.title=a[b][0].title),h()):(f.field.title=a[b][0].title,g()),f.savingField=!1},function(){f.field.id||f.fields.splice(f.fields.indexOf(f.field),1),f.savingField=!1})};if(!f.field.id)switch(f.field.field_type){case"previous_field":i();break;case"inventory_field":j();break;default:g()}f.editField=function(){switch(f.field.field_type){case"previous_field":i();break;case"inventory_field":j();break;default:return!1}return!0},f.saveTitle=function(){h(),f.editingLabel=!1},f.saveField=function(){h(),f.popover.options=!1},f.removeField=function(){a.one("flows",f.flow.id).one("steps",f.step.id).one("fields",f.field.id).remove().then(function(){f.fields.splice(f.fields.indexOf(f.field),1),f.showMessage(null,null,"updated-successfuly",!1)}),f.field.destroy=!0}}}}]),angular.module("FlowsStepsOrderComponentModule",[]).directive("flowsStepsOrder",["Restangular","$timeout",function(a,b){return{restrict:"A",link:function(b,c){b.updateFieldsOrder=function(){for(var c=[],d=!1,e=b.flow.steps.length-1;e>=0;e--)"undefined"!=typeof b.flow.steps[e].id&&(c[b.flow.steps[e].position]=b.flow.steps[e].id);for(var e=c.length-1;e>=0;e--)"undefined"==typeof c[e]&&(d=!0);d||a.one("flows",b.flow.id).all("steps").customPUT({ids:c})};var d=function(a){c.find("tbody").each(function(){"undefined"!=typeof $(this).scope().step&&($(this).scope().step.position=$(this).index())}),b.$apply(),a===!0&&b.updateFieldsOrder()};c.sortable({cursor:"move",revert:!0,tolerance:"pointer",handle:".handle",forcePlaceholderSize:!1,containment:"#flow-step-list",placeholder:{element:function(){return $('<tr class="flow-step-order-placeholder"><td colspan="3">Solte para ordenar</td></tr>')},update:function(){}},start:function(a,b){$(b.helper).addClass("helper"),b.placeholder.height(b.item.height()),d()},stop:function(a,b){$(b.item).removeClass("helper"),d(!0)}})}}}]),angular.module("FlowsTriggerComponentModule",[]).directive("flowsTrigger",["Restangular",function(a){return{restrict:"A",link:function(b){b.editing=!!b.trigger.isNew,b.types=[{id:"==",name:"Igual"},{id:"!=",name:"Diferente"},{id:">",name:"Maior"},{id:"<",name:"Menor"},{id:"inc",name:"Entre valores"}],b.saveTrigger=function(){var c=_.map(b.trigger.trigger_conditions,function(a){var b={field_id:angular.isObject(a.my_field)?a.my_field.id:null,condition_type:a.condition_type,values:a.values};return angular.isDefined(a.id)&&(b.id=a.id),b}),d={return_fields:"id",title:b.trigger.title,trigger_conditions_attributes:c,action_type:b.trigger.action_type,action_values:b.trigger.action_values,description:b.trigger.description},e=a.one("flows",b.$parent.flow.id).one("steps",b.$parent.step.id).withHttpConfig({treatingErrors:!0});b.trigger.isNew?b.triggerPromise=e.post("triggers",d):b.triggerPromise=e.one("triggers",b.trigger.id).customPUT(d),b.triggerPromise.then(function(a){b.trigger.isNew&&(b.trigger.id=a.data.id,b.trigger.isNew=!1),b.editing=!1,b.showMessage("ok","O gatilho foi atualizado com sucesso!","success")})["catch"](function(){b.showMessage("exclamation-sign","O gatilho não pode ser salvo","error",!0)})},b.newCondition=function(){b.trigger.trigger_conditions.push({my_field:{},condition_type:"==",values:[]})},b.removeCondition=function(c){if(angular.isNumber(c.id)){b.processingForm=!0;var d=a.one("flows",b.$parent.flow.id).one("steps",b.$parent.step.id).one("triggers",b.trigger.id).one("trigger_conditions",c.id).remove();d.then(function(){b.trigger.trigger_conditions.splice(b.trigger.trigger_conditions.indexOf(c),1),b.processingForm=!1})}else b.trigger.trigger_conditions.splice(b.trigger.trigger_conditions.indexOf(c),1)},b.toggle=function(){b.editing=!b.editing}}}}]),angular.module("FlowsDraggableInputComponentModule",[]).directive("flowsDraggableInput",function(){return{restrict:"A",link:function(a,b){b.draggable({connectToSortable:".droppableInputsArea",revert:"invalid",helper:function(){return $('<div class="customDraggableHelper">'+b.find("p").html()+"</div>")},start:function(a,b){$(b.helper).css("width","auto").css("height","auto")}})}}}),angular.module("SlideComponent",[]).animation(".slide",function(){var a="ng-hide";return{beforeAddClass:function(b,c,d){c===a&&b.slideUp(d)},removeClass:function(b,c,d){c===a&&b.hide().slideDown(d)}}}),angular.module("ZupTranscludeComponentModule",[]).directive("zupTransclude",function(){return{compile:function(a,b,c){return function(a,b){c(a.$new(),function(a){b.append(a)})}}}}),angular.module("MultipleSelectListComponentModule",[]).directive("multipleSelectList",function(){return{restrict:"E",templateUrl:"components/multiple-select-list/multiple-select-list.template.html",transclude:!0,scope:{ngModel:"=",singularObjectName:"@",pluralObjectName:"@"},replace:!0,controller:["$scope",function(a){_.isArray(a.ngModel)||(a.ngModel=[]),a.selectAll=function(b,c){a.ngModel.length=0,_.each(b,function(b){a.ngModel.push(b[c])})},a.getExcerpt=function(){switch(a.ngModel.length){case 0:return"Selecione uma "+(_.isUndefined(a.singularObjectName)?"categoria":a.singularObjectName);case 1:return"1 "+(_.isUndefined(a.singularObjectName)?"categoria":a.singularObjectName)+" selecionado";default:return a.ngModel.length+" "+(_.isUndefined(a.pluralObjectName)?"categorias":a.pluralObjectName)+" selecionadas"}},a.toggle=function(b){var c=a.ngModel.indexOf(b);c===-1?a.ngModel.push(b):a.ngModel.splice(c,1)},a.isSelected=function(b){return a.ngModel.indexOf(b)!==-1}}]}}),angular.module("SelectListComponentModule",[]).directive("selectList",["$document",function(a){return{restrict:"E",templateUrl:"components/select-list/select-list.template.html",transclude:!0,scope:{ngModel:"=",optionName:"@",optionValue:"@",myPlaceHolder:"@",markDirty:"=",options:"="},replace:!0,controller:["$scope",function(a){var b=function(){if(_.isUndefined(a.markDirty.__dirty)||_.isNull(a.markDirty.__dirty)){var b=a.markDirty.__dirty=[];a.markDirty.__isDirty=function(){return _.indexOf(b,!0)>-1},a.markDirty.__resetDirty=function(){for(var c=b.length-1;c>=0;c--)b[c]=!1;a.memento=angular.copy(a.ngModel)}}a.dirtyIndex=a.markDirty.__dirty.length,a.markDirty.__dirty.push(!1),a.memento=angular.copy(a.ngModel)};a.markDirty&&b(),a.getExcerpt=function(){if(_.isArray(a.options)){if(_.isNull(a.ngModel)||_.isUndefined(a.ngModel))return a.myPlaceHolder;var b=_.find(a.options,function(b){return _.isEqual(b[a.optionValue],a.ngModel)});return _.isNull(b)||_.isUndefined(b)?"Opção não disponível":b[a.optionName]}return a.title?a.title:a.myPlaceHolder?a.myPlaceHolder:"Selecione uma categoria"},a.select=function(b,c){a.ngModel=b,a.markDirty&&_.isArray(a.markDirty.__dirty)&&(a.markDirty.__dirty[a.dirtyIndex]=!_.isEqual(a.ngModel,a.memento)),a.title=c[a.optionName],a.show=!1,a.$emit("optionSelected",c)},a.toggle=function(b,c){a.isSelected(b)?(a.ngModel=null,a.show=!1):a.select(b,c)},a.isSelected=function(b){return b===a.ngModel}}],link:function(b,c){var d=function(e){$(e.target).closest(c).length||(b.show=!1,b.$apply(),angular.element(a).off("click",d))};b.toggleList=function(){b.show=!b.show,b.show?angular.element(a).on("click",d):angular.element(a).off("click",d)},b.$on("$destroy",function(){angular.element(a).off("click",d)})}}}]),angular.module("FormInputValidatorIntegerComponentModule",[]).directive("formInputValidatorInteger",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){return d?void d.$parsers.unshift(function(a){return/[0-9]/.test(a)?d.$setValidity("integerValidator",!0):d.$setValidity("integerValidator",!1),a}):void $log.warn("Integer validation requires ngModel to be on the element")}}}),angular.module("FormInputValidatorGreatThanComponentModule",[]).directive("formInputValidatorGreatThan",["$parse",function(a){return{restrict:"A",require:"ngModel",link:function(b,c,d,e){if(!e)return void $log.warn('"Great than" validation requires ngModel to be on the element');var f=a(d.formInputValidatorGreatThan)(b);e.$parsers.unshift(function(a){return a>=f?e.$setValidity("greatThanValidator",!0):e.$setValidity("greatThanValidator",!1),a})}}}]),angular.module("FormInputSliderComponentModule",[]).directive("formInputSlider",function(){return{restrict:"CA",require:"?ngModel",link:function(a,b,c,d){function e(){d.$setViewValue(g)}if(!d)return void $log.warn("Slider directive requires ngModel to be on the element");var f=b[0];angular.element(f).addClass("input-slider"),noUiSlider.create(f,{start:0,step:1,connect:"lower",range:{min:[0],max:[90]}}),d.$render=function(){d.$viewValue>90?f.noUiSlider.set(90):d.$viewValue<0?f.noUiSlider.set(0):f.noUiSlider.set(d.$viewValue||0)};var g;f.noUiSlider.on("slide",function(b,c,d){g=parseInt(b[0]||0,10),a.$evalAsync(e)}),e();var h=a.$on("$destroy",function(){f.noUiSlider.off("slide"),f.noUiSlider.destroy(),h(),h=null})}}}),angular.module("FormInputSliderRangeComponentModule",[]).directive("formInputSliderRange",["$parse",function(a){return{restrict:"CA",require:"?ngModel",link:function(b,c,d,e){if(!e)return void $log.warn("Slider directive requires ngModel to be on the element");var f=c[0];angular.element(f).addClass("input-slider-range"),noUiSlider.create(f,{start:[0,90],step:1,connect:!0,range:{min:[0],max:[90]}});var g=a(d.ngModel),h=b.$watch(d.ngModel,function(){var a=g(b),c=parseInt(a.begin||0,10),d=parseInt(a.end||90,10);d>90?f.noUiSlider.set([null,90]):c<0?f.noUiSlider.set([0,null]):f.noUiSlider.set([c,d])},!0);f.noUiSlider.on("slide",function(a,c,d){b.$evalAsync(function(){e.$setViewValue({begin:d[0],end:d[1]})})}),e.$parsers.push(function(a){return{begin:a.begin||0,end:a.end||90}});var i=b.$on("$destroy",function(){h(),h=null,f.noUiSlider.off("slide"),f.noUiSlider.destroy(),i(),i=null})}}}]),angular.module("ItemSelectorDirectiveModule",["SelectListComponentModule"]).directive("itemSelector",["$document","$timeout",function(a,b){return{restrict:"E",scope:{promiseGenerator:"&",onItemSelect:"&",onItemUnselect:"&",title:"=",selectedItemsIds:"=?",multiple:"="},templateUrl:"components/item-selector/item-selector.template.html",controllerAs:"itemSelectorCtrl",controller:["$scope",function(a){a.selectedItemsIds=a.selectedItemsIds||[],a.getExcerpt=function(){return a.selectedItemsIds&&a.selectedItemsIds.length>0?1==a.selectedItemsIds.length?_.findWhere(a.items,{id:a.selectedItemsIds[0]}).title:a.selectedItemsIds.length+" itens selecionados.":a.title?a.title:"Selecione um item"},a.select=function(b){a.selected(b)?(a.selectedItemsIds.splice(a.selectedItemsIds.indexOf(b.id),1),a.onItemUnselect&&a.onItemUnselect({item:b})):(a.onItemSelect&&a.onItemSelect({item:b}),a.selectedItemsIds.push(b.id)),a.multiple||(a.show=!1)},a.selected=function(b){return _.include(a.selectedItemsIds,b.id)},a.loadingItems=!0,a.errorLoadingItems=!1,a.promiseGenerator().then(function(b){b.data&&b.data.categories?a.items=b.data.categories:a.items=b,a.loadingItems=!1},function(){a.loadingItems=!1,a.errorLoadingItems=!0})}],link:function(b,c){var d=function(e){$(e.target).closest(c).length||(b.show=!1,b.$apply(),angular.element(a).off("click",d))};b.toggleList=function(){b.show=!b.show,b.show?angular.element(a).on("click",d):angular.element(a).off("click",d)},b.$on("$destroy",function(){angular.element(a).off("click",d)})}}}]),angular.module("UploaderDirectiveModule",[]).directive("uploader",["$q","FileUploader",function(a,b){function c(c,d,e,f,g){function h(a){return new RegExp(".("+c.extensions+")").test(a.type)}function i(b){var c=new FileReader,d=a.defer();return c.addEventListener("load",function(){d.resolve(c.result)},!1),c.addEventListener("error",function(){d.reject()},!1),c.addEventListener("abort",function(){d.reject()},!1),c.readAsDataURL(b),d.promise}c.uploader=new b,_.isString(c.extensions)&&c.uploader.filters.push({name:"extensions",fn:h});var j=function(a){var b=c.uploader.queue[a];b.isUploading&&b.cancel(),c.uploader.queue.splice(a,1);var e=d.find('input[type="file"]')[0];e.value=""};c.uploader.onAfterAddingFile=function(a){i(a._file).then(function(b){c.files.push({file_name:a.file.name,content:b,url:b,queue_index:c.uploader.getIndexOfItem(a)})});var b=d.find('input[type="file"]')[0];b.value=""},c.uploader.remove=function(a){a.id?(a.destroy=!0,c.files.indexOf(a)==-1&&c.files.push(a)):(c.files.splice(c.files.indexOf(a),1),j(a.queue_index))},g(c.$parent,function(a,b){b.$uploader=c.uploader,d.append(a)})}return{restrict:"E",transclude:!0,replace:!0,templateUrl:"components/uploader/uploader.template.html",scope:{files:"=",extensions:"@",multiple:"="},link:{pre:c}}}]),angular.module("UploaderDirectiveModule").directive("uploaderDropzone",function(){return{restrict:"E",replace:!0,require:"^uploader",templateUrl:"components/uploader/dropzone/uploader-dropzone.template.html"}}),angular.module("NotificationsCenterComponentModule",["NotificationServiceModule"]).directive("notificationsCenter",NotificationsCenterComponent).directive("notification",NotificationComponent),!function(a,b){"use strict";"function"==typeof define&&define.amd?define("jquery-bridget/jquery-bridget",["jquery"],function(c){b(a,c)}):"object"==typeof module&&module.exports?module.exports=b(a,require("jquery")):a.jQueryBridget=b(a,a.jQuery)}(window,function(a,b){"use strict";function c(c,f,h){function i(a,b,d){var e,f="$()."+c+'("'+b+'")';return a.each(function(a,i){var j=h.data(i,c);if(!j)return void g(c+" not initialized. Cannot call methods, i.e. "+f);var k=j[b];if(!k||"_"==b.charAt(0))return void g(f+" is not a valid method");var l=k.apply(j,d);e=void 0===e?l:e}),void 0!==e?e:a}function j(a,b){a.each(function(a,d){var e=h.data(d,c);e?(e.option(b),e._init()):(e=new f(d,b),h.data(d,c,e))})}h=h||b||a.jQuery,h&&(f.prototype.option||(f.prototype.option=function(a){h.isPlainObject(a)&&(this.options=h.extend(!0,this.options,a))}),h.fn[c]=function(a){if("string"==typeof a){var b=e.call(arguments,1);return i(this,a,b)}return j(this,a),this},d(h))}function d(a){!a||a&&a.bridget||(a.bridget=c)}var e=Array.prototype.slice,f=a.console,g="undefined"==typeof f?function(){}:function(a){f.error(a)};return d(b||a.jQuery),c}),function(a,b){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",b):"object"==typeof module&&module.exports?module.exports=b():a.EvEmitter=b()}(this,function(){function a(){}var b=a.prototype;return b.on=function(a,b){if(a&&b){var c=this._events=this._events||{},d=c[a]=c[a]||[];return-1==d.indexOf(b)&&d.push(b),this}},b.once=function(a,b){if(a&&b){this.on(a,b);var c=this._onceEvents=this._onceEvents||{},d=c[a]=c[a]||[];return d[b]=!0,this}},b.off=function(a,b){var c=this._events&&this._events[a];if(c&&c.length){var d=c.indexOf(b);return-1!=d&&c.splice(d,1),this}},b.emitEvent=function(a,b){var c=this._events&&this._events[a];if(c&&c.length){var d=0,e=c[d];b=b||[];for(var f=this._onceEvents&&this._onceEvents[a];e;){var g=f&&f[e];g&&(this.off(a,e),delete f[e]),e.apply(this,b),d+=g?0:1,e=c[d]}return this}},a}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("get-size/get-size",[],function(){return b()}):"object"==typeof module&&module.exports?module.exports=b():a.getSize=b()}(window,function(){"use strict";function a(a){var b=parseFloat(a),c=-1==a.indexOf("%")&&!isNaN(b);return c&&b}function b(){}function c(){for(var a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},b=0;j>b;b++){var c=i[b];a[c]=0}return a}function d(a){var b=getComputedStyle(a);return b||h("Style returned "+b+". Are you running this code in a hidden iframe on Firefox? See http://bit.ly/getsizebug1"),b}function e(){if(!k){k=!0;var b=document.createElement("div");b.style.width="200px",b.style.padding="1px 2px 3px 4px",b.style.borderStyle="solid",b.style.borderWidth="1px 2px 3px 4px",b.style.boxSizing="border-box";var c=document.body||document.documentElement;c.appendChild(b);var e=d(b);f.isBoxSizeOuter=g=200==a(e.width),c.removeChild(b)}}function f(b){if(e(),"string"==typeof b&&(b=document.querySelector(b)),b&&"object"==typeof b&&b.nodeType){var f=d(b);if("none"==f.display)return c();
var h={};h.width=b.offsetWidth,h.height=b.offsetHeight;for(var k=h.isBorderBox="border-box"==f.boxSizing,l=0;j>l;l++){var m=i[l],n=f[m],o=parseFloat(n);h[m]=isNaN(o)?0:o}var p=h.paddingLeft+h.paddingRight,q=h.paddingTop+h.paddingBottom,r=h.marginLeft+h.marginRight,s=h.marginTop+h.marginBottom,t=h.borderLeftWidth+h.borderRightWidth,u=h.borderTopWidth+h.borderBottomWidth,v=k&&g,w=a(f.width);w!==!1&&(h.width=w+(v?0:p+t));var x=a(f.height);return x!==!1&&(h.height=x+(v?0:q+u)),h.innerWidth=h.width-(p+t),h.innerHeight=h.height-(q+u),h.outerWidth=h.width+r,h.outerHeight=h.height+s,h}}var g,h="undefined"==typeof console?b:function(a){console.error(a)},i=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],j=i.length,k=!1;return f}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("matches-selector/matches-selector",b):"object"==typeof module&&module.exports?module.exports=b():a.matchesSelector=b()}(window,function(){"use strict";var a=function(){var a=Element.prototype;if(a.matches)return"matches";if(a.matchesSelector)return"matchesSelector";for(var b=["webkit","moz","ms","o"],c=0;c<b.length;c++){var d=b[c],e=d+"MatchesSelector";if(a[e])return e}}();return function(b,c){return b[a](c)}}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("fizzy-ui-utils/utils",["matches-selector/matches-selector"],function(c){return b(a,c)}):"object"==typeof module&&module.exports?module.exports=b(a,require("desandro-matches-selector")):a.fizzyUIUtils=b(a,a.matchesSelector)}(window,function(a,b){var c={};c.extend=function(a,b){for(var c in b)a[c]=b[c];return a},c.modulo=function(a,b){return(a%b+b)%b},c.makeArray=function(a){var b=[];if(Array.isArray(a))b=a;else if(a&&"number"==typeof a.length)for(var c=0;c<a.length;c++)b.push(a[c]);else b.push(a);return b},c.removeFrom=function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)},c.getParent=function(a,c){for(;a!=document.body;)if(a=a.parentNode,b(a,c))return a},c.getQueryElement=function(a){return"string"==typeof a?document.querySelector(a):a},c.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},c.filterFindElements=function(a,d){a=c.makeArray(a);var e=[];return a.forEach(function(a){if(a instanceof HTMLElement){if(!d)return void e.push(a);b(a,d)&&e.push(a);for(var c=a.querySelectorAll(d),f=0;f<c.length;f++)e.push(c[f])}}),e},c.debounceMethod=function(a,b,c){var d=a.prototype[b],e=b+"Timeout";a.prototype[b]=function(){var a=this[e];a&&clearTimeout(a);var b=arguments,f=this;this[e]=setTimeout(function(){d.apply(f,b),delete f[e]},c||100)}},c.docReady=function(a){"complete"==document.readyState?a():document.addEventListener("DOMContentLoaded",a)},c.toDashed=function(a){return a.replace(/(.)([A-Z])/g,function(a,b,c){return b+"-"+c}).toLowerCase()};var d=a.console;return c.htmlInit=function(b,e){c.docReady(function(){var f=c.toDashed(e),g="data-"+f,h=document.querySelectorAll("["+g+"]"),i=document.querySelectorAll(".js-"+f),j=c.makeArray(h).concat(c.makeArray(i)),k=g+"-options",l=a.jQuery;j.forEach(function(a){var c,f=a.getAttribute(g)||a.getAttribute(k);try{c=f&&JSON.parse(f)}catch(h){return void(d&&d.error("Error parsing "+g+" on "+a.className+": "+h))}var i=new b(a,c);l&&l.data(a,e,i)})})},c}),function(a,b){"function"==typeof define&&define.amd?define("outlayer/item",["ev-emitter/ev-emitter","get-size/get-size"],function(c,d){return b(a,c,d)}):"object"==typeof module&&module.exports?module.exports=b(a,require("ev-emitter"),require("get-size")):(a.Outlayer={},a.Outlayer.Item=b(a,a.EvEmitter,a.getSize))}(window,function(a,b,c){"use strict";function d(a){for(var b in a)return!1;return b=null,!0}function e(a,b){a&&(this.element=a,this.layout=b,this.position={x:0,y:0},this._create())}function f(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}var g=document.documentElement.style,h="string"==typeof g.transition?"transition":"WebkitTransition",i="string"==typeof g.transform?"transform":"WebkitTransform",j={WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[h],k=[i,h,h+"Duration",h+"Property"],l=e.prototype=Object.create(b.prototype);l.constructor=e,l._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:MasonryHack?MasonryHack.position:"absolute"})},l.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},l.getSize=function(){this.size=c(this.element)},l.css=function(a){var b=this.element.style;for(var c in a){var d=k[c]||c;b[d]=a[c]}},l.getPosition=function(){var a=getComputedStyle(this.element),b=this.layout._getOption("originLeft"),c=this.layout._getOption("originTop"),d=a[b?"left":"right"],e=a[c?"top":"bottom"],f=this.layout.size,g=-1!=d.indexOf("%")?parseFloat(d)/100*f.width:parseInt(d,10),h=-1!=e.indexOf("%")?parseFloat(e)/100*f.height:parseInt(e,10);g=isNaN(g)?0:g,h=isNaN(h)?0:h,g-=b?f.paddingLeft:f.paddingRight,h-=c?f.paddingTop:f.paddingBottom,this.position.x=g,this.position.y=h},l.layoutPosition=function(){var a=this.layout.size,b={},c=this.layout._getOption("originLeft"),d=this.layout._getOption("originTop"),e=c?"paddingLeft":"paddingRight",f=c?"left":"right",g=c?"right":"left",h=this.position.x+a[e];b[f]=this.getXValue(h),b[g]="";var i=d?"paddingTop":"paddingBottom",j=d?"top":"bottom",k=d?"bottom":"top",l=this.position.y+a[i];b[j]=this.getYValue(l),b[k]="",this.css(b),this.emitEvent("layout",[this])},l.getXValue=function(a){var b=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&!b?a/this.layout.size.width*100+"%":a+"px"},l.getYValue=function(a){var b=this.layout._getOption("horizontal");return this.layout.options.percentPosition&&b?a/this.layout.size.height*100+"%":a+"px"},l._transitionTo=function(a,b){this.getPosition();var c=this.position.x,d=this.position.y,e=parseInt(a,10),f=parseInt(b,10),g=e===this.position.x&&f===this.position.y;if(this.setPosition(a,b),g&&!this.isTransitioning)return void this.layoutPosition();var h=a-c,i=b-d,j={};j.transform=this.getTranslate(h,i),this.transition({to:j,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})},l.getTranslate=function(a,b){var c=this.layout._getOption("originLeft"),d=this.layout._getOption("originTop");return a=c?a:-a,b=d?b:-b,"translate3d("+a+"px, "+b+"px, 0)"},l.goTo=function(a,b){this.setPosition(a,b),this.layoutPosition()},l.moveTo=l._transitionTo,l.setPosition=function(a,b){this.position.x=parseInt(a,10),this.position.y=parseInt(b,10)},l._nonTransition=function(a){this.css(a.to),a.isCleaning&&this._removeStyles(a.to);for(var b in a.onTransitionEnd)a.onTransitionEnd[b].call(this)},l._transition=function(a){if(!parseFloat(this.layout.options.transitionDuration))return void this._nonTransition(a);var b=this._transn;for(var c in a.onTransitionEnd)b.onEnd[c]=a.onTransitionEnd[c];for(c in a.to)b.ingProperties[c]=!0,a.isCleaning&&(b.clean[c]=!0);if(a.from){this.css(a.from);var d=this.element.offsetHeight;d=null}this.enableTransition(a.to),this.css(a.to),this.isTransitioning=!0};var m="opacity,"+f(k.transform||"transform");l.enableTransition=function(){this.isTransitioning||(this.css({transitionProperty:m,transitionDuration:this.layout.options.transitionDuration}),this.element.addEventListener(j,this,!1))},l.transition=e.prototype[h?"_transition":"_nonTransition"],l.onwebkitTransitionEnd=function(a){this.ontransitionend(a)},l.onotransitionend=function(a){this.ontransitionend(a)};var n={"-webkit-transform":"transform"};l.ontransitionend=function(a){if(a.target===this.element){var b=this._transn,c=n[a.propertyName]||a.propertyName;if(delete b.ingProperties[c],d(b.ingProperties)&&this.disableTransition(),c in b.clean&&(this.element.style[a.propertyName]="",delete b.clean[c]),c in b.onEnd){var e=b.onEnd[c];e.call(this),delete b.onEnd[c]}this.emitEvent("transitionEnd",[this])}},l.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(j,this,!1),this.isTransitioning=!1},l._removeStyles=function(a){var b={};for(var c in a)b[c]="";this.css(b)};var o={transitionProperty:"",transitionDuration:""};return l.removeTransitionStyles=function(){this.css(o)},l.removeElem=function(){this.element.parentNode.removeChild(this.element),this.css({display:""}),this.emitEvent("remove",[this])},l.remove=function(){return h&&parseFloat(this.layout.options.transitionDuration)?(this.once("transitionEnd",function(){this.removeElem()}),void this.hide()):void this.removeElem()},l.reveal=function(){delete this.isHidden,this.css({display:""});var a=this.layout.options,b={},c=this.getHideRevealTransitionEndProperty("visibleStyle");b[c]=this.onRevealTransitionEnd,this.transition({from:a.hiddenStyle,to:a.visibleStyle,isCleaning:!0,onTransitionEnd:b})},l.onRevealTransitionEnd=function(){this.isHidden||this.emitEvent("reveal")},l.getHideRevealTransitionEndProperty=function(a){var b=this.layout.options[a];if(b.opacity)return"opacity";for(var c in b)return c},l.hide=function(){this.isHidden=!0,this.css({display:""});var a=this.layout.options,b={},c=this.getHideRevealTransitionEndProperty("hiddenStyle");b[c]=this.onHideTransitionEnd,this.transition({from:a.visibleStyle,to:a.hiddenStyle,isCleaning:!0,onTransitionEnd:b})},l.onHideTransitionEnd=function(){this.isHidden&&(this.css({display:"none"}),this.emitEvent("hide"))},l.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},e}),function(a,b){"use strict";"function"==typeof define&&define.amd?define("outlayer/outlayer",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./item"],function(c,d,e,f){return b(a,c,d,e,f)}):"object"==typeof module&&module.exports?module.exports=b(a,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./item")):a.Outlayer=b(a,a.EvEmitter,a.getSize,a.fizzyUIUtils,a.Outlayer.Item)}(window,function(a,b,c,d,e){"use strict";function f(a,b){var c=d.getQueryElement(a);if(!c)return void(h&&h.error("Bad element for "+this.constructor.namespace+": "+(c||a)));this.element=c,i&&(this.$element=i(this.element)),this.options=d.extend({},this.constructor.defaults),this.option(b);var e=++k;this.element.outlayerGUID=e,l[e]=this,this._create();var f=this._getOption("initLayout");f&&this.layout()}function g(a){function b(){a.apply(this,arguments)}return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b}var h=a.console,i=a.jQuery,j=function(){},k=0,l={};f.namespace="outlayer",f.Item=e,f.defaults={containerStyle:{position:"relative"},initLayout:!0,originLeft:!0,originTop:!0,resize:!0,resizeContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}};var m=f.prototype;return d.extend(m,b.prototype),m.option=function(a){d.extend(this.options,a)},m._getOption=function(a){var b=this.constructor.compatOptions[a];return b&&void 0!==this.options[b]?this.options[b]:this.options[a]},f.compatOptions={initLayout:"isInitLayout",horizontal:"isHorizontal",layoutInstant:"isLayoutInstant",originLeft:"isOriginLeft",originTop:"isOriginTop",resize:"isResizeBound",resizeContainer:"isResizingContainer"},m._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),d.extend(this.element.style,this.options.containerStyle);var a=this._getOption("resize");a&&this.bindResize()},m.reloadItems=function(){this.items=this._itemize(this.element.children)},m._itemize=function(a){for(var b=this._filterFindItemElements(a),c=this.constructor.Item,d=[],e=0;e<b.length;e++){var f=b[e],g=new c(f,this);d.push(g)}return d},m._filterFindItemElements=function(a){return d.filterFindElements(a,this.options.itemSelector)},m.getItemElements=function(){return this.items.map(function(a){return a.element})},m.layout=function(){this._resetLayout(),this._manageStamps();var a=this._getOption("layoutInstant"),b=void 0!==a?a:!this._isLayoutInited;this.layoutItems(this.items,b),this._isLayoutInited=!0},m._init=m.layout,m._resetLayout=function(){this.getSize()},m.getSize=function(){this.size=c(this.element)},m._getMeasurement=function(a,b){var d,e=this.options[a];e?("string"==typeof e?d=this.element.querySelector(e):e instanceof HTMLElement&&(d=e),this[a]=d?c(d)[b]:e):this[a]=0},m.layoutItems=function(a,b){a=this._getItemsForLayout(a),this._layoutItems(a,b),this._postLayout()},m._getItemsForLayout=function(a){return a.filter(function(a){return!a.isIgnored})},m._layoutItems=function(a,b){if(this._emitCompleteOnItems("layout",a),a&&a.length){var c=[];a.forEach(function(a){var d=this._getItemLayoutPosition(a);d.item=a,d.isInstant=b||a.isLayoutInstant,c.push(d)},this),this._processLayoutQueue(c)}},m._getItemLayoutPosition=function(){return{x:0,y:0}},m._processLayoutQueue=function(a){a.forEach(function(a){this._positionItem(a.item,a.x,a.y,a.isInstant)},this)},m._positionItem=function(a,b,c,d){d?a.goTo(b,c):a.moveTo(b,c)},m._postLayout=function(){this.resizeContainer()},m.resizeContainer=function(){var a=this._getOption("resizeContainer");if(a){var b=this._getContainerSize();b&&(this._setContainerMeasure(b.width,!0),this._setContainerMeasure(b.height,!1))}},m._getContainerSize=j,m._setContainerMeasure=function(a,b){if(void 0!==a){var c=this.size;c.isBorderBox&&(a+=b?c.paddingLeft+c.paddingRight+c.borderLeftWidth+c.borderRightWidth:c.paddingBottom+c.paddingTop+c.borderTopWidth+c.borderBottomWidth),a=Math.max(a,0),this.element.style[b?"width":"height"]=a+"px"}},m._emitCompleteOnItems=function(a,b){function c(){e.dispatchEvent(a+"Complete",null,[b])}function d(){g++,g==f&&c()}var e=this,f=b.length;if(!b||!f)return void c();var g=0;b.forEach(function(b){b.once(a,d)})},m.dispatchEvent=function(a,b,c){var d=b?[b].concat(c):c;if(this.emitEvent(a,d),i)if(this.$element=this.$element||i(this.element),b){var e=i.Event(b);e.type=a,this.$element.trigger(e,c)}else this.$element.trigger(a,c)},m.ignore=function(a){var b=this.getItem(a);b&&(b.isIgnored=!0)},m.unignore=function(a){var b=this.getItem(a);b&&delete b.isIgnored},m.stamp=function(a){a=this._find(a),a&&(this.stamps=this.stamps.concat(a),a.forEach(this.ignore,this))},m.unstamp=function(a){a=this._find(a),a&&a.forEach(function(a){d.removeFrom(this.stamps,a),this.unignore(a)},this)},m._find=function(a){return a?("string"==typeof a&&(a=this.element.querySelectorAll(a)),a=d.makeArray(a)):void 0},m._manageStamps=function(){this.stamps&&this.stamps.length&&(this._getBoundingRect(),this.stamps.forEach(this._manageStamp,this))},m._getBoundingRect=function(){var a=this.element.getBoundingClientRect(),b=this.size;this._boundingRect={left:a.left+b.paddingLeft+b.borderLeftWidth,top:a.top+b.paddingTop+b.borderTopWidth,right:a.right-(b.paddingRight+b.borderRightWidth),bottom:a.bottom-(b.paddingBottom+b.borderBottomWidth)}},m._manageStamp=j,m._getElementOffset=function(a){var b=a.getBoundingClientRect(),d=this._boundingRect,e=c(a),f={left:b.left-d.left-e.marginLeft,top:b.top-d.top-e.marginTop,right:d.right-b.right-e.marginRight,bottom:d.bottom-b.bottom-e.marginBottom};return f},m.handleEvent=d.handleEvent,m.bindResize=function(){a.addEventListener("resize",this),this.isResizeBound=!0},m.unbindResize=function(){a.removeEventListener("resize",this),this.isResizeBound=!1},m.onresize=function(){this.resize()},d.debounceMethod(f,"onresize",100),m.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},m.needsResizeLayout=function(){var a=c(this.element),b=this.size&&a;return b&&a.innerWidth!==this.size.innerWidth},m.addItems=function(a){var b=this._itemize(a);return b.length&&(this.items=this.items.concat(b)),b},m.appended=function(a){var b=this.addItems(a);b.length&&(this.layoutItems(b,!0),this.reveal(b))},m.prepended=function(a){var b=this._itemize(a);if(b.length){var c=this.items.slice(0);this.items=b.concat(c),this._resetLayout(),this._manageStamps(),this.layoutItems(b,!0),this.reveal(b),this.layoutItems(c)}},m.reveal=function(a){this._emitCompleteOnItems("reveal",a),a&&a.length&&a.forEach(function(a){a.reveal()})},m.hide=function(a){this._emitCompleteOnItems("hide",a),a&&a.length&&a.forEach(function(a){a.hide()})},m.revealItemElements=function(a){var b=this.getItems(a);this.reveal(b)},m.hideItemElements=function(a){var b=this.getItems(a);this.hide(b)},m.getItem=function(a){for(var b=0;b<this.items.length;b++){var c=this.items[b];if(c.element==a)return c}},m.getItems=function(a){a=d.makeArray(a);var b=[];return a.forEach(function(a){var c=this.getItem(a);c&&b.push(c)},this),b},m.remove=function(a){var b=this.getItems(a);this._emitCompleteOnItems("remove",b),b&&b.length&&b.forEach(function(a){a.remove(),d.removeFrom(this.items,a)},this)},m.destroy=function(){var a=this.element.style;a.height="",a.position="",a.width="",this.items.forEach(function(a){a.destroy()}),this.unbindResize();var b=this.element.outlayerGUID;delete l[b],delete this.element.outlayerGUID,i&&i.removeData(this.element,this.constructor.namespace)},f.data=function(a){a=d.getQueryElement(a);var b=a&&a.outlayerGUID;return b&&l[b]},f.create=function(a,b){var c=g(f);return c.defaults=d.extend({},f.defaults),d.extend(c.defaults,b),c.compatOptions=d.extend({},f.compatOptions),c.namespace=a,c.data=f.data,c.Item=g(e),d.htmlInit(c,a),i&&i.bridget&&i.bridget(a,c),c},f.Item=e,f}),function(a,b){"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],b):"object"==typeof module&&module.exports?module.exports=b(require("outlayer"),require("get-size")):a.Masonry=b(a.Outlayer,a.getSize)}(window,function(a,b){var c=a.create("masonry");return c.compatOptions.fitWidth="isFitWidth",c.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns(),this.colYs=[];for(var a=0;a<this.cols;a++)this.colYs.push(0);this.maxY=0},c.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var a=this.items[0],c=a&&a.element;this.columnWidth=c&&b(c).outerWidth||this.containerWidth}var d=this.columnWidth+=this.gutter,e=this.containerWidth+this.gutter,f=e/d,g=d-e%d,h=g&&1>g?"round":"floor";f=Math[h](f),this.cols=Math.max(f,1)},c.prototype.getContainerWidth=function(){var a=this._getOption("fitWidth"),c=a?this.element.parentNode:this.element,d=b(c);this.containerWidth=d&&d.innerWidth},c.prototype._getItemLayoutPosition=function(a){a.getSize();var b=a.size.outerWidth%this.columnWidth,c=b&&1>b?"round":"ceil",d=Math[c](a.size.outerWidth/this.columnWidth);d=Math.min(d,this.cols);for(var e=this._getColGroup(d),f=Math.min.apply(Math,e),g=e.indexOf(f),h={x:this.columnWidth*g,y:f},i=f+a.size.outerHeight,j=this.cols+1-e.length,k=0;j>k;k++)this.colYs[g+k]=i;return h},c.prototype._getColGroup=function(a){if(2>a)return this.colYs;for(var b=[],c=this.cols+1-a,d=0;c>d;d++){var e=this.colYs.slice(d,d+a);b[d]=Math.max.apply(Math,e)}return b},c.prototype._manageStamp=function(a){var c=b(a),d=this._getElementOffset(a),e=this._getOption("originLeft"),f=e?d.left:d.right,g=f+c.outerWidth,h=Math.floor(f/this.columnWidth);h=Math.max(0,h);var i=Math.floor(g/this.columnWidth);i-=g%this.columnWidth?0:1,i=Math.min(this.cols-1,i);for(var j=this._getOption("originTop"),k=(j?d.top:d.bottom)+c.outerHeight,l=h;i>=l;l++)this.colYs[l]=Math.max(k,this.colYs[l])},c.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var a={height:this.maxY};return this._getOption("fitWidth")&&(a.width=this._getContainerFitWidth()),a},c.prototype._getContainerFitWidth=function(){for(var a=0,b=this.cols;--b&&0===this.colYs[b];)a++;return(this.cols-a)*this.columnWidth-this.gutter},c.prototype.needsResizeLayout=function(){var a=this.containerWidth;return this.getContainerWidth(),a!=this.containerWidth},c}),angular.module("bootstrapSubmenu",[]).directive("submenu",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){$(c).submenupicker()},500)}}}]),function(){var a={};a.map=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d]));return c},a.filter=function(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c},a.find=function(a,b){var c;if("[object Array]"===Object.prototype.toString.call(a)){for(c=0;c<a.length;c++)if(b(a[c]))return a[c]}else for(c in a)if(b(a[c]))return a[c];return null},a.indexOf=function(a,b){var c;if("[object Array]"===Object.prototype.toString.call(a)){for(c=0;c<a.length;c++)if(b(a[c]))return c}else for(c in a)if(b(a[c]))return c;return-1},a.isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},a.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)};var b=this,c={};c.Server=function(a){a?this.ajaxRequest=a:this.ajaxRequest=$.ajax,this._cube_list=[],this._cubes={}},c.Server.prototype.cubeinfo=function(a){var b=$.grep(this._cube_list,function(b){return b.name==a});if(1!=b.length)throw"Found "+b.length+" cubes with name '"+a+"' in the cube list";return b[0]},c.Server.prototype.ajaxRequest=function(a){throw"Must implement ajaxRequest for server to process jquery-style $.ajax settings object"},c.Server.prototype.query=function(a,b,c,d,e,f){var g={dataType:"json",type:"GET"},h=null;return h=b.hasOwnProperty("name")?b.name:b,g.url=this.url+"cube/"+h+"/"+a,g.data=c,c&&c.cut&&(g.data.cut=g.data.cut.toString()),c&&c.drilldown&&(g.data.drilldown=g.data.drilldown.toString()),g.success=function(a){d(a)},g.error=function(a){e&&e(a)},g.complete=function(a){f&&f(a)},this.ajaxRequest(g)},c.Server.prototype.connect=function(a,b,c){var d=this;d.url=d._normalize_url(a);var e={dataType:"json",type:"GET"};e.url=d.url+"info",e.success=function(a,e,f){d.server_version=a.cubes_version,d.cubes_version=a.cubes_version,d.api_version=a.api_version,d.info=a,d.load_cube_list(b,c)},e.error=function(a,b,d){c&&c(a)},this.ajaxRequest(e)},c.Server.prototype._normalize_url=function(a){return"/"!=a[a.length-1]?a+"/":a},c.Server.prototype.load_cube_list=function(a,b){var c=this,d={dataType:"json",type:"GET"};return d.url=c.url+"cubes",d.success=function(b,d,e){c._cube_list=b,a&&a(c._cube_list)},d.error=function(a,c,d){b&&b(a)},this.ajaxRequest(d)},c.Server.prototype.get_cube=function(a,b,d){var e=this;if(a in this._cubes&&b){var f=$.Deferred();return f.error=function(){},setTimeout(function(){b(e._cubes[a]),f.resolve()},0),f}var g={dataType:"json",type:"GET"};return g.url=e.url+"cube/"+encodeURI(a)+"/model",g.success=function(d,f,g){var h=new c.Cube(d);e._cubes[a]=h,b&&b(h)},g.error=function(a,b,c){d&&d(a)},this.ajaxRequest(g)},c.Cube=function(b){this.name=b.name,!b.label||(this.label=b.label),!b.description||(this.description=b.description),!b.key||(this.key=b.key),!b.info||(this.info=b.info),!b.category||(this.category=b.category),!b.features||(this.features=b.features),this.measures=a.map(b.measures||[],function(a){return new c.Measure(a)}),this.aggregates=a.map(b.aggregates||[],function(a){return new c.MeasureAggregate(a)}),this.details=a.map(b.details||[],function(a){return new c.Attribute(a)}),this.dimensions=a.map(b.dimensions||[],function(a){return new c.Dimension(a)})},c.Cube.prototype.dimension=function(b){return a.isObject(b)?b:a.find(this.dimensions,function(a){return a.name===b})},c.Dimension=function(a){var b,d=this;if(d.name=a.name,d.label=a.name,!a.label||(d.label=a.label),!a.description||(d.description=a.description),!a.default_hierarchy_name||(d.default_hierarchy_name=a.default_hierarchy_name),!a.info||(d.info=a.info),!a.role||(d.role=a.role),!a.cardinality||(d.cardinality=a.cardinality),!a.nonadditive||(d.nonadditive=a.nonadditive),d.levels=[],a.levels)for(b in a.levels){var e=new c.Level(d.name,a.levels[b]);d.levels.push(e)}if(this.hierarchies={},a.hierarchies)for(b in a.hierarchies){var f=new c.Hierarchy(a.hierarchies[b],this);d.hierarchies[f.name]=f}!d.default_hierarchy_name&&a.hierarchies&&a.hierarchies.length>0&&(d.default_hierarchy_name=a.hierarchies[0].name)},c.Dimension.prototype.hierarchy=function(b){return a.isObject(b)?b:b?this.hierarchies[b]:this.hierarchies[this.default_hierarchy_name]},c.Dimension.prototype.level=function(b){return a.isObject(b)?b:a.find(this.levels,function(a){return a.name==b})},c.Dimension.prototype.toString=function(a){return this.name},c.Dimension.prototype.display_label=function(){return this.label||this.name},c.Dimension.prototype.hierarchy=function(b){return a.isObject(b)?b:null!=b?this.hierarchies[b]:this.hierarchies[this.default_hierarchy_name]},c.Hierarchy=function(a,b){this.parse(a,b)},c.Hierarchy.prototype.parse=function(b,c){var d=this;d.name=b.name,d.label=d.name,!b.label||(d.label=b.label),!b.description||(d.description=b.description),!b.info||(d.info=b.info);var e=b.levels||[];d.levels=a.map(e,function(a){return c.level(a)})},c.Hierarchy.prototype.toString=function(){return c.HIERARCHY_PREFIX_CHAR+this.name},c.Hierarchy.prototype.display_label=function(){return this.label||this.name},c.Level=function(a,b){this.parse(a,b)},c.Level.prototype.parse=function(a,b){var d,e=this;if(e.dimension_name=a,e.name=b.name,!b.label||(e.label=b.label),!b.description||(e.description=b.description),!b.info||(e.info=b.info),e._key=b.key,e._label_attribute=b.label_attribute,e._order_attribute=b.order_attribute,!b.role||(e.role=b.role),!b.cardinality||(e.cardinality=b.cardinality),e.nonadditive=b.nonadditive,e.attributes=[],b.attributes)for(d in b.attributes){var f=new c.Attribute(b.attributes[d]);e.attributes.push(f)}},c.Level.prototype.key=function(){var b=this._key,c=a.find(this.attributes,function(a){return a.name===b});return c||this.attributes[0]},c.Level.prototype.label_attribute=function(){var b=null;if(this._label_attribute){var c=this._label_attribute;b=a.find(this.attributes,function(a){return a.name===c})}return b||this.key()},c.Level.prototype.order_attribute=function(){var b=null,c=this._order_attribute;return c&&(b=a.find(this.attributes,function(a){return a.name===c})),b||this.label_attribute()},c.Level.prototype.toString=function(){return this.name},c.Level.prototype.display_name=function(){return this.label||this.name},c.Level.prototype.full_name=function(){return this.dimension_name+c.ATTRIBUTE_STRING_SEPARATOR_CHAR+this.name},c.Level.prototype.full_name_for_drilldown=function(){return this.dimension_name+c.DIMENSION_STRING_SEPARATOR_CHAR+this.name},c.Attribute=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.locales=a.locales},c.Measure=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.nonadditive=a.nonadditive,a.aggregates&&(this.aggregates=a.aggregates)},c.MeasureAggregate=function(a){this.ref=a.ref,this.name=a.name,this.label=a.label,this.order=a.order,this.locales=a.locales,this.info=a.info||{},this.description=a.description,this.format=a.format,this.missing_value=a.missing_value,this.nonadditive=a.nonadditive,this["function"]=a["function"],this.measure=a.measure},c.Browser=function(a,b){this.cube=b,this.server=a},c.Browser.prototype.full_cube=function(){return new c.Cell(this.cube)},c.Browser.prototype.aggregate=function(a,b){a||(a={});var c={};return a.cut&&(c.cut=a.cut.toString()),a.measure&&(c.measure=a.measure.toString()),a.drilldown&&(c.drilldown=a.drilldown.toString()),a.split&&(c.split=a.split.toString()),a.order&&(c.order=a.order.toString()),a.page&&(c.page=a.page),a.pagesize&&(c.pagesize=a.pagesize),this.server.query("aggregate",this.cube,a,b)},c.Browser.prototype.facts=function(a,b){a||(a={});var c={};return a.cut&&(c.cut=a.cut.toString()),a.order&&(c.order=a.order.toString()),a.page&&(c.page=a.page),a.pagesize&&(c.pagesize=a.pagesize),this.server.query("facts",this.cube,a,b)},c.Drilldown=function(b,c,d){if(!a.isObject(b))throw"Drilldown requires a Dimension object as first argument";if(this.dimension=b,this.hierarchy=b.hierarchy(c),this.level=b.level(d)||this.hierarchy.levels[0],!this.hierarchy)throw"Drilldown cannot recognize hierarchy "+c+" for dimension "+b;if(!this.level)throw"Drilldown cannot recognize level "+d+" for dimension "+b},c.Drilldown.prototype.toString=function(){return""+this.dimension+this.hierarchy+c.DIMENSION_STRING_SEPARATOR_CHAR+this.level},c.Drilldown.prototype.keysInResultCell=function(){var b=this,c=!1,d=a.filter(b.hierarchy.levels,function(a){return a.key()===b.level.key()&&(c=!0)||!c});return a.map(d,function(a){return a.key().ref})},c.Drilldown.prototype.labelsInResultCell=function(){var b=this,c=!1,d=a.filter(b.hierarchy.levels,function(a){return a.key()===b.level.key()&&(c=!0)||!c});return a.map(d,function(a){return a.label_attribute().ref})},c.Cell=function(b,c){this.cube=b,this.cuts=a.map(c||[],function(a){return a})},c.Cell.prototype.slice=function(a){for(var b=[],d=!1,e=0;e<this.cuts.length;e++){var f=this.cuts[e];f.dimension==a.dimension?(b.push(a),d=!0):b.push(f)}d||b.push(a);var g=new c.Cell(this.cube,b);return g},c.Cell.prototype.toString=function(){return a.map(this.cuts||[],function(a){return a.toString()}).join(c.CUT_STRING_SEPARATOR_CHAR)},c.Cell.prototype.cut_for_dimension=function(b){return a.find(this.cuts,function(a){return a.dimension.name==b})},c.PointCut=function(a,b,c,d){this.type="point",this.dimension=a,this.hierarchy=a.hierarchy(b),this.path=c,this.invert=!!d},c.PointCut.prototype.toString=function(){var a=c.string_from_path(this.path);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+a},c.SetCut=function(a,b,c,d){this.type="set",this.dimension=a,this.hierarchy=a.hierarchy(b),this.paths=c,this.invert=!!d},c.SetCut.prototype.toString=function(){var b=a.map(this.paths,c.string_from_path).join(c.SET_CUT_SEPARATOR_CHAR);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+b},c.RangeCut=function(a,b,c,d,e){if(this.type="range",this.dimension=a,this.hierarchy=a.hierarchy(b),null===c&&null===d)throw"Either from_path or to_path must be defined for RangeCut";this.from_path=c,this.to_path=d,this.invert=!!e},c.RangeCut.prototype.toString=function(){var a=c.string_from_path(this.from_path)+c.RANGE_CUT_SEPARATOR_CHAR+c.string_from_path(this.to_path);return(this.invert?c.CUT_INVERSION_CHAR:"")+this.dimension+(this.hierarchy||"")+c.DIMENSION_STRING_SEPARATOR_CHAR+a},c.CUT_INVERSION_CHAR="!",c.CUT_STRING_SEPARATOR_CHAR="|",c.DIMENSION_STRING_SEPARATOR_CHAR=":",c.ATTRIBUTE_STRING_SEPARATOR_CHAR=".",c.HIERARCHY_PREFIX_CHAR="@",c.PATH_STRING_SEPARATOR_CHAR=",",c.RANGE_CUT_SEPARATOR_CHAR="-",c.SET_CUT_SEPARATOR_CHAR=";",c.CUT_STRING_SEPARATOR=/\|/g,c.DIMENSION_STRING_SEPARATOR=/:/g,c.PATH_STRING_SEPARATOR=/,/g,c.RANGE_CUT_SEPARATOR=/-/g,c.SET_CUT_SEPARATOR=/;/g,c.PATH_PART_ESCAPE_PATTERN=/([\\!|:;,-])/g,c.PATH_PART_UNESCAPE_PATTERN=/\\([\\!|:;,-])/g,c.CUT_PARSE_REGEXP=new RegExp("^("+c.CUT_INVERSION_CHAR+"?)(\\w+)(?:"+c.HIERARCHY_PREFIX_CHAR+"(\\w+))?"+c.DIMENSION_STRING_SEPARATOR_CHAR+"(.*)$"),c.DRILLDOWN_PARSE_REGEXP=new RegExp("^(\\w+)(?:"+c.HIERARCHY_PREFIX_CHAR+"(\\w+))?(?:"+c.DIMENSION_STRING_SEPARATOR_CHAR+"(\\w+))?$"),c.NULL_PART_STRING="__null__",c.SPLIT_DIMENSION_STRING="__within_split__",c.SPLIT_DIMENSION=new c.Dimension({name:c.SPLIT_DIMENSION_STRING,label:"Matches Filters",hierarchies:[{name:"default",levels:[c.SPLIT_DIMENSION_STRING]}],levels:[{name:c.SPLIT_DIMENSION_STRING,attributes:[{name:c.SPLIT_DIMENSION_STRING}],label:"Matches Filters"}]}),c._split_with_negative_lookbehind=function(a,b,c){for(var d,e=a,f=[];null!=(d=b.exec(e));)e.substr(d.index-c.length,c.length)!=c&&(f.push(e.substring(0,d.index)),e=e.substring(Math.min(d.index+d[0].length,e.length)),b.lastIndex=0);return f.push(e),f},c._escape_path_part=function(a){return null==a?c.NULL_PART_STRING:a.toString().replace(c.PATH_PART_ESCAPE_PATTERN,function(a,b){return"\\"+b})},c._unescape_path_part=function(a){return a===c.NULL_PART_STRING?null:a.replace(c.PATH_PART_UNESCAPE_PATTERN,function(a,b){
return b})},c.string_from_path=function(b){var d=a.map(b||[],function(a){return c._escape_path_part(a)}).join(c.PATH_STRING_SEPARATOR_CHAR);return d},c.path_from_string=function(b){var d=c._split_with_negative_lookbehind(b,c.PATH_STRING_SEPARATOR,"\\"),e=a.map(d||[],function(a){return c._unescape_path_part(a)});return e},c.cut_from_string=function(b,d){var e=c.CUT_PARSE_REGEXP.exec(d);if(!e)return null;var f=!!e[1],g=e[2],h=e[3]||null,i=e[4],j=b.dimension(g),k=c._split_with_negative_lookbehind(i,c.SET_CUT_SEPARATOR,"\\");if(k.length>1)return new c.SetCut(j,h,a.map(k,function(a){return c.path_from_string(a)}),f);if(k=c._split_with_negative_lookbehind(i,c.RANGE_CUT_SEPARATOR,"\\"),2==k.length){var l=k[0]?c.path_from_string(k[0]):null,m=k[1]?c.path_from_string(k[1]):null;return new c.RangeCut(j,h,l,m,f)}return new c.PointCut(j,h,c.path_from_string(i),f)},c.cuts_from_string=function(b,d){var e=c._split_with_negative_lookbehind(d,c.CUT_STRING_SEPARATOR,"\\");return a.map(e||[],function(a){return c.cut_from_string(b,a)})},c.cell_from_string=function(a,b){return new c.Cell(a,c.cuts_from_string(a,b))},c.drilldown_from_string=function(a,b){var d=c.DRILLDOWN_PARSE_REGEXP.exec(b);if(!d)return null;var e=d[1],f=d[2]||null,g=d[3]||null,h=a.dimension(e);if(!h){if(e!==c.SPLIT_DIMENSION_STRING)return null;h=c.SPLIT_DIMENSION}return new c.Drilldown(h,f,g)},c.drilldowns_from_string=function(b,d){var e=c._split_with_negative_lookbehind(d,c.CUT_STRING_SEPARATOR,"\\");return a.map(e||[],function(a){return c.drilldown_from_string(b,a)})},c.drilldowns_to_string=function(b){return a.map(b,function(a){return a.toString()}).join(c.CUT_STRING_SEPARATOR_CHAR)},b.cubes=c}.call(this),cubes.Dimension.prototype.hierarchies_count=function(){var a=0;for(var b in this.hierarchies)this.hierarchies.hasOwnProperty(b)&&a++;return a},cubes.Dimension.prototype.default_hierarchy=function(){return this.hierarchies[this.default_hierarchy_name]},cubes.Dimension.prototype.isDateDimension=function(){return!("time"!=this.role||"cv-datefilter"in this.info&&1!=this.info["cv-datefilter"])},cubes.Cube.prototype.dateDimensions=function(){var a=[];for(var b in this.dimensions){var c=this.dimensions[b];c.isDateDimension()&&a.push(c)}return a},cubes.Cube.prototype.cvdim_dim=function(a){var b=a;return a.indexOf("@")>0?b=a.split("@")[0]:a.indexOf(":")>0&&(b=a.split(":")[0]),this.dimension(b)},cubes.Cube.prototype.dimensionPartsFromCut=function(a){var b=this.dimensionParts(a.dimension),c=(a.value.split(";")[0].match(/,/g)||[]).length+1,d=b.dimension.name+"@"+b.hierarchy.name+":"+b.hierarchy.levels[c-1].name;return this.dimensionParts(d)},cubes.Cube.prototype.dimensionParts=function(a){if(!a)return null;var b=this.cvdim_dim(a),c=b.default_hierarchy();if(a.indexOf("@")>0){var d=a.split("@")[1].split(":")[0];c=b.hierarchy(d)}var e=null,f=0;if(a.indexOf(":")>0){var g=a.split(":")[1];for(e=b.level(g),f=0;f<c.levels.length&&c.levels[f]!=e;f++);}else e=b.level(c.levels[0]);for(var h=null,i=0;i<c.levels.length;i++)if(e.name==c.levels[i]){h=i+1;break}return{dimension:b,level:e,levelIndex:f,depth:h,hierarchy:c,label:b.label+("default"!=c.name?" - "+c.label:"")+(c.levels.length>1?" / "+e.label:""),labelShort:b.label+(c.levels.length>1?" / "+e.label:""),labelNoLevel:b.label+("default"!=c.name?" - "+c.label:""),fullDrilldownValue:b.name+("default"!=c.name?"@"+c.name:"")+":"+e.name,drilldownDimension:b.name+"@"+c.name+":"+e.name,drilldownDimensionPlus:c.levels.length>1&&f<c.levels.length-1?b.name+"@"+c.name+":"+c.levels[f+1].name:null,drilldownDimensionMinus:c.levels.length>1&&f>0?b.name+"@"+c.name+":"+c.levels[f-1].name:null,cutDimension:b.name+("default"!=c.name?"@"+c.name:"")}},cubes.Cube.prototype.measureAggregates=function(a){var b=$.grep(this.aggregates,function(b){return a?b.measure==a:!b.measure});return b},cubes.Cube.prototype.aggregateFromName=function(a){var b=$.grep(this.aggregates,function(b){return a?b.name==a:!b.measure});return 1==b.length?b[0]:null},cubes.Level.prototype.readCell=function(a){if(!(this.key().ref in a))return null;var b={};return b.key=a[this.key().ref],b.label=a[this.label_attribute().ref],b.orderValue=a[this.order_attribute().ref],b.info={},$(this.attributes).each(function(c,d){b.info[d.ref]=a[d.ref]}),b},cubes.Hierarchy.prototype.readCell=function(a,b){for(var c=[],d=0;d<this.levels.length;d++){var e=this.levels[d],f=e.readCell(a);if(null!=f&&c.push(f),void 0!=b&&null!=b&&b.name==e.name)break}return c},angular.module("cv.cubes",["cubesConfigurationModule"]),angular.module("cv.cubes").service("cubesService",["$rootScope","$log","cvOptions",function(a,b,c){var d=this;this.cubesserver=null,this.state=cubesviewer.VIEW_STATE_INITIALIZING,this.stateText="",this.initialize=function(){},this.isConnected=function(){return d.state===cubesviewer.VIEW_STATE_INITIALIZED},this.connect=function(){this.cubesserver=new cubes.Server(d._cubesAjaxHandler),console.debug("Cubes client connecting to: "+c.cubesUrl),this.cubesserver.connect(c.cubesUrl,function(){b.debug("Cubes client initialized (server version: "+d.cubesserver.server_version+")"),d.state=cubesviewer.VIEW_STATE_INITIALIZED,a.$apply()},function(b){console.debug(b),console.debug("Could not connect to Cubes server [code="+b.status+"]"),d.state=cubesviewer.VIEW_STATE_ERROR,401==b.status?d.stateText="Unauthorized.":403==b.status?d.stateText="Forbidden.":400==b.status?d.stateText="Bad request: "+$.parseJSON(b.responseText).message:d.stateText="Unknown error.",a.$apply()})},this._cubesAjaxHandler=function(a){return d.cubesRequest(a.url,a.data||[],a.success,a.error)},this.cubesRequest=function(a,e,f,g){"/"==a.charAt(0)&&(a=c.cubesUrl+a),c.debug&&b.debug("Cubes request: "+a+" ("+JSON.stringify(e)+")");var h=$.get(a,e,d._cubesRequestCallback(f),c.jsonRequestType);return h.fail(g||d.defaultRequestErrorHandler),h},this._cubesRequestCallback=function(a){return function(b,c){a(b)}},this.defaultRequestErrorHandler=function(a,c,d){b.error("Cubes request error: "+a)},this.buildBrowserArgs=function(a,b,c){var d={};if(!c){var e=a.params.drilldown.slice(0);b&&e.splice(0,0,a.params.xaxis);for(var f=0;f<e.length;f++)e[f]=cubes.drilldown_from_string(a.cube,a.cube.dimensionParts(e[f]).fullDrilldownValue);e.length>0&&(d.drilldown=cubes.drilldowns_to_string(e))}var g=this.buildQueryCuts(a);return g.length>0&&(d.cut=new cubes.Cell(a.cube,g)),d},this.buildQueryCutsStrings=function(a){var b=[];return $(a.params.cuts).each(function(c,d){var e=d.invert?"!":"",f=a.cube.dimensionParts(d.dimension),g=f.dimension.name+("default"!=f.hierarchy.name?"@"+f.hierarchy.name:"");b.push(e+g+":"+d.value.replace("-","\\-"))}),$(a.params.datefilters).each(function(c,e){var f=d.datefilterValue(a,e);null!=f&&b.push(e.dimension+":"+f)}),b},this.buildQueryCuts=function(a){var b=[],c=d.buildQueryCutsStrings(a);return $(c).each(function(c,d){b.push(cubes.cut_from_string(a.cube,d))}),b},this.datefilterValue=function(a,b){var c=null,e=null;if(0==b.mode.indexOf("auto-")?"auto-last1m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-1)):"auto-last3m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-3)):"auto-last6m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-6)):"auto-last12m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-12)):"auto-last24m"==b.mode?(c=new Date,c.setMonth(c.getMonth()-24)):"auto-january1st"==b.mode?(c=new Date,c.setMonth(0),c.setDate(1)):"auto-yesterday"==b.mode&&(c=new Date,c.setDate(c.getDate()-1),e=new Date,e.setDate(c.getDate()-1)):"custom"==b.mode&&(null!=b.date_from&&""!=b.date_from&&(c=new Date(b.date_from)),null!=b.date_to&&""!=b.date_to&&(e=new Date(b.date_to))),null!=c||null!=e){var f="";return null!=c&&(f+=d._datefiltercell(a,b,c)),f+="-",null!=e&&(f+=d._datefiltercell(a,b,e)),f}return null},this._datefiltercell=function(a,b,c){for(var d=[],e=a.cube.dimensionParts(b.dimension),f=0;f<e.hierarchy.levels.length;f++){var g=e.hierarchy.levels[f],h=g.role;"year"==h?d.push(c.getFullYear()):"month"==h?d.push(c.getMonth()+1):"quarter"==h?d.push(Math.floor(c.getMonth()/3)+1):"week"==h?d.push(this._weekNumber(c)):"day"==h?d.push(c.getDate()):dialogService.show("Wrong configuration of model: time role of level '"+g.name+"' is invalid.")}return d.join(",")},this._weekNumber=function(a){a=new Date(a),a.setHours(0,0,0);var b=new Date(a.getFullYear(),0,1),c=Math.ceil(((a-b)/864e5+1)/7);return c},this.getKeyForDataRow=function(a){return a.key?a.key:a.key0?a.key0:void 0},this.initialize()}]),angular.module("cv.cubes").service("cubesCacheService",["$rootScope","$log","cvOptions","cubesService",function(a,b,c,d){var e=this;this.cache={},this._cacheOverridedCubesRequest=null,this.initialize=function(){return this._cacheOverridedCubesRequest?void b.warn("Error: tried to initialize CubesCacheService but it was already initialized."):void(c.cacheEnabled&&(b.debug("Replacing Cubes request method with caching version."),e._cacheOverridedCubesRequest=d.cubesRequest,d.cubesRequest=e.cachedCubesRequest))},this.cachedCubesRequest=function(a,d,f,g){e._cacheCleanup();var h=a+"?"+$.param(d),i=null;if(h in e.cache&&c.cacheEnabled){var j=Math.round(((new Date).getTime()-e.cache[h].time)/1e3);j>c.cacheNotice&&b.debug("Data loaded from cache ("+Math.floor(j/60,2)+" minutes old)"),i=$.Deferred(),i.error=function(){},setTimeout(function(){f(e.cache[h].data),i.resolve()},0)}else i=e._cacheOverridedCubesRequest(a,d,e._cacheCubesRequestSuccess(f,h),g);return i},this._cacheCleanup=function(){var a=c.cacheDuration,b=c.cacheSize,d=(new Date).getTime()-1e3*a,f=[];for(var g in e.cache)e.cache[g].time<d?delete e.cache[g]:f.push(g);if(f.sort(function(a,b){return e.cache[a].time-e.cache[b].time}),f.length>=b)for(var h=0;h<f.length-b;h++)delete e.cache[f[h]]},this._cacheCubesRequestSuccess=function(a,b){return function(c){e.cache[b]={time:(new Date).getTime(),data:c},a(c)}}}]),angular.module("cv",["ui.bootstrap","bootstrapSubmenu","ui.grid","ui.grid.resizeColumns","ui.grid.selection","ui.grid.autoResize","ui.grid.pagination","ui.grid.pinning","ngCookies","cubesConfigurationModule","cv.cubes","cv.views"]),angular.module("cv").config(["$logProvider","cvOptions",function(a,b){var c={jsonRequestType:"json",pagingOptions:[15,30,100,250],cacheEnabled:!0,cacheDuration:1800,cacheNotice:600,cacheSize:32,datepickerShowWeeks:!0,datepickerFirstDay:1,undoEnabled:!0,undoSize:32,seriesOperationsEnabled:!1,hideControls:!1,gaTrackEvents:!1,debug:!1};$.extend(c,b),$.extend(b,c),a.debugEnabled(b.debug)}]),angular.module("cv").run(["$timeout","$log","cvOptions","cubesService","cubesCacheService","cubesConfigurationService",function(a,b,c,d,e,f){b.debug("CubesViewer debug mode is enabled."),e.initialize(),f.bus().$on("cubesUrlChanged",d.connect.bind(d))}]);var cubesviewer=new CubesViewer;cubesviewer.View=function(a,b,c){var d={};return d.id="_cv-view-"+b,d.type=c,d.cvOptions=a,d.state=cubesviewer.VIEW_STATE_INITIALIZING,d.error="",d.params={},d.savedId=0,d.owner=a.user,d.shared=!1,d.getControlsHidden=function(){return!!d.params.controlsHidden||!!d.cvOptions.hideControls},d.setControlsHidden=function(a){d.params.controlsHidden=a},d},angular.module("cv.views",["cv.views.cube"]),angular.module("cv.views").service("viewsService",["$rootScope","$window","cvOptions","cubesService","dialogService",function(a,b,c,d,e){this.resetService=function(){this.views=[],this.lastViewId=0,this.studioViewsService=null},this.resetService(),this.createView=function(a,b){this.lastViewId++;var d={};if("string"==typeof b)try{d=$.parseJSON(b)}catch(f){console.debug("Error: could not process serialized data (JSON parse error)"),e.show("Error: could not process serialized data (JSON parse error)."),d.name="Undefined view"}else d=b;var g=cubesviewer.CubeView(c,this.lastViewId,a);return $.extend(g.params,d),g},this.serializeView=function(a){return angular.toJson(a.params)}}]),angular.module("cv.views").service("dialogService",["$rootScope","$modal","cvOptions","cubesService",function(a,b,c,d){this.initialize=function(){$("body").append('<div class="cv-modals cv-bootstrap"></div>')},this.show=function(a){var c=b.open({animation:!0,templateUrl:"dialog/dialog.html",controller:"CubesViewerViewsDialogController",appendTo:angular.element($("body").find(".cv-modals")[0]),resolve:{dialog:function(){return{text:a}}}});c.result.then(function(a){},function(){})},this.initialize()}]),angular.module("cv.views").controller("CubesViewerViewsDialogController",["$rootScope","$scope","$timeout","$modalInstance","cvOptions","cubesService","viewsService","dialog",function(a,b,c,d,e,f,g,h){b.$rootScope=a,b.dialog=h,b.close=function(){d.dismiss("cancel")}}]),cubesviewer.CubeView=function(a,b,c){var d=cubesviewer.View(a,b,c);return d.resultLimitHit=!1,d.requestFailed=!1,d.pendingRequests=0,d.dimensionFilter=null,d._invalidatedData=!0,d._invalidatedDefs=!0,d.grid={api:null,data:[],columnDefs:[]},d.invalidateData=function(){d._invalidatedData=!0},d.invalidateDefs=function(){d._invalidatedData=!0,d._invalidatedDefs=!0},d.setViewMode=function(a){d.params.mode=a,d.invalidateDefs()},d},angular.module("cv.views.cube",["angular-bind-html-compile"]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeController",["$rootScope","$log","$window","$injector","$scope","$timeout","cvOptions","cubesService","viewsService","exportService","rowSorter","dialogService",function($rootScope,$log,$window,$injector,$scope,$timeout,cvOptions,cubesService,viewsService,exportService,rowSorter,dialogService){$scope.viewController={},$scope.$rootScope=$rootScope,$scope.viewsService=viewsService,$scope.cvOptions=cvOptions,$scope.cubesService=cubesService,$scope.exportService=exportService,$scope.refreshView=function(){$scope.view&&$scope.view.cube&&($scope.$emit("ViewRefresh",$scope.view),$scope.$broadcast("ViewRefresh",$scope.view))},$scope.setViewMode=function(a){$scope.$emit("ViewModeChanged",$scope.view),$scope.view.setViewMode(a)},$scope.initCube=function(){if($scope.view){$scope.view.cube=null;var a={mode:"explore",drilldown:[],cuts:[],datefilters:[],columnHide:{},columnWidths:{},columnSort:{}},b=cubesService.cubesserver.get_cube($scope.view.params.cubename,function(b){$scope.view.cube=b,"cv-view-params"in $scope.view.cube.info?$scope.view.params=$.extend({},a,$scope.view.cube.info["cv-view-params"],$scope.view.params):$scope.view.params=$.extend({},a,$scope.view.params),$scope.view.state=cubesviewer.VIEW_STATE_INITIALIZED,$scope.view.error="",$rootScope.$apply()});b.fail(function(a){var b=a.responseJSON;$scope.view.state=cubesviewer.VIEW_STATE_ERROR,$scope.view.error="Error loading model: "+b.message+" ("+b.error+")",console.debug(b),$rootScope.$apply()})}},$scope.requestErrorHandler=function(){$scope.view.requestFailed=!0},$scope.resetGrid=function(){rowSorter.colSortFnCache={}},$scope.onGridRegisterApi=function(a){$scope.view.grid.api=a,a.core.on.columnVisibilityChanged($scope,function(a){a.visible?delete $scope.view.params.columnHide[a.field]:($scope.view.params.columnHide[a.field]=!0,delete $scope.view.params.columnWidths[a.field]),$scope.view.updateUndo()}),a.core.on.sortChanged($scope,function(a,b){$scope.view.params.columnSort[$scope.view.params.mode]={},$(b).each(function(a,b){$scope.view.params.columnSort[$scope.view.params.mode][b.field]={direction:b.sort.direction,priority:b.sort.priority}}),$scope.view.updateUndo()}),a.colResizable&&a.colResizable.on.columnSizeChanged($scope,function(b,c){var d=-1;$(a.grid.columns).each(function(a,c){c.field==b.field&&(d=a)}),d>=0&&($scope.view.params.columnWidths[b.field]=a.grid.columns[d].width),$scope.view.updateUndo()})},$scope.view&&($scope.view.grid.onRegisterApi=$scope.onGridRegisterApi),$scope.validateData=function(a,b){$scope.view.requestFailed=!1,$scope.view.resultLimitHit=!1,("cells"in a&&a.cells.length>=cubesService.cubesserver.info.json_record_limit||a.length&&a.length>=cubesService.cubesserver.info.json_record_limit)&&($scope.view.resultLimitHit=!0)},$scope.newViewStateKey=function(){return $scope._viewStateKey=Math.floor(999999999999*Math.random()),$scope._viewStateKey},$scope.selectDrill=function(a,b){$scope.view.cube;a?($scope.removeDrill(a),1==b&&$scope.view.params.drilldown.push(a)):$scope.view.params.drilldown=[],$scope.refreshView()},$scope.removeDrill=function(a){$scope.view.params.drilldown=$.grep($scope.view.params.drilldown,function(b){return $scope.view.cube.dimensionParts(b).dimension.name==$scope.view.cube.dimensionParts(a).dimension.name},!0),$scope.refreshView()},$scope.columnFormatFunction=function(agmes){var view=$scope.view,measure=agmes;if(!measure)return function(a){return a};"measure"in agmes&&(measure=$.grep(view.cube.measures,function(a,b){return a.ref==agmes.measure})[0]);var formatterFunction=null;return formatterFunction="cv-formatter"in agmes.info?function(value,row){return eval(agmes.info["cv-formatter"])}:function(a){return Math.formatnumber(a,"record_count"==agmes.ref?0:2)}},$scope.selectCut=function(a,b,c){var d=$scope.view;if(a)if(b){d.params.cuts=$.grep(d.params.cuts,function(b){return d.cube.dimensionParts(b.dimension).cutDimension==d.cube.dimensionParts(a).cutDimension},!0);var e=_.map(b,function(a){return a.value}).join(";"),f=d.cube.dimensionParts(a).dimension,g=[];f.info["cv-boolean-label"]?(_.each(b,function(a){var b=f.info["cv-boolean-label"][a.value];b&&g.push(b)}),g=g.join(" / ")):g=_.map(b,function(a){return a.label}).join(" / "),d.params.cuts.push({dimension:a,value:e,label:g,invert:c})}else d.params.cuts=$.grep(d.params.cuts,function(b){return d.cube.dimensionParts(b.dimension).cutDimension==d.cube.dimensionParts(a).cutDimension},!0);else d.params.cuts=[];$scope.refreshView()},$scope.filterSelected=function(){var a=$scope.view;if(1!=a.params.drilldown.length)return void dialogService.show("Só é possível filtrar valores múltiplos em uma visualização com um nível de detalhamento.");if(a.grid.api.selection.getSelectedCount()<=0)return void dialogService.show("Não é possível filtrar. Não há dados selecionados.");var b=[],c=a.grid.api.selection.getSelectedRows();$(c).each(function(a,c){b.push({value:c.key0.cutValue,label:c.key0.title||c.key0.label||c.key0.name})});var d=!1;$scope.selectCut(a.grid.columnDefs[0].cutDimension,b,d)},$scope.showDimensionFilter=function(a){var b=$scope.view.cube.dimensionParts(a);$scope.view.dimensionFilter&&$scope.view.dimensionFilter==b.drilldownDimension?$scope.view.dimensionFilter=null:$scope.view.dimensionFilter=b.drilldownDimension},$scope.selectMeasure=function(a){$scope.view.params.yaxis=a,$scope.refreshView()},$scope.selectQuantityFilter=function(){$scope.view.quantity_filter_open=!0,$scope.refreshView()},$scope.resetQuantityFilter=function(){$scope.view.quantity_filter_open=!1,$scope.view.params.quantity_filter=null,$scope.refreshView()},$scope.selectXAxis=function(a){$scope.view.params.xaxis=""==a?null:a,$scope.refreshView()},$scope.selectChartType=function(a){$scope.view.params.charttype=a,$scope.refreshView()},$scope.selectCalculation=function(a){$scope.view.params.calculation=a,$scope.refreshView()},$scope.showSerializeView=function(a){studioViewsService.studioScope.showSerializeView(a)},$scope.selectDateFilter=function(a,b){var c=$scope.view;c.cube;if(""!=a){if("1"==b)c.params.datefilters.push({dimension:a,mode:"auto-last3m",date_from:null,date_to:null});else for(var d=0;d<c.params.datefilters.length;d++)if(c.params.datefilters[d].dimension.split(":")[0]==a){c.params.datefilters.splice(d,1);break}}else c.params.datefilters=[];$scope.refreshView()},$scope.clearFilters=function(){$scope.view.params.cuts=[],$scope.view.params.datefilters=[],$scope.refreshView()},$scope.defineColumnWidth=function(a,b){return a in $scope.view.params.columnWidths?$scope.view.params.columnWidths[a]:b},$scope.defineColumnSort=function(a){var b=null;return $scope.view.params.columnSort[$scope.view.params.mode]&&$scope.view.params.columnSort[$scope.view.params.mode][a]&&(b={direction:$scope.view.params.columnSort[$scope.view.params.mode][a].direction,priority:$scope.view.params.columnSort[$scope.view.params.mode][a].priority}),b},$scope.sortValues=function(a,b){return"number"==typeof a&&"number"==typeof b?a-b:"string"==typeof a&&"string"==typeof b?$.isNumeric(a)&&$.isNumeric(b)?parseFloat(a)-parseFloat(b):a.localeCompare(b):null==a&&null==b?0:null==a?1:null==b?-1:a-b},$scope.sortDimensionParts=function(a){var b=a,c=function(a,c,d,e,f){for(var g=0,h=0;0==g&&h<b.hierarchy.levels.length;h++){var i=b.hierarchy.levels[h],j=i.order_attribute(),k=j.ref;if(!(k in d.entity._cell&&k in e.entity._cell))break;g=$scope.sortValues(d.entity._cell[k],e.entity._cell[k])}return g};return c},$scope.sortDimensionLevel=function(a){var b=function(b,c,d,e,f){var g=0,h=a.order_attribute(),i=h.ref;return i in d.entity._cell&&i in e.entity._cell&&(g=$scope.sortValues(d.entity._cell[i],e.entity._cell[i])),g};return b},$scope.onResize=function(){$rootScope.$broadcast("ViewResize")},angular.element($window).on("resize",$scope.onResize),$scope.$on("$destroy",function(){angular.element($window).off("resize",$scope.onResize)})}]).directive("cvViewCube",function(){return{restrict:"A",templateUrl:"views/cube/cube.html",scope:{view:"="},controller:"CubesViewerViewsCubeController",link:function(a,b,c){a.initCube()}}}),Math.formatnumber=function(a,b,c,d){if(void 0===a)return"";void 0===b&&(b=2),void 0===c&&(c="."),void 0===d&&(d=" ");for(var e="",f=Math.abs(a),g=Math.floor(f).toString(),h=0;h<g.length;h++){e+=g[h];var i=g.length-h-1;i>0&&i%3==0&&(e+=d)}return b>0&&(e+=parseFloat(f-Math.floor(f)).toFixed(b).toString().replace(".",c).substring(1)),a<0&&(e="-"+e),e},angular.module("cv.views.cube").controller("CubesViewerViewsCubeExploreController",["$rootScope","$scope","$timeout","cvOptions","cubesService","viewsService","dialogService","uiGridConstants",function(a,b,c,d,e,f,g,h){b.view.grid.enableRowSelection=!0,b.view.grid.enableRowHeaderSelection=!0,b.initialize=function(){b.refreshView()},b.$on("ViewRefresh",function(a){b.loadData()}),b.loadData=function(){var c=e.buildBrowserArgs(b.view,!1,!1),d=new cubes.Browser(e.cubesserver,b.view.cube),f=b.newViewStateKey(),g=d.aggregate(c,b._loadDataCallback(f));b.view.pendingRequests++,g.always(function(){b.view.pendingRequests--,a.$apply()}),g.error(b.requestErrorHandler)},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),b.processData(d),a.$apply())}},b.exploreCut=function(a,c,d){if(b.selectCut(a,c,d),1==b.view.params.drilldown.length){var e=b.view.cube.dimensionParts(b.view.params.drilldown[0]);if(e.levelIndex<e.hierarchy.levels.length-1){var f=e.dimension.name+("default"!=e.hierarchy.name?"@"+e.hierarchy.name:"")+":"+e.hierarchy.levels[e.levelIndex+1].name;b.selectDrill(f,!0)}}},b.processData=function(c){var f=b.view;b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply(),angular.extend(f.grid,{data:[],rowHeight:24,onRegisterApi:b.onGridRegisterApi,enableColumnResizing:!0,showColumnFooter:!0,enableGridMenu:!d.readOnly,enableHiding:!d.readOnly,allowCellFocus:!d.readOnly,enableSorting:!d.readOnly,enableFiltering:!1,paginationPageSizes:d.pagingOptions,paginationPageSize:d.pagingOptions[0],enableRowSelection:f.params.drilldown.length>0,enablePinning:!1,multiSelect:!d.readOnly,selectionRowHeaderWidth:20,columnDefs:[]}),$(f.cube.aggregates).each(function(a,d){var e={name:d.label,field:d.ref,index:d.ref,cellClass:"text-right",type:"number",width:b.defineColumnWidth(d.ref,115),visible:!f.params.columnHide[d.ref],cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ col.colDef.formatter(COL_FIELD, row, col) }}</div>',formatter:b.columnFormatFunction(d),sort:b.defineColumnSort(d.ref)};e.footerValue=b.columnFormatFunction(d)(c.summary[d.ref],null,e),e.footerCellTemplate='<div class="ui-grid-cell-contents text-right">{{ col.colDef.footerValue }}</div>',f.grid.columnDefs.push(e)}),b._sortData(c),b._addRows(c);var g=[];$(f.params.drilldown).each(function(a,b){g.push(f.cube.cvdim_dim(b).label)});for(var h=0;h<f.params.drilldown.length;h++){var i=(f.cube.cvdim_dim(f.params.drilldown[h]),f.cube.dimensionParts(f.params.drilldown[h])),j=f.params.drilldown[h],k="";0==h&&(k=0==e.buildQueryCuts(f).length?"<b>Sumário</b>":'<b>Sumário <i style="color: #333;">(Filtrado)</i></b>'),f.grid.columnDefs.splice(h,0,{name:g[h],field:"key"+h,index:"key"+h,enableHiding:!1,cutDimension:j,width:b.defineColumnWidth("key"+h,190),cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ COL_FIELD.title }}</div>',footerCellTemplate:'<div class="ui-grid-cell-contents">'+k+"</div>",sort:b.defineColumnSort("key"+h),sortingAlgorithm:b.sortDimensionParts(i)})}0==f.params.drilldown.length&&f.grid.columnDefs.splice(0,0,{name:f.cube.label,field:"key0",index:"key0",enableHiding:!1,align:"left",width:b.defineColumnWidth("key0",190),sort:b.defineColumnSort("key0")})},b._addRows=function(a){var c=b.view,d=c.grid.data;if($(a.cells).each(function(a,b){for(var e=[],f={},g=[],h=0;h<c.params.drilldown.length;h++){var i=(c.cube.cvdim_dim(c.params.drilldown[h]),c.cube.dimensionParts(c.params.drilldown[h])),j=i.hierarchy.readCell(b,i.level),k=[],l=[];$(j).each(function(a,b){if(k.push(b.key),i.dimension.info["cv-boolean-label"]){var c=i.dimension.info["cv-boolean-label"][b.key];if(c)return void l.push(c)}l.push(b.label)}),e.push(k.join("-"));i.dimension.name+("default"!=i.hierarchy.name?"@"+i.hierarchy.name:"");g.push({cutValue:k.join(","),title:l.join(" / ")})}f.key=g.join(" / ");for(var h=0;h<g.length;h++)f["key"+h]=g[h];$(c.cube.aggregates).each(function(a,c){f[c.ref]=b[c.ref]}),f.id=e.join("-"),f._cell=b,d.push(f)}),0==d.length&&a.summary){var f={},g=0==e.buildQueryCuts(c).length?"Sumário":"Sumário (Filtrado)";f.key0=g,$(c.cube.aggregates).each(function(b,c){f[c.ref]=a.summary[c.ref]}),d.push(f)}},b._sortData=function(a){var c;_.each(b.view.grid.columnDefs,function(a){a.sort&&0===a.sort.priority&&(c=a.sort,c.field=a.field)}),c&&a.cells&&a.cells.sort(function(a,b){var d,e;return"desc"==c.direction?(d=b[c.field],e=a[c.field]):(d=a[c.field],e=b[c.field]),"number"==typeof d&&"number"==typeof e?d-e:"string"==typeof d&&"string"==typeof e?$.isNumeric(d)&&$.isNumeric(e)?parseFloat(d)-parseFloat(e):d.localeCompare(e):null==d&&null==e?0:null==d?1:null==e?-1:d-e})},b.$on("$destroy",function(){b.view.grid.data=[],b.view.grid.columnDefs=[]}),b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFilterDimensionController",["$rootScope","$scope","$filter","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f){b.parts=null,b.dimensionValues=null,b.loadingDimensionValues=!1,b.searchString="",b.selectedValues=null,b.filterInverted=null,b.filterShowAll=!1,b.currentDataId=null,b.initialize=function(){for(var a=b.view,c=a.cube.dimensionParts(b.view.dimensionFilter),d=0;d<a.params.cuts.length;d++)if(a.params.cuts[d].dimension==c.cutDimension){b.filterInverted=a.params.cuts[d].invert;break}},b.$watch("view.dimensionFilter",function(){b.parts=b.view.cube.dimensionParts(b.view.dimensionFilter),b.loadDimensionValues()}),b.$on("ViewRefresh",function(a){b.loadDimensionValues()}),b.$watch("filterShowAll",function(a){b.loadDimensionValues()}),b.closeDimensionFilter=function(){b.view.dimensionFilter=null},b.loadDimensionValues=function(){var a={hierarchy:b.parts.hierarchy.name,depth:b.parts.depth};if(!b.filterShowAll){var c=b.view.cube.dimensionParts(b.view.dimensionFilter),d=e.buildQueryCutsStrings(b.view);d.length>0&&(d=$.grep(d,function(a){return 0!=a.indexOf(c.dimension.name)&&0!=a.indexOf("!"+c.dimension.name)}),a.cut=d.join(cubes.CUT_STRING_SEPARATOR_CHAR))}var f="/cube/"+b.view.cube.name+"/members/"+b.parts.dimension.name,g=f+"?"+$.param(a);if(b.currentDataId!=g){b.currentDataId=g;var h=b.view.dimensionFilter;b.loadingDimensionValues=!0;var i=e.cubesRequest(f,a,b._loadDimensionValuesCallback(h));i.always(function(){b.loadingDimensionValues=!1,b.$apply()})}},b._loadDimensionValuesCallback=function(a){var a=a;return function(c,d){b.view.dimensionFilter==a&&b._processData(c)}},b.filterDimensionValue=function(a){return function(b){var c=a.toLowerCase();return""==a||b.label.toLowerCase().indexOf(c)>=0}},b.selectAll=function(){var a=b.filterDimensionValue(b.searchString);$(b.dimensionValues).each(function(b,c){a(c)&&(c.selected=!0)})},b.selectNone=function(){var a=b.filterDimensionValue(b.searchString);$(b.dimensionValues).each(function(b,c){a(c)&&(c.selected=!1)})},b._processData=function(a){for(var c=b.view,d=(b.view.cube.cvdim_dim(b.view.dimensionFilter),[]),e=(c.cube.dimensionParts(b.view.dimensionFilter),b.view.dimensionFilter),f=[],g=0;g<c.params.cuts.length;g++)if(c.params.cuts[g].dimension==e){b.filterInverted=c.params.cuts[g].invert,f=c.params.cuts[g].value.split(";");break}$(a.data).each(function(a,c){var e=b.view.cube.dimensionParts(b.view.dimensionFilter),g=e.hierarchy.readCell(c,e.level),h=[],i=[];$(g).each(function(a,b){if(h.push(b.key),e.dimension.info["cv-boolean-label"]){var c=e.dimension.info["cv-boolean-label"][b.key];if(c)return void i.push(c)}i.push(b.label)}),d.push({label:i.join(" / "),value:h.join(","),selected:f.indexOf(h.join(","))>=0})}),b.dimensionValues=d,b.$apply()},b.applyFilter=function(){var a=(b.view,[]);$(b.dimensionValues).each(function(b,c){c.selected&&a.push(c)});var c=b.parts.dimension.name+("default"!=b.parts.hierarchy.name?"@"+b.parts.hierarchy.name:"")+":"+b.parts.level.name;b.selectCut(c,a,b.filterInverted)},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFilterQuantityController",["$rootScope","$scope","$filter","cvOptions","cubesService","viewsService",function(a,b){b.quantity_filter={order:"top"},b.applyFilter=function(){var a=parseInt(b.quantity_filter.amount,10);isNaN(a)||(b.view.params.quantity_filter=b.quantity_filter),b.closeQuantityFilter(),b.refreshView()},b.closeQuantityFilter=function(){b.view.quantity_filter_open=!1}}]),angular.module("cv.views.cube").filter("datefilterMode",["$rootScope","cvOptions",function(a,b){return function(a){var b="None";switch(a){case"custom":b="Personalizado";break;case"auto-last1m":b="Último mês";break;case"auto-last3m":b="Últimos 3 meses";break;case"auto-last6m":b="Últimos 6 meses";break;case"auto-last12m":b="Último ano";break;case"auto-last24m":b="Últimos 2 anos";break;case"auto-january1st":b="Desde 1 de Janeiro";break;case"auto-yesterday":b="Ontem"}return b}}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFilterDateController",["$rootScope","$scope","$filter","cvOptions","cubesService","viewsService","PeriodSelectorService",function(a,b,c,d,e,f,g){b.initialize=function(){b.dateStart.value=b.datefilter.date_from?new Date(b.datefilter.date_from):null,b.dateEnd.value=b.datefilter.date_to?new Date(b.datefilter.date_to):null},b.dateStart={opened:!1,value:null,options:{formatYear:"yyyy",startingDay:d.datepickerFirstDay,showWeeks:d.datepickerShowWeeks}},b.dateEnd={opened:!1,value:null,options:{formatYear:"yyyy",startingDay:d.datepickerFirstDay,showWeeks:d.datepickerShowWeeks}},b.dateStartOpen=function(){g.open(!1).then(function(a){b.dateStart={value:moment(a.beginDate).startOf("day").format()},b.dateEnd={value:moment(a.endDate).endOf("day").format()},b.updateDateFilter()})},b.setMode=function(a){b.datefilter.mode=a},b.updateDateFilter=function(){b.datefilter.date_from=b.dateStart.value,b.datefilter.date_to=b.dateEnd.value,b.refreshView()},b.$watch("dateStart.value",b.updateDateFilter),b.$watch("dateEnd.value",b.updateDateFilter),b.$watch("datefilter.mode",b.updateDateFilter),b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeFactsController",["$rootScope","$scope","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f){b.view.grid.enableRowSelection=!1,b.view.grid.enableRowHeaderSelection=!1,b.initialize=function(){b.refreshView()},b.$on("ViewRefresh",function(a){b.loadData()}),b.loadData=function(){var c=e.buildBrowserArgs(b.view,!1,!1),d=new cubes.Browser(e.cubesserver,b.view.cube),f=b.newViewStateKey(),g=d.facts(c,b._loadDataCallback(f));b.view.pendingRequests++,g.always(function(){b.view.pendingRequests--,a.$apply();
}),g.error(b.requestErrorHandler)},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),b.processData(d),a.$apply())}},b.processData=function(c){var e=b.view;b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply();var f=e.cube.dimensions,g=e.cube.measures,h=e.cube.details;angular.extend(b.view.grid,{data:[],rowHeight:24,onRegisterApi:b.onGridRegisterApi,enableColumnResizing:!0,showColumnFooter:!1,enableGridMenu:!0,paginationPageSizes:d.pagingOptions,paginationPageSize:d.pagingOptions[0],enableRowSelection:!1,enableRowHeaderSelection:!1,enablePinning:!1,multiSelect:!1,columnDefs:[]}),e.grid.columnDefs.push({name:"id",field:"id",index:"id",enableHiding:!1,width:80});for(var i in f)for(var j=f[i],k=0;k<j.levels.length;k++){var l=j.levels[k],m={name:l.label,field:l.key().ref,index:l.key().ref,headerCellClass:"cv-grid-header-dimension",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ row.entity[col.colDef.field] }}</div>',visible:!e.params.columnHide[l.key().ref],width:b.defineColumnWidth(l.key().ref,95),sort:b.defineColumnSort(l.key().ref),sortingAlgorithm:b.sortDimensionLevel(l)};e.grid.columnDefs.push(m),$(l.attributes).each(function(a,c){if(c.ref!=l.key().ref&&c.ref!=l.label_attribute().ref){var d={name:c.name,field:c.ref,index:c.ref,headerCellClass:"cv-grid-header-dimensionattribute",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ row.entity[col.colDef.field] }}</div>',visible:!e.params.columnHide[c.ref],width:b.defineColumnWidth(c.ref,85),sort:b.defineColumnSort(c.ref)};e.grid.columnDefs.push(d)}})}for(var n in g){var o=g[n],m={name:o.label,field:o.ref,index:o.ref,cellClass:"text-right",headerCellClass:"cv-grid-header-measure",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ col.colDef.formatter(COL_FIELD, row, col) }}</div>',formatter:b.columnFormatFunction(o),visible:!e.params.columnHide[o.ref],width:b.defineColumnWidth(o.ref,75),sort:b.defineColumnSort(o.ref)};e.grid.columnDefs.push(m)}for(var p in h){var q=h[p],m={name:q.name,field:q.ref,index:q.ref,visible:!e.params.columnHide[q.ref],width:b.defineColumnWidth(q.ref,95),sort:b.defineColumnSort(q.ref),sortingAlgorithm:b.sortValues};e.grid.columnDefs.push(m)}b._addRows(c)},b._addRows=function(a){var c=b.view,d=c.grid.data,e=0,f=c.cube.dimensions,g=c.cube.measures,h=c.cube.details;$(a).each(function(a,b){var c=[];for(var i in f)for(var j=f[i],k=0;k<j.levels.length;k++){var l=j.levels[k],m=l.readCell(b);j.info["cv-boolean-label"]?c[l.key().ref]=j.info["cv-boolean-label"][m.label]:c[l.key().ref]=m.label,$(l.attributes).each(function(a,b){b.ref!=l.key().ref&&b.ref!=l.label_attribute().ref&&(c[b.ref]=m.info[b.ref])})}for(var n in g){var o=g[n];c[o.ref]=b[o.ref]}for(var p in h){var q=h[p];c[q.ref]=b[q.ref]}c.id=e++,"id"in b&&(c.id=b.id),c.key=c.id,c._cell=b,d.push(c)})},b.$on("$destroy",function(){b.view.grid.data=[],b.view.grid.columnDefs=[]}),b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeSeriesController",["$rootScope","$scope","$timeout","cvOptions","cubesService","viewsService","seriesOperationsService",function(a,b,c,d,e,f,g){b.view.grid.enableRowSelection=!1,b.view.grid.enableRowHeaderSelection=!1,b.initialize=function(){b.view.params=$.extend({},{xaxis:null,yaxis:null},b.view.params),b.refreshView()},b.$on("ViewRefresh",function(a){b.loadData()}),b.loadData=function(){var c=b.view;if(null!=c.params.yaxis){var d=e.buildBrowserArgs(b.view,null!=b.view.params.xaxis,!1),f=new cubes.Browser(e.cubesserver,b.view.cube),g=b.newViewStateKey(),h=f.aggregate(d,b._loadDataCallback(g));b.view.pendingRequests++,h.always(function(){b.view.pendingRequests--,a.$apply()}),h.error(b.requestErrorHandler)}},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),b.processData(d),a.$apply())}},b.processData=function(c){var e=b.view;b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply(),angular.extend(b.view.grid,{data:[],rowHeight:24,onRegisterApi:b.onGridRegisterApi,enableColumnResizing:!0,showColumnFooter:!1,enableGridMenu:!0,paginationPageSizes:d.pagingOptions,paginationPageSize:d.pagingOptions[0],enableRowSelection:!1,enableRowHeaderSelection:!1,enablePinning:!1,multiSelect:!1,selectionRowHeaderWidth:20,columnDefs:[]}),b._addRows(b,c),g.applyCalculations(b.view,b.view.grid.data,e.grid.columnDefs)},b._addRows=cubesviewer._seriesAddRows,b.$on("$destroy",function(){b.view.grid.data=[],b.view.grid.columnDefs=[]}),b.initialize()}]),cubesviewer._seriesAddRows=function(a,b){var c=a.view,d=c.grid.data,e=(c.cube.dimensions,c.cube.measures,c.cube.details,c.params.drilldown.slice(0));null!=c.params.xaxis&&e.splice(0,0,c.params.xaxis);var f=null==c.params.xaxis?0:1,g=[];if($(b.cells).each(function(b,h){for(var i=[],j=[],k=0;k<e.length;k++){var l=c.cube.dimensionParts(e[k]),m=l.hierarchy.readCell(h,l.level),n=[],o=[];$(m).each(function(a,b){if(n.push(b.key),l.dimension.info["cv-boolean-label"]){var c=l.dimension.info["cv-boolean-label"][b.key];if(c)return void o.push(c)}o.push(b.label)}),j.push(o.join(" / "))}var p=null==c.params.xaxis?c.params.yaxis:j[0],q=h[c.params.yaxis],r=null==c.params.xaxis?j.join(" / "):j.slice(1).join(" / "),i=$.grep(d,function(a){return a.key==r});if(i.length>0)i[0][p]=q,i[0]._cell=h;else{var s={};s.key=r,s[p]=q;for(var k=f;k<j.length;k++)s["key"+(k-f)]=j[k];s._cell=h,d.push(s)}if(g.indexOf(p)<0){g.push(p);var t=$.grep(c.cube.aggregates,function(a){return a.ref==c.params.yaxis})[0],u={name:c.params.xaxis?p:t.label,field:p,index:p,cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents" title="TOOLTIP">{{ col.colDef.formatter(COL_FIELD, row, col) }}</div>',formatter:a.columnFormatFunction(t),label:t.label,enableHiding:!1,width:a.defineColumnWidth(p,90),sort:a.defineColumnSort(p)};c.grid.columnDefs.push(u)}}),$(c.params.drilldown).each(function(b,d){var e={name:c.cube.cvdim_dim(d).label,field:"key"+b,index:"key"+b,headerCellClass:"cv-grid-header-dimension",enableHiding:!1,width:a.defineColumnWidth("key"+b,190),sort:a.defineColumnSort("key"+b),sortingAlgorithm:a.sortDimensionParts(c.cube.dimensionParts(d))};c.grid.columnDefs.splice(b,0,e)}),0==c.params.drilldown.length&&d.length>0){d[0].key0=c.cube.aggregateFromName(c.params.yaxis).label;var h={name:"Medida",field:"key0",index:"key0",headerCellClass:"cv-grid-header-measure",enableHiding:!1,width:a.defineColumnWidth("key0",190),sort:a.defineColumnSort("key0")};c.grid.columnDefs.splice(0,0,h)}},angular.module("cv.views").service("seriesOperationsService",["$rootScope","cvOptions","cubesService",function(a,b,c){this.calculateDifferentials=function(a,b,c){console.debug("FIXME: Differentials are ignoring drilldown.length columns, but fails in some cases."),$(b).each(function(b,d){for(var e=null,f=a.params.drilldown.length;f<c.length;f++){var g=d[c[f].field],h=null;if(null!=e&&null!=g){var h=g-e;d[c[f].field]=h}else delete d[c[f].field];e=g}})},this.calculateDifferentialsPercent=function(a,b,c){console.debug("FIXME: Differentials are ignoring drilldown.length columns, but fails in some cases."),$(b).each(function(b,d){for(var e=null,f=a.params.drilldown.length;f<c.length;f++){var g=d[c[f].field],h=null;if(null!=e&&null!=g){var h=(g-e)/e;d[c[f].field]=h}else delete d[c[f].field];e=g}})},this.applyQuantityFilterHorizontally=function(a,b,c){_.each(b,function(b,d){var e=_.map(b,function(a,b){if(a&&!isNaN(a))return b});e=_.compact(e);var f,g=e.sort(function(a,c){return b[c]-b[a]});f="top"==a.params.quantity_filter.order?g.slice(a.params.quantity_filter.amount,g.length):g.slice(0,g.length-a.params.quantity_filter.amount);var h=0,i=[],j=_.compact(c);_.each(f,function(c){var d=b[c];delete b[c];var e=_.indexOf(_.pluck(j,"field"),c);i.push(e),a.params.quantity_filter.group_remaining&&(h+=d)}),_.each(i,function(a){delete c[a]}),a.params.quantity_filter.group_remaining&&(b.Outros=h,c.push({name:"Outros",field:"Outros",index:"Outros",cellClass:"text-right",cellTemplate:'<div class="ui-grid-cell-contents" title="Outros resultados">Outros</div>',label:"Outros",enableHiding:!1,width:90,sort:null}))})},this.calculateTopOrBottomResults=function(a,b,c){if(a.params.drilldown.length<1)this.applyQuantityFilterHorizontally(a,b,c);else{var d=_.pluck(c,"field");d=_.filter(d,function(a){return a.match(/key\d*/)})}},this.applyCalculations=function(a,b,c){"difference"==a.params.calculation&&this.calculateDifferentials(a,b,c),"percentage"==a.params.calculation&&this.calculateDifferentialsPercent(a,b,c),a.params.quantity_filter&&this.calculateTopOrBottomResults(a,b,c)}}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartController",["$rootScope","$scope","$timeout","$element","cvOptions","cubesService","viewsService","seriesOperationsService","exportService",function(a,b,c,d,e,f,g,h,i){var j=this;this.chart=null,this.initialize=function(){b.view.params=$.extend({},{charttype:"bars-vertical",chartoptions:{showLegend:!0}},b.view.params)},b.$watch("view.params.charttype",function(){j.loadData()}),b.$on("ViewRefresh",function(a){j.loadData()}),this.loadData=function(){var c=b.view;if(null!=c.params.yaxis){var d=f.buildBrowserArgs(b.view,null!=b.view.params.xaxis,!1),e=new cubes.Browser(f.cubesserver,b.view.cube),g=b.newViewStateKey(),h=e.aggregate(d,b._loadDataCallback(g));b.view.pendingRequests++,h.always(function(){b.view.pendingRequests--,a.$apply()}),h.error(b.requestErrorHandler)}},b._loadDataCallback=function(c){return function(d,e){c==b._viewStateKey&&(b.validateData(d,e),j.processData(d),a.$apply())}},this.processData=function(c){0==b.view.pendingRequests&&($(d).find("svg").empty(),$(d).find("svg").parent().children().not("svg").remove()),b.rawData=c,b.resetGrid(),b.view.grid.data=[],b.view.grid.columnDefs=[],a.$apply();var e=b.view,f=b.view.grid.data,g=e.grid.columnDefs;this._addRows(b,c),h.applyCalculations(b.view,b.view.grid.data,e.grid.columnDefs),e.grid.columnDefs=_.compact(e.grid.columnDefs),e.params.drilldown.length>0&&(g.splice(0,e.params.drilldown.length,{name:"key"}),$(f).each(function(a,b){for(var c=[],d=0;d<e.params.drilldown.length;d++)c.push(b["key"+d]);b.key=c.join(" / ")})),b.$broadcast("gridDataUpdated")},this._addRows=cubesviewer._seriesAddRows,this.cleanupNvd3=function(){$(d).find("svg").parent().children().not("svg").remove(),j.chart&&$("#"+j.chart.tooltip.id()).remove()},b.$watch("cvOptions.studioTwoColumn",function(){j.chart&&c(function(){j.chart.update()},100)}),this.resizeChart=function(a){b.view;$(d).find("svg").height(a),$(d).find("svg").resize(),j.chart&&j.chart.update()},b.$on("ViewResize",function(a){j.chart&&j.chart.update()}),b.view.exportChartAsPNG=function(){var a='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">',c=i.getDocumentStyles();c=void 0===c?"":c;var e=$(d).find("svg").first();e.addClass("cv-bootstrap"),e.css("font-size","10px"),e.css("font-family","Helvetica, Arial, sans-serif"),e.css("background-color","white"),e.attr("width",e.width()),e.attr("height",e.height()),e.attr("version","1.1");var f=document.createElement("defs");e[0].insertBefore(f,e[0].firstChild);var g=document.createElement("style");f.appendChild(g),g.setAttribute("type","text/css");var h=(new XMLSerializer).serializeToString(e.get(0));h=h.replace("</style>","<![CDATA["+c+"]]></style>");var j=new Blob([a+h],{type:"image/svg+xml;charset=utf-8"}),k=window.URL.createObjectURL(j),l=d3.select("body").append("img").attr("visibility","hidden").attr("width",e.width()).attr("height",e.height()).node();l.onload=function(){var a=d3.select("body").append("canvas").node();$(a).addClass("cv-bootstrap"),$(a).attr("visibility","hidden"),a.width=e.width(),a.height=e.height();var c=a.getContext("2d");c.drawImage(l,0,0,e.width(),e.height());var d=a.toDataURL("image/png");$(l).remove(),$(a).remove(),i.saveAs(d,b.view.cube.name+"-"+b.view.params.charttype+".png")},l.src=k},b.$on("$destroy",function(){j.cleanupNvd3(),b.view.grid.data=[],b.view.grid.columnDefs=[]}),this.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartBarsVerticalController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartBarsVertical()},0)}),b.drawChartBarsVertical=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,g=$(c).find("svg").get(0),h=null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"Nenhuma dimensão horizontal selecionada.",i=[],j=(d.length,0);$(d).each(function(b,c){for(var d=[],g=1;g<e.length;g++){var h=c[e[g].field];d.push({x:e[g].name,y:void 0!=h?h:0})}var k=f.getKeyForDataRow(c),l={values:d,key:k||a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(l.disabled=!!a.params["chart-disabledseries"].disabled[l.key]),i.push(l),j++}),i.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var k={delay:1200,groupSpacing:.1},l=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],m=b.columnFormatFunction(l);nv.addGraph(function(){var c=nv.models.multiBarChart().controlLabels({stacked:"Empilhado",stream:"Em fluxo",expanded:"Expandido",grouped:"Agrupado"}).showLegend(!!a.params.chartoptions.showLegend).margin({left:120});return a.params["chart-barsvertical-stacked"]&&c.stacked(a.params["chart-barsvertical-stacked"]),c.options(k),c.multibar.hideable(!0),c.xAxis.axisLabel(h),c.yAxis.tickFormat(function(a,b){return m(a)}),d3.select(g).datum(i).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-barsvertical-stacked"]=b.stacked,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[i[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartBarsHorizontalController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartBarsVertical()},0)}),b.drawChartBarsVertical=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,g=$(c).find("svg").get(0),h=(null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"Nenhuma dimensão horizontal selecionada.",[]),i=(d.length,0);$(d).each(function(b,c){for(var g=[],j=1;j<e.length;j++){var k=c[e[j].field];2==d.length&&1==i&&a.params.chartoptions.mirrorSerie2&&(k=void 0!=k?-k:0),g.push({x:e[j].name,y:void 0!=k?k:0})}g.reverse();var l=f.getKeyForDataRow(c),m={values:g,key:l||a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(m.disabled=!!a.params["chart-disabledseries"].disabled[m.key]),h.push(m),i++}),h.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var j={delay:1200,groupSpacing:.1},k=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],l=b.columnFormatFunction(k);nv.addGraph(function(){var c=nv.models.multiBarHorizontalChart().controlLabels({stacked:"Empilhado",stream:"Em fluxo",expanded:"Expandido",grouped:"Agrupado"}).showLegend(!!a.params.chartoptions.showLegend).showValues(!0).showControls(!0);a.params["chart-barsvertical-stacked"]&&c.stacked(a.params["chart-barsvertical-stacked"]),c.options(j),c.yAxis.tickFormat(function(b,c){return 2==d.length&&a.params.chartoptions.mirrorSerie2&&b<0&&(b=-b),l(b)});var e=_.uniq(_.flatten(_.map(h,function(a){return _.map(a.values,function(a){return a.x})}))),f=Math.max.apply(null,_.pluck(e,"length"));if(1==e.length){c.margin({left:120});var i=d3.select(g).select(".nv-x.nv-axis > g").selectAll("g.tick");i.selectAll("text").attr("transform",function(){return"translate (-20, -100) rotate(-90 0,0)"})}else f>0?c.margin({left:6.3*f}):c.margin({left:120});return d3.select(g).datum(h).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-barsvertical-stacked"]=b.stacked,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[h[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartLinesController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){!1 in b.view.params.chartoptions&&(b.view.params.chartoptions.lineInterpolation="linear")},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartLines()},0)}),b.drawChartLines=function(){if(b.view.params.xaxis){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,g=$(c).find("svg").get(0),h=null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"Nenhuma dimensão horizontal selecionada",i=[],j=(d.length,0);$(d).each(function(b,c){for(var d=[],g=1;g<e.length;g++)if(e[g].field in c){var h=c[e[g].field];d.push({x:g,y:void 0!=h?h:0})}else"lines-stacked"==a.params.charttype&&d.push({x:g,y:0});var k=f.getKeyForDataRow(c),l={values:d,key:k||a.params.yaxis};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(l.disabled=!!a.params["chart-disabledseries"].disabled[l.key]),i.push(l),j++}),i.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});var k=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],l=b.columnFormatFunction(k);"lines-stacked"!=a.params.charttype?nv.addGraph(function(){var c=nv.models.lineChart().useInteractiveGuideline(!0).interpolate(b.view.params.chartoptions.lineInterpolation).showLegend(!!a.params.chartoptions.showLegend).margin({left:120});return c.xAxis.axisLabel(h).tickFormat(function(a,b){return e[a].name}),c.yAxis.tickFormat(function(a,b){return l(a)}),d3.select(g).datum(i).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[i[c].key]=b.disabled[c]}),b.chartCtrl.chart=c,c}):nv.addGraph(function(){var c=nv.models.stackedAreaChart().showLegend(!!a.params.chartoptions.showLegend).interpolate(b.view.params.chartoptions.lineInterpolation).margin({left:130}).clipEdge(!0).useInteractiveGuideline(!0);return a.params["chart-stackedarea-style"]&&c.style(a.params["chart-stackedarea-style"]),c.xAxis.axisLabel(h).showMaxMin(!1).tickFormat(function(a,b){return e[a].name}),c.yAxis.tickFormat(function(a,b){return l(a)}),d3.select(g).datum(i).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-stackedarea-style"]=b.style,a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[i[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})}},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartPieController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){b.chartCtrl.cleanupNvd3(),d(function(){b.drawChartPie()},0)}),b.drawChartPie=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,g=$(c).find("svg").get(0),h=(null!=a.params.xaxis?a.cube.dimensionParts(a.params.xaxis).label:"Nenhuma dimensão horizontal selecionada",[]),i=(d.length,0);$(d).each(function(b,c){var d=c[e[1].field];if(void 0!=d&&d>0){var g=f.getKeyForDataRow(c),j={y:d,key:g||e[0].name};a.params["chart-disabledseries"]&&a.params["chart-disabledseries"].key==a.params.drilldown.join(",")&&(j.disabled=!!a.params["chart-disabledseries"].disabled[j.key]),h.push(j),i++}}),h.sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:0});for(var j=[],k=1;k<e.length;k++)j.push([k-1,e[k].name]);var l=$.grep(a.cube.aggregates,function(b){return b.ref==a.params.yaxis})[0],m=b.columnFormatFunction(l);nv.addGraph(function(){var c=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return a.y}).showLegend(!!a.params.chartoptions.showLegend).margin({bottom:20,top:20}).labelType("percent");return c.valueFormat(function(a,b){return m(a)}),d3.select(g).datum(h).call(c),c.dispatch.on("stateChange",function(b){a.params["chart-disabledseries"]={key:a.params.drilldown.join(","),disabled:{}};for(var c=0;c<b.disabled.length;c++)a.params["chart-disabledseries"].disabled[h[c].key]=b.disabled[c];a.updateUndo()}),b.chartCtrl.chart=c,c})},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartRadarController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){d(function(){b.drawChartRadar()},2e3)}),b.$watch("cvOptions.studioTwoColumn",function(){d(function(){b.drawChartRadar()},2e3)}),b.$on("ViewResize",function(){b.$apply(function(){b.drawChartRadar()})}),b.drawChartRadar=function(){var a=b.view,d=b.view.grid.data,e=a.grid.columnDefs,g=$(c).find(".cv-chart-container")[0];$(g).empty(),$(g).height(400);var h=[],i=d.length;$(d).each(function(b,c){for(var d=[],g=1;g<e.length;g++){var i=c[e[g].field];void 0!=i?d.push([g-1,i]):d.push([g-1,0])}var j=f.getKeyForDataRow(c);h.push({data:d,label:j||a.params.yaxis})}),h.sort(function(a,b){return a.label<b.label?-1:a.label>b.label?1:0});for(var j=[],k=1;k<e.length;k++)j.push([k-1,e[k].name]);var l={HtmlText:!1,shadowSize:2,height:350,radar:{show:!0,fill:i<4,fillOpacity:.2},mouse:{track:!1,relative:!0},grid:{circular:!0,minorHorizontalLines:!0},xaxis:{ticks:j},yaxis:{},legend:{show:!!a.params.chartoptions.showLegend,position:"se",backgroundColor:"#D2E8FF"}};b.flotrDraw=Flotr.draw(g,h,l)},b.initialize()}]),angular.module("cv.views.cube").controller("CubesViewerViewsCubeChartSunburstController",["$rootScope","$scope","$element","$timeout","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.chart=null,b.initialize=function(){},b.$on("gridDataUpdated",function(){d(function(){b.drawChartSunburst()},2e3)}),b.drawChartSunburst=function(){var a=b.view,c=b.rawData,d=(b.view.grid.data,a.grid.columnDefs,b.prepareDrilldownTree(c));b.draw3DJSSunburst(d)},b.prepareDrilldownTree=function(a){var c=b.view,d=[{children:[],name:"Current Slice"}],e=null;return $(a.cells).each(function(a,b){e=d[0];for(var f=0;f<c.params.drilldown.length;f++){var g=c.cube.dimensionParts(c.params.drilldown[f]),h=g.hierarchy.readCell(b);$(h).each(function(a,b){var c=$.grep(e.children,function(a){return a.name==b.key});c.length>0?e=c[0]:(c={children:[],name:String(b.key),label:b.label},e.children.push(c),e=c)})}e.measure=b[c.params.yaxis]}),d[0].children},String.prototype.hashCode=function(){var a,b,c,d=0;if(0===this.length)return d;for(a=0,c=this.length;a<c;a++)b=this.charCodeAt(a),d=(d<<5)-d+b,d|=0;return d},b.draw3DJSSunburst=function(a){function d(a,b){return a===b||!!(a.children&&a.children.length>0)&&a.children.some(function(a){return d(a,b)})}function e(a){if(!a)return"#ffaaaa";if(void 0!=a.color)return a.color;if(null!=a.parent&&null!=a.parent.parent){a.color=e(a.parent);var b=u(Math.abs(String(a.name).hashCode())%20);a.color=d3.scale.linear().domain([0,100]).interpolate(d3.interpolateRgb).range([a.color,b])(30),a.color=b}else"name"in a?a.color=u(Math.abs(String(a.name).hashCode())%20):a.color="#ffffff";return a.color}function f(a){var b=g(a),c=d3.interpolate(q.domain(),[a.x,a.x+a.dx]),d=d3.interpolate(r.domain(),[a.y,b]),e=d3.interpolate(r.range(),[20,p]);return function(a){return function(b){return q.domain(c(b)),r.domain(d(b)).range(e(b)),z(a)}}}function g(a){return 1}function h(a){return.299*a.r+.587*a.g+.114*a.b}function i(a,b){var c=a.split(" "),d=c.length>8;return c.length<=2?0==b?a:"":(c=c.slice(0,8),c=0==b?c.slice(0,Math.floor(c.length/2)):c.slice(Math.floor(c.length/2)),c.join(" ")+(d&&1==b?"...":""))}function j(a){C.style("visibility",function(a){var b=Math.abs(q(a.x+a.dx)-q(a.x))>Math.PI/48;return b?null:"hidden"}).transition().duration(t).attrTween("text-anchor",function(a){return function(){return q(a.x+a.dx/2)>Math.PI?"end":"start"}}).attrTween("transform",function(a){var b=(a.name||"").split(" ").length>1;return function(){var c=180*q(a.x+a.dx/2)/Math.PI-90,d=c+(b?-.5:0);return"rotate("+d+")translate("+(r(a.y)+s)+")rotate("+(c>90?-180:0)+")"}}).style("fill-opacity",function(b){return d(a,b)?1:1e-6}).each("end",function(a){var b=Math.abs(q(a.x+a.dx)-q(a.x))>Math.PI/48;d3.select(this).style("visibility",b?null:"hidden")})}function k(a){v=a,B.transition().duration(t).attrTween("d",f(a)),j(a)}var l=b.view,a=a,m=(b.rawData,l.grid.columnDefs,$(c).find("svg").parent().empty().get(0)),n=(null!=l.params.xaxis?l.cube.dimensionParts(l.params.xaxis).label:"Nenhuma dimensão horizontal selecionada",470),o=n,p=n/2,q=d3.scale.linear().range([0*Math.PI,2*Math.PI]),r=d3.scale.linear().domain([0,1]).range([20,p]),s=5,t=1e3,u=d3.scale.category20b().domain([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]),v=null,w=d3.select(m),x=w.append("svg").attr("width",n+2*s).attr("height",o+2*s).append("g").attr("transform","translate("+(p+s)+","+(p+s)+")"),y=d3.layout.partition().sort(null).value(function(a){return a.measure}),z=d3.svg.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,q(a.x)))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,q(a.x+a.dx)))}).innerRadius(function(a){return Math.max(0,a.y?r(a.y):a.y)}).outerRadius(function(a){return Math.max(0,r(a.y+a.dy))}),A=y.nodes({children:a}),B=x.selectAll("path").data(A);B.enter().append("path").attr("id",function(a,b){return"path-"+b}).attr("d",z).attr("fill-rule","evenodd").style("fill",e).on("click",k).each(function(a,b){var c=this;$(c).hover(function(){d3.select(c).style("stroke","#ffffff").style("stroke-width","2").style("stroke-opacity","1"),$(c).insertBefore($("text").first())},function(){d3.select(c).style("stroke","#000000").style("stroke-width","0").style("stroke-opacity","0")})}),v=A[0];var C=x.selectAll("text").data(A),D=C.enter().append("text").style("fill-opacity",1).style("fill",function(a){return h(d3.rgb(e(a)))<125?"#eee":"#000"}).style("font-size",9).style("-webkit-touch-callout","none").style("-webkit-user-select","none").style("-khtml-user-select","none").style("-moz-user-select","none").style("-ms-user-select","none").style("user-select","none").style("pointer-events","none").style("visibility",function(a){var b=Math.abs(q(a.x+a.dx)-q(a.x))>Math.PI/48;return b=!0,b?null:"hidden"}).attr("text-anchor",function(a){return q(a.x+a.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",function(a){var b=(("label"in a?String(a.label):"")||"").split(" ").length>1,c=180*q(a.x+a.dx/2)/Math.PI-90,d=c+(b?-.5:0);return"rotate("+d+")translate("+(r(a.y)+s)+")rotate("+(c>90?-180:0)+")"}).on("click",k);D.append("tspan").attr("x",0).text(function(a){return a.depth?i(a.label,0):""}),D.append("tspan").attr("x",0).attr("dy","1em").text(function(a){return a.depth?i(a.label,1)||"":""})}}]),angular.module("cv.views.cube").service("exportService",["$rootScope","$timeout","cvOptions","cubesService","viewsService","seriesOperationsService",function(a,b,c,d,e,f){this.exportFacts=function(a){var b=d.buildBrowserArgs(a,!1,!0),e={};e.format="csv",b.cut&&(e.cut=b.cut.toString()),b.order&&(e.order=b.order.toString());var f=c.cubesUrl+"/cube/"+a.cube.name+"/facts?"+$.param(e);window.open(f,"_blank"),window.focus()},this.exportGridAsCsv=function(a){if(!a.grid)return void console.debug("View has no grid that can be exported.");var b=(a.grid,a.grid.data),c="",d=[];$(a.grid.columnDefs).each(function(a,b){d.push('"'+b.name+'"')}),c=c+d.join(",")+"\n",$(b).each(function(b,e){d=[],$(a.grid.columnDefs).each(function(a,b){e[b.field]&&e[b.field].title?d.push('"'+e[b.field].title+'"'):d.push('"'+e[b.field]+'"')}),c=c+d.join(",")+"\n"}),this.saveAs(c,"text/csv",a.cube.name+"-summary.csv")},this.saveAs=function(a,b,c){var d=new Blob([a],{type:b}),e=URL.createObjectURL(d),f=document.createElement("a");"string"==typeof f.download?(document.body.appendChild(f),f.download=c,f.href=e,f.click(),document.body.removeChild(f)):location.replace(e)},this.getDocumentStyles=function(){function a(b){try{if(b.cssRules){console.debug(b);for(var d=0;d<b.cssRules.length;d++){var e=b.cssRules[d];3===e.type?a(e.styleSheet):e.selectorText&&e.selectorText.indexOf(">")===-1&&(c+="\n"+e.cssText)}}}catch(f){console.debug("Could not access document stylesheet.")}}var b=window.document,c="",d=b.styleSheets;if(d)for(var e=0;e<d.length;e++)a(d[e]);return c}}]),angular.module("cv.views.cube").controller("CubesViewerViewsUndoController",["$rootScope","$scope","$timeout","$element","cvOptions","cubesService","viewsService",function(a,b,c,d,e,f,g){b.initialize=function(){b.view.undoList=[],b.view.undoPos=-1},b.initialize(),b.$on("ViewRefresh",function(a){b._processState(a)}),b._processState=function(){var a=g.serializeView(b.view),c=b.getCurrentUndoState();a!=c&&b.pushUndo(a)},b.pushUndo=function(a){var c=b.view;c.undoPos=c.undoPos+1,c.undoPos+1<=c.undoList.length&&c.undoList.splice(c.undoPos,c.undoList.length-c.undoPos),c.undoList.push(a),c.undoList.length>e.undoSize&&(c.undoList.splice(0,c.undoList.length-e.undoSize),c.undoPos=c.undoList.length-1)},b.view.updateUndo=function(){var a=b.view,c=g.serializeView(a);a.undoList[a.undoPos]&&(a.undoList[a.undoPos]=c)},b.getCurrentUndoState=function(){return 0==b.view.undoList.length?"{}":b.view.undoList[b.view.undoPos]},b.undo=function(){b.view.undoPos=b.view.undoPos-1,b.view.undoPos<0&&(b.view.undoPos=0),b.applyCurrentUndoState()},b.redo=function(){b.view.undoPos=b.view.undoPos+1,b.applyCurrentUndoState()},b.applyCurrentUndoState=function(){var a=b.getCurrentUndoState();b.view.params=$.parseJSON(a),b.refreshView()}}]),angular.module("cv.studio",["cv"]),angular.module("cv.studio").service("studioViewsService",["$rootScope","$anchorScroll","$timeout","cvOptions","cubesService","viewsService","dialogService",function(a,b,c,d,e,f,g){this.resetService=function(){this.views=[],this.studioScope=null,f.resetService(),f.studioViewsService=this,cubesviewerStudio.studioViewsService=this},this.resetService(),this.addViewCube=function(a,g){var h=e.cubesserver.cubeinfo(a),i=h.label+" ("+(f.lastViewId+1)+")",j=f.createView("cube",{cubename:a,name:i});return j.params.mode="chart",_.isUndefined(g)?this.views.push(j):this.views[g]=j,c(function(){$(".cv-views-container").masonry("appended",$(".cv-views-container").find(".sv"+j.id).show()),c(function(){d.hideBorders||b("cvView"+j.id)},500)},0),j},this.addViewObject=function(a,e){if("string"==typeof a)try{$.parseJSON(a)}catch(h){return void g.show("Could not process serialized data: JSON parse error.")}var i=f.createView("cube",a);return _.isUndefined(e)?this.views.push(i):this.views[e]=i,c(function(){$(".cv-views-container").masonry("appended",$(".cv-views-container").find(".sv"+i.id).show()),c(function(){d.hideBorders||b("cvView"+i.id)},500)},0),i},this.closeView=function(a){var b=this.views.indexOf(a);b>=0&&($(".cv-views-container").masonry("remove",$(".cv-views-container").find(".sv"+a.id)),this.views[b]=void 0,$(".cv-views-container").masonry("layout"))},this.toggleCollapseView=function(a){a.collapsed=!a.collapsed,c(function(){$(".cv-views-container").masonry("layout")},100)}}]),angular.module("cv.studio").controller("CubesViewerStudioViewController",["$rootScope","$scope","cvOptions","cubesService","studioViewsService",function(a,b,c,d,e){c.hideControls=b.hideControls||!1,c.hideBorders=b.hideBorders||!1,c.readOnly=b.readOnly||!1,b.cubesService=d,b.studioViewsService=e,b.cvOptions=c,b.$watch("__height",function(){$(".cv-views-container").masonry("layout");
})}]).directive("cvStudioView",function(){return{restrict:"A",templateUrl:"studio/panel.html",scope:{view:"=",hideControls:"=",hideBorders:"=",readOnly:"="},link:function(a,b,c){a.$watch(function(){a.__height=b.height()})}}}),angular.module("cv.studio").controller("CubesViewerStudioController",["$rootScope","$scope","$modal","$element","$timeout","cvOptions","cubesService","studioViewsService","viewsService",function(a,b,c,d,e,f,g,h,i){b.cvVersion=cubesviewer.version,b.cvOptions=f,b.cubesService=g,b.studioViewsService=h,b.studioViewsService.studioScope=b,b.initialize=function(){},b.showSerializeAdd=function(){var a=c.open({animation:!0,templateUrl:"studio/serialize-add.html",controller:"CubesViewerSerializeAddController",appendTo:angular.element($(d).find(".cv-gui-modals")[0])});a.result.then(function(a){},function(){})},b.showSerializeView=function(a){var b=c.open({animation:!0,templateUrl:"studio/serialize-view.html",controller:"CubesViewerSerializeViewController",appendTo:angular.element($(d).find(".cv-gui-modals")[0]),resolve:{view:function(){return a},element:function(){return $(d).find(".cv-gui-modals")[0]}}});b.result.then(function(a){},function(){})},b.showRenameView=function(a){var b=c.open({animation:!0,templateUrl:"studio/rename.html",controller:"CubesViewerRenameController",appendTo:angular.element($(d).find(".cv-gui-modals")[0]),size:"md",resolve:{view:function(){return a},element:function(){return $(d).find(".cv-gui-modals")[0]}}});b.result.then(function(a){},function(){})},b.cloneView=function(a){var b=$.parseJSON(i.serializeView(a));b.name="Clone of "+b.name;var a=h.addViewObject(b);a.savedId=0,a.owner=f.user,a.shared=!1},b.toggleTwoColumn=function(){f.studioTwoColumn=!f.studioTwoColumn,e(function(){$(".cv-views-container").masonry("layout")},100)},b.toggleHideControls=function(){f.hideControls=!f.hideControls,e(function(){$(".cv-views-container").masonry("layout")},100)},b.initialize()}]),angular.module("cv.studio").controller("CubesViewerRenameController",["$rootScope","$scope","$modalInstance","cvOptions","cubesService","studioViewsService","view",function(a,b,c,d,e,f,g){b.cvVersion=cubesviewer.version,b.cvOptions=d,b.cubesService=e,b.studioViewsService=f,b.viewName=g.params.name,b.renameView=function(a){null!=a&&""!=a&&(g.params.name=a),c.close(g)},b.close=function(){c.dismiss("cancel")}}]),angular.module("cv.studio").config(["$compileProvider",function(a){}]),angular.module("cv.studio").run(["$rootScope","$compile","$controller","$http","$templateCache","cvOptions",function(a,b,c,d,e,f){console.debug("Bootstrapping CubesViewer Studio.");var g={container:null,user:null,studioTwoColumn:!1,hideControls:!1,backendUrl:null};$.extend(g,f),$.extend(f,g)}]);var cubesviewerStudio=new CubesViewerStudio;angular.module("cv.studio").controller("CubesViewerSerializeViewController",["$rootScope","$scope","$timeout","$modalInstance","element","cvOptions","cubesService","studioViewsService","viewsService","view",function(a,b,c,d,e,f,g,h,i,j){b.cvVersion=cubesviewer.version,b.cvOptions=f,b.cubesService=g,b.studioViewsService=h,b.serializedView="",b.initialize=function(){b.serializedView=i.serializeView(j),console.log("Serialized view: "+b.serializedView),c(function(){window.getSelection().removeAllRanges();var a=document.createRange();a.selectNodeContents($(e).find(".cv-serialized-view")[0]),window.getSelection().addRange(a)},0)},b.close=function(){d.dismiss("cancel")},b.initialize()}]),angular.module("cv.studio").controller("CubesViewerSerializeAddController",["$rootScope","$scope","$modalInstance","cvOptions","cubesService","studioViewsService",function(a,b,c,d,e,f){b.cvVersion=cubesviewer.version,b.cvOptions=d,b.cubesService=e,b.studioViewsService=f,b.serializedView=null,b.addSerializedView=function(a){if(null!=a){f.addViewObject(a)}c.close(a)},b.close=function(){c.dismiss("cancel")}}]),angular.module("cv").run(["$templateCache",function(a){"use strict";a.put("dialog/dialog.html",'  <div class=modal-header>\n    <button type=button ng-click=close() class=close data-dismiss=modal aria-label=Close><span aria-hidden=true><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class=modal-title id=myModalLabel><i class="fa fa-fw fa-exclamation"></i> Visualizador</h4>\n  </div>\n  <div class=modal-body>\n        <p>{{ dialog.text }}</p>\n  </div>\n  <div class=modal-footer>\n    \n    <button type=button ng-click=close() class="btn btn-primary" data-dismiss=modal>Fechar</button>\n  </div>\n\n'),a.put("studio/about.html",'<div class="modal fade" id=cvAboutModal tabindex=-1 role=dialog aria-labelledby="">\n  <div class=modal-dialog role=document>\n    <div class=modal-content>\n      <div class=modal-header>\n        <button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true><i class="fa fa-fw fa-close"></i></span></button>\n        <h4 class=modal-title id=myModalLabel><i class=cv-logo-embedded></i> CubesViewer</h4>\n      </div>\n      <div class=modal-body>\n\n            <p><a href=http://jjmontesl.github.io/cubesviewer/ target=_blank>CubesViewer</a> is a visual, web-based application for exploring and analyzing\n            OLAP databases served by the <a href=http://cubes.databrewery.org/ target=_blank>Cubes OLAP Framework</a>.</p>\n            <hr>\n\n            <p>Version {{ cvVersion }}<br>\n            <a href=https://github.com/jjmontesl/cubesviewer/ target=_blank>https://github.com/jjmontesl/cubesviewer/</a></p>\n\n            <p>by José Juan Montes and others (see AUTHORS)<br>\n            2012 - 2016</p>\n\n            <p>\n            <a href=http://github.com/jjmontesl/cubesviewer/blob/master/LICENSE.txt target=_blank>LICENSE</a>\n            </p>\n\n      </div>\n      <div class=modal-footer>\n        <button type=button class="btn btn-default" data-dismiss=modal><i class="fa fa-cube"></i> Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n'),a.put("studio/panel.html",'<div ng-class="{\'cv-bootstrap\': !cvOptions.hideControls}" class=cv-gui-viewcontainer ng-controller=CubesViewerStudioViewController>\n\n    <div class=panel ng-class="{\'panel-primary\': (!cvOptions.hideControls && !view.cvOptions.hideBorders)}">\n        <div ng-if="!cvOptions.hideControls && !view.cvOptions.hideBorders" class=panel-heading>\n\n            <button type=button ng-click=studioViewsService.closeView(view) class="btn btn-danger btn-xs pull-right hidden-print" style="margin-left: 10px"><i class="fa fa-fw fa-close"></i></button>\n            <button type=button ng-click=studioViewsService.toggleCollapseView(view) class="btn btn-primary btn-xs pull-right hidden-print" style="margin-left: 5px"><i class="fa fa-fw" ng-class="{\'fa-caret-up\': !view.collapsed, \'fa-caret-down\': view.collapsed }"></i></button>\n\n            <i class="fa fa-fw fa-file"></i> <span class=cv-gui-title style="cursor: pointer" ng-dblclick=studioViewsService.studioScope.showRenameView(view)><a name="cvView{{ view.id }}"></a>{{ view.params.name }}</span>\n\n            <span ng-if="view.savedId > 0 && reststoreService.isViewChanged(view)" class="badge cv-gui-container-state" style="margin-left: 15px; font-size: 80%">Modificado</span>\n            <span ng-if="view.savedId > 0 && !reststoreService.isViewChanged(view)" class="badge cv-gui-container-state" style="margin-left: 15px; font-size: 80%">Salvo</span>\n            <span ng-if=view.shared class="badge cv-gui-container-state" style="margin-left: 5px; font-size: 80%">Shared</span>\n\n            <button type=button class="btn btn-danger btn-xs" style="visibility: hidden"><i class="fa fa-fw fa-info"></i></button>\n\n        </div>\n        <div class=panel-body ng-hide=view.collapsed>\n            <div class=cv-gui-viewcontent>\n\n                <div cv-view-cube view=view></div>\n\n            </div>\n        </div>\n    </div>\n\n</div>\n'),a.put("studio/rename.html",'  <div class=modal-header>\n    <button type=button ng-click=close(); class=close data-dismiss=modal aria-label=Close><span aria-hidden=true><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class=modal-title id=myModalLabel><i class="fa fa-pencil"></i> Renomear visualização</h4>\n  </div>\n  <div class=modal-body>\n\n        <form class=form ng-submit=renameView(viewName);>\n            <div class=form-group>\n                <label for=serializedView>Nome:</label>\n                <input class=form-control ng-model=viewName>\n            </div>\n        </form>\n\n  </div>\n  <div class=modal-footer>\n    <button type=button ng-click=close(); class="btn btn-secondary" data-dismiss=modal>Cancelar</button>\n    <button type=button ng-click=renameView(viewName); class="btn btn-primary" data-dismiss=modal>Renomear</button>\n  </div>\n\n'),a.put("studio/serialize-add.html",'  <div class=modal-header>\n    <button type=button ng-click=close() class=close data-dismiss=modal aria-label=Close><span aria-hidden=true><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class=modal-title id=myModalLabel><i class="fa fa-code"></i> Adicionar visualização de um JSON serializado</h4>\n  </div>\n  <div class=modal-body>\n\n        <div class=form>\n            <label for=serializedView>Code:</label>\n            <textarea class=form-control ng-model=serializedView style="width: 100%; height: 12em">\n        </div>\n\n  </div>\n  <div class=modal-footer>\n    <button type=button ng-click=close() class="btn btn-secondary" data-dismiss=modal>Cancelar</button>\n    <button type=button ng-click=addSerializedView(serializedView) class="btn btn-primary" data-dismiss=modal>Adicionar visualização</button>\n  </div>\n\n'),a.put("studio/serialize-view.html",'  <div class=modal-header>\n    <button type=button ng-click=close() class=close data-dismiss=modal aria-label=Close><span aria-hidden=true><i class="fa fa-fw fa-close"></i></span></button>\n    <h4 class=modal-title id=myModalLabel><i class="fa fa-code"></i> Serializar visualização</h4>\n  </div>\n  <div class=modal-body>\n\n        <div class=form>\n            <label for=serializedView>Visualização do JSON:</label>\n            <textarea class="form-control cv-serialized-view" ng-bind=serializedView style="width: 100%; height: 12em" readonly=readonly></textarea>\n        </div>\n\n  </div>\n  <div class=modal-footer>\n    <button type=button ng-click=close() class="btn btn-default" data-dismiss=modal>Fechar</button>\n  </div>\n\n'),a.put("studio/serverinfo.html",'<div class="modal fade" id=cvServerInfo tabindex=-1 role=dialog aria-labelledby="">\n  <div class=modal-dialog role=document>\n    <div class=modal-content>\n      <div class=modal-header>\n        <button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true><i class="fa fa-fw fa-close"></i></span></button>\n        <h4 class=modal-title id=myModalLabel><i class="fa fa-fw fa-database"></i> Server info</h4>\n      </div>\n      <div class=modal-body>\n\n            <p>\n                <i>This CubesViewer version supports Cubes Server version 1.0.x and 1.1.x</i><br>\n                <br>\n                <b>Server version:</b> {{ cubesService.cubesserver.server_version }} <br>\n                <b>Cubes version:</b> {{ cubesService.cubesserver.cubes_version }} <br>\n                <b>API version:</b> {{ cubesService.cubesserver.api_version }} <br>\n            </p>\n            <p>\n                <b>Timezone:</b> {{ cubesService.cubesserver.info.timezone }} <br>\n                <b>Week start:</b> {{ cubesService.cubesserver.info.first_weekday }} <br>\n            </p>\n            <p>\n                <b>Result limit:</b> <strong class=text-warning>{{ cubesService.cubesserver.info.json_record_limit }}</strong> items<br>\n            </p>\n\n      </div>\n      <div class=modal-footer>\n        <button type=button class="btn btn-default" data-dismiss=modal> Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n'),a.put("views/cube/alerts.html",'<div>\n\n    <div ng-if=view.requestFailed class="alert alert-dismissable alert-danger" style="margin-bottom: 5px">\n        <div style="display: inline-block"><i class="fa fa-exclamation"></i></div>\n        <div style="display: inline-block; margin-left: 20px">\n            Um erro ocorreu. Não é possível apresentar a visualização.<br>\n            Por favor, tente novamente e contate o administrador se o problema persistir.\n        </div>\n    </div>\n\n    <div ng-if=view.resultLimitHit class="alert alert-dismissable alert-warning" style="margin-bottom: 5px">\n        <button type=button class=close ng-click="view._resultLimitHit = false;" data-dismiss=alert aria-hidden=true>&times;</button>\n        <div style="display: inline-block; vertical-align: top"><i class="fa fa-exclamation"></i></div>\n        <div style="display: inline-block; margin-left: 20px">\n          O limite de itens {{ cubesService.cubesserver.info.json_record_limit }} foi atingido. <b>Resultados estão incompletos.</b><br>\n          <i>Dica</i>: reduza o nível de detalhamento ou a seleção de filtros para reduzir o número de itens no resultado.\n        </div>\n    </div>\n\n</div>\n'),a.put("views/cube/chart/chart-common.html",'<div ng-show="(view.grid.data.length > 0 && view.params.yaxis != null) &&\n              (!(view.params.charttype == \'pie\' && view.grid.columnDefs.length > 2)) &&\n              (!(view.params.charttype == \'lines\' && view.params.xaxis == null)) &&\n              (!(view.params.charttype == \'lines-stacked\' && view.params.xaxis == null)) &&\n              (!(view.params.charttype == \'radar\' && view.grid.columnDefs.length < 4))" style="width: 99%">\n    <div>\n        <div class=cv-chart-container>\n            <svg style="height: 400px"/>\n        </div>\n        <div ng-hide="view.getControlsHidden() || view.params.charttype == \'radar\'" style="font-size: 8px; float: right">\n            <a href="" class=cv-chart-height ng-click=chartCtrl.resizeChart(400);>Pequeno</a>\n            <a href="" class=cv-chart-height ng-click=chartCtrl.resizeChart(550);>Médio</a>\n            <a href="" class=cv-chart-height ng-click=chartCtrl.resizeChart(700);>Grande</a>\n        </div>\n    </div>\n</div>\n\n<div ng-if="view.params.yaxis == null" class="alert alert-info" style="margin-bottom: 0px">\n    <p>\n        Não é possível apresentar o gráfico: nenhuma <b>medida</b> foi selecionada.\n    </p>\n    <p>\n        Dica: utilize o menu <kbd><i class="fa fa-fw fa-cogs"></i> Visualizações &gt; <i class="fa fa-fw fa-crosshairs"></i> Medida</kbd>.\n    </p>\n</div>\n\n<div ng-if="view.pendingRequests == 0 && view.params.yaxis != null && view.grid.data.length == 0" class="alert alert-info" style="margin-bottom: 0px">\n    <p>\n        Não é possível apresentar o gráfico: <b>nenhum dado retornado</b> pela combinação atual de filtros, dimensão horizontal e detalhamento.\n    </p>\n    <p>\n        Dica: utilize o menu de<kbd><i class="fa fa-fw fa-cogs"></i> Visualização</kbd> para selecionar uma dimensão horizontal.\n    </p>\n</div>\n\n<div ng-if="(view.params.charttype == \'lines-stacked\' || view.params.charttype == \'lines\') && !view.params.xaxis" class="alert alert-info" style="margin-bottom: 0px">\n  <p>\n    Não é possível apresentar o gráfico: <b>dimensão horizontal não foi selecionada</b>.\n  </p>\n  <p>\n    Dica: utilize o <kbd><i class="fa fa-fw fa-cogs"></i> menu de visualização</kbd> para selecionar uma dimensão horizontal.\n  </p>\n</div>\n\n<div ng-if="view.pendingRequests == 0 && view.params.charttype == \'pie\' && view.grid.columnDefs.length > 2" class="alert alert-info" style="margin-bottom: 0px">\n    <p>\n        Não é possível apresentar um <b>gráfico de torta</b> quando <b>mais de uma coluna</b> está presente.<br/>\n    </p>\n    <p>\n        Dica: revise os dados e colunas do gráfico no <a href="" ng-click="setViewMode(\'series\')" class=alert-link>modo de séries</a>,\n        ou <a href="" ng-click=selectXAxis(null); class=alert-link>remova a dimensão horizontal</a>.\n    </p>\n</div>\n\n<div ng-if="view.pendingRequests == 0 && view.params.yaxis != null && view.params.charttype == \'radar\' && view.grid.columnDefs.length < 3 && view.grid.data.length != 0" class="alert alert-info" style="margin-bottom: 0px">\n    Não é possível apresentar um <b>gráfico de radar</b> quando <b>menos de 3 colunas</b> estão presentes.<br/>\n    Dica: revise os dados e colunas do gráfico no <a href="" ng-click="setViewMode(\'series\')" class=alert-link>modo de séries</a>.\n</div>\n'),a.put("views/cube/chart/chart.html",'<div ng-controller="CubesViewerViewsCubeChartController as chartCtrl">\n\n    <div ng-if="view.params.charttype == \'pie\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-pie-chart"></i> Gráfico\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartPieController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'bars-vertical\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-bar-chart"></i> Gráfico\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartBarsVerticalController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'bars-horizontal\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-bar-chart fa-rotate-270"></i> Gráfico\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartBarsHorizontalController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'lines\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-line-chart"></i> Gráfico\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartLinesController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'lines-stacked\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-area-chart"></i> Gráfico\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartLinesController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'radar\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-bullseye"></i> Gráfico\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartRadarController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n    <div ng-if="view.params.charttype == \'sunburst\'">\n        <h3 ng-if=!view.cvOptions.readOnly><i class="fa fa-fw fa-sun-o"></i> Chart\n            <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n        </h3>\n        <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n            <span class=loadingbar-expand></span>\n        </div>\n        <div ng-controller=CubesViewerViewsCubeChartSunburstController>\n            <div ng-include="\'views/cube/chart/chart-common.html\'"></div>\n        </div>\n    </div>\n\n</div>\n'),a.put("views/cube/cube-menu-drilldown.html",'  <button class="btn btn-primary btn-sm dropdown-toggle drilldownbutton" ng-disabled="view.params.mode == \'facts\'" type=button data-toggle=dropdown data-submenu>\n    <i class="fa fa-fw fa-arrow-down"></i> <span class=hidden-xs ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Detalhamento</span> <span class=caret></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu-drilldown">\n\n      \n      <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click="selectDrill(dimension.name, true);">\n        <a href="">{{ dimension.label }}</a>\n      </li>\n      <li ng-repeat-end ng-if="dimension.levels.length != 1" class=dropdown-submenu>\n        <a tabindex=0>{{ dimension.label }}</a>\n\n        <ul ng-if="dimension.hierarchies_count() != 1" class=dropdown-menu>\n            <li ng-repeat="(hikey,hi) in dimension.hierarchies" class=dropdown-submenu>\n                <a tabindex=0 href="" onclick="return false;">{{ hi.label }}</a>\n                <ul class=dropdown-menu>\n                    <li ng-repeat="level in hi.levels" ng-click="selectDrill(dimension.name + \'@\' + hi.name + \':\' + level.name, true)"><a href="">{{ level.label }}</a></li>\n                </ul>\n            </li>\n        </ul>\n\n        <ul ng-if="dimension.hierarchies_count() == 1" class=dropdown-menu>\n            <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="selectDrill(dimension.name + \'@\' + dimension.default_hierarchy().name + \':\' + level.name, true)"><a href="">{{ level.label }}</a></li>\n        </ul>\n\n      </li>\n\n      <div class=divider></div>\n\n      <li ng-class="{ \'disabled\': view.params.drilldown.length == 0 }" ng-click="selectDrill(\'\')"><a href=""><i class="fa fa-fw fa-close"></i> Nenhum</a></li>\n\n  </ul>\n\n'),a.put("views/cube/cube-menu-filter.html",'<button class="btn btn-primary btn-sm dropdown-toggle cutbutton" type=button data-toggle=dropdown data-submenu>\n  <i class="fa fa-fw fa-filter"></i> <span class=hidden-xs ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Filtros</span>\n  <span class=caret></span>\n</button>\n\n<ul class="dropdown-menu dropdown-menu-right cv-view-menu cv-view-menu-cut">\n\n  <li ng-show="view.params.mode == \'explore\'" ng-click=filterSelected() ng-class="{ \'disabled\': view.params.drilldown.length != 1 }"><a href=""><i class="fa fa-fw fa-filter"></i> Filtrar\n    dados selecionados</a></li>\n  <div ng-show="view.params.mode == \'explore\'" class=divider></div>\n\n  <li ng-class="{ \'disabled\': !view.params.yaxis }">\n    <a tabindex=0 ng-click="view.params.yaxis && selectQuantityFilter()"><i class="fa fa-sort-amount-asc"></i> Filtro de quantidade</a>\n  </li>\n\n  <li class=dropdown-submenu>\n    <a tabindex=0><i class="fa fa-fw fa-bars"></i> Filtro de dimensão</a>\n    <ul class=dropdown-menu>\n\n      <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click=showDimensionFilter(dimension.name);>\n        <a href="">{{ dimension.label }}</a>\n      </li>\n      <li ng-repeat-end ng-if="dimension.levels.length != 1" class=dropdown-submenu>\n        <a tabindex=0>{{ dimension.label }}</a>\n\n        <ul ng-if="dimension.hierarchies_count() != 1" class=dropdown-menu>\n          <li ng-repeat="(hikey,hi) in dimension.hierarchies" class=dropdown-submenu>\n            <a tabindex=0 href="" onclick="return false;">{{ hi.label }}</a>\n            <ul class=dropdown-menu>\n              \n              <li ng-repeat="level in hi.levels" ng-click="showDimensionFilter(dimension.name + \'@\' + hi.name + \':\' + level.name )"><a href="">{{\n                level.label }}</a></li>\n            </ul>\n          </li>\n        </ul>\n\n        <ul ng-if="dimension.hierarchies_count() == 1" class=dropdown-menu>\n          \n          <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="showDimensionFilter(dimension.name + \'@\' + dimension.default_hierarchy().name + \':\' + level.name);">\n            <a href="">{{ level.label }}</a></li>\n        </ul>\n\n      </li>\n\n    </ul>\n  </li>\n\n  <li class=dropdown-submenu>\n    <a tabindex=0><i class="fa fa-fw fa-calendar"></i> Filtro de data</a>\n    <ul class=dropdown-menu>\n      <li ng-repeat="dimension in view.cube.dimensions" ng-if=dimension.isDateDimension()>\n        <a href="" ng-click="selectDateFilter(dimension.name + ((dimension.info[\'cv-datefilter-hierarchy\']) ? \'@\' + dimension.info[\'cv-datefilter-hierarchy\'] : \'\'), true)">\n          {{ dimension.label }}\n        </a>\n      </li>\n      <li ng-if="view.cube.dateDimensions().length == 0" class=disabled>\n        <a href="" ng-click=""><i>Não existem filtros de data para este modelo.</i></a>\n      </li>\n\n    </ul>\n  </li>\n\n  <div class=divider></div>\n\n  <li ng-class="{ \'disabled\': view.params.cuts.length == 0 && view.params.datefilters.length == 0 }" ng-click=clearFilters()><a href=""><i class="fa fa-fw fa-trash"></i> Limpar filtros</a></li>\n\n</ul>\n'),a.put("views/cube/cube-menu-panel.html",'  <button class="btn btn-primary btn-sm dropdown-toggle" type=button data-toggle=dropdown data-submenu>\n    <i class="fa fa-fw fa-file"></i> <span class=hidden-xs ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Painel</span> <span class=caret></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu cv-view-menu-view">\n\n    <li ng-click=viewsService.studioViewsService.studioScope.showRenameView(view)><a><i class="fa fa-fw fa-pencil"></i> Renomear...</a></li>\n    <li ng-click=viewsService.studioViewsService.studioScope.cloneView(view)><a><i class="fa fa-fw fa-clone"></i> Clonar</a></li>\n\n    <div ng-if=cvOptions.backendUrl class=divider></div>\n    <li ng-if=cvOptions.backendUrl ng-click=reststoreService.saveView(view)><a><i class="fa fa-fw fa-save"></i> Salvar</a></li>\n    <li ng-if=cvOptions.backendUrl ng-click="reststoreService.shareView(view, ! view.shared)"><a><i class="fa fa-fw fa-share"></i> {{ view.shared ? "Unshare" : "Share" }}</a></li>\n    <li ng-if=cvOptions.backendUrl ng-click=reststoreService.deleteView(view)><a><i class="fa fa-fw fa-trash-o"></i> Deletar...</a></li>\n\n    <div class=divider></div>\n    <li ng-click=viewsService.studioViewsService.studioScope.showSerializeView(view)><a><i class="fa fa-fw fa-code"></i> Serializar...</a></li>\n    <div class=divider></div>\n    <li ng-click=viewsService.studioViewsService.closeView(view)><a><i class="fa fa-fw fa-close"></i> Fechar</a></li>\n  </ul>\n'),a.put("views/cube/cube-menu-view.html",'  <button class="btn btn-primary btn-sm dropdown-toggle" type=button data-toggle=dropdown data-submenu>\n    <i class="fa fa-fw fa-cogs"></i> <span class=hidden-xs ng-class="{ \'hidden-sm hidden-md\': cvOptions.studioTwoColumn }">Visualização</span> <span class=caret></span>\n  </button>\n\n  <ul class="dropdown-menu dropdown-menu-right cv-view-menu cv-view-menu-view">\n\n    <li ng-show="view.params.mode == \'chart\'" class=dropdown-submenu>\n        <a tabindex=0><i class="fa fa-fw fa-area-chart"></i> Tipo do gráfico</a>\n        <ul class=dropdown-menu>\n          <li ng-click="selectChartType(\'pie\')"><a href=""><i class="fa fa-fw fa-pie-chart"></i> Torta</a></li>\n          <li ng-click="selectChartType(\'bars-vertical\')"><a href=""><i class="fa fa-fw fa-bar-chart"></i> Barras verticais</a></li>\n          <li ng-click="selectChartType(\'bars-horizontal\')"><a href=""><i class="fa fa-fw fa-rotate-270 fa-bar-chart"></i> Barras horizontais</a></li>\n          <li ng-click="selectChartType(\'lines\')"><a href=""><i class="fa fa-fw fa-line-chart"></i> Linhas</a></li>\n          <li ng-click="selectChartType(\'lines-stacked\')"><a href=""><i class="fa fa-fw fa-area-chart"></i> Áreas</a></li>\n          <li ng-click="selectChartType(\'radar\')"><a href=""><i class="fa fa-fw fa-bullseye"></i> Radar</a></li>\n\n          \n\n          \n\n          \n\n        </ul>\n    </li>\n\n    \n        <li class=dropdown-submenu ng-show="view.params.mode == \'chart\' && (view.params.charttype == \'lines-stacked\' || view.params.charttype == \'lines\')">\n            <a href=""><i class="fa fa-fw fa-angle-up"></i> Tipo de curva</a>\n            <ul class=dropdown-menu>\n                <li ng-class="{\'active\': view.params.chartoptions.lineInterpolation == \'linear\'}" ng-click="view.params.chartoptions.lineInterpolation = \'linear\'; refreshView();"><a href=""> Linear</a></li>\n                <li ng-class="{\'active\': view.params.chartoptions.lineInterpolation == \'monotone\'}" ng-click="view.params.chartoptions.lineInterpolation = \'monotone\'; refreshView();"><a href=""> Suave</a></li>\n                \n            </ul>\n        </li>\n\n        <li ng-class="{\'disabled\': view.grid.data.length != 2 }" ng-show="view.params.mode == \'chart\' && view.params.charttype == \'bars-horizontal\'" ng-click="view.params.chartoptions.mirrorSerie2 = !view.params.chartoptions.mirrorSerie2; refreshView();">\n            <a><i class="fa fa-fw fa-arrows-h"></i> Inverter séries secundárias\n                <span style="margin-left: 5px" class="label label-default" ng-class="{ \'label-success\': view.params.chartoptions.mirrorSerie2 }">{{ view.params.chartoptions.mirrorSerie2 ? "Ligado" : "Desligado" }}</span>\n            </a>\n        </li>\n\n    \n\n    <li ng-show="view.params.mode == \'chart\'" ng-click="view.params.chartoptions.showLegend = !view.params.chartoptions.showLegend; refreshView();">\n        <a><i class="fa fa-fw" ng-class="{\'fa-toggle-on\': view.params.chartoptions.showLegend, \'fa-toggle-off\': ! view.params.chartoptions.showLegend }"></i> Alternar legenda\n            <span style="margin-left: 5px" class="label label-default" ng-class="{ \'label-success\': view.params.chartoptions.showLegend }">{{ view.params.chartoptions.showLegend ? "Ligado" : "Desligado" }}</span>\n        </a>\n    </li>\n\n    <div ng-show="view.params.mode == \'chart\'" class=divider></div>\n\n    <li ng-show="view.params.mode == \'series\' || view.params.mode == \'chart\'" class=dropdown-submenu>\n        <a tabindex=0><i class="fa fa-fw fa-long-arrow-right"></i> Dimensão horizontal</a>\n        <ul class=dropdown-menu>\n\n          <li on-repeat-done ng-repeat-start="dimension in view.cube.dimensions" ng-if="dimension.levels.length == 1" ng-click=selectXAxis(dimension.name)>\n            <a href="">{{ dimension.label }}</a>\n          </li>\n          <li ng-repeat-end ng-if="dimension.levels.length != 1" class=dropdown-submenu>\n            <a tabindex=0>{{ dimension.label }}</a>\n\n            <ul ng-if="dimension.hierarchies_count() != 1" class=dropdown-menu>\n                <li ng-repeat="(hikey,hi) in dimension.hierarchies" class=dropdown-submenu>\n                    <a tabindex=0 href="" onclick="return false;">{{ hi.label }}</a>\n                    <ul class=dropdown-menu>\n                        \n                        <li ng-repeat="level in hi.levels" ng-click="selectXAxis(dimension.name + \'@\' + hi.name + \':\' + level.name )"><a href="">{{ level.label }}</a></li>\n                    </ul>\n                </li>\n            </ul>\n\n            <ul ng-if="dimension.hierarchies_count() == 1" class=dropdown-menu>\n                \n                <li ng-repeat="level in dimension.default_hierarchy().levels" ng-click="selectXAxis(dimension.name + \':\' + level.name);"><a href="">{{ level.label }}</a></li>\n            </ul>\n\n          </li>\n\n          <div class=divider></div>\n\n          <li ng-click=selectXAxis(null);><a href=""><i class="fa fa-fw fa-close"></i> Nenhuma</a></li>\n\n        </ul>\n    </li>\n\n    <li ng-show="view.params.mode == \'series\' || view.params.mode == \'chart\'" class=dropdown-submenu>\n        <a tabindex=0><i class="fa fa-fw fa-crosshairs"></i> Medida</a>\n        <ul class=dropdown-menu>\n\n          <li ng-repeat="measure in view.cube.measures" ng-if="view.cube.measureAggregates(measure.name).length > 0" class=dropdown-submenu>\n            <a href="">{{ measure.label }}</a>\n            <ul class=dropdown-menu>\n                <li ng-repeat="aggregate in view.cube.measureAggregates(measure.name)">\n                    <a href="" ng-click=selectMeasure(aggregate.ref)>{{ aggregate.label }}</a>\n                </li>\n            </ul>\n          </li>\n\n          <div class=divider ng-if="view.cube.measureAggregates(null).length > 0"></div>\n          <li ng-repeat="aggregate in view.cube.measureAggregates(null)" ng-if="view.cube.measureAggregates(null).length > 0">\n            <a href="" ng-click=selectMeasure(aggregate.ref)>{{ aggregate.label }}</a>\n          </li>\n\n        </ul>\n    </li>\n\n    <div ng-show="cvOptions.seriesOperationsEnabled && (view.params.mode == \'series\' || view.params.mode == \'chart\')" class=divider></div>\n\n    <li ng-show="cvOptions.seriesOperationsEnabled && (view.params.mode == \'series\' || view.params.mode == \'chart\')" class=dropdown-submenu>\n        <a tabindex=0><i class="fa fa-fw fa-calculator"></i> Series operations</a>\n        <ul class=dropdown-menu>\n          <li ng-click="selectOperation(\'difference\')"><a href=""><i class="fa fa-fw fa-line-chart"></i> Diferença</a></li>\n          <li ng-click="selectOperation(\'percentage\')"><a href=""><i class="fa fa-fw fa-percent"></i> Taxa de alteração</a></li>\n          \n          <div class=divider></div>\n          <li ng-click=selectOperation(null)><a href=""><i class="fa fa-fw fa-times"></i> Limpar operações</a></li>\n        </ul>\n    </li>\n\n    <div ng-show="view.params.mode == \'series\' || view.params.mode == \'chart\'" class=divider></div>\n\n    <li ng-show="view.params.mode != \'chart\'" ng-click=exportService.exportGridAsCsv(view)><a><i class="fa fa-fw fa-table"></i> Exportar tabela</a></li>\n    <li ng-show="view.params.mode == \'chart\' && view.params.charttype != \'radar\' " ng-click=view.exportChartAsPNG()><a><i class="fa fa-fw fa-picture-o"></i> Exportar gráfico</a></li>\n    <li ng-click=exportService.exportFacts(view)><a><i class="fa fa-fw fa-th"></i> Exportar fatos</a></li>\n\n  </ul>\n\n'),
a.put("views/cube/cube.html",'<div class=cv-view-panel ng-controller="CubesViewerViewsCubeController as cubeView">\n\n    <div ng-if="view.state == 3">\n        <div class="alert alert-danger" style="margin: 0px">\n            <p>Ocorreu um erro. Não é possível apresentar a visualização.</p>\n            <p ng-if="cubesService.state != 3">{{ view.error }}</p>\n            <p ng-if="cubesService.state == 3">Não foi possível conectar ao servidor de dados: {{ cubesService.stateText }}</p>\n            <p>Por favor, tente novamente e contate o administrador se o problema persistir.</p>\n            <p class=text-right>\n                <a class=alert-link href=http://jjmontesl.github.io/cubesviewer/ target=_blank>Visualizador de dados</a>\n            </p>\n        </div>\n    </div>\n\n    <div>\n        <h2 ng-show="view.getControlsHidden() && !view.cvOptions.readOnly" style="margin-top: 5px">\n            <i class="fa fa-fw fa-file-o"></i> {{ view.params.name }}\n        </h2>\n\n        <div ng-include="\'views/cube/alerts.html\'"></div>\n    </div>\n\n    <div ng-if="view.state == 2" style="min-height: 80px">\n\n        <div class="cv-view-viewmenu hidden-print" ng-hide=view.getControlsHidden()>\n\n            <div class="panel panel-primary pull-right" style="padding: 3px; white-space: nowrap; margin-bottom: 6px; margin-left: 6px">\n\n                <div ng-if=cvOptions.undoEnabled class=btn-group role=group ng-controller=CubesViewerViewsUndoController>\n                  <button type=button ng-click=undo() ng-disabled="view.undoPos <= 0" class="btn btn-default btn-sm" title=Undo><i class="fa fa-fw fa-undo"></i></button>\n                  <button type=button ng-click=redo() ng-disabled="view.undoPos >= view.undoList.length - 1" class="btn btn-default btn-sm" title=Redo><i class="fa fa-fw fa-undo fa-flip-horizontal"></i></button>\n                </div>\n\n                <div class=btn-group role=group aria-label=... style="margin-left: 5px">\n                  <button type=button ng-click="setViewMode(\'explore\')" ng-class="{\'active\': view.params.mode == \'explore\'}" class="btn btn-primary btn-sm explorebutton" title=Exporar><i class="fa fa-fw fa-arrow-circle-down"></i></button>\n                  <button type=button ng-click="setViewMode(\'series\')" ng-class="{\'active\': view.params.mode == \'series\'}" class="btn btn-primary btn-sm" title=Séries><i class="fa fa-fw fa-clock-o"></i></button>\n                  <button type=button ng-click="setViewMode(\'chart\')" ng-class="{\'active\': view.params.mode == \'chart\'}" class="btn btn-primary btn-sm" title=Gráficos><i class="fa fa-fw fa-area-chart"></i></button>\n                </div>\n\n                <div ng-include="\'views/cube/cube-menu-drilldown.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 5px"></div>\n\n                <div ng-include="\'views/cube/cube-menu-filter.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 2px"></div>\n\n                <div ng-include="\'views/cube/cube-menu-view.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 5px"></div>\n\n                <div ng-if=cvOptions.container ng-include="\'views/cube/cube-menu-panel.html\'" class="dropdown m-b" style="display: inline-block; margin-left: 5px"></div>\n\n            </div>\n\n            <div class=pull-right style="white-space: nowrap; padding-top: 4px; padding-bottom: 4px; margin-left: 6px; margin-bottom: 6px">\n\n            </div>\n\n        </div>\n\n        <div class=cv-view-viewinfo ng-if=!view.cvOptions.readOnly>\n            <div>\n                <div class="label label-secondary cv-infopiece cv-view-viewinfo-cubename" style="color: white; background-color: black">\n                    <span><i class="fa fa-fw fa-cube" title=Cubo></i> <b class="hidden-xs hidden-sm">Cubo:</b> {{ view.cube.label }}</span>\n                    <button type=button class="btn btn-info btn-xs" style="visibility: hidden"><i class="fa fa-fw fa-info"></i></button>\n                </div>\n\n                <div class=cv-view-viewinfo-drill>\n\n\n                    <div ng-repeat="drilldown in view.params.drilldown" ng-init="parts = view.cube.dimensionParts(drilldown);" ng-if="view.params.mode != \'facts\'" class="label label-secondary cv-infopiece cv-view-viewinfo-drill" style="color: black; background-color: #ccffcc">\n                        <span><i class="fa fa-fw fa-arrow-down" title=Drilldown></i> <b class="hidden-xs hidden-sm">Detalhamento:</b> <span title="{{ view.cube.dimensionParts(drilldown).label }}">{{ parts.labelShort }}</span></span>\n                        <button type=button class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px"><i class="fa fa-fw fa-info"></i></button>\n\n                        <button ng-hide="view.getControlsHidden() || parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionMinus" type=button ng-click="selectDrill(parts.drilldownDimensionMinus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px"><i class="fa fa-fw fa-minus"></i></button>\n                        <button ng-hide="view.getControlsHidden() || parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionPlus" type=button ng-click="selectDrill(parts.drilldownDimensionPlus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 0px"><i class="fa fa-fw fa-plus"></i></button>\n\n                        <button ng-hide=view.getControlsHidden() type=button ng-click=showDimensionFilter(drilldown) class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px"><i class="fa fa-fw fa-search"></i></button>\n                        <button ng-hide=view.getControlsHidden() type=button ng-click="selectDrill(drilldown, \'\')" class="btn btn-danger btn-xs hidden-print" style="margin-left: 1px"><i class="fa fa-fw fa-trash"></i></button>\n                    </div>\n\n                </div>\n                <div class=cv-view-viewinfo-cut>\n                    \n                    <div ng-repeat="cut in view.params.cuts" ng-init="equality = cut.invert ? \' &ne; \' : \' = \';" class="label label-secondary cv-infopiece cv-view-viewinfo-cut" style="color: black; background-color: #ffcccc">\n                        <span style="max-width: 480px"><i class="fa fa-fw fa-filter" title=Filter></i> <b class="hidden-xs hidden-sm">Filtro:</b> <span title="{{ view.cube.dimensionPartsFromCut(cut).label }}">{{ view.cube.dimensionPartsFromCut(cut).labelShort }}</span> <span ng-class="{ \'text-danger\': cut.invert }">{{ equality }}</span> <span title="{{ cut.label }}">{{ cut.label }}</span></span>\n                        <button type=button class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px"><i class="fa fa-fw fa-info"></i></button>\n                        <button ng-hide=view.getControlsHidden() type=button ng-click=showDimensionFilter(view.cube.dimensionPartsFromCut(cut).drilldownDimension) class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px"><i class="fa fa-fw fa-search"></i></button>\n                        <button ng-hide=view.getControlsHidden() type=button ng-click="selectCut(cut.dimension, \'\', cut.invert)" class="btn btn-danger btn-xs hidden-print" style="margin-left: 1px"><i class="fa fa-fw fa-trash"></i></button>\n                    </div>\n                </div>\n\n                <div ng-include="\'views/cube/filter/datefilter.html\'"></div>\n\n                <div class=cv-view-viewinfo-extra>\n\n                    <div ng-if="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="label label-secondary cv-infopiece cv-view-viewinfo-extra" style="color: black; background-color: #ccccff">\n                        <span style="max-width: 350px"><i class="fa fa-fw fa-crosshairs" title=Measure></i> <b class="hidden-xs hidden-sm">Medição:</b> {{ (view.params.yaxis != null) ? view.cube.aggregateFromName(view.params.yaxis).label : "Nenhum" }}</span>\n                        <button type=button class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px"><i class="fa fa-fw fa-info"></i></button>\n                    </div>\n\n                    <div ng-if="view.params.mode == \'series\' || view.params.mode == \'chart\'" class="label label-secondary cv-infopiece cv-view-viewinfo-extra" style="color: black; background-color: #ccddff">\n                        <span style="max-width: 350px"><i class="fa fa-fw fa-long-arrow-right" title="Horizontal dimension"></i> <b class="hidden-xs hidden-sm">Dimensão horizontal:</b> {{ (view.params.xaxis != null) ? view.cube.dimensionParts(view.params.xaxis).labelShort : "Nenhum" }}</span>\n                        <button type=button class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px"><i class="fa fa-fw fa-info"></i></button>\n\n                        <button ng-hide="view.getControlsHidden() || !view.params.xaxis || view.cube.dimensionParts(view.params.xaxis).hierarchy.levels.length < 2" ng-disabled="! view.cube.dimensionParts(view.params.xaxis).drilldownDimensionMinus" type=button ng-click="selectXAxis(view.cube.dimensionParts(view.params.xaxis).drilldownDimensionMinus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px"><i class="fa fa-fw fa-minus"></i></button>\n                        <button ng-hide="view.getControlsHidden() || !view.params.xaxis || view.cube.dimensionParts(view.params.xaxis).hierarchy.levels.length < 2" ng-disabled="! view.cube.dimensionParts(view.params.xaxis).drilldownDimensionPlus" type=button ng-click="selectXAxis(view.cube.dimensionParts(view.params.xaxis).drilldownDimensionPlus, true)" class="btn btn-secondary btn-xs hidden-print" style="margin-left: 0px"><i class="fa fa-fw fa-plus"></i></button>\n\n                        \n                        \n                    </div>\n\n                </div>\n\n                <div class=cv-view-viewinfo-extra ng-if="view.params.quantity_filter && view.params.quantity_filter.amount && !view.quantity_filter_open">\n                  <div class="label label-secondary cv-infopiece cv-view-viewinfo-extra" style="color: black; background-color: #ffecc6">\n                    <span><i class="fa fa-fw fa-arrow-down" title="Filtro de quantidade"></i> <b class="hidden-xs hidden-sm">Quantidade:</b>\n                      <span title="{{ view.params.quantity_filter.amount }}">Exibindo apenas os {{ view.params.quantity_filter.amount }} </span>\n                      <span ng-if="view.params.quantity_filter.order == \'desc\'">maiores resultados.</span>\n                      <span ng-if="view.params.quantity_filter.order == \'asc\'">menores resultados.</span>\n                    </span>\n                    <button ng-hide=view.getControlsHidden() type=button ng-click=selectQuantityFilter() class="btn btn-secondary btn-xs hidden-print" style="margin-left: 3px"><i class="fa fa-fw fa-search"></i></button>\n                    <button ng-hide=view.getControlsHidden() type=button ng-click=resetQuantityFilter() class="btn btn-danger btn-xs hidden-print" style="margin-left: 1px"><i class="fa fa-fw fa-trash"></i></button>\n                  </div>\n                </div>\n              </div>\n        </div>\n        <div class=clearfix></div>\n\n        <div class=cv-view-viewdialogs>\n            <div ng-if=view.dimensionFilter ng-include="\'views/cube/filter/dimension.html\'"></div>\n            <div ng-if=view.quantity_filter_open ng-include="\'views/cube/filter/quantity.html\'"></div>\n        </div>\n\n        <div class=cv-view-viewdata>\n\n            <div ng-if="view.params.mode == \'explore\'" ng-include="\'views/cube/explore/explore.html\'"></div>\n            <div ng-if="view.params.mode == \'facts\'" ng-include="\'views/cube/facts/facts.html\'"></div>\n            <div ng-if="view.params.mode == \'series\'" ng-include="\'views/cube/series/series.html\'"></div>\n            <div ng-if="view.params.mode == \'chart\'" ng-include="\'views/cube/chart/chart.html\'"></div>\n\n        </div>\n        <div class=clearfix></div>\n\n        <div class=cv-view-viewfooter></div>\n\n    </div>\n\n</div>\n'),a.put("views/cube/explore/explore.html",'<div ng-controller=CubesViewerViewsCubeExploreController>\n\n    \n    <h3 ng-if=!cvOptions.readOnly><i class="fa fa-fw fa-arrow-circle-down"></i> Dados agregados\n        <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n    </h3>\n\n    <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n        <span class=loadingbar-expand></span>\n    </div>\n\n    <div ui-grid=view.grid ng-if=!cvOptions.readOnly ui-grid-resize-columns ui-grid-move-columns ui-grid-selection ui-grid-auto-resize ui-grid-pagination ui-grid-pinning style="width: 100%" ng-style="{height: ((view.grid.data.length < 15 ? view.grid.data.length : 15) * 24) + 44 + 34 + \'px\'}">\n    </div>\n    <div ng-if=cvOptions.readOnly>\n      <table class=print-friendly-table>\n        <thead>\n          <tr>\n              <th ng-repeat="col in view.grid.columnDefs" ng-if="col.visible === undefined || col.visible" ng-style="{ \'max-width\': col.width + \'px\'}">{{ col.name }}</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr ng-repeat="datum in view.grid.data">\n            <td ng-repeat="col in view.grid.columnDefs" ng-class="{ \'text-right\': col.formatter }" ng-if="col.visible === undefined || col.visible" ng-style="{ \'max-width\': col.width + \'px\'}" ng-init="COL_FIELD = datum[col.field]; col.colDef = col;">\n              <div bind-html-compile=col.cellTemplate></div>\n            </td>\n          </tr>\n        </tbody>\n        <tfoot>\n          <tr>\n            <td ng-repeat="col in view.grid.columnDefs" ng-if="col.visible === undefined || col.visible" ng-style="{ \'max-width\': col.width + \'px\'}" ng-init="COL_FIELD = datum[col.field]; col.colDef = col;">\n              <div bind-html-compile=col.footerCellTemplate></div>\n            </td>\n          </tr>\n        </tfoot>\n      </table>\n    </div>\n    <div style="height: 30px">&nbsp;</div>\n\n</div>\n'),a.put("views/cube/facts/facts.html",'<div ng-controller=CubesViewerViewsCubeFactsController>\n\n    \n    <h3><i class="fa fa-fw fa-th"></i> Dados de Fatos\n        <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n    </h3>\n\n    <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n        <span class=loadingbar-expand></span>\n    </div>\n\n    <div ng-if="view.grid.data.length > 0" ui-grid=view.grid ui-grid-resize-columns ui-grid-move-columns ui-grid-selection ui-grid-auto-resize ui-grid-pagination ui-grid-pinning style="width: 100%" ng-style="{height: ((view.grid.data.length < 15 ? view.grid.data.length : 15) * 24) + 44 + 30 + \'px\'}">\n    </div>\n    <div ng-if="view.grid.data.length > 0" style="height: 30px">&nbsp;</div>\n\n    <div ng-if="viewController.view.pendingRequests == 0 && view.grid.data.length == 0">Nenhum fato retornado pela combinação de filtros atual.</div>\n\n</div>\n'),a.put("views/cube/filter/datefilter.html",'<div class=cv-view-viewinfo-date>\n    <div ng-repeat="datefilter in view.params.datefilters" ng-controller=CubesViewerViewsCubeFilterDateController ng-init="dimparts = view.cube.dimensionParts(datefilter.dimension);" class="label label-secondary cv-infopiece cv-view-viewinfo-cut text-left" style="color: black; background-color: #ffdddd; text-align: left">\n        <span style="max-width: 280px; white-space: nowrap"><i class="fa fa-fw fa-filter"></i> <b class="hidden-xs hidden-sm">Filtro:</b> {{ dimparts.labelNoLevel }}:</span>\n\n        \n\n        <div class=cv-datefilter style="overflow: visible; display: inline-block">\n\n            <form class=form-inline>\n\n                 <div class=form-group style="display: inline-block; margin: 0px">\n                    <div class=dropdown style="display: inline-block">\n                      <button ng-hide=view.getControlsHidden() style="height: 20px" class="btn btn-default btn-sm dropdown-toggle" type=button data-toggle=dropdown data-submenu>\n                        <i class="fa fa-fw fa-calendar"></i> {{ datefilter.mode | datefilterMode }} <span class=caret></span>\n                      </button>\n                      <span ng-show=view.getControlsHidden()><i class="fa fa-fw fa-calendar"></i> {{ datefilter.mode | datefilterMode }}</span>\n\n                      <ul class="dropdown-menu cv-view-menu cv-view-menu-view">\n                        <li ng-click="setMode(\'custom\')"><a><i class="fa fa-fw"></i> Personalizado</a></li>\n                        <div class=divider></div>\n                        <li ng-click="setMode(\'auto-last1m\')"><a><i class="fa fa-fw"></i> Último mês</a></li>\n                        <li ng-click="setMode(\'auto-last3m\')"><a><i class="fa fa-fw"></i> Últimos 3 meses</a></li>\n                        <li ng-click="setMode(\'auto-last6m\')"><a><i class="fa fa-fw"></i> Últimos 6 meses</a></li>\n                        <li ng-click="setMode(\'auto-last12m\')"><a><i class="fa fa-fw"></i> Último ano</a></li>\n                        <li ng-click="setMode(\'auto-last24m\')"><a><i class="fa fa-fw"></i> Últimos 2 anos</a></li>\n                        <li ng-click="setMode(\'auto-january1st\')"><a><i class="fa fa-fw"></i> Desde 1º de Janeiro</a></li>\n                        <li ng-click="setMode(\'auto-yesterday\')"><a><i class="fa fa-fw"></i> Ontem</a></li>\n                      </ul>\n                  </div>\n                 </div>\n\n            <div ng-show="datefilter.mode == \'custom\'" style="display: inline-block; margin: 0px">\n\n                 &rArr;\n\n                 <div class=form-group style="display: inline-block; margin: 0px">\n                    <p class="input-group disabled" style="margin: 0px; display: inline-block">\n                      <input ng-disabled=view.getControlsHidden() autocomplete=off type=text style="height: 20px; width: 80px; display: inline-block" class="form-control input-sm" ng-model=dateStart.value is-open=dateStart.opened ng-required=true close-text=Fechar>\n                      <span ng-hide=view.getControlsHidden() class=input-group-btn style="display: inline-block">\n                        <button type=button style="height: 20px" class="btn btn-default" ng-click=dateStartOpen()><i class="fa fa-fw fa-calendar"></i></button>\n                      </span>\n                    </p>\n                </div>\n\n                <span ng-hide=view.getControlsHidden() style="margin-left: 17px; margin-right: 0px">-</span>\n                <span ng-show=view.getControlsHidden() style="margin-left: 0px; margin-right: 0px">-</span>\n\n                 <div class=form-group style="display: inline-block; margin: 0px">\n                    <p class=input-group style="margin: 0px; display: inline-block">\n                      <input ng-disabled=view.getControlsHidden() autocomplete=off type=text style="height: 20px; width: 80px; display: inline-block" class="form-control input-sm" ng-model=dateEnd.value ng-required=true close-text=Fechar>\n                      <span ng-hide=view.getControlsHidden() class=input-group-btn style="display: inline-block">\n                        <button type=button style="height: 20px" class="btn btn-default" ng-click=dateStartOpen()><i class="fa fa-fw fa-calendar"></i></button>\n                      </span>\n                    </p>\n                </div>\n\n            </div>\n\n        </form>\n\n        </div>\n\n        <button type=button ng-hide=view.getControlsHidden() ng-click="selectDateFilter(datefilter.dimension, false)" class="btn btn-danger btn-xs" style="margin-left: 20px"><i class="fa fa-fw fa-trash"></i></button>\n        <button type=button class="btn btn-info btn-xs" style="visibility: hidden; margin-left: -20px"><i class="fa fa-fw fa-info"></i></button>\n\n\n    </div>\n</div>\n\n'),a.put("views/cube/filter/dimension.html",'<div ng-controller=CubesViewerViewsCubeFilterDimensionController>\n\n  <div class="panel panel-default panel-outline hidden-print" ng-hide=view.getControlsHidden() style="border-color: #ffcccc">\n    <div class="panel-heading clearfix" style="border-color: #ffcccc">\n      <button class="btn btn-xs btn-danger pull-right" ng-click=closeDimensionFilter()><i class="fa fa-fw fa-close"></i></button>\n      <h4 style="margin: 2px 0px 0px 0px"><i class="fa fa-fw fa-filter"></i> Filtro de dimensão: <b>{{ parts.label }}</b>\n      </h4>\n    </div>\n    <div class=panel-body>\n\n      <div>\n        <form>\n\n          <div class="form-group has-feedback" style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px">\n            \n            <input type=text class=form-control ng-model=searchString ng-model-options="{ debounce: 300 }" placeholder=Pesquisar... style="width: 16em">\n            <i class="fa fa-fw fa-times-circle form-control-feedback" ng-click="searchString = \'\'" style="cursor: pointer; pointer-events: inherit"></i>\n          </div>\n\n          <div class=btn-group style="margin-left: 10px; display: inline-block; vertical-align: middle; margin-bottom: 2px; margin-right: 5px">\n            <button class="btn btn-default" ng-click=selectAll(); type=button title="Selecionar todos"><i class="fa fa-fw fa-check-square-o"></i></button>\n            <button class="btn btn-default" ng-click=selectNone(); type=button title="Desselecionar todos"><i class="fa fa-fw fa-square-o"></i></button>\n          </div>\n\n          <div class=btn-group style="display: inline-block; vertical-align: middle; margin-bottom: 2px; margin-right: 5px">\n            <button ng-hide="parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionMinus" class="btn btn-default" ng-click=showDimensionFilter(parts.drilldownDimensionMinus) type=button title="Detalhar menos"><i class="fa fa-fw fa-minus"></i></button>\n            <button ng-hide="parts.hierarchy.levels.length < 2" ng-disabled="! parts.drilldownDimensionPlus" class="btn btn-default" ng-click=showDimensionFilter(parts.drilldownDimensionPlus) type=button title="Detalhar mais"><i class="fa fa-fw fa-plus"></i></button>\n            <button class="btn btn-default" type=button title="Detalhar isto" ng-click="selectDrill(parts.drilldownDimension, true)"><i class="fa fa-fw fa-arrow-down"></i>\n            </button>\n          </div>\n\n          <div class=form-group style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px; margin-right: 5px">\n            <div class="btn btn-default" ng-click="filterShowAll = ! filterShowAll" ng-class="{ \'active\': filterShowAll, \'btn-info\': filterShowAll }">\n              <i class="fa fa-fw fa-filter fa-rotate-180"></i> Exibir todos\n            </div>\n          </div>\n\n          <div class=form-group style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px">\n\n            <div class="btn btn-default" ng-click="filterInverted = !filterInverted" ng-class="{ \'active\': filterInverted, \'btn-danger\': filterInverted }">\n              <input type=checkbox ng-model=filterInverted style="pointer-events: none; margin: 0px; vertical-align: middle">\n              <b>&ne;</b> Inverter\n            </div>\n\n          </div>\n\n          <div class=form-group style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px">\n            <button ng-click=applyFilter() class="btn btn-success" type=button><i class="fa fa-fw fa-filter"></i>\n              Aplicar\n            </button>\n          </div>\n        </form>\n      </div>\n\n      <div class=clearfix></div>\n\n      <div class=row>\n        <div class="col-xs-9 col-sm-6">\n          <div style="margin-top: 5px">\n            <div class="panel panel-default panel-outline" style="margin-bottom: 0px">\n              <div class=panel-body style="max-height: 180px; overflow-y: auto; overflow-x: hidden">\n                <div ng-show=loadingDimensionValues><i class="fa fa-circle-o-notch fa-spin fa-fw"></i> Carregando...\n                </div>\n\n                <div ng-if=!loadingDimensionValues>\n                  <div ng-repeat="val in dimensionValues | filter:filterDimensionValue(searchString)" style="overflow-x: hidden; text-overflow: ellipsis; white-space: nowrap">\n                    <label style="font-weight: normal; margin-bottom: 2px">\n                      <input type=checkbox name=selectedValues[] ng-model=val.selected value="{{ val.value }}" style="vertical-align: bottom">\n                      <span title="{{ val.label }}" bind-once>{{ val.label }}</span>\n                    </label>\n                  </div>\n                </div>\n\n              </div>\n            </div>\n\n            <div ng-if=!loadingDimensionValues class="" style="margin-bottom: 0px">\n              <div class=text-right>\n                {{ dimensionValues.length }} itens\n              </div>\n            </div>\n\n            <div ng-if="!loadingDimensionValues && dimensionValues.length >= cubesService.cubesserver.info.json_record_limit" class="alert alert-warning" style="margin-bottom: 0px">\n              <div style="display: inline-block"><i class="fa fa-exclamation"></i></div>\n              <div style="display: inline-block; margin-left: 20px">\n                O limite de itens {{ cubesService.cubesserver.info.json_record_limit }} foi atingido. A lista de valores de dimensão está <b>incompleta</b>.<br>\n              </div>\n            </div>\n\n          </div>\n        </div>\n      </div>\n      <div class=clearfix></div>\n    </div>\n  </div>\n\n\n</div>\n'),a.put("views/cube/filter/quantity.html",'<div ng-controller=CubesViewerViewsCubeFilterQuantityController>\n\n  <div class="panel panel-default panel-outline hidden-print" ng-hide=view.getControlsHidden() style="border-color: #ffcccc">\n    <div class="panel-heading clearfix" style="border-color: #ffcccc">\n      <button class="btn btn-xs btn-danger pull-right" ng-click=closeQuantityFilter()><i class="fa fa-fw fa-close"></i></button>\n      <h4 style="margin: 2px 0px 0px 0px"><i class="fa fa-fw fa-filter"></i> Filtro de quantidade\n      </h4>\n    </div>\n    <div class=panel-body>\n      <div>\n        <form>\n          <span>Retornar apenas os</span>\n          <input style="width: 40px" type=number ng-model=quantity_filter.amount placeholder=10>\n          <span style="text-decoration: underline; color: dodgerblue; cursor: pointer" ng-if="quantity_filter.order == \'top\'" ng-click="quantity_filter.order = \'bottom\'">maiores</span>\n          <span style="text-decoration: underline; color: dodgerblue; cursor: pointer" ng-if="quantity_filter.order == \'bottom\'" ng-click="quantity_filter.order = \'top\'">menores</span>\n          <span>resultados</span>. <input type=checkbox ng-model=quantity_filter.group_remaining> Agrupar o restante como "Outros".\n\n\n          <div class=form-group style="display: inline-block; margin-bottom: 0; vertical-align: middle; margin-bottom: 2px">\n            <button ng-click=applyFilter() class="btn btn-success" type=button><i class="fa fa-fw fa-filter"></i>\n              Aplicar\n            </button>\n          </div>\n        </form>\n      </div>\n\n      <div class=clearfix></div>\n    </div>\n  </div>\n</div>\n'),a.put("views/cube/series/series.html",'<div ng-controller=CubesViewerViewsCubeSeriesController>\n  <h3 ng-if=!cvOptions.readOnly><i class="fa fa-fw fa-clock-o"></i> Tabela de séries\n    <i ng-show="view.pendingRequests > 0" class="fa fa-circle-o-notch fa-spin fa-fw margin-bottom text-info pull-right"></i>\n  </h3>\n\n  <div ng-if="view.pendingRequests > 0" class=loadingbar-content>\n    <span class=loadingbar-expand></span>XXXX\n  </div>\n\n  <div ng-if="view.grid.data.length > 0 && !cvOptions.readOnly" ui-grid=view.grid ui-grid-resize-columns ui-grid-move-columns ui-grid-selection ui-grid-auto-resize ui-grid-pagination ui-grid-pinning style="width: 100%" ng-style="{height: ((view.grid.data.length < 15 ? view.grid.data.length : 15) * 24) + 44 + 34 + \'px\'}">\n  </div>\n  <div ng-if=cvOptions.readOnly>\n    <table class=print-friendly-table>\n      <thead>\n      <tr>\n        <th ng-repeat="col in view.grid.columnDefs" ng-if="col.visible === undefined || col.visible" ng-style="{ \'max-width\': col.width + \'px\'}">{{ col.name }}\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-repeat="datum in view.grid.data">\n        <td ng-repeat="col in view.grid.columnDefs" ng-class="{ \'text-right\': col.formatter }" ng-if="col.visible === undefined || col.visible" ng-style="{ \'max-width\': col.width + \'px\'}" ng-init="COL_FIELD = datum[col.field]; col.colDef = col;">\n          <div ng-if=col.cellTemplate bind-html-compile=col.cellTemplate></div>\n          <div ng-if=!col.cellTemplate>{{ COL_FIELD }}</div>\n        </td>\n      </tr>\n      </tbody>\n      <tfoot ng-if=view.grid.showColumnFooter>\n      <tr>\n        <td ng-repeat="col in view.grid.columnDefs" ng-if="col.visible === undefined || col.visible" ng-style="{ \'max-width\': col.width + \'px\'}" ng-init="COL_FIELD = datum[col.field]; col.colDef = col;">\n          <div bind-html-compile=col.footerCellTemplate></div>\n        </td>\n      </tr>\n      </tfoot>\n    </table>\n  </div>\n  <div ng-if="view.grid.data.length > 0" style="height: 30px">&nbsp;</div>\n\n  <div ng-if="view.pendingRequests == 0 && view.params.yaxis == null" class="alert alert-info" style="margin-bottom: 0px">\n    <p>\n      Não é possível apresentar a tabela de séries: nem uma <b>medida</b> foi selecionada.\n    </p>\n    <p>\n      Dica: utilize o <kbd><i class="fa fa-fw fa-cogs"></i> menu de &gt; <i class="fa fa-fw fa-crosshairs"></i>\n      visualizações</kbd> de medidas.\n    </p>\n  </div>\n\n  <div ng-if="view.pendingRequests == 0 && view.params.yaxis != null && view.grid.data.length == 0" class="alert alert-info" style="margin-bottom: 0px">\n    <p>\n      Não é possível apresentar a tabela de séries: <b>nenhum dado</b> foi retornado pela combinação de dimensão\n      horizontal, detalhamento ou filtro.\n    </p>\n    <p>\n      Dica: utilize o menu <kbd><i class="fa fa-fw fa-cogs"></i> Visualização</kbd> para selecionar a dimensão\n      horizontal.\n    </p>\n  </div>\n\n</div>\n')}]),angular.module("ChatRoomsEditModalControllerModule",["ChatServiceModule"]).controller("ChatRoomsEditModalController",["ChatService","$scope","$modalInstance","$state","room",function(a,b,c,d,e){b.room=angular.copy(e)||{title:""},b.save=function(){b.processingForm=!0;var f=null===e?a.createRoom(b.room):a.updateRoom(b.room);f.then(function(a){b.processingForm=!1,e?(b.showMessage("ok","A sala de chat foi editada.","success",!0),e.title=b.room.title):(b.showMessage("ok","A sala de chat foi criada com sucesso.","success",!0),d.go("chat-rooms.show",{id:a.data.id})),c.close()},function(a){b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("TwoStepSelectorModule",["FocusIfComponentModule"]).controller("TwoStepSelectorController",["$rootScope","$modal","$scope","Restangular","$modalInstance","multiple","promise","selection","title","categoriesLabel","categoriesPromise","itemsLabel","itemsPromiseGenerator",function(a,b,c,d,e,f,g,h,i,j,k,l,m){c.title=i,c.categoriesLabel=j,c.itemsLabel=l,c.loadingCategories=!0,k.promise.then(function(a){if(c.categories=a||[],c.loadingCategories=!1,h&&!_.isEmpty(h)){var b=_.keys(h)[0],d=_.findWhere(a,{id:parseInt(b,10)}),e=angular.copy(h[b]);c.selectCategory(d).then(function(){_.each(e,function(a){var b=_.findWhere(c.items,{id:a});c.toggleItem(d,b)})})}else h={}},function(){c.fetchCategoriesFailure=!0,c.loadingCategories=!1}),c.selectCategory=function(a){return c.selectedCategory=a,_.each(h,function(a,b){
a.length<1&&delete h[b]}),f||(h={}),h[a.id]||(h[a.id]=[]),c.loadingItems=!0,m.call(null,a).then(function(a){c.items=a||[],c.loadingItems=!1},function(){c.fetchItemsFailure=!0,c.loadingItems=!1})},c.toggleItem=function(a,b){if(!f)return void(h[a.id]=[b]);h[a.id]||(h[a.id]=[]);var c=h[a.id].indexOf(_.findWhere(h[a.id],{id:b.id}));c===-1?h[a.id].push(b):h[a.id].splice(c,1)},c.categorySelected=function(a){return _.has(h,a.id)},c.itemSelected=function(a,b){return!!c.categorySelected(a)&&_.findWhere(h[a.id],{id:b.id})},c.valid=function(){return _.any(_.select(h,function(a){return a.length>0}))},c.confirm=function(){g.resolve(h),e.close()},c.close=function(){e.close(),g.reject()}}]).factory("TwoStepSelector",["$modal","$q",function(a,b){return{open:function(c,d,e,f,g,h,i){var j=b.defer();return a.open({templateUrl:"modals/flows/steps/fields/two-step-selector/two-step-selector.template.html",windowClass:"twoStepSelectorModal",resolve:{selection:function(){return c},title:function(){return d},categoriesLabel:function(){return f},categoriesPromise:function(){return{promise:g}},itemsLabel:function(){return h},itemsPromiseGenerator:function(){return i},promise:function(){return j},multiple:function(){return!!e}},controller:"TwoStepSelectorController"}),j.promise}}}]),angular.module("BusinessReportsDestroyModalModule",["BusinessReportsServiceModule","FocusIfComponentModule"]).controller("BusinessReportsDestroyModalController",["$rootScope","$modal","$scope","Restangular","BusinessReportsService","$modalInstance","report","promise","$log",function(a,b,c,d,e,f,g,h,i){i.info("ReportsDestroyModalController created."),c.$on("$destroy",function(){i.info("ReportsDestroyModalController destroyed.")}),c.report=g,c.confirm=function(){var a=e.remove(c.report.id);c.deleting=!0,a.then(function(){f.close(),c.deleting=!1,c.showMessage("ok","O Relatório "+c.report.title+" foi removido com sucesso","success",!0),h.resolve(g)},function(){c.deleting=!1,c.showMessage("exclamation-sign"," Não foi possível remover o relatório "+c.report.title+". Por favor, tente novamente em alguns minutos.","error",!0),f.close(),h.reject(g)})},c.close=function(){f.close()}}]).factory("BusinessReportDestroyModalService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"modals/business-reports/destroy/business-reports-destroy.template.html",windowClass:"businessReportDestroyModal",resolve:{report:function(){return c},promise:function(){return d}},controller:"BusinessReportsDestroyModalController"}),d.promise}}}]),angular.module("BusinessReportsEditChartModalModule",["ItemSelectorDirectiveModule"]).controller("BusinessReportsEditChartModalController",["$modal","$scope","ReportsCategoriesService","$modalInstance","promise","chart",function(a,b,c,d,e,f){b.chartTypes=[{type:"BarChart",title:"Barra"},{type:"PieChart",title:"Pizza"},{type:"AreaChart",title:"Área"},{type:"LineChart",title:"Linha"}],b.metricTypes=[{metric:"total-reports-by-category",title:"Total de relatos criados por categoria"},{metric:"total-reports-by-status",title:"Total de relatos por estado"},{metric:"total-reports-overdue-by-category",title:"Total de relatos atrasados por categoria"},{metric:"total-reports-overdue-by-category-per-day",title:"Total de relatos atrasados por quantidade de dias em atraso"},{metric:"total-reports-assigned-by-category",title:"Total de relatos delegados por categoria"},{metric:"total-reports-assigned-by-group",title:"Total de relatos que foram associados, por grupo"},{metric:"total-reports-unassigned-to-user",title:"Total de relatos que não foram delegados à nenhum usuário"},{metric:"average-resolution-time-by-category",title:"Média de tempo de resolução por categoria"},{metric:"average-resolution-time-by-group",title:"Média de tempo de resolução por grupo associado"},{metric:"average-overdue-time-by-category",title:"Média de atraso por categoria"},{metric:"average-overdue-time-by-group",title:"Média de tempo de atraso por grupo"}],b.getReportCategories=c.fetchTitlesAndIds,b.chart=f,b.select2Options={minimumResultsForSearch:1/0},b.valid=function(){return b.chart.categories.length>0&&b.chart.metric&&b.chart.type},b.close=function(){e.reject(),d.close()},b.confirm=function(){e.resolve(b.chart),d.close()},b.chart.categories=b.chart.categories||[],b.selectCategory=function(a){var c=_.findWhere(b.chart.categories,{id:a.id});c||b.chart.categories.push(a)},b.removeCategory=function(a){b.chart.categories.splice(b.chart.categories.indexOf(a),1)}}]).factory("BusinessReportsEditChartModalService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"modals/business-reports/edit-chart/business-reports-edit-chart.template.html",windowClass:"businessReportEditChartModal",resolve:{promise:function(){return d},chart:function(){return c}},controller:"BusinessReportsEditChartModalController",controllerAs:"businessReportEditCtrl"}),d.promise}}}]),angular.module("caseCreatedModalModule",[]).controller("caseCreatedModalController",["$modal","$scope","$modalInstance","$state","kase",function(a,b,c,d,e){b["case"]=e,b.close=function(){c.close()},b.openCase=function(){c.close(),d.go("cases.edit",{id:e.id})}}]).factory("caseCreatedModalService",["$modal","$q",function(a,b){return{open:function(c){var d=b.defer();return a.open({templateUrl:"modals/reports/case-created/case-created.template.html",windowClass:"caseCreatedModalController",resolve:{kase:function(){return c}},controller:"caseCreatedModalController",controllerAs:"caseCreatedModalCtrl"}),d.promise}}}]),angular.module("ReportsDestroyModalControllerModule",["ReportsItemsServiceModule"]).controller("ReportsDestroyModalController",["$rootScope","$scope","Restangular","ReportsItemsService","$modalInstance","report","$log",function(a,b,c,d,e,f,g){g.info("ReportsDestroyModalController created."),b.$on("$destroy",function(){g.info("ReportsDestroyModalController destroyed.")}),b.report=f,b.confirm=function(){var c=d.remove(b.report.id);b.deleting=!0,c.then(function(){e.close(),a.$broadcast("reports:itemRemoved",b.report.id),b.deleting=!1,b.showMessage("ok","O Relato "+b.report.protocol+" foi removido com sucesso","success",!0)},function(){b.deleting=!1,b.showMessage("exclamation-sign"," Não foi possível remover o relato "+b.report.protocol+". Por favor, tente novamente em alguns minutos.","error",!0)})},b.close=function(){e.close()}}]),angular.module("ReportsEditStatusModalControllerModule",["ReportsFeatureFlagsServiceModule","caseCreatedModalModule","CasesServiceModule"]).controller("ReportsEditStatusModalController",["Restangular","$scope","$rootScope","$state","$modalInstance","category","report","statusesResponse","ReportsFeatureFlagsService","CasesService","caseCreatedModalService",function(a,b,c,d,e,f,g,h,i,j,k){c.resolvingRequest=!1,b.category=f,b.report=angular.copy(g),b.caseUsers=[],b.category.statuses=h.data,b.selected_status_id=b.report.status_id,_.each(b.category.statuses,function(a){a.permittedGroups=[a.responsible_group]}),b.report.privateComment=!0,b.changeStatus=function(a){b.selected_status_id=a.id,b.status=a},i.getFeatureFlags().then(function(a){i.convertFeaturesFlagsFrom(a.data).and().addInto(b)}),b.save=function(){b.processing=!0;var c=0;b.report.privateComment&&(c=1);var f={status_id:b.selected_status_id,comment:b.report.comment,comment_visibility:c};b.caseUsers[0]&&(f.case_conductor_id=b.caseUsers[0].id);var g=a.one("reports",b.category.id).one("items",b.report.id).one("update_status").customPUT(f,"?return_fields=status_id,case.id,case.created_at,case.updated_at,case.status,case.initial_flow.title");g.then(function(a){b.report.status_id=b.selected_status_id,a.data["case"]&&(b.report["case"]=j.denormalizeCase(a.data["case"])),b.processing=!1,e.close(),f.case_conductor_id&&k.open(a.data["case"]),b.showMessage("ok","O estado do relato foi alterado com sucesso.","success",!0),d.go(d.current,{},{reload:!0})})},b.close=function(){e.close()}}]),angular.module("ReportsEditCategoryModalControllerModule",["SelectListComponentModule"]).controller("ReportsEditCategoryModalController",["Restangular","$scope","$modalInstance","category","report","categories","$rootScope","$state",function(a,b,c,d,e,f,g,h){b.categories=f.data,g.resolvingRequest=!1,b.report=angular.copy(e),b.category=d,b.transfer={toCategory:null,toStatus:null},b.subCategories=function(a){return null==a.parent_id?"Categorias principais":null!==a.parent_id?"Subcategorias":void 0},b.$on("optionSelected",function(c,d){c.stopPropagation(),b.categoryData=d;var e=a.one("reports").one("categories",d.id).all("statuses").getList({return_fields:"id,color,title,flow"});e.then(function(a){b.categoryData.statuses=a.data})}),b.confirm=function(){c.close(),g.resolvingRequest=!0;var d=a.one("reports",b.category.id).one("items",b.report.id).customPUT({new_category_id:b.transfer.toCategory,new_status_id:b.transfer.toStatus.id,return_fields:""},"change_category");d.then(function(){b.showMessage("ok","A categoria do relato foi alterada com sucesso!","success",!0),h.go(h.current,{},{reload:!0})})},b.close=function(){c.close()}}]),angular.module("ReportsSelectAddressModalControllerModule",["SelectLatLngMapComponent","SearchLatLngMapComponent"]).controller("ReportsSelectAddressModalController",["$scope","$modalInstance","$state","$rootScope","Restangular","category","report",function(a,b,c,d,e,f,g){a.updating=!0,a.category=f,a.latLng=[g.position.latitude,g.position.longitude],a.close=function(){b.close()},a.save=function(){b.close(),d.resolvingRequest=!0;var f={latitude:a.latLng[0],longitude:a.latLng[1],address:a.formattedAddress,return_fields:""},h=e.one("reports",g.category.id).one("items",g.id).customPUT(f);h.then(function(b){a.showMessage("ok","O endereço do relato foi alterado com sucesso.","success",!0),c.go(c.current,{},{reload:!0})})}}]),angular.module("ReportsForwardModalControllerModule",[]).controller("ReportsForwardModalController",["Restangular","$rootScope","$scope","$state","$modalInstance","category","report","groupsResponse",function(a,b,c,d,e,f,g,h){b.resolvingRequest=!1,c.category=f,c.report=angular.copy(g),c.groups=h.data,c.filterByIds=function(a){return(!g.assigned_group||g.assigned_group.id!=a.id)&&!!~f.solver_groups_ids.indexOf(a.id)},c.save=function(){c.processing=!0;var b=a.one("reports",c.category.id).one("items",c.report.id).one("forward").customPUT({group_id:c.report.group_id,comment:c.report.comment,return_fields:""});b.then(function(){c.processing=!1,e.close(),c.showMessage("ok","O grupo responsável foi alterado com sucesso.","success",!0),d.go(d.current,{},{reload:!0})})},c.close=function(){e.close()}}]),angular.module("ReportsSendNotificationsModalControllerModule",["ReportsCategoriesNotificationsServiceModule"]).controller("ReportsSendNotificationsModalController",["$scope","$modalInstance","Restangular","$q","$log","$http","$rootScope","parentScope","report","notifications","ReportsCategoriesNotificationsService",function(a,b,c,d,e,f,g,h,i,j,k){e.info("ReportsSendNotificationsModalController created."),a.$on("$destroy",function(){e.info("ReportsSendNotificationsModalController destroyed.")}),a.notifications=j,a.loadingInfo=!1;var l=function(){a.confirmSendMap={},a.notificationPromises={},a.showRestartProcessLink=!1;for(var b=0,c=a.notifications.length;b<c;b++)a.confirmSendMap[a.notifications[b]]=!1,a.notifications[b].created_at&&(a.showRestartProcessLink=!0)};a.canRestartNotificationProcess=g.hasAnyPermission(["reports_items_restart_notification","reports_full_access","reports_categories_edit","reports_items_edit"]),l();var m=function(){a.loadingInfo=!0,k.cleanCache(),k.getAvailableNotificationsForReport(i.id,i.category.id).then(function(b){a.notifications=b,l(),a.loadingInfo=!1})};a.send=function(b){a.confirmSendMap[b.notification_type.id]=!0},a.confirmSend=function(b){a.loadingInfo=!0;var c=b.notification_type.id;b.sent?a.notificationPromises[c]=k.resendNotification(i.id,i.category.id,b.id):a.notificationPromises[c]=k.sendNotification(i.id,i.category.id,b.notification_type.id);var e=k.getLastNotification(i.id,i.category.id);a.sendPromise=d.all(a.notificationPromises[c],e).then(function(c){a.addModalMessage("ok","Notificação ["+b.notification_type.title+"]"+(b.sent?" reemitida":" emitida"),"success"),m(),h.lastNotification=c.data,h.report.status=c.data.current_status,h.refreshHistory(),h.reloadNotifications()})};var n=function(a){return a+" dia"+(a>1?"s":"")};a.getDefaultDeadlineInDaysTxt=function(a){var b=a.deadline_in_days?a.deadline_in_days:a.notification_type.default_deadline_in_days;return b?n(b):"-"},a.getDaysToDeadlineTxt=function(a){if(a.sent){var b=a.days_to_deadline;return b<=0?"Encerrado":n(b)}return"-"},a.restartProcess=function(){a.loadingInfo=!0,a.restartProcessPromise=k.restartProcess(i.id,i.category.id),a.restartProcessPromise.then(function(b){a.addModalMessage("ok","Processo reiniciado.","success"),m(),h.report.status=b.data,h.refreshHistory(),h.reloadNotifications()})},a.close=function(){b.close()}}]),angular.module("ReportsEditReferenceModalControllerModule",[]).controller("ReportsEditReferenceModalController",["Restangular","$scope","$modalInstance","report","parentScope",function(a,b,c,d,e){b.report=angular.copy(d),b.save=function(){b.processingForm=!0;var f=a.one("reports",d.category.id).one("items",d.id).customPUT({reference:b.report.reference,return_fields:"reference"});f.then(function(a){c.close(),b.processingForm=!1,b.showMessage("ok","A referência do relato foi alterada com sucesso.","success",!0),d.reference=b.report.reference,e.refreshHistory()},function(a){c.close(),b.showMessage("exclamation-sign","Não foi possível alterar a referência.","error",!0),b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("ReportsEditCustomFieldModalControllerModule",[]).controller("ReportsEditCustomFieldModalController",["Restangular","$scope","$modalInstance","field","report",function(a,b,c,d,e){b.field=angular.copy(d),b.save=function(){b.processingForm=!0;var f={};f[b.field.id]=b.field.value;var g=a.one("reports",e.category.id).one("items",e.id).customPUT({custom_fields:f});g.then(function(){c.close(),_.extend(d,b.field),b.processingForm=!1},function(){b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("ReportsPrintModalControllerModule",[]).controller("ReportsPrintModalController",["$scope","$modalInstance","openModal",function(a,b,c){a.selectedSections=[],a.sections=[{name:"Dados do relato",key:"fields"},{name:"Fotos do relato",key:"images"},{name:"Mapa com localização do relato",key:"map"},{name:"Informações do solicitante",key:"user"},{name:"Respostas ao solicitante",key:"replies"},{name:"Observações internas",key:"comments"},{name:"Histórico do relato",key:"history"},{name:"Feedback do usuário",key:"feedback"}],a.toggleAll=function(){return a.allSelected()?void(a.selectedSections=[]):void _.each(a.sections,function(b){a.isActive(b)||a.selectedSections.push(b.key)})},a.allSelected=function(){return a.sections.length===a.selectedSections.length},a.isActive=function(b){return a.selectedSections.indexOf(b.key)!==-1},a.toggle=function(b){var c=a.selectedSections.indexOf(b.key);c===-1?a.selectedSections.push(b.key):a.selectedSections.splice(c,1)},a.confirm=function(){c(a.selectedSections),b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersAreaModalControllerModule",["AreaMapComponentModule","AddAreaCircleFormComponentModule","ReplaceDotWithCommaHelperModule"]).controller("AdvancedFiltersAreaModalController",["$scope","$modalInstance","activeAdvancedFilters",function(a,b,c){a.activeAdvancedFilters=c,a.save=function(){for(var c=a.circles.length-1;c>=0;c--){var d={title:"Perímetro",type:"area",desc:a.circles[c].get("distance").toFixed(2).replace(".",",")+"km de "+a.circles[c].get("position").lat().toFixed(4)+", "+a.circles[c].get("position").lng().toFixed(4),value:{latitude:a.circles[c].get("position").lat(),longitude:a.circles[c].get("position").lng(),distance:1e3*a.circles[c].get("distance")}};a.activeAdvancedFilters.push(d)}b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersAuthorModalControllerModule",["FocusOnEventComponentModule","UsersServiceModule"]).controller("AdvancedFiltersAuthorModalController",["$scope","$modalInstance","activeAdvancedFilters","UsersService",function(a,b,c,d){a.activeAdvancedFilters=c,a.users=[],a.field={},a.usersAutocomplete={options:{onlySelect:!0,source:function(a,b){var c=d.fetchAll({query:a.term,per_page:10});c.then(function(a){b(_.map(a,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:angular.noop()}}},a.usersAutocomplete.events={select:function(b,c){for(var d=!1,e=a.users.length-1;e>=0;e--)a.users[e].id===c.item.user.id&&(d=!0);d||a.users.push(c.item.user)},change:function(){a.field.text="",a.$broadcast("focusField",!0)}},a.removeUser=function(b){a.users.splice(a.users.indexOf(b),1)},a.save=function(){for(var c=a.users.length-1;c>=0;c--){var d={title:"Usuário",type:"authors",desc:a.users[c].name,value:a.users[c].id};a.activeAdvancedFilters.push(d)}b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersReporterModalControllerModule",["FocusOnEventComponentModule","UsersServiceModule"]).controller("AdvancedFiltersReporterModalController",["$scope","$modalInstance","activeAdvancedFilters","UsersService",function(a,b,c,d){a.activeAdvancedFilters=c,a.users=[],a.field={},a.usersAutocomplete={options:{onlySelect:!0,source:function(a,b){var c=d.fetchAll({query:a.term,per_page:10});c.then(function(a){b(_.map(a,function(a){return{label:a.name,value:a.name,user:{id:a.id,name:a.name}}}))})},messages:{noResults:"",results:angular.noop}}},a.usersAutocomplete.events={select:function(b,c){for(var d=!1,e=a.users.length-1;e>=0;e--)a.users[e].id===c.item.user.id&&(d=!0);d||a.users.push(c.item.user)},change:function(){a.field.text="",a.$broadcast("focusField",!0)}},a.removeUser=function(b){a.users.splice(a.users.indexOf(b),1)},a.save=function(){for(var c=a.users.length-1;c>=0;c--){var d={title:"Relatados por",type:"reporters",desc:a.users[c].name,value:a.users[c].id};a.activeAdvancedFilters.push(d)}b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersCategoryModalControllerModule",[]).controller("AdvancedFiltersCategoryModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","categoriesResponse","entityType",function(a,b,c,d,e,f){a.entityType=f,b.resolvingRequest=!1,a.categories=[],a.activeAdvancedFilters=d;var g=[],h="undefined"!=typeof e.data?e.data:e;h.categories&&(h=h.categories);var i=angular.copy(h);_.each(i,function(a){if(null!==a.parent_id){var b=i.indexOf(_.findWhere(i,{id:a.parent_id}));if(b===-1)return!1;var c=i.indexOf(a);_.isUndefined(i[b].subcategories)?i[b].subcategories=[a]:i[b].subcategories.push(a),i[c]=void 0}}),i=_.without(i,void 0),a.categories=i,_.each(a.activeAdvancedFilters,function(a){"categories"==a.type&&g.indexOf(a.value)===-1&&g.push(a.value)}),a.isActive=function(a){return g.indexOf(a.id)!==-1},a.updateCategory=function(a){var b=g.indexOf(a.id);b===-1?g.push(a.id):g.splice(b,1)},a.save=function(){_.each(g,function(b){var c=_.where(h,{id:b})[0];if(!_.any(a.activeAdvancedFilters,function(a){return"categories"==a.type&&a.value==c.id})){var d={title:"Categoria",type:"categories",desc:c.title,value:c.id};a.activeAdvancedFilters.push(d)}}),_.each(a.activeAdvancedFilters,function(b,c){b&&"categories"==b.type&&g.indexOf(b.value)===-1&&a.activeAdvancedFilters.splice(c,1)}),c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersGroupModalControllerModule",[]).controller("AdvancedFiltersGroupModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","groupsResponse",function(a,b,c,d,e){a.groups=[],a.activeAdvancedFilters=d;var f=[];a.groups="undefined"!=typeof e.data?e.data:e,_.each(a.activeAdvancedFilters,function(a){"groups"===a.type&&f.indexOf(a.value)===-1&&f.push(a.value)}),a.isActive=function(a){return f.indexOf(a.id)!==-1},a.updateGroup=function(a){var b=f.indexOf(a.id);b===-1?f.push(a.id):f.splice(b,1)},a.save=function(){_.each(f,function(b){var c=_.where(a.groups,{id:b})[0];if(!_.any(a.activeAdvancedFilters,function(a){return"groups"==a.type&&a.value==c.id})){var d={title:"Grupo",type:"groups",desc:c.name,value:c.id};a.activeAdvancedFilters.push(d)}}),_.each(a.activeAdvancedFilters,function(b,c){b&&"groups"==b.type&&f.indexOf(b.value)===-1&&a.activeAdvancedFilters.splice(c,1)}),c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersShapefileModalControllerModule",[]).controller("AdvancedFiltersShapefileModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","perimetersResponse","$log",function(a,b,c,d,e,f){b.resolvingRequest=!1,a.perimeters=[],a.activeAdvancedFilters=d,a.search={};var g=[],h=a.perimeters=_.map(e,function(a,b){return a});_.each(a.activeAdvancedFilters,function(a){"shapefiles"==a.type&&g.indexOf(a.value)===-1&&g.push(a.value)}),a.isActive=function(a){return g.indexOf(a.id)!==-1},a.updateShapefile=function(a){var b=g.indexOf(a.id);b===-1?g.push(a.id):g.splice(b,1)},a.save=function(){_.each(g,function(b){var c=_.where(h,{id:b})[0];if(!_.any(a.activeAdvancedFilters,function(a){return"perimeters"==a.type&&a.value==c.id})){var d={title:"Perímetro de encaminhamento",type:"shapefiles",desc:c.title,value:c.id};a.activeAdvancedFilters.push(d)}}),_.each(a.activeAdvancedFilters,function(b,c){b&&"perimeters"==b.type&&g.indexOf(b.value)===-1&&a.activeAdvancedFilters.splice(c,1)}),c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersFieldsModalControllerModule",["FieldsFilterItemComponentModule","InventoriesCategoriesServiceModule"]).controller("AdvancedFiltersFieldsModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","categoriesResponse","InventoriesCategoriesService",function(a,b,c,d,e,f){b.resolvingRequest=!1,a.categories=e.data?e.data:e,a.categories.categories&&(a.categories=a.categories.categories),a.activeAdvancedFilters=d,a.items=[],a.methods=[{condition:"greater_than",canSelectMultiple:!1,text:"Maior que",availableKinds:["text","integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle"]},{condition:"lesser_than",canSelectMultiple:!1,text:"Menor que",availableKinds:["text","integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle"]},{condition:"equal_to",canSelectMultiple:!1,text:"Igual a",availableKinds:["text","integer","decimal","checkbox","radio","select","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time","cpf","cnpj","url","email"]},{condition:"different",canSelectMultiple:!1,text:"Diferente de",availableKinds:["text","integer","decimal","checkbox","radio","select","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time","cpf","cnpj","url","email"]},{condition:"like",canSelectMultiple:!1,text:"Parecido com",availableKinds:["text","integer","decimal","meters","centimeters","kilometers","years","months","days","hours","seconds","angle","date","time","cpf","cnpj","url","email"]},{condition:"includes",canSelectMultiple:!0,text:"Inclui",availableKinds:["checkbox","radio","select"]},{condition:"excludes",canSelectMultiple:!0,text:"Não inclui",availableKinds:["checkbox","radio","select"]}],a.newField={category:null,condition:null,field:null,value:null},a.selectCategory=function(b){a.loading=!0,a.newField.category=!1;var c=f.getCategory(b.id);c.then(function(b){a.newField.category=b.data,a.newField.condition=null,a.newField.field=null,a.newField.value=null,a.newField.fieldId=null,a.loading=!1})},a.selectCondition=function(b){a.newField.condition=b},a.$watch("newField.fieldId",function(){if(null!==a.newField.category&&null!==a.newField.fieldId)for(var b=a.newField.category.sections.length-1;b>=0;b--)for(var c=a.newField.category.sections[b],d=c.fields.length-1;d>=0;d--)c.fields[d].id==a.newField.fieldId&&(a.newField.field=c.fields[d],a.selectCondition(null))}),a.selectField=function(b){a.newField.field=b},a.addItem=function(){a.items.push(angular.copy(a.newField)),a.newField.condition=null,a.newField.field=null,a.newField.value=null,a.newField.fieldId=null},a.save=function(){for(var b=a.items.length-1;b>=0;b--){var d={title:"Campo",type:"fields",desc:a.items[b].field.label+": "+a.items[b].condition.text+" "+a.items[b].value,value:{id:a.items[b].field.id,condition:a.items[b].condition.condition,value:a.items[b].value}};a.activeAdvancedFilters.push(d)}c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersQueryModalControllerModule",[]).controller("AdvancedFiltersQueryModalController",["$scope","$modalInstance","activeAdvancedFilters",function(a,b,c){a.input={},a.save=function(){var d={title:"Protocolo ou endereço",desc:a.input.query,type:"query",value:a.input.query};c.push(d),b.close()},a.close=function(){b.close()}}]),angular.module("AdvancedFiltersShareModalControllerModule",["CopyTextComponentModule"]).controller("AdvancedFiltersShareModalController",["$scope","$modalInstance","$q","url",function(a,b,c,d){a.url=d,a.close=function(){b.close()}}]),angular.module("AdvancedFiltersStatusModalControllerModule",["SlideComponent"]).controller("AdvancedFiltersStatusModalController",["$scope","$rootScope","$modalInstance","activeAdvancedFilters","categoriesResponse","entityType",function(a,b,c,d,e,f){b.resolvingRequest=!1;var g="undefined"!=typeof e.data?e.data:e;a.entityType=f,a.statuses=[],a.categories=[],a.search={};var h=function(b){_.each(b.statuses,function(b){var c=_.findWhere(a.statuses,{id:b.id});_.isUndefined(c)&&a.statuses.push(b)})};g.categories&&(g=g.categories),_.each(g,function(b){a.categories.push(b),h(b),_.each(b.subcategories,function(b){a.categories.push(b),addStatusFromCategory(b)})}),a.updateStatus=function(a){"undefined"==typeof a.selected||a.selected===!1?a.selected=!0:a.selected=!1},a.save=function(){for(var b={},e=[],f=a.categories.length-1;f>=0;f--)for(var g=a.categories[f].statuses.length-1;g>=0;g--)a.categories[f].statuses[g].selected===!0&&(b[a.categories[f].statuses[g].id]=a.categories[f].statuses[g],e.indexOf(a.categories[f])===-1&&e.push(a.categories[f])),a.categories[f].statuses[g].selected=!1;for(var h in b){var i={title:"Estado",type:"statuses",desc:b[h].title,value:b[h].id};d.push(i)}c.close()},a.close=function(){c.close()}}]),angular.module("AdvancedFiltersNotificationMinimumNumberModalControllerModule",["FormInputValidatorIntegerComponentModule"]).controller("AdvancedFiltersNotificationMinimumNumberModalController",["Restangular","$scope","$modalInstance","activeAdvancedFilters",function(a,b,c,d){b.input={value:null},b.save=function(){var a={title:"Quantidade mínima de",desc:b.input.value+(+b.input.value>1?" notificações":" notificação"),type:"minimumNotificationNumber",value:b.input.value};d.push(a),c.close()},b.close=function(){c.close()}}]),angular.module("AdvancedFiltersNotificationDeadlineModalControllerModule",["FormInputSliderRangeComponentModule"]).controller("AdvancedFiltersNotificationDeadlineModalController",["Restangular","$scope","$modalInstance","activeAdvancedFilters",function(a,b,c,d){b.input={values:{begin:null,end:null}},b.save=function(){var a=b.input.values,e=a.begin,f=a.end;e=e?e:0,f=f?f:90,a.begin=e,a.end=f;var g={title:"Vencimento da última notificação",desc:e+" a "+f+" dias",type:"daysForLastNotificationDeadline",value:b.input.values};d.push(g),c.close()},b.close=function(){c.close()}}]),angular.module("AdvancedFiltersNotificationOverdueModalControllerModule",["FormInputSliderRangeComponentModule"]).controller("AdvancedFiltersNotificationOverdueModalController",["Restangular","$scope","$modalInstance","activeAdvancedFilters",function(a,b,c,d){b.input={values:{begin:null,end:null}},b.save=function(){var a=b.input.values,e=a.begin,f=a.end;e=e?e:0,f=f?f:90,a.begin=e,a.end=f;var g={title:"Notificações vencidas",desc:e+" a "+f+" dias",type:"daysForOverdueNotification",value:b.input.values};d.push(g),c.close()},b.close=function(){c.close()}}]),angular.module("AdvancedFiltersNotificationSinceLastModalControllerModule",["FormInputSliderRangeComponentModule"]).controller("AdvancedFiltersNotificationSinceLastModalController",["Restangular","$scope","$modalInstance","activeAdvancedFilters",function(a,b,c,d){b.input={values:{begin:null,end:null}},b.save=function(){var a=b.input.values,e=a.begin,f=a.end;e=e?e:0,f=f?f:90,a.begin=e,a.end=f;var g={title:"Última notificação emitida há",desc:e+" a "+f+" dias",type:"daysSinceLastNotification",value:b.input.values};d.push(g),c.close()},b.close=function(){c.close()}}]),angular.module("ReportsCategoriesManageStatusesModalControllerModule",["ReportStatusComponentModule","FlowsServiceModule"]).controller("ReportsCategoriesManageStatusesModalController",["$scope","$modalInstance","category","updating","categoryId","Restangular","FlowsService",function(a,b,c,d,e,f,g){a.category=c,a.newStatus={},a.updating=d,a.categoryId=e,a.updateStatuses={},f.all("groups").getList({return_fields:"id,name"}).then(function(b){a.groups=b.data}),a.availableColors=["#59B1DF","#7DDCE2","#64D2AF","#5CB466","#99C450","#EACD31","#F3AC2E","#F18058","#EF4D3E","#E984FC","#A37FE1","#7A7AF2"],a.createStatus=function(){if(""!==a.newStatus.title){var b={title:a.newStatus.title,color:"#FFFFFF",initial:"false","final":"false",active:"true","private":"false"};if(d){var c=f.one("reports").one("categories",e).post("statuses",b);c.then(function(b){a.category.statuses.push(f.stripRestangular(b.data)),a.newStatus.title=""})}else a.category.statuses.push(b),a.newStatus.title=""}},a.changeInitial=function(b){for(var c=a.category.statuses.length-1;c>=0;c--)b!==a.category.statuses[c]&&(a.category.statuses[c].initial=!1);b.initial=!0},a.removeStatus=function(b){if("undefined"!=typeof b.id){var c=f.one("reports").one("categories",e).one("statuses",b.id).remove();c.then(function(){a.category.statuses.splice(a.category.statuses.indexOf(b),1)})}else a.category.statuses.splice(a.category.statuses.indexOf(b),1)},a.close=function(){if(d)for(var c in a.updateStatuses){var g=angular.copy(a.updateStatuses[c]);g.initial=g.initial.toString(),g["final"]=g["final"].toString(),g.active=g.active.toString(),g["private"]=g["private"].toString();var h=f.one("reports").one("categories",e).one("statuses",g.id).customPUT(g);h.then(function(){})}b.close()};var h;a.getFlowList=function(){return h=h||g.fetchAll({return_fields:"id,title"})},a.selectFlow=function(a,b){b.flow_id=a.id,b.flow_title=a.title},a.unselectFlow=function(a,b){(b.flow||b.flow_id)&&(b.flow=null,b.flow_id=null,b.flow_title=null)},_.each(a.category.statuses,function(a){a.flow&&(a.selectedFlowsId=[a.flow.id])})}]),angular.module("ReportsCategoriesDestroyModalControllerModule",["ReportsCategoriesServiceModule"]).controller("ReportsCategoriesDestroyModalController",["$scope","$modalInstance","Restangular","destroyCategory","category","ReportsCategoriesService",function(a,b,c,d,e,f){a.category=e,a.confirm=function(){a.deleting=!0;var e=c.one("reports").one("categories",a.category.id).remove();e.then(function(){f.purgeCache(),a.deleting=!1,b.close(),a.showMessage("ok","A categoria de relato foi removida com sucesso","success",!0),d(a.category)})},a.close=function(){b.close()}}]),angular.module("ReportsCategoriesNotificationsLayoutControllerModule",["ckeditor","angularLoad"]).controller("ReportsCategoriesNotificationsLayoutController",["$scope","$rootScope","$timeout","$location","$anchorScroll","$modalInstance","$log","parentScope","notificationType","angularLoad","ENV",function(a,b,c,d,e,f,g,h,i,j,k){g.info("ReportsCategoriesNotificationsLayoutController created."),a.$on("$destroy",function(){g.info("ReportsCategoriesNotificationsLayoutController destroyed.")});var l=angular.copy(i.layout);a.notificationTypeOnLayoutModal=i,a.loadingCkeditorScript=!0,g.info("ckeditorPath: "+k.ckeditorPath),
j.loadScript(k.ckeditorPath).then(function(){a.loadingCkeditorScript=!1}),a.$on("$locationChangeStart",function(b){b.preventDefault(),a.closeLayoutNotificationTypeModal()}),a.closeLayoutNotificationTypeModal=function(){return l||0!==a.notificationTypeOnLayoutModal.layout.length?void(angular.equals(l,a.notificationTypeOnLayoutModal.layout)?f.close():window.confirm("Você tem certeza que deseja sair? Há alterações que não foram salvas.")&&(a.notificationTypeOnLayoutModal.layout=angular.copy(l),f.close())):void f.close()},a.saveLayoutNotificationType=function(){angular.equals(l,a.notificationTypeOnLayoutModal.layout)||h.verifyDirtyNotificationTypeMemento(h.notificationTypeOriginator),f.close()}}]),angular.module("ItemsDestroyModalControllerModule",["InventoriesItemsServiceModule"]).controller("ItemsDestroyModalController",["$scope","Restangular","InventoriesItemsService","$modalInstance","item","category",function(a,b,c,d,e,f){a.item=e,a.confirm=function(){var b=c.remove(a.item.id,f.id);b.then(function(){d.close(),a.showMessage("ok","O item de inventário "+a.item.title+" foi removido com sucesso","success",!0)})},a.close=function(){d.close()}}]),angular.module("ItemsRestoreModalControllerModule",[]).controller("ItemsRestoreModalController",["$scope","$modalInstance","setItemData","clearData",function(a,b,c,d){a.restore=function(){c(),b.close()},a.close=function(){d(),b.close()}}]),function(a,b){"use strict";a.module("ItemsSelectAddressModalControllerModule",["SelectLatLngMapComponent","SearchLatLngMapComponent"]).controller("ItemsSelectAddressModalController",["$scope","$modalInstance","category","updating","itemData","locationFieldsIds",function(a,c,d,e,f,g){a.updating=e,a.category=d,a.latLng=[f[g[0]],f[g[1]]],a.close=function(){c.close()},a.save=function(){f[g[0]]=a.latLng[0],f[g[1]]=a.latLng[1],f[g[2]]=null,f[g[3]]=null,f[g[4]]=null,f[g[5]]=null,f[g[6]]=null,b.isEmpty(a.addressComponents)||b.each(a.addressComponents,function(a){var c=a.types[0];"route"===c&&(null!==f[g[2]]?f[g[2]]=a.long_name+", "+f[g[2]]:f[g[2]]=a.long_name),"street_number"===c&&(null!==f[g[2]]?f[g[2]]=f[g[2]]+", "+a.long_name:f[g[2]]=a.long_name),b.contains(["sublocality_level_1","sublocality"],a.types[1])&&(f[g[4]]=a.long_name),"locality"===c&&(f[g[5]]=a.long_name),"administrative_area_level_1"===c&&(f[g[6]]=a.long_name),b.contains(["postal_code","postal_code_prefix"],c)&&(f[g[3]]=a.long_name)}),c.close()}}])}(angular,_),angular.module("FieldHistoryModalControllerModule",[]).controller("FieldHistoryModalController",["$rootScope","$scope","$modalInstance","Restangular","itemHistoryResponse","itemId","field",function(a,b,c,d,e,f,g){var h=function(a){for(var b=[],c=0;c<a.length;c++){var d={},e=a[c];d.user=e.user,d.created_at=e.created_at,d.changes=_.filter(e.fields_changes,function(a){return a.field.id==g.id})[0],b.push(d)}return b};b.historyLogs=h(e.data),b.field=g,a.resolvingRequest=!1,b.isArray=_.isArray,b.refreshHistory=function(){var a={object_id:g.id};b.historyFilterBeginDate&&(a["created_at[begin]"]=b.historyFilterBeginDate),b.historyFilterEndDate&&(a["created_at[end]"]=b.historyFilterEndDate),b.loadingHistoryLogs=!0;var c=d.one("inventory").one("items",f).one("history").getList(null,a);c.then(function(a){b.historyLogs=h(a.data),b.loadingHistoryLogs=!1})},b.availableHistoryDateFilters=[{name:"Hoje",beginDate:moment().startOf("day").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Ontem",beginDate:moment().subtract(1,"days").startOf("day").format(),endDate:moment().subtract(1,"days").endOf("day").format(),selected:!1},{name:"Este mês",beginDate:moment().startOf("month").format(),endDate:moment().endOf("day").format(),selected:!1},{name:"Mês passado",beginDate:moment().subtract(1,"months").startOf("month").format(),endDate:moment().subtract(1,"months").subtract(1,"days").endOf("day").format(),selected:!1},{name:"Todos",beginDate:null,endDate:null,selected:!0}],b.showCustomDateFields=function(){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),b.showCustomDateHelper=!0},b.selectDateFilter=function(a){_.each(b.availableHistoryDateFilters,function(a){a.selected=!1}),a.selected=!a.selected,b.historyFilterBeginDate=a.beginDate,b.historyFilterEndDate=a.endDate,b.showCustomDateHelper=!1,b.refreshHistory()},b.close=function(){c.close()}}]),angular.module("ItemsCategoriesDestroyModalControllerModule",["InventoriesCategoriesServiceModule"]).controller("ItemsCategoriesDestroyModalController",["Restangular","$scope","$modalInstance","inventoriesCategoriesList","category","$cookies","InventoriesCategoriesService",function(a,b,c,d,e,f,g){b.category=e,b.confirm=function(){b.deletePromise=a.one("inventory").one("categories",b.category.id).remove(),b.deletePromise.then(function(){delete f.inventoryFiltersHash,d.splice(d.indexOf(b.category),1),b.showMessage("ok","A categoria de inventário foi removida com sucesso.","success",!0),g.purgeCache(),c.close()})},b.close=function(){c.close()}}]),function(a){"use strict";function b(b,c,d,e,f,g,h,i){function j(){var d=a.copy(b.category.color);b.category.color=b.color,b.loading=!0;var e=i();e.then(function(){c.close(),b.loading=!1})["catch"](function(){b.category.color=d})}function k(){c.close()}function l(){b.color=a.copy(d.color),b.category=d,b.uploaderQueue=e,b.icon=d.original_icon;var c=b.uploader=new f;c.filters.push(h(c.isHTML5)),c.filters.push(g),c.onAfterAddingFile=function(){b.$apply(function(){b.uploaderQueue.items=c.queue})}}b.save=j,b.close=k,l()}function c(a,b){return{open:function(c,d,e){var f=b.defer();return a.open({templateUrl:"modals/items/categories/edit-options/items-categories-edit-options.template.html",windowClass:"editCategory",resolve:{category:function(){return c},uploaderQueue:function(){return d},send:function(){return function(){return e()}}},controller:"ItemsCategoriesEditOptionsModalController"}),f.promise}}}a.module("ItemsCategoriesEditOptionsModalControllerModule",["NgThumbComponentModule"]).controller("ItemsCategoriesEditOptionsModalController",b).factory("ItemsCategoriesEditOptionsModalService",c),b.$inject=["$scope","$modalInstance","category","uploaderQueue","FileUploader","singleItemUploaderFilter","onlyImagesUploaderFilter","send"],c.$inject=["$modal","$q"]}(angular),angular.module("ItemsCategoriesEditFieldValuesModalControllerModule",["InventorySingleValueComponentModule"]).controller("ItemsCategoriesEditFieldValuesModalController",["$scope","$modalInstance","field","Restangular","setFieldOptions",function(a,b,c,d,e){a.showErrors=!1,a.errors=[],a.field=angular.copy(c),a.value={importing:!1},a.isExistingField="undefined"!=typeof a.field.id&&a.field.id,null===a.field.field_options&&(a.field.field_options=[]),a.toggleImport=function(){a.value.importing=!a.value.importing};var f=function(b){var c=_.findWhere(a.field.field_options,{value:b});return!angular.isUndefined(c)},g=function(a){return d.all("inventory").one("fields",c.id).post("options",a)};a.newValue=function(){if(!a.loadingValue){if(a.loadingValue=!0,a.showErrors=!1,a.errors=[],a.value.importing===!0&&(!a.value.multipleOptionsText||0===a.value.multipleOptionsText.length))return a.errors.push("Você precisa de pelo menos um item para importar valores;"),a.showErrors=!0,void(a.loadingValue=!1);if(a.value.importing===!1&&(!a.value.text||0===a.value.text.length))return a.errors.push("O nome da opção não pode ficar em branco;"),a.showErrors=!0,void(a.loadingValue=!1);if(a.value.importing===!0){for(var b=a.value.multipleOptionsText.split(/\n/),c=[],d=b.length-1;d>=0;d--)f(b[d])&&a.errors.push("A opção "+b[d]+" já existe;"),c.push(b[d]);if(0!==a.errors.length)return a.showErrors=!0,void(a.loadingValue=!1);if(a.isExistingField)g({value:c}).then(function(b){a.loadingValue=!1,a.field.field_options.concat(b.data),e(a.field.field_options)});else{for(var d=c.length-1;d>=0;d--)a.field.field_options.push({value:c[d],disabled:!1});a.loadingValue=!1,e(a.field.field_options)}}else{if(f(a.value.text))return a.errors.push("A opção "+a.value.text+" já existe;"),a.showErrors=!0,void(a.loadingValue=!1);var h={value:a.value.text,disabled:!1};a.isExistingField?g(h).then(function(b){a.loadingValue=!1,a.field.field_options.push(b.data),e(a.field.field_options)}):(a.field.field_options.push(h),a.loadingValue=!1,e(a.field.field_options))}a.value.multipleOptionsText=null,a.value.text=null}},a.clear=function(){a.field.field_options=[],e([])},a.close=function(){b.close()},a.save=function(){e(a.field.field_options),b.close()}}]),angular.module("ItemsCategoriesNewStatusModalControllerModule",[]).controller("ItemsCategoriesNewStatusModalController",["$scope","Restangular","$modalInstance","statuses","updating","categoryId",function(a,b,c,d,e,f){a.status={color:"#2FB4E6"},a.save=function(){if(e){var g=b.one("inventory").one("categories",f).post("statuses",{title:a.status.title,color:a.status.color});g.then(function(a){d.push(b.stripRestangular(a.data)),c.close()})}else d.push({title:a.status.title,color:a.status.color}),c.close()},a.close=function(){c.close()}}]),angular.module("ItemsCategoriesEditStatusModalControllerModule",[]).controller("ItemsCategoriesEditStatusModalController",["$scope","Restangular","$modalInstance","status","updating","categoryId",function(a,b,c,d,e,f){a.status=angular.copy(d),a.save=function(){if(e){var g=b.one("inventory").one("categories",f).one("statuses",d.id).customPUT(a.status);g.then(function(){d.title=a.status.title,d.color=a.status.color,c.close()})}else d.title=a.status.title,d.color=a.status.color,c.close()},a.close=function(){c.close()}}]),angular.module("ItemsSelectModalModule",["InventoriesItemsServiceModule"]).controller("ItemsSelectModalController",["$scope","InventoriesItemsService","$modalInstance","insertedItems","permittedCategories","multiple",function(a,b,c,d,e,f){function g(){a.loadingPagination=!1,a.items=[],a.insertedItems=angular.copy(d),a.getItems()}var h=1,i=35;a.getItems=function(c){var d={page:h,per_page:i,inventory_categories_ids:e.join()};c&&(d.query=c),a.loadingPagination=!0,b.fetchAll(d).then(function(b){a.loadingPagination=!1,a.items=_.toArray(b)})},a.close=function(){c.dismiss()},a.confirm=function(){c.close(a.insertedItems)},a.insertItem=function(b){f?a.insertedItems.push(b):a.insertedItems[0]=b},a.removeItem=function(b){a.insertedItems.splice(a.insertedItems.indexOf(b),1)},a.isInsertedItems=function(b){return _.contains(a.insertedItems,b)},g()}]).factory("ItemsSelectModalService",["$modal",function(a){return{open:function(b,c,d){return a.open({templateUrl:"modals/items/select/items-select.template.html",windowClass:"itemsSelectModal",resolve:{insertedItems:function(){return b},permittedCategories:function(){return c},multiple:function(){return d}},controller:"ItemsSelectModalController",controllerAs:"itemsSelectModalCtrl"}).result}}}]),angular.module("UsersDisableModalControllerModule",[]).controller("UsersDisableModalController",["Restangular","$scope","$modalInstance","user",function(a,b,c,d){b.user=d,b.confirm=function(){var e=a.one("users",b.user.id).remove();e.then(function(){c.close(),b.showMessage("ok","O Usuário "+b.user.name+" foi desativado com sucesso.","success",!1),d.disabled=!0})},b.close=function(){c.close()}}]),angular.module("GalleryModalControllerModule",["panzoom","panzoomwidget","GalleryImageOnLoadComponentModule"]).controller("GalleryModalController",["$scope","$modalInstance","$window","image",function(a,b,c,d){a.loading=!0,a.image=d,"undefined"==typeof d.url&&(a.image.url=d.versions.original),a.$watch("imageDimensions",function(b,d){b!==d&&(a.panzoomConfig={zoomLevels:12,neutralZoomLevel:5,scalePerZoomLevel:1.5,useHardwareAcceleration:!0,initialPanX:$(c).width()/2-a.imageDimensions.width/2,initialPanY:$(c).height()/2-a.imageDimensions.height/2})}),a.panzoomModel={},a.close=function(){b.close()}}]),angular.module("ReportsSelectUserModalControllerModule",[]).controller("ReportsSelectUserModalController",["Restangular","$scope","$modalInstance","$q","setUser","filterByGroup",function(a,b,c,d,e,f){b.loadingPagination=!1,f&&(b.resultsFiltered=!0),b.sort={column:"",descending:!1},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1)},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending},b.setUser=function(a){e(a),c.close()};var g,h=1,i=30,j="",k="id,name,email,phone,group.id",l=function(){if(b.groupId)return""!==j?a.one("search").one("groups",b.groupId).all("users").getList({query:j,page:h,per_page:i,return_fields:k,global_namespaces:!0}):a.one("groups",b.groupId).all("users").getList({page:h,per_page:i,return_fields:k,global_namespaces:!0});if(b.groupId=null,""!==j){var c={query:j,page:h,per_page:i,global_namespaces:!0};return f&&(c.groups=f),c.return_fields=k,a.one("search").all("users").getList(c)}var c={page:h,per_page:i,global_namespaces:!0};return f&&(c.groups=f),c.return_fields=k,a.all("users").getList(c)},m=a.all("groups").getList({return_fields:"id,name",global_namespaces:!0});b.getGroupById=function(a){if(b.groups)return b.groups[a]};var n=b.getData=function(a){if(b.loadingPagination===!1){b.loadingPagination=!0;var c=l(),e=[c];return b.groups||e.push(m),d.all(e).then(function(c){if(b.groups||(b.groups=c[1].data),a!==!0)b.users=c[0].data;else{"undefined"==typeof b.users&&(b.users=[]);for(var d=0;d<c[0].data.length;d++)b.users.push(c[0].data[d]);h++}g=parseInt(c[0].headers().total);var e=Math.ceil(g/i);h===e+1?b.loadingPagination=null:b.loadingPagination=!1}),c}};b.search=function(a){j=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,n().then(function(){b.loadingContent=!1,h++})},b.selectGroup=function(a){b.groupId=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,n().then(function(){b.loadingContent=!1,h++})},b.close=function(){c.close()}}]),angular.module("ReportsCreateUserModalControllerModule",["ngCpfCnpj","UsersServiceModule"]).controller("ReportsCreateUserModalController",["UsersService","$scope","moment","$modalInstance","$q","setUser",function(a,b,c,d,e,f){b.user={},b.inputErrors=null,b.isObject=_.isObject,b.create=function(){b.inputErrors=null,b.processingForm=!0,b.user.birthdate&&(b.user.birthdate=c(b.user.birthdate,"DD/MM/YYYY").toJSON()),b.createUserPromise=a.create(b.user,{return_fields:"id,name",generate_password:!0}),b.createUserPromise.then(function(a){f(a),d.close(),b.processingForm=!1})["catch"](function(a){b.inputErrors=a,b.processingForm=!1})},b.close=function(){d.close()}}]),angular.module("ReportsEditDescriptionModalControllerModule",[]).controller("ReportsEditDescriptionModalController",["Restangular","$scope","$modalInstance","report","refreshHistory",function(a,b,c,d,e){b.report=angular.copy(d),b.save=function(){b.processingForm=!0;var f=a.one("reports",d.category.id).one("items",d.id).customPUT({description:b.report.description});f.then(function(a){e(),c.close(),b.processingForm=!1,d.description=b.report.description},function(a){b.processingForm=!1})},b.close=function(){c.close()}}]),angular.module("ReportsPerimetersModalControllerModule",["ReportsPerimetersServiceModule"]).controller("ReportsPerimetersModalController",["$scope","$modalInstance","$log","$rootScope","FileUploader","$q","parentScope","ReportsPerimetersService","Restangular",function(a,b,c,d,e,f,g,h,i){c.info("ReportsPerimetersModalController created."),a.$on("$destroy",function(){c.info("ReportsPerimetersModalController destroyed.")});var j=h;a.perimeter={},a.groups={},i.all("groups").getList({return_fields:"id,name"}).then(function(b){a.groups=b.data}),a.mandatoryCheckFlags=[!0,!0,!0];var k=a.uploaderShp=new e,l=a.uploaderShx=new e;k.filters.push(j.createFileUploaderFilter("shp",k)),l.filters.push(j.createFileUploaderFilter("shx",l));var m=function(){return a.mandatoryCheckFlags=[!0,!0,!0],0===k.queue.length&&(a.mandatoryCheckFlags[0]=!1),0===l.queue.length&&(a.mandatoryCheckFlags[1]=!1),a.perimeter.title||(a.mandatoryCheckFlags[2]=!1),a.mandatoryCheckFlags[0]&&a.mandatoryCheckFlags[1]&&a.mandatoryCheckFlags[2]},n=function(a){var b=f.defer(),c=new FileReader;return c.addEventListener("load",function(c){var d=c.target,e={};e.file_name=a.file.name,e.content=d.result.replace(/^data:;base64,/,""),b.resolve(e)}),c.readAsDataURL(a._file),b.promise};a.save=function(){if(c.info("Saving perimeter."),m()){var e=[];e.push(n(k.queue[0])),e.push(n(l.queue[0])),f.all(e).then(function(c){a.perimeter.shp_file=c[0],a.perimeter.shx_file=c[1],a.confirmPromise=j.addPerimeter(a.perimeter).then(function(){g.cleanCache(),g.getData(),d.showMessage("ok","Perímetro cadastrado com sucesso.","success",!1),b.close(),a.confirmPromise=null},function(){d.showMessage("exclamation-sign","Não foi possível cadastrar o perímetro, tente novamente.","error",!0),b.close(),a.confirmPromise=null})})}},a.close=function(){b.close()}}]),angular.module("ReportsSelectModalModule",["ItemSelectorDirectiveModule","ReportsItemsServiceModule","ConfigServiceModule"]).controller("ReportsSelectModalController",["$scope","$q","ReportsItemsService","ConfigService","$modalInstance","insertedReports","permittedCategories","multiple","lrInfiniteScroll",function(a,b,c,d,e,f,g,h,i){function j(){a.reports=[],a.insertedReports=angular.copy(f),a.loadingPagination=!0,k().then(function(){a.getReports()})}function k(){return d.getReportsColumns().then(function(b){a.activeColumns=_.filter(b,function(a){return a.active})})}function l(a){var b=["id","status_id","category_id","overdue"],c=function(a){return"custom_field"==a.type};return _.any(_.select(a,c))&&b.push("custom_fields"),a=_.reject(a,function(a){return"custom_field"==a.type}),a=_.map(a,function(a){switch(a.type){case"category":return"category.title";case"reporter":return["reporter.id","reporter.name"].join();case"user":return["user.id","user.name"].join();case"assignment":return["assigned_group.name","assigned_group.title","assigned_user.name","assigned_user.id"].join();case"priority":return"category.priority_pretty";default:return a.type}}),_.union(b,a).join()}var m=1,n=35;a.getReports=function(){var b={page:m,per_page:n,reports_categories_ids:g.join(),return_fields:l(a.activeColumns)};return a.loadingPagination=!0,c.fetchAll(b).then(function(b){a.reports=_.toArray(b),m++,a.loadingPagination=!1})},a.close=function(){e.dismiss()},a.confirm=function(){e.close(a.insertedReports)},a.insertReport=function(b){h?a.insertedReports.push(b.id):a.insertedReports[0]=b.id},a.removeReport=function(b){a.insertedReports.splice(a.insertedReports.indexOf(b.id),1)},a.isInsertedReport=function(b){return _.contains(a.insertedReports,b.id)},j()}]).factory("ReportsSelectModalService",["$modal",function(a){return{open:function(b,c,d){return a.open({templateUrl:"modals/reports/select/reports-select.template.html",windowClass:"reportsSelectModal",resolve:{insertedReports:function(){return b},permittedCategories:function(){return c},multiple:function(){return d}},controller:"ReportsSelectModalController",controllerAs:"reportsSelectModalCtrl"}).result}}}]),angular.module("ErrorModalControllerModule",[]).controller("ErrorModalController",["$scope","$rootScope","$modalInstance","$state","response","Raven","Auth",function(a,b,c,d,e,f,g){b.resolvingRoute=!1,b.resolvingRequest=!1,a.response=e,f.captureMessage(JSON.stringify(e)),a.ok=function(){c.close()},a.redoSession=function(){g.logout(),d.go("user.login"),c.close()}}]),angular.module("FlowsAddModalControllerModule",["FlowsServiceModule"]).controller("FlowsAddModalController",["$rootScope","$scope","$modalInstance","FlowsService","flows","Error",function(a,b,c,d,e,f){b.flow={},b.save=function(){b.savePromise=d.create(b.flow),b.savePromise.then(function(a){e.push(a),c.close(),b.showMessage("ok","O fluxo foi criado com sucesso","success",!0)},function(a){"object"!=typeof a.data.error?f.show(a):b.inputErrors=a.data.error})},b.close=function(){c.close()}}]),angular.module("FlowsEditModalControllerModule",["FlowsServiceModule"]).controller("FlowsEditModalController",["$scope","$modalInstance","Restangular","FlowsService","flows","flow",function(a,b,c,d,e,f){var g={"default":!1,active:!0,title:""};a.flow=angular.copy(f),a.resolutionState=angular.copy(g),a.validResolutionStateTitle=!1,a.update=function(){a.updatePromise=d.update(a.flow),a.updatePromise.then(function(c){e&&(e[e.indexOf(f)]=a.flow),a.showMessage("ok","O fluxo foi editado com sucesso!","success"),b.close(a.flow)})},a.close=function(){b.dismiss()},a.createResolutionState=function(){var b=_.findWhere(a.flow.resolution_states,{title:a.resolutionState.title,active:!1});b?(b["default"]=!1,b.active=!0):a.flow.resolution_states.push(angular.copy(a.resolutionState)),a.resolutionState=angular.copy(b),a.validResolutionStateTitle=!1},a.removeResolutionState=function(b){a.flow.resolution_states=_.map(a.flow.resolution_states,function(a){return a.title==b.title&&(a["default"]=!1,b.active=!1),a})},a.changeDefaultResolutionState=function(b){var c=_.findIndex(a.flow.resolution_states,b);_.each(a.flow.resolution_states,function(a,b){c!=b&&(a["default"]=!1)})};var h=function(b){return _.some(_.filter(a.flow.resolution_states,function(a){return a.active===!0&&a.title===b}))};a.validateResolutionStateTitle=function(b){a.validResolutionStateTitle=!(!(b&&b.length>0)||h(b))}}]),angular.module("FlowsDestroyModalControllerModule",["FlowsServiceModule"]).controller("FlowsDestroyModalController",["$scope","$modalInstance","FlowsService","flow","flows",function(a,b,c,d,e){a.flow=d,a.confirm=function(){var a=c.destroy(d.id);a.then(function(){b.close(),e.splice(e.indexOf(d),1)})},a.close=function(){b.close()}}]),angular.module("FlowsStepsAddModalControllerModule",[]).controller("FlowsStepsAddModalController",["$scope","$modalInstance","$q","Restangular","flow",function(a,b,c,d,e){a.flow={stepType:"form"},a.selectedFlow=null,a.selectFlow=function(b){a.selectedFlow=b};var f=d.one("flows",e.id).all("ancestors").getList(),g=d.all("flows").getList({display_type:"full"});c.all([g,f]).then(function(b){a.flows=b[0].data;for(var c=b[1].data,d=a.flows.length-1;d>=0;d--)c.indexOf(a.flows[d].id)!==-1&&(a.flows[d].hidden=!0)}),a.save=function(){var c;c="form"===a.flow.stepType?{title:a.flow.title,step_type:"form"}:{title:a.selectedFlow.title,step_type:"flow",child_flow_id:a.selectedFlow.id},a.saveStepPromise=d.one("flows",e.id).post("steps",c),a.saveStepPromise.then(function(a){e.my_steps.push(d.stripRestangular(a.data)),b.close()})},a.close=function(){b.close()}}]),angular.module("FlowsStepsDestroyModalControllerModule",[]).controller("FlowsStepsDestroyModalController",["$scope","$modalInstance","Restangular","step","flow",function(a,b,c,d,e){a.step=d,a.confirm=function(){var f=c.one("flows",e.id).one("steps",d.id).remove();f.then(function(){b.close(),e.my_steps.splice(e.my_steps.indexOf(a.step),1)})},a.close=function(){b.close()}}]),angular.module("FlowsStepsEditModalControllerModule",[]).controller("FlowsStepsEditModalController",["$scope","$modalInstance","Restangular","step","flow",function(a,b,c,d,e){a.step=angular.copy(d),a.update=function(){a.updateStepPromise=c.one("flows",e.id).one("steps",d.id).customPUT({title:a.step.title}),a.updateStepPromise.then(function(){d.title=a.step.title,b.close()})},a.close=function(){b.close()}}]),angular.module("CasesInactiveModalModule",["CasesServiceModule"]).controller("CasesInactiveModalController",["CasesService","$scope","$modalInstance","kase",function(a,b,c,d){b["case"]=d,b.confirm=function(){return a.inactive(d).then(function(){c.close(),b.showMessage("ok","O caso foi desativado com sucesso.","success",!1),d.status="inactive"})},b.close=function(){c.dismiss()}}]).factory("CasesInactiveModalService",["$modal",function(a){return{open:function(b){return a.open({templateUrl:"modals/cases/inactive/cases-inactive.template.html",windowClass:"casesInactiveModal",resolve:{kase:function(){return b}},controller:"CasesInactiveModalController",controllerAs:"casesInactiveModalCtrl"}).result}}}]),angular.module("CasesSelectConductorModalModule",["UsersSelectorInlineModule","CasesServiceModule"]).controller("CasesSelectConductorModalController",["$scope","$modalInstance","CasesService","kase","step",function(a,b,c,d,e){a.responsible={user:[],group:[]},a.permittedGroups=e.permissions.can_execute_step,a.isConductionModeOpen=e.conduction_mode_open,a.confirm=function(){var f={step_id:e.id};return _.isUndefined(a.responsible.user[0])?_.isUndefined(a.responsible.group[0])||(f.responsible_group_id=a.responsible.group[0].id):f.responsible_user_id=a.responsible.user[0].id,c.saveStep(d.id,f).then(function(a){b.close(a)})},a.close=function(){b.dismiss()}}]).factory("CasesSelectConductorModalService",["$modal",function(a){return{open:function(b,c){return a.open({templateUrl:"modals/cases/select-conductor/cases-select-conductor.template.html",windowClass:"casesSelectConductorModal",resolve:{kase:function(){return b},step:function(){return c}},controller:"CasesSelectConductorModalController",controllerAs:"casesSelectConductorModalCtrl"}).result}}}]),angular.module("CasesFinishModalModule",["CasesServiceModule"]).controller("CasesFinishModalController",["$scope","$modalInstance","CasesService","kase",function(a,b,c,d){console.log(d),a.resolutionStates=d.flow.my_resolution_states,a.resolutionState={},a.valid=function(){return!_.isEmpty(a.resolutionState)},a.confirm=function(){return c.finish(d,a.resolutionState.selected).then(function(){a.showMessage("ok","O caso foi finalizado com sucesso!","success",!0),b.close()})},a.close=function(){b.dismiss()}}]).factory("CasesFinishModalService",["$modal",function(a){return{open:function(b){return a.open({templateUrl:"modals/cases/finish/cases-finish.template.html",windowClass:"casesFinishModal",resolve:{kase:function(){return b}},controller:"CasesFinishModalController",controllerAs:"casesFinishModalCtrl"}).result}}}]),angular.module("GroupsEditModalControllerModule",[]).controller("GroupsEditModalController",["Restangular","FullResponseRestangular","$scope","$modalInstance","$state","group",function(a,b,c,d,e,f){c.group=angular.copy(f)||{name:"",permissions:{}},c.save=function(){c.processingForm=!0;var g;g=f?a.one("groups",f.id).customPUT({name:c.group.name}):b.one("groups").withHttpConfig({treatingErrors:!0}).post(null,c.group),g.then(function(a){c.processingForm=!1,f?(c.showMessage("ok","O grupo foi editado.","success",!0),f.name=c.group.name):(c.showMessage("ok","O grupo foi criado com sucesso.","success",!0),e.go("groups.show",{id:a.data.group.id})),d.close()},function(a){c.processingForm=!1,c.inputErrors=a.data.error})},c.isObject=_.isObject,c.close=function(){d.close()}}]),angular.module("GroupsAddUsersModalControllerModule",[]).controller("GroupsAddUsersModalController",["Restangular","$scope","$modalInstance","$q","$state","group",function(a,b,c,d,e,f){b.loadingPagination=!1,b.sort={column:"",descending:!1},b.changeSorting=function(a){var c=b.sort;c.column===a?c.descending=!c.descending:(c.column=a,c.descending=!1)},b.selectedCls=function(a){return a===b.sort.column&&"sort-"+b.sort.descending};var g,h=1,i=30,j="",k=function(){var c={query:j,page:h,per_page:i};return b.groupId?""!==j?a.one("search").one("groups",b.groupId).all("users").getList(c):a.one("groups",b.groupId).all("users").getList({page:h,per_page:i}):(b.groupId=null,""!==j?a.one("search").all("users").getList(c):a.all("users").getList({page:h,per_page:i}))},l=a.all("groups").getList({return_fields:"id,name"}),m=b.getData=function(a){if(b.loadingPagination===!1){b.loadingPagination=!0;var c=k(),e=[c];return b.groups||e.push(l),d.all(e).then(function(c){if(b.groups||(b.groups=c[1].data),a!==!0)b.users=c[0].data;else{"undefined"==typeof b.users&&(b.users=[]);for(var d=0;d<c[0].data.length;d++)b.users.push(c[0].data[d]);h++}g=parseInt(c[0].headers().total);var e=Math.ceil(g/i);h===e+1?b.loadingPagination=null:b.loadingPagination=!1}),c}};b.search=function(a){j=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,m().then(function(){b.loadingContent=!1,h++})},b.selectGroup=function(a){b.groupId=a,h=1,b.loadingPagination=!1,b.loadingContent=!0,m().then(function(){b.loadingContent=!1,h++})},b.usersToAdd=[],b.isUserSelected=function(a){return b.usersToAdd.indexOf(a)!==-1},b.addUser=function(a){f.users.filter(function(b){return b.id==a}).length>0?b.addModalMessage("exclamation-sign","Usuário já relacionado ao grupo.","error"):b.usersToAdd.push(a)},b.removeUser=function(a){b.usersToAdd.splice(b.usersToAdd.indexOf(a),1)},b.addUsers=function(){var d=a.one("groups",f.id).customPUT({users:b.usersToAdd});d.then(function(){b.showMessage("ok","Os usuários foram adicionados.","success",!0),e.go(e.current,{},{reload:!0}),c.close()})},b.close=function(){c.close()}}]),angular.module("GroupsRemoveUserModalControllerModule",[]).controller("GroupsRemoveUserModalController",["$scope","$modalInstance","removeUserFromList","user","group","Restangular",function(a,b,c,d,e,f){a.user=d,a.group=e,a.confirm=function(){var g=f.one("groups",e.id).all("users").remove({user_id:d.id});g.then(function(){b.close(),a.showMessage("ok","O Usuário "+a.user.name+" foi removido do grupo com sucesso","success",!0),c(a.user)})},a.close=function(){b.close()}}]),angular.module("UserPasswordRecoverModalControllerModule",[]).controller("UserPasswordRecoveryModalController",["Restangular","$scope","$modalInstance",function(a,b,c){b.user={email:null},b.confirm=function(){b.processingForm=!0;var c=a.one("recover_password").customPUT({email:b.user.email,panel:!0});c.then(function(){b.success=!0})},b.close=function(){c.close()}}]),function(a){"use strict";function b(a,b,c,d){b.service=d,b.confirm=function(){var e=a.one("services",b.service.id).remove();e.then(function(){c.close(),b.showMessage("ok","A aplicação "+b.service.name+" foi desativada com sucesso.","success",!1),d.disabled=!0})},b.close=function(){c.close()}}function c(a){function b(b){return a.open({templateUrl:"modals/services/disable/services-disable.template.html",windowClass:"removeModal",resolve:{service:function(){return b}},controller:"ServicesDisableModalController"}).result}var c={};return c.open=b,c}a.module("ServicesDisableModalControllerModule",[]).controller("ServicesDisableModalController",b).factory("ServicesDisableModalService",c),b.$inject=["Restangular","$scope","$modalInstance","service"],c.$inject=["$modal"]}(angular),angular.module("DisplayNotificationDirectiveModule",["ZupPrintDirectiveModule","ckeditor","angularLoad"]).directive("displayNotification",["$modal",function(a){return{restrict:"A",scope:{displayNotification:"&"},link:function(b,c,d){var e=function(c){c.preventDefault(),a.open({backdrop:"static",templateUrl:"directives/display-notification/display-notification.template.html",windowClass:"gallery-modal fade",resolve:{content:function(){return b.displayNotification()}},controller:"DisplayNotificationModalCtrl"})};c.on("click",e),b.$on("$destroy",function(){c.off("click",e)})}}}]).controller("DisplayNotificationModalCtrl",["$scope","$rootScope","$modalInstance","ENV","content","angularLoad",function(a,b,c,d,e,f){a.content=e,a.scriptLoaded=!1,a.close=function(){c.close()},f.loadScript(d.ckeditorPath).then(function(){a.scriptLoaded=!0}),a.$on("$locationChangeStart",function(a){a.preventDefault(),c.dismiss("locationChange")})}]),angular.module("ZupPrintDirectiveModule",[]).directive("zupPrint",function(){return{restrict:"A",link:function(a,b,c){function d(a){a.parentNode.removeChild(a)}function e(){var a=window.document,b=a.getElementById("zupPrintFrame");b&&d(b),b=a.createElement("iframe"),a.body.appendChild(b),b.id="zupPrintFrame",b.contentWindow.document.open(),b.contentWindow.document.write("<html><head><style>@page {size: A4; margin: 50px;}div.report-image { width: 100%; text-align: left; }div.report-image img { max-width: 150px; padding: 5px; }div.report-image span { display: inline-table; }</style></head><body></body></html>"),a.body.appendChild(b);var e=a.getElementById(c.zupPrint),g=e.cloneNode(!0);b.contentWindow.document.body.appendChild(g),b.contentWindow.document.close(),b.contentWindow.print(),f&&window.clearTimeout(f),f=window.setTimeout(d(b),2e3);
}b.on("click",function(a){a.preventDefault(),e()});var f=null}}}),angular.module("ConfirmDialogDirectiveModule",[]).directive("confirmDialog",["$modal",function(a){return{restrict:"A",scope:{cdModalTitle:"@",cdWarningMsg:"@",cdItemTitle:"&",cdConfirmText:"@",cdButtonLabel:"@",cdConfirmFunction:"&",cdConfirmPromise:"="},link:function(b,c,d){var e=function(c){c.preventDefault(),a.open({backdrop:"static",templateUrl:"directives/confirm-dialog/confirm-dialog.template.html",resolve:{cdModalTitle:function(){return b.cdModalTitle},cdWarningMsg:function(){return b.cdWarningMsg},cdItemTitle:function(){return b.cdItemTitle()},cdConfirmText:function(){return b.cdConfirmText},cdButtonLabel:function(){return b.cdButtonLabel},cdConfirmPromise:function(){return b.cdConfirmPromise},parentScope:function(){return b}},controller:"ConfirmDialogCtrl"})};c.on("click",function(a){e(a)}),c.off("click",function(a){e(a)})}}}]).controller("ConfirmDialogCtrl",["$scope","$modalInstance","$q","$timeout","cdModalTitle","cdWarningMsg","cdItemTitle","cdConfirmText","cdButtonLabel","cdConfirmPromise","parentScope",function(a,b,c,d,e,f,g,h,i,j,k){a.cdModalTitle=e,a.cdWarningMsg=f,a.cdItemTitle=g,a.cdConfirmText=h?h:"DELETAR",a.cdButtonLabel=i,a.cdConfirmPromise=j,a.confirmText="",a.close=function(){b.close()},a.disabled=function(){return!(a.confirmText&&angular.equals(a.confirmText.toLowerCase(),a.cdConfirmText))},a.confirm=function(){k.cdConfirmFunction(),b.close()},a.$on("$locationChangeStart",function(a){b.dismiss("locationChange"),a.preventDefault()})}]),angular.module("ZupChatDirectiveModule",["mentio","ChatServiceModule"]).directive("zupChat",function(){return{restrict:"E",templateUrl:"directives/zup-chat/zup-chat.template.html",scope:{user:"=",chattableType:"@",chattableId:"@"},link:function(a,b,c){var d=$(b).find(".zc-messages");d.scroll(function(){if(0==d.scrollTop()){var b=d.find(".zc-day-messages:first");a.loadMessages().then(function(a){a.length>1&&d.scrollTop(b.position().top)})}})},controller:["$scope","$element","$timeout","$log","$rootScope","ChatService",function(a,b,c,d,e,f){function g(){a.loadMessages().then(function(){i()})}function h(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function i(){c(function(){var a=$(b).find(".zc-messages");a.scrollTop(a[0].scrollHeight)})}var j=1,k=25;a.dayMessagesMap={},a.newMessage="",a.mentions={},a.showPostMessageBtn=!1,a.loadMessages=function(){var b={page:j,per_page:k};return a.loading=!0,f.listMessages(a.chattableType,a.chattableId,b).then(function(b){a.loading=!1;for(var c=b.data,d=c.length-1;d>=0;d--){var e=c[d],f=new Date(e.created_at),g=f.getFullYear()+h(f.getMonth(),2)+h(f.getDay(),2);a.dayMessagesMap[g]||(a.dayMessagesMap[g]={},a.dayMessagesMap[g].date=f,a.dayMessagesMap[g].messages=[]);var i=angular.extend(e,{hour:h(f.getHours(),2)+":"+h(f.getMinutes(),2)});a.dayMessagesMap[g].messages.push(i)}return j++,c})},a.getRawText=function(b){return a.mentions[b.name]=b.id,"[~"+b.name+"]"},a.searchItem=function(b){a.items=[];var c=/U\d/g;c.test(b)||f.autoCompleteUser(b).then(function(b){a.items=b.data})},a.postMessage=function(){""!=a.newMessage&&(a.newMessage=a.newMessage.replace(/\[~(.*)\]/,function(b,c){return"@["+a.mentions[c]+":"+c+"]"}),f.postMessage(a.newMessage,a.chattableType,a.chattableId).then(function(b){e.showMessage("ok","Mensagem postada com sucesso!","success",!1);var c=b.data,d=new Date(c.created_at),f=d.getFullYear()+h(d.getMonth(),2)+h(d.getDay(),2);a.dayMessagesMap[f]||(a.dayMessagesMap[f]={},a.dayMessagesMap[f].date=d,a.dayMessagesMap[f].messages=[]);var c=angular.extend(c,{hour:h(d.getHours(),2)+":"+h(d.getMinutes(),2)});a.dayMessagesMap[f].messages.push(c),a.newMessage="",i()})["catch"](function(){e.showMessage("exclamation-sign","Não foi possivel postar a mensagem. Por favor, tente novamente.","success",!1)}))},g()}]}}).directive("zcTextWithMentions",["$compile",function(a){return{restrict:"A",scope:{zcTextWithMentions:"=zcTextWithMentions"},link:function(b,c,d){function e(a){return a.replace(/@\[(.*):(.*)\]/,function(a,b,c){return'<a href="#/users/'+b+'">'+c+"</a>"})}function f(){var d=angular.element("<div></div>").html(e(b.zcTextWithMentions)).contents(),f=a(d);c.html(""),c.append(d),f(b)}f(),b.$watch("zcTextWithMentions",function(a,b){f()})}}}]),angular.module("FormatErrorsHelperModule",[]).filter("formatErrors",["$sce","$filter",function(a,b){return function(c){var d=[];for(var e in c)for(var f=0;f<c[e].length;f++){var g=b("translateErrors")(e),h=g.charAt(0).toUpperCase()+g.slice(1);d.push(h+" "+b("translateErrors")(c[e][f]))}return a.trustAsHtml(d.join("<br>"))}}]),angular.module("ReplaceDotWithCommaHelperModule",[]).filter("replaceDotWithComma",function(){return function(a){if("undefined"!=typeof a)return a.replace(".",",")}}),angular.module("TranslateErrorsHelperModule",[]).filter("translateErrors",function(){return function(a){var b={"is missing":"não pode estar em branco",statuses:"status de relatos",title:"título",icon:"ícone",marker:"marcador",color:"Cor",password:"Senha",document:"CPF",name:"Nome"};return"undefined"!=typeof b[a]?b[a]:a}}),angular.module("DiacriticsInsensitiveFilterHelperModule",[]).filter("diacriticsInsensitiveFilter",["$filter",function(a){return function(a,b){function c(a){if(!_.isUndefined(a))return a.replace(/([àáâãäå])|([ç])|([èéêë])|([ìíîï])|([ñ])|([òóôõöø])|([ß])|([ùúûü])|([ÿ])|([æ])/g,function(a,b,c,d,e,f,g,h,i,j,k){return b?"a":c?"c":d?"e":e?"i":f?"n":g?"o":h?"s":i?"u":j?"y":k?"ae":void 0})}for(var d=0;d<a.length;d++)console.log(c(a[d]),b);return!1}}]),angular.module("FilterGoogleAddressComponentsHelperModule",[]).filter("filterGoogleAddressComponents",function(){return function(a){var b={};return _.each(a,function(a){_.each(a.types,function(c){"route"===c?b.address=a.long_name:"sublocality_level_1"===c?b.neighborhood=a.long_name:"sublocality"===c?b.neighborhood=a.long_name:"locality"===c?b.city=a.long_name:"administrative_area_level_1"===c?b.state=a.short_name:"country"===c?b.country=a.long_name:"street_number"===c?b.number=a.long_name:"postal_code_prefix"===c?b.zipcode=a.long_name:"postal_code"===c&&(b.zipcode=a.long_name)})}),b}});